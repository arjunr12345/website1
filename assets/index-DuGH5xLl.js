(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();var ro=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lx(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var pf={exports:{}},Ea={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q0;function ox(){if(q0)return Ea;q0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,l){var o=null;if(l!==void 0&&(o=""+l),s.key!==void 0&&(o=""+s.key),"key"in s){l={};for(var c in s)c!=="key"&&(l[c]=s[c])}else l=s;return s=l.ref,{$$typeof:a,type:i,key:o,ref:s!==void 0?s:null,props:l}}return Ea.Fragment=e,Ea.jsx=t,Ea.jsxs=t,Ea}var Y0;function ux(){return Y0||(Y0=1,pf.exports=ox()),pf.exports}var _=ux(),yf={exports:{}},_e={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X0;function cx(){if(X0)return _e;X0=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function y(w){return w===null||typeof w!="object"?null:(w=m&&w[m]||w["@@iterator"],typeof w=="function"?w:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,x={};function T(w,Y,J){this.props=w,this.context=Y,this.refs=x,this.updater=J||S}T.prototype.isReactComponent={},T.prototype.setState=function(w,Y){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,Y,"setState")},T.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function R(){}R.prototype=T.prototype;function D(w,Y,J){this.props=w,this.context=Y,this.refs=x,this.updater=J||S}var A=D.prototype=new R;A.constructor=D,E(A,T.prototype),A.isPureReactComponent=!0;var O=Array.isArray,I={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function M(w,Y,J,ne,oe,he){return J=he.ref,{$$typeof:a,type:w,key:Y,ref:J!==void 0?J:null,props:he}}function F(w,Y){return M(w.type,Y,void 0,void 0,void 0,w.props)}function H(w){return typeof w=="object"&&w!==null&&w.$$typeof===a}function B(w){var Y={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(J){return Y[J]})}var ie=/\/+/g;function ae(w,Y){return typeof w=="object"&&w!==null&&w.key!=null?B(""+w.key):Y.toString(36)}function ve(){}function de(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(ve,ve):(w.status="pending",w.then(function(Y){w.status==="pending"&&(w.status="fulfilled",w.value=Y)},function(Y){w.status==="pending"&&(w.status="rejected",w.reason=Y)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function ue(w,Y,J,ne,oe){var he=typeof w;(he==="undefined"||he==="boolean")&&(w=null);var ce=!1;if(w===null)ce=!0;else switch(he){case"bigint":case"string":case"number":ce=!0;break;case"object":switch(w.$$typeof){case a:case e:ce=!0;break;case g:return ce=w._init,ue(ce(w._payload),Y,J,ne,oe)}}if(ce)return oe=oe(w),ce=ne===""?"."+ae(w,0):ne,O(oe)?(J="",ce!=null&&(J=ce.replace(ie,"$&/")+"/"),ue(oe,Y,J,"",function(et){return et})):oe!=null&&(H(oe)&&(oe=F(oe,J+(oe.key==null||w&&w.key===oe.key?"":(""+oe.key).replace(ie,"$&/")+"/")+ce)),Y.push(oe)),1;ce=0;var xe=ne===""?".":ne+":";if(O(w))for(var be=0;be<w.length;be++)ne=w[be],he=xe+ae(ne,be),ce+=ue(ne,Y,J,he,oe);else if(be=y(w),typeof be=="function")for(w=be.call(w),be=0;!(ne=w.next()).done;)ne=ne.value,he=xe+ae(ne,be++),ce+=ue(ne,Y,J,he,oe);else if(he==="object"){if(typeof w.then=="function")return ue(de(w),Y,J,ne,oe);throw Y=String(w),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return ce}function U(w,Y,J){if(w==null)return w;var ne=[],oe=0;return ue(w,ne,"","",function(he){return Y.call(J,he,oe++)}),ne}function W(w){if(w._status===-1){var Y=w._result;Y=Y(),Y.then(function(J){(w._status===0||w._status===-1)&&(w._status=1,w._result=J)},function(J){(w._status===0||w._status===-1)&&(w._status=2,w._result=J)}),w._status===-1&&(w._status=0,w._result=Y)}if(w._status===1)return w._result.default;throw w._result}var re=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function K(){}return _e.Children={map:U,forEach:function(w,Y,J){U(w,function(){Y.apply(this,arguments)},J)},count:function(w){var Y=0;return U(w,function(){Y++}),Y},toArray:function(w){return U(w,function(Y){return Y})||[]},only:function(w){if(!H(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},_e.Component=T,_e.Fragment=t,_e.Profiler=s,_e.PureComponent=D,_e.StrictMode=i,_e.Suspense=h,_e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,_e.__COMPILER_RUNTIME={__proto__:null,c:function(w){return I.H.useMemoCache(w)}},_e.cache=function(w){return function(){return w.apply(null,arguments)}},_e.cloneElement=function(w,Y,J){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var ne=E({},w.props),oe=w.key,he=void 0;if(Y!=null)for(ce in Y.ref!==void 0&&(he=void 0),Y.key!==void 0&&(oe=""+Y.key),Y)!N.call(Y,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&Y.ref===void 0||(ne[ce]=Y[ce]);var ce=arguments.length-2;if(ce===1)ne.children=J;else if(1<ce){for(var xe=Array(ce),be=0;be<ce;be++)xe[be]=arguments[be+2];ne.children=xe}return M(w.type,oe,void 0,void 0,he,ne)},_e.createContext=function(w){return w={$$typeof:o,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:l,_context:w},w},_e.createElement=function(w,Y,J){var ne,oe={},he=null;if(Y!=null)for(ne in Y.key!==void 0&&(he=""+Y.key),Y)N.call(Y,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(oe[ne]=Y[ne]);var ce=arguments.length-2;if(ce===1)oe.children=J;else if(1<ce){for(var xe=Array(ce),be=0;be<ce;be++)xe[be]=arguments[be+2];oe.children=xe}if(w&&w.defaultProps)for(ne in ce=w.defaultProps,ce)oe[ne]===void 0&&(oe[ne]=ce[ne]);return M(w,he,void 0,void 0,null,oe)},_e.createRef=function(){return{current:null}},_e.forwardRef=function(w){return{$$typeof:c,render:w}},_e.isValidElement=H,_e.lazy=function(w){return{$$typeof:g,_payload:{_status:-1,_result:w},_init:W}},_e.memo=function(w,Y){return{$$typeof:f,type:w,compare:Y===void 0?null:Y}},_e.startTransition=function(w){var Y=I.T,J={};I.T=J;try{var ne=w(),oe=I.S;oe!==null&&oe(J,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(K,re)}catch(he){re(he)}finally{I.T=Y}},_e.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},_e.use=function(w){return I.H.use(w)},_e.useActionState=function(w,Y,J){return I.H.useActionState(w,Y,J)},_e.useCallback=function(w,Y){return I.H.useCallback(w,Y)},_e.useContext=function(w){return I.H.useContext(w)},_e.useDebugValue=function(){},_e.useDeferredValue=function(w,Y){return I.H.useDeferredValue(w,Y)},_e.useEffect=function(w,Y,J){var ne=I.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ne.useEffect(w,Y)},_e.useId=function(){return I.H.useId()},_e.useImperativeHandle=function(w,Y,J){return I.H.useImperativeHandle(w,Y,J)},_e.useInsertionEffect=function(w,Y){return I.H.useInsertionEffect(w,Y)},_e.useLayoutEffect=function(w,Y){return I.H.useLayoutEffect(w,Y)},_e.useMemo=function(w,Y){return I.H.useMemo(w,Y)},_e.useOptimistic=function(w,Y){return I.H.useOptimistic(w,Y)},_e.useReducer=function(w,Y,J){return I.H.useReducer(w,Y,J)},_e.useRef=function(w){return I.H.useRef(w)},_e.useState=function(w){return I.H.useState(w)},_e.useSyncExternalStore=function(w,Y,J){return I.H.useSyncExternalStore(w,Y,J)},_e.useTransition=function(){return I.H.useTransition()},_e.version="19.1.0",_e}var Q0;function Ad(){return Q0||(Q0=1,yf.exports=cx()),yf.exports}var $=Ad(),vf={exports:{}},Sa={},Ef={exports:{}},Sf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W0;function fx(){return W0||(W0=1,function(a){function e(U,W){var re=U.length;U.push(W);e:for(;0<re;){var K=re-1>>>1,w=U[K];if(0<s(w,W))U[K]=W,U[re]=w,re=K;else break e}}function t(U){return U.length===0?null:U[0]}function i(U){if(U.length===0)return null;var W=U[0],re=U.pop();if(re!==W){U[0]=re;e:for(var K=0,w=U.length,Y=w>>>1;K<Y;){var J=2*(K+1)-1,ne=U[J],oe=J+1,he=U[oe];if(0>s(ne,re))oe<w&&0>s(he,ne)?(U[K]=he,U[oe]=re,K=oe):(U[K]=ne,U[J]=re,K=J);else if(oe<w&&0>s(he,re))U[K]=he,U[oe]=re,K=oe;else break e}}return W}function s(U,W){var re=U.sortIndex-W.sortIndex;return re!==0?re:U.id-W.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;a.unstable_now=function(){return l.now()}}else{var o=Date,c=o.now();a.unstable_now=function(){return o.now()-c}}var h=[],f=[],g=1,m=null,y=3,S=!1,E=!1,x=!1,T=!1,R=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function O(U){for(var W=t(f);W!==null;){if(W.callback===null)i(f);else if(W.startTime<=U)i(f),W.sortIndex=W.expirationTime,e(h,W);else break;W=t(f)}}function I(U){if(x=!1,O(U),!E)if(t(h)!==null)E=!0,N||(N=!0,ae());else{var W=t(f);W!==null&&ue(I,W.startTime-U)}}var N=!1,M=-1,F=5,H=-1;function B(){return T?!0:!(a.unstable_now()-H<F)}function ie(){if(T=!1,N){var U=a.unstable_now();H=U;var W=!0;try{e:{E=!1,x&&(x=!1,D(M),M=-1),S=!0;var re=y;try{t:{for(O(U),m=t(h);m!==null&&!(m.expirationTime>U&&B());){var K=m.callback;if(typeof K=="function"){m.callback=null,y=m.priorityLevel;var w=K(m.expirationTime<=U);if(U=a.unstable_now(),typeof w=="function"){m.callback=w,O(U),W=!0;break t}m===t(h)&&i(h),O(U)}else i(h);m=t(h)}if(m!==null)W=!0;else{var Y=t(f);Y!==null&&ue(I,Y.startTime-U),W=!1}}break e}finally{m=null,y=re,S=!1}W=void 0}}finally{W?ae():N=!1}}}var ae;if(typeof A=="function")ae=function(){A(ie)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,de=ve.port2;ve.port1.onmessage=ie,ae=function(){de.postMessage(null)}}else ae=function(){R(ie,0)};function ue(U,W){M=R(function(){U(a.unstable_now())},W)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(U){U.callback=null},a.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<U?Math.floor(1e3/U):5},a.unstable_getCurrentPriorityLevel=function(){return y},a.unstable_next=function(U){switch(y){case 1:case 2:case 3:var W=3;break;default:W=y}var re=y;y=W;try{return U()}finally{y=re}},a.unstable_requestPaint=function(){T=!0},a.unstable_runWithPriority=function(U,W){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var re=y;y=U;try{return W()}finally{y=re}},a.unstable_scheduleCallback=function(U,W,re){var K=a.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?K+re:K):re=K,U){case 1:var w=-1;break;case 2:w=250;break;case 5:w=1073741823;break;case 4:w=1e4;break;default:w=5e3}return w=re+w,U={id:g++,callback:W,priorityLevel:U,startTime:re,expirationTime:w,sortIndex:-1},re>K?(U.sortIndex=re,e(f,U),t(h)===null&&U===t(f)&&(x?(D(M),M=-1):x=!0,ue(I,re-K))):(U.sortIndex=w,e(h,U),E||S||(E=!0,N||(N=!0,ae()))),U},a.unstable_shouldYield=B,a.unstable_wrapCallback=function(U){var W=y;return function(){var re=y;y=W;try{return U.apply(this,arguments)}finally{y=re}}}}(Sf)),Sf}var Z0;function dx(){return Z0||(Z0=1,Ef.exports=fx()),Ef.exports}var Tf={exports:{}},_t={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J0;function hx(){if(J0)return _t;J0=1;var a=Ad();function e(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function l(h,f,g){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:h,containerInfo:f,implementation:g}}var o=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,f){if(h==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return _t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,_t.createPortal=function(h,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return l(h,f,null,g)},_t.flushSync=function(h){var f=o.T,g=i.p;try{if(o.T=null,i.p=2,h)return h()}finally{o.T=f,i.p=g,i.d.f()}},_t.preconnect=function(h,f){typeof h=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(h,f))},_t.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},_t.preinit=function(h,f){if(typeof h=="string"&&f&&typeof f.as=="string"){var g=f.as,m=c(g,f.crossOrigin),y=typeof f.integrity=="string"?f.integrity:void 0,S=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;g==="style"?i.d.S(h,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:S}):g==="script"&&i.d.X(h,{crossOrigin:m,integrity:y,fetchPriority:S,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},_t.preinitModule=function(h,f){if(typeof h=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var g=c(f.as,f.crossOrigin);i.d.M(h,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(h)},_t.preload=function(h,f){if(typeof h=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var g=f.as,m=c(g,f.crossOrigin);i.d.L(h,g,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},_t.preloadModule=function(h,f){if(typeof h=="string")if(f){var g=c(f.as,f.crossOrigin);i.d.m(h,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(h)},_t.requestFormReset=function(h){i.d.r(h)},_t.unstable_batchedUpdates=function(h,f){return h(f)},_t.useFormState=function(h,f,g){return o.H.useFormState(h,f,g)},_t.useFormStatus=function(){return o.H.useHostTransitionStatus()},_t.version="19.1.0",_t}var ep;function gx(){if(ep)return Tf.exports;ep=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),Tf.exports=hx(),Tf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tp;function mx(){if(tp)return Sa;tp=1;var a=dx(),e=Ad(),t=gx();function i(n){var r="https://react.dev/errors/"+n;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)r+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function l(n){var r=n,u=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(u=r.return),n=r.return;while(n)}return r.tag===3?u:null}function o(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function c(n){if(l(n)!==n)throw Error(i(188))}function h(n){var r=n.alternate;if(!r){if(r=l(n),r===null)throw Error(i(188));return r!==n?null:n}for(var u=n,d=r;;){var p=u.return;if(p===null)break;var v=p.alternate;if(v===null){if(d=p.return,d!==null){u=d;continue}break}if(p.child===v.child){for(v=p.child;v;){if(v===u)return c(p),n;if(v===d)return c(p),r;v=v.sibling}throw Error(i(188))}if(u.return!==d.return)u=p,d=v;else{for(var L=!1,C=p.child;C;){if(C===u){L=!0,u=p,d=v;break}if(C===d){L=!0,d=p,u=v;break}C=C.sibling}if(!L){for(C=v.child;C;){if(C===u){L=!0,u=v,d=p;break}if(C===d){L=!0,d=v,u=p;break}C=C.sibling}if(!L)throw Error(i(189))}}if(u.alternate!==d)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?n:r}function f(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n;for(n=n.child;n!==null;){if(r=f(n),r!==null)return r;n=n.sibling}return null}var g=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),A=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),H=Symbol.for("react.activity"),B=Symbol.for("react.memo_cache_sentinel"),ie=Symbol.iterator;function ae(n){return n===null||typeof n!="object"?null:(n=ie&&n[ie]||n["@@iterator"],typeof n=="function"?n:null)}var ve=Symbol.for("react.client.reference");function de(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ve?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case E:return"Fragment";case T:return"Profiler";case x:return"StrictMode";case I:return"Suspense";case N:return"SuspenseList";case H:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case S:return"Portal";case A:return(n.displayName||"Context")+".Provider";case D:return(n._context.displayName||"Context")+".Consumer";case O:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case M:return r=n.displayName||null,r!==null?r:de(n.type)||"Memo";case F:r=n._payload,n=n._init;try{return de(n(r))}catch{}}return null}var ue=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},K=[],w=-1;function Y(n){return{current:n}}function J(n){0>w||(n.current=K[w],K[w]=null,w--)}function ne(n,r){w++,K[w]=n.current,n.current=r}var oe=Y(null),he=Y(null),ce=Y(null),xe=Y(null);function be(n,r){switch(ne(ce,r),ne(he,n),ne(oe,null),r.nodeType){case 9:case 11:n=(n=r.documentElement)&&(n=n.namespaceURI)?T0(n):0;break;default:if(n=r.tagName,r=r.namespaceURI)r=T0(r),n=x0(r,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}J(oe),ne(oe,n)}function et(){J(oe),J(he),J(ce)}function Ui(n){n.memoizedState!==null&&ne(xe,n);var r=oe.current,u=x0(r,n.type);r!==u&&(ne(he,n),ne(oe,u))}function Es(n){he.current===n&&(J(oe),J(he)),xe.current===n&&(J(xe),ga._currentValue=re)}var Tr=Object.prototype.hasOwnProperty,Hn=a.unstable_scheduleCallback,Vn=a.unstable_cancelCallback,nh=a.unstable_shouldYield,Pe=a.unstable_requestPaint,Xe=a.unstable_now,Ot=a.unstable_getCurrentPriorityLevel,Si=a.unstable_ImmediatePriority,kt=a.unstable_UserBlockingPriority,ci=a.unstable_NormalPriority,Bi=a.unstable_LowPriority,xr=a.unstable_IdlePriority,Ss=a.log,Va=a.unstable_setDisableYieldValue,fi=null,bt=null;function Ti(n){if(typeof Ss=="function"&&Va(n),bt&&typeof bt.setStrictMode=="function")try{bt.setStrictMode(fi,n)}catch{}}var At=Math.clz32?Math.clz32:qE,Ka=Math.log,Kn=Math.LN2;function qE(n){return n>>>=0,n===0?32:31-(Ka(n)/Kn|0)|0}var za=256,qa=4194304;function zn(n){var r=n&42;if(r!==0)return r;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Ya(n,r,u){var d=n.pendingLanes;if(d===0)return 0;var p=0,v=n.suspendedLanes,L=n.pingedLanes;n=n.warmLanes;var C=d&134217727;return C!==0?(d=C&~v,d!==0?p=zn(d):(L&=C,L!==0?p=zn(L):u||(u=C&~n,u!==0&&(p=zn(u))))):(C=d&~v,C!==0?p=zn(C):L!==0?p=zn(L):u||(u=d&~n,u!==0&&(p=zn(u)))),p===0?0:r!==0&&r!==p&&(r&v)===0&&(v=p&-p,u=r&-r,v>=u||v===32&&(u&4194048)!==0)?r:p}function br(n,r){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&r)===0}function YE(n,r){switch(n){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sh(){var n=za;return za<<=1,(za&4194048)===0&&(za=256),n}function rh(){var n=qa;return qa<<=1,(qa&62914560)===0&&(qa=4194304),n}function su(n){for(var r=[],u=0;31>u;u++)r.push(n);return r}function Ar(n,r){n.pendingLanes|=r,r!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function XE(n,r,u,d,p,v){var L=n.pendingLanes;n.pendingLanes=u,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=u,n.entangledLanes&=u,n.errorRecoveryDisabledLanes&=u,n.shellSuspendCounter=0;var C=n.entanglements,k=n.expirationTimes,q=n.hiddenUpdates;for(u=L&~u;0<u;){var ee=31-At(u),le=1<<ee;C[ee]=0,k[ee]=-1;var X=q[ee];if(X!==null)for(q[ee]=null,ee=0;ee<X.length;ee++){var Q=X[ee];Q!==null&&(Q.lane&=-536870913)}u&=~le}d!==0&&ah(n,d,0),v!==0&&p===0&&n.tag!==0&&(n.suspendedLanes|=v&~(L&~r))}function ah(n,r,u){n.pendingLanes|=r,n.suspendedLanes&=~r;var d=31-At(r);n.entangledLanes|=r,n.entanglements[d]=n.entanglements[d]|1073741824|u&4194090}function lh(n,r){var u=n.entangledLanes|=r;for(n=n.entanglements;u;){var d=31-At(u),p=1<<d;p&r|n[d]&r&&(n[d]|=r),u&=~p}}function ru(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function au(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function oh(){var n=W.p;return n!==0?n:(n=window.event,n===void 0?32:G0(n.type))}function QE(n,r){var u=W.p;try{return W.p=n,r()}finally{W.p=u}}var dn=Math.random().toString(36).slice(2),Rt="__reactFiber$"+dn,Mt="__reactProps$"+dn,Ts="__reactContainer$"+dn,lu="__reactEvents$"+dn,WE="__reactListeners$"+dn,ZE="__reactHandles$"+dn,uh="__reactResources$"+dn,Rr="__reactMarker$"+dn;function ou(n){delete n[Rt],delete n[Mt],delete n[lu],delete n[WE],delete n[ZE]}function xs(n){var r=n[Rt];if(r)return r;for(var u=n.parentNode;u;){if(r=u[Ts]||u[Rt]){if(u=r.alternate,r.child!==null||u!==null&&u.child!==null)for(n=L0(n);n!==null;){if(u=n[Rt])return u;n=L0(n)}return r}n=u,u=n.parentNode}return null}function bs(n){if(n=n[Rt]||n[Ts]){var r=n.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return n}return null}function Lr(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n.stateNode;throw Error(i(33))}function As(n){var r=n[uh];return r||(r=n[uh]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function gt(n){n[Rr]=!0}var ch=new Set,fh={};function qn(n,r){Rs(n,r),Rs(n+"Capture",r)}function Rs(n,r){for(fh[n]=r,n=0;n<r.length;n++)ch.add(r[n])}var JE=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dh={},hh={};function eS(n){return Tr.call(hh,n)?!0:Tr.call(dh,n)?!1:JE.test(n)?hh[n]=!0:(dh[n]=!0,!1)}function Xa(n,r,u){if(eS(r))if(u===null)n.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":n.removeAttribute(r);return;case"boolean":var d=r.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(r);return}}n.setAttribute(r,""+u)}}function Qa(n,r,u){if(u===null)n.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttribute(r,""+u)}}function Fi(n,r,u,d){if(d===null)n.removeAttribute(u);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(u);return}n.setAttributeNS(r,u,""+d)}}var uu,gh;function Ls(n){if(uu===void 0)try{throw Error()}catch(u){var r=u.stack.trim().match(/\n( *(at )?)/);uu=r&&r[1]||"",gh=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uu+n+gh}var cu=!1;function fu(n,r){if(!n||cu)return"";cu=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(r){var le=function(){throw Error()};if(Object.defineProperty(le.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(le,[])}catch(Q){var X=Q}Reflect.construct(n,[],le)}else{try{le.call()}catch(Q){X=Q}n.call(le.prototype)}}else{try{throw Error()}catch(Q){X=Q}(le=n())&&typeof le.catch=="function"&&le.catch(function(){})}}catch(Q){if(Q&&X&&typeof Q.stack=="string")return[Q.stack,X.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=d.DetermineComponentFrameRoot(),L=v[0],C=v[1];if(L&&C){var k=L.split(`
`),q=C.split(`
`);for(p=d=0;d<k.length&&!k[d].includes("DetermineComponentFrameRoot");)d++;for(;p<q.length&&!q[p].includes("DetermineComponentFrameRoot");)p++;if(d===k.length||p===q.length)for(d=k.length-1,p=q.length-1;1<=d&&0<=p&&k[d]!==q[p];)p--;for(;1<=d&&0<=p;d--,p--)if(k[d]!==q[p]){if(d!==1||p!==1)do if(d--,p--,0>p||k[d]!==q[p]){var ee=`
`+k[d].replace(" at new "," at ");return n.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",n.displayName)),ee}while(1<=d&&0<=p);break}}}finally{cu=!1,Error.prepareStackTrace=u}return(u=n?n.displayName||n.name:"")?Ls(u):""}function tS(n){switch(n.tag){case 26:case 27:case 5:return Ls(n.type);case 16:return Ls("Lazy");case 13:return Ls("Suspense");case 19:return Ls("SuspenseList");case 0:case 15:return fu(n.type,!1);case 11:return fu(n.type.render,!1);case 1:return fu(n.type,!0);case 31:return Ls("Activity");default:return""}}function mh(n){try{var r="";do r+=tS(n),n=n.return;while(n);return r}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Zt(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function ph(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function iS(n){var r=ph(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),d=""+n[r];if(!n.hasOwnProperty(r)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,v=u.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return p.call(this)},set:function(L){d=""+L,v.call(this,L)}}),Object.defineProperty(n,r,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(L){d=""+L},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Wa(n){n._valueTracker||(n._valueTracker=iS(n))}function yh(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var u=r.getValue(),d="";return n&&(d=ph(n)?n.checked?"true":"false":n.value),n=d,n!==u?(r.setValue(n),!0):!1}function Za(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var nS=/[\n"\\]/g;function Jt(n){return n.replace(nS,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function du(n,r,u,d,p,v,L,C){n.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?n.type=L:n.removeAttribute("type"),r!=null?L==="number"?(r===0&&n.value===""||n.value!=r)&&(n.value=""+Zt(r)):n.value!==""+Zt(r)&&(n.value=""+Zt(r)):L!=="submit"&&L!=="reset"||n.removeAttribute("value"),r!=null?hu(n,L,Zt(r)):u!=null?hu(n,L,Zt(u)):d!=null&&n.removeAttribute("value"),p==null&&v!=null&&(n.defaultChecked=!!v),p!=null&&(n.checked=p&&typeof p!="function"&&typeof p!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?n.name=""+Zt(C):n.removeAttribute("name")}function vh(n,r,u,d,p,v,L,C){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(n.type=v),r!=null||u!=null){if(!(v!=="submit"&&v!=="reset"||r!=null))return;u=u!=null?""+Zt(u):"",r=r!=null?""+Zt(r):u,C||r===n.value||(n.value=r),n.defaultValue=r}d=d??p,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=C?n.checked:!!d,n.defaultChecked=!!d,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(n.name=L)}function hu(n,r,u){r==="number"&&Za(n.ownerDocument)===n||n.defaultValue===""+u||(n.defaultValue=""+u)}function _s(n,r,u,d){if(n=n.options,r){r={};for(var p=0;p<u.length;p++)r["$"+u[p]]=!0;for(u=0;u<n.length;u++)p=r.hasOwnProperty("$"+n[u].value),n[u].selected!==p&&(n[u].selected=p),p&&d&&(n[u].defaultSelected=!0)}else{for(u=""+Zt(u),r=null,p=0;p<n.length;p++){if(n[p].value===u){n[p].selected=!0,d&&(n[p].defaultSelected=!0);return}r!==null||n[p].disabled||(r=n[p])}r!==null&&(r.selected=!0)}}function Eh(n,r,u){if(r!=null&&(r=""+Zt(r),r!==n.value&&(n.value=r),u==null)){n.defaultValue!==r&&(n.defaultValue=r);return}n.defaultValue=u!=null?""+Zt(u):""}function Sh(n,r,u,d){if(r==null){if(d!=null){if(u!=null)throw Error(i(92));if(ue(d)){if(1<d.length)throw Error(i(93));d=d[0]}u=d}u==null&&(u=""),r=u}u=Zt(r),n.defaultValue=u,d=n.textContent,d===u&&d!==""&&d!==null&&(n.value=d)}function Ds(n,r){if(r){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=r;return}}n.textContent=r}var sS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Th(n,r,u){var d=r.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?d?n.setProperty(r,""):r==="float"?n.cssFloat="":n[r]="":d?n.setProperty(r,u):typeof u!="number"||u===0||sS.has(r)?r==="float"?n.cssFloat=u:n[r]=(""+u).trim():n[r]=u+"px"}function xh(n,r,u){if(r!=null&&typeof r!="object")throw Error(i(62));if(n=n.style,u!=null){for(var d in u)!u.hasOwnProperty(d)||r!=null&&r.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var p in r)d=r[p],r.hasOwnProperty(p)&&u[p]!==d&&Th(n,p,d)}else for(var v in r)r.hasOwnProperty(v)&&Th(n,v,r[v])}function gu(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),aS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ja(n){return aS.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var mu=null;function pu(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Cs=null,Is=null;function bh(n){var r=bs(n);if(r&&(n=r.stateNode)){var u=n[Mt]||null;e:switch(n=r.stateNode,r.type){case"input":if(du(n,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),r=u.name,u.type==="radio"&&r!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Jt(""+r)+'"][type="radio"]'),r=0;r<u.length;r++){var d=u[r];if(d!==n&&d.form===n.form){var p=d[Mt]||null;if(!p)throw Error(i(90));du(d,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<u.length;r++)d=u[r],d.form===n.form&&yh(d)}break e;case"textarea":Eh(n,u.value,u.defaultValue);break e;case"select":r=u.value,r!=null&&_s(n,!!u.multiple,r,!1)}}}var yu=!1;function Ah(n,r,u){if(yu)return n(r,u);yu=!0;try{var d=n(r);return d}finally{if(yu=!1,(Cs!==null||Is!==null)&&(Bl(),Cs&&(r=Cs,n=Is,Is=Cs=null,bh(r),n)))for(r=0;r<n.length;r++)bh(n[r])}}function _r(n,r){var u=n.stateNode;if(u===null)return null;var d=u[Mt]||null;if(d===null)return null;u=d[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(i(231,r,typeof u));return u}var $i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vu=!1;if($i)try{var Dr={};Object.defineProperty(Dr,"passive",{get:function(){vu=!0}}),window.addEventListener("test",Dr,Dr),window.removeEventListener("test",Dr,Dr)}catch{vu=!1}var hn=null,Eu=null,el=null;function Rh(){if(el)return el;var n,r=Eu,u=r.length,d,p="value"in hn?hn.value:hn.textContent,v=p.length;for(n=0;n<u&&r[n]===p[n];n++);var L=u-n;for(d=1;d<=L&&r[u-d]===p[v-d];d++);return el=p.slice(n,1<d?1-d:void 0)}function tl(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function il(){return!0}function Lh(){return!1}function Pt(n){function r(u,d,p,v,L){this._reactName=u,this._targetInst=p,this.type=d,this.nativeEvent=v,this.target=L,this.currentTarget=null;for(var C in n)n.hasOwnProperty(C)&&(u=n[C],this[C]=u?u(v):v[C]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?il:Lh,this.isPropagationStopped=Lh,this}return g(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=il)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=il)},persist:function(){},isPersistent:il}),r}var Yn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nl=Pt(Yn),Cr=g({},Yn,{view:0,detail:0}),lS=Pt(Cr),Su,Tu,Ir,sl=g({},Cr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ir&&(Ir&&n.type==="mousemove"?(Su=n.screenX-Ir.screenX,Tu=n.screenY-Ir.screenY):Tu=Su=0,Ir=n),Su)},movementY:function(n){return"movementY"in n?n.movementY:Tu}}),_h=Pt(sl),oS=g({},sl,{dataTransfer:0}),uS=Pt(oS),cS=g({},Cr,{relatedTarget:0}),xu=Pt(cS),fS=g({},Yn,{animationName:0,elapsedTime:0,pseudoElement:0}),dS=Pt(fS),hS=g({},Yn,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gS=Pt(hS),mS=g({},Yn,{data:0}),Dh=Pt(mS),pS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ES(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=vS[n])?!!r[n]:!1}function bu(){return ES}var SS=g({},Cr,{key:function(n){if(n.key){var r=pS[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=tl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yS[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bu,charCode:function(n){return n.type==="keypress"?tl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?tl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),TS=Pt(SS),xS=g({},sl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ch=Pt(xS),bS=g({},Cr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bu}),AS=Pt(bS),RS=g({},Yn,{propertyName:0,elapsedTime:0,pseudoElement:0}),LS=Pt(RS),_S=g({},sl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),DS=Pt(_S),CS=g({},Yn,{newState:0,oldState:0}),IS=Pt(CS),wS=[9,13,27,32],Au=$i&&"CompositionEvent"in window,wr=null;$i&&"documentMode"in document&&(wr=document.documentMode);var OS=$i&&"TextEvent"in window&&!wr,Ih=$i&&(!Au||wr&&8<wr&&11>=wr),wh=" ",Oh=!1;function kh(n,r){switch(n){case"keyup":return wS.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mh(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ws=!1;function kS(n,r){switch(n){case"compositionend":return Mh(r);case"keypress":return r.which!==32?null:(Oh=!0,wh);case"textInput":return n=r.data,n===wh&&Oh?null:n;default:return null}}function MS(n,r){if(ws)return n==="compositionend"||!Au&&kh(n,r)?(n=Rh(),el=Eu=hn=null,ws=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Ih&&r.locale!=="ko"?null:r.data;default:return null}}var PS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ph(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!PS[n.type]:r==="textarea"}function Nh(n,r,u,d){Cs?Is?Is.push(d):Is=[d]:Cs=d,r=Vl(r,"onChange"),0<r.length&&(u=new nl("onChange","change",null,u,d),n.push({event:u,listeners:r}))}var Or=null,kr=null;function NS(n){p0(n,0)}function rl(n){var r=Lr(n);if(yh(r))return n}function Uh(n,r){if(n==="change")return r}var Bh=!1;if($i){var Ru;if($i){var Lu="oninput"in document;if(!Lu){var Fh=document.createElement("div");Fh.setAttribute("oninput","return;"),Lu=typeof Fh.oninput=="function"}Ru=Lu}else Ru=!1;Bh=Ru&&(!document.documentMode||9<document.documentMode)}function $h(){Or&&(Or.detachEvent("onpropertychange",Gh),kr=Or=null)}function Gh(n){if(n.propertyName==="value"&&rl(kr)){var r=[];Nh(r,kr,n,pu(n)),Ah(NS,r)}}function US(n,r,u){n==="focusin"?($h(),Or=r,kr=u,Or.attachEvent("onpropertychange",Gh)):n==="focusout"&&$h()}function BS(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return rl(kr)}function FS(n,r){if(n==="click")return rl(r)}function $S(n,r){if(n==="input"||n==="change")return rl(r)}function GS(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var jt=typeof Object.is=="function"?Object.is:GS;function Mr(n,r){if(jt(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var u=Object.keys(n),d=Object.keys(r);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var p=u[d];if(!Tr.call(r,p)||!jt(n[p],r[p]))return!1}return!0}function jh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Hh(n,r){var u=jh(n);n=0;for(var d;u;){if(u.nodeType===3){if(d=n+u.textContent.length,n<=r&&d>=r)return{node:u,offset:r-n};n=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=jh(u)}}function Vh(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?Vh(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function Kh(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var r=Za(n.document);r instanceof n.HTMLIFrameElement;){try{var u=typeof r.contentWindow.location.href=="string"}catch{u=!1}if(u)n=r.contentWindow;else break;r=Za(n.document)}return r}function _u(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}var jS=$i&&"documentMode"in document&&11>=document.documentMode,Os=null,Du=null,Pr=null,Cu=!1;function zh(n,r,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Cu||Os==null||Os!==Za(d)||(d=Os,"selectionStart"in d&&_u(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Pr&&Mr(Pr,d)||(Pr=d,d=Vl(Du,"onSelect"),0<d.length&&(r=new nl("onSelect","select",null,r,u),n.push({event:r,listeners:d}),r.target=Os)))}function Xn(n,r){var u={};return u[n.toLowerCase()]=r.toLowerCase(),u["Webkit"+n]="webkit"+r,u["Moz"+n]="moz"+r,u}var ks={animationend:Xn("Animation","AnimationEnd"),animationiteration:Xn("Animation","AnimationIteration"),animationstart:Xn("Animation","AnimationStart"),transitionrun:Xn("Transition","TransitionRun"),transitionstart:Xn("Transition","TransitionStart"),transitioncancel:Xn("Transition","TransitionCancel"),transitionend:Xn("Transition","TransitionEnd")},Iu={},qh={};$i&&(qh=document.createElement("div").style,"AnimationEvent"in window||(delete ks.animationend.animation,delete ks.animationiteration.animation,delete ks.animationstart.animation),"TransitionEvent"in window||delete ks.transitionend.transition);function Qn(n){if(Iu[n])return Iu[n];if(!ks[n])return n;var r=ks[n],u;for(u in r)if(r.hasOwnProperty(u)&&u in qh)return Iu[n]=r[u];return n}var Yh=Qn("animationend"),Xh=Qn("animationiteration"),Qh=Qn("animationstart"),HS=Qn("transitionrun"),VS=Qn("transitionstart"),KS=Qn("transitioncancel"),Wh=Qn("transitionend"),Zh=new Map,wu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wu.push("scrollEnd");function di(n,r){Zh.set(n,r),qn(r,[n])}var Jh=new WeakMap;function ei(n,r){if(typeof n=="object"&&n!==null){var u=Jh.get(n);return u!==void 0?u:(r={value:n,source:r,stack:mh(r)},Jh.set(n,r),r)}return{value:n,source:r,stack:mh(r)}}var ti=[],Ms=0,Ou=0;function al(){for(var n=Ms,r=Ou=Ms=0;r<n;){var u=ti[r];ti[r++]=null;var d=ti[r];ti[r++]=null;var p=ti[r];ti[r++]=null;var v=ti[r];if(ti[r++]=null,d!==null&&p!==null){var L=d.pending;L===null?p.next=p:(p.next=L.next,L.next=p),d.pending=p}v!==0&&eg(u,p,v)}}function ll(n,r,u,d){ti[Ms++]=n,ti[Ms++]=r,ti[Ms++]=u,ti[Ms++]=d,Ou|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function ku(n,r,u,d){return ll(n,r,u,d),ol(n)}function Ps(n,r){return ll(n,null,null,r),ol(n)}function eg(n,r,u){n.lanes|=u;var d=n.alternate;d!==null&&(d.lanes|=u);for(var p=!1,v=n.return;v!==null;)v.childLanes|=u,d=v.alternate,d!==null&&(d.childLanes|=u),v.tag===22&&(n=v.stateNode,n===null||n._visibility&1||(p=!0)),n=v,v=v.return;return n.tag===3?(v=n.stateNode,p&&r!==null&&(p=31-At(u),n=v.hiddenUpdates,d=n[p],d===null?n[p]=[r]:d.push(r),r.lane=u|536870912),v):null}function ol(n){if(50<aa)throw aa=0,Fc=null,Error(i(185));for(var r=n.return;r!==null;)n=r,r=n.return;return n.tag===3?n.stateNode:null}var Ns={};function zS(n,r,u,d){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ht(n,r,u,d){return new zS(n,r,u,d)}function Mu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Gi(n,r){var u=n.alternate;return u===null?(u=Ht(n.tag,r,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=r,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&65011712,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,r=n.dependencies,u.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u.refCleanup=n.refCleanup,u}function tg(n,r){n.flags&=65011714;var u=n.alternate;return u===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=u.childLanes,n.lanes=u.lanes,n.child=u.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=u.memoizedProps,n.memoizedState=u.memoizedState,n.updateQueue=u.updateQueue,n.type=u.type,r=u.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),n}function ul(n,r,u,d,p,v){var L=0;if(d=n,typeof n=="function")Mu(n)&&(L=1);else if(typeof n=="string")L=YT(n,u,oe.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case H:return n=Ht(31,u,r,p),n.elementType=H,n.lanes=v,n;case E:return Wn(u.children,p,v,r);case x:L=8,p|=24;break;case T:return n=Ht(12,u,r,p|2),n.elementType=T,n.lanes=v,n;case I:return n=Ht(13,u,r,p),n.elementType=I,n.lanes=v,n;case N:return n=Ht(19,u,r,p),n.elementType=N,n.lanes=v,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case R:case A:L=10;break e;case D:L=9;break e;case O:L=11;break e;case M:L=14;break e;case F:L=16,d=null;break e}L=29,u=Error(i(130,n===null?"null":typeof n,"")),d=null}return r=Ht(L,u,r,p),r.elementType=n,r.type=d,r.lanes=v,r}function Wn(n,r,u,d){return n=Ht(7,n,d,r),n.lanes=u,n}function Pu(n,r,u){return n=Ht(6,n,null,r),n.lanes=u,n}function Nu(n,r,u){return r=Ht(4,n.children!==null?n.children:[],n.key,r),r.lanes=u,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}var Us=[],Bs=0,cl=null,fl=0,ii=[],ni=0,Zn=null,ji=1,Hi="";function Jn(n,r){Us[Bs++]=fl,Us[Bs++]=cl,cl=n,fl=r}function ig(n,r,u){ii[ni++]=ji,ii[ni++]=Hi,ii[ni++]=Zn,Zn=n;var d=ji;n=Hi;var p=32-At(d)-1;d&=~(1<<p),u+=1;var v=32-At(r)+p;if(30<v){var L=p-p%5;v=(d&(1<<L)-1).toString(32),d>>=L,p-=L,ji=1<<32-At(r)+p|u<<p|d,Hi=v+n}else ji=1<<v|u<<p|d,Hi=n}function Uu(n){n.return!==null&&(Jn(n,1),ig(n,1,0))}function Bu(n){for(;n===cl;)cl=Us[--Bs],Us[Bs]=null,fl=Us[--Bs],Us[Bs]=null;for(;n===Zn;)Zn=ii[--ni],ii[ni]=null,Hi=ii[--ni],ii[ni]=null,ji=ii[--ni],ii[ni]=null}var wt=null,st=null,Be=!1,es=null,xi=!1,Fu=Error(i(519));function ts(n){var r=Error(i(418,""));throw Br(ei(r,n)),Fu}function ng(n){var r=n.stateNode,u=n.type,d=n.memoizedProps;switch(r[Rt]=n,r[Mt]=d,u){case"dialog":ke("cancel",r),ke("close",r);break;case"iframe":case"object":case"embed":ke("load",r);break;case"video":case"audio":for(u=0;u<oa.length;u++)ke(oa[u],r);break;case"source":ke("error",r);break;case"img":case"image":case"link":ke("error",r),ke("load",r);break;case"details":ke("toggle",r);break;case"input":ke("invalid",r),vh(r,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Wa(r);break;case"select":ke("invalid",r);break;case"textarea":ke("invalid",r),Sh(r,d.value,d.defaultValue,d.children),Wa(r)}u=d.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||r.textContent===""+u||d.suppressHydrationWarning===!0||S0(r.textContent,u)?(d.popover!=null&&(ke("beforetoggle",r),ke("toggle",r)),d.onScroll!=null&&ke("scroll",r),d.onScrollEnd!=null&&ke("scrollend",r),d.onClick!=null&&(r.onclick=Kl),r=!0):r=!1,r||ts(n)}function sg(n){for(wt=n.return;wt;)switch(wt.tag){case 5:case 13:xi=!1;return;case 27:case 3:xi=!0;return;default:wt=wt.return}}function Nr(n){if(n!==wt)return!1;if(!Be)return sg(n),Be=!0,!1;var r=n.tag,u;if((u=r!==3&&r!==27)&&((u=r===5)&&(u=n.type,u=!(u!=="form"&&u!=="button")||tf(n.type,n.memoizedProps)),u=!u),u&&st&&ts(n),sg(n),r===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8)if(u=n.data,u==="/$"){if(r===0){st=gi(n.nextSibling);break e}r--}else u!=="$"&&u!=="$!"&&u!=="$?"||r++;n=n.nextSibling}st=null}}else r===27?(r=st,Cn(n.type)?(n=af,af=null,st=n):st=r):st=wt?gi(n.stateNode.nextSibling):null;return!0}function Ur(){st=wt=null,Be=!1}function rg(){var n=es;return n!==null&&(Bt===null?Bt=n:Bt.push.apply(Bt,n),es=null),n}function Br(n){es===null?es=[n]:es.push(n)}var $u=Y(null),is=null,Vi=null;function gn(n,r,u){ne($u,r._currentValue),r._currentValue=u}function Ki(n){n._currentValue=$u.current,J($u)}function Gu(n,r,u){for(;n!==null;){var d=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,d!==null&&(d.childLanes|=r)):d!==null&&(d.childLanes&r)!==r&&(d.childLanes|=r),n===u)break;n=n.return}}function ju(n,r,u,d){var p=n.child;for(p!==null&&(p.return=n);p!==null;){var v=p.dependencies;if(v!==null){var L=p.child;v=v.firstContext;e:for(;v!==null;){var C=v;v=p;for(var k=0;k<r.length;k++)if(C.context===r[k]){v.lanes|=u,C=v.alternate,C!==null&&(C.lanes|=u),Gu(v.return,u,n),d||(L=null);break e}v=C.next}}else if(p.tag===18){if(L=p.return,L===null)throw Error(i(341));L.lanes|=u,v=L.alternate,v!==null&&(v.lanes|=u),Gu(L,u,n),L=null}else L=p.child;if(L!==null)L.return=p;else for(L=p;L!==null;){if(L===n){L=null;break}if(p=L.sibling,p!==null){p.return=L.return,L=p;break}L=L.return}p=L}}function Fr(n,r,u,d){n=null;for(var p=r,v=!1;p!==null;){if(!v){if((p.flags&524288)!==0)v=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var L=p.alternate;if(L===null)throw Error(i(387));if(L=L.memoizedProps,L!==null){var C=p.type;jt(p.pendingProps.value,L.value)||(n!==null?n.push(C):n=[C])}}else if(p===xe.current){if(L=p.alternate,L===null)throw Error(i(387));L.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(n!==null?n.push(ga):n=[ga])}p=p.return}n!==null&&ju(r,n,u,d),r.flags|=262144}function dl(n){for(n=n.firstContext;n!==null;){if(!jt(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ns(n){is=n,Vi=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Lt(n){return ag(is,n)}function hl(n,r){return is===null&&ns(n),ag(n,r)}function ag(n,r){var u=r._currentValue;if(r={context:r,memoizedValue:u,next:null},Vi===null){if(n===null)throw Error(i(308));Vi=r,n.dependencies={lanes:0,firstContext:r},n.flags|=524288}else Vi=Vi.next=r;return u}var qS=typeof AbortController<"u"?AbortController:function(){var n=[],r=this.signal={aborted:!1,addEventListener:function(u,d){n.push(d)}};this.abort=function(){r.aborted=!0,n.forEach(function(u){return u()})}},YS=a.unstable_scheduleCallback,XS=a.unstable_NormalPriority,ct={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Hu(){return{controller:new qS,data:new Map,refCount:0}}function $r(n){n.refCount--,n.refCount===0&&YS(XS,function(){n.controller.abort()})}var Gr=null,Vu=0,Fs=0,$s=null;function QS(n,r){if(Gr===null){var u=Gr=[];Vu=0,Fs=zc(),$s={status:"pending",value:void 0,then:function(d){u.push(d)}}}return Vu++,r.then(lg,lg),r}function lg(){if(--Vu===0&&Gr!==null){$s!==null&&($s.status="fulfilled");var n=Gr;Gr=null,Fs=0,$s=null;for(var r=0;r<n.length;r++)(0,n[r])()}}function WS(n,r){var u=[],d={status:"pending",value:null,reason:null,then:function(p){u.push(p)}};return n.then(function(){d.status="fulfilled",d.value=r;for(var p=0;p<u.length;p++)(0,u[p])(r)},function(p){for(d.status="rejected",d.reason=p,p=0;p<u.length;p++)(0,u[p])(void 0)}),d}var og=U.S;U.S=function(n,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&QS(n,r),og!==null&&og(n,r)};var ss=Y(null);function Ku(){var n=ss.current;return n!==null?n:We.pooledCache}function gl(n,r){r===null?ne(ss,ss.current):ne(ss,r.pool)}function ug(){var n=Ku();return n===null?null:{parent:ct._currentValue,pool:n}}var jr=Error(i(460)),cg=Error(i(474)),ml=Error(i(542)),zu={then:function(){}};function fg(n){return n=n.status,n==="fulfilled"||n==="rejected"}function pl(){}function dg(n,r,u){switch(u=n[u],u===void 0?n.push(r):u!==r&&(r.then(pl,pl),r=u),r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,gg(n),n;default:if(typeof r.status=="string")r.then(pl,pl);else{if(n=We,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=r,n.status="pending",n.then(function(d){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=d}},function(d){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=d}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,gg(n),n}throw Hr=r,jr}}var Hr=null;function hg(){if(Hr===null)throw Error(i(459));var n=Hr;return Hr=null,n}function gg(n){if(n===jr||n===ml)throw Error(i(483))}var mn=!1;function qu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yu(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function pn(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function yn(n,r,u){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(je&2)!==0){var p=d.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),d.pending=r,r=ol(n),eg(n,null,u),r}return ll(n,d,r,u),ol(n)}function Vr(n,r,u){if(r=r.updateQueue,r!==null&&(r=r.shared,(u&4194048)!==0)){var d=r.lanes;d&=n.pendingLanes,u|=d,r.lanes=u,lh(n,u)}}function Xu(n,r){var u=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var p=null,v=null;if(u=u.firstBaseUpdate,u!==null){do{var L={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};v===null?p=v=L:v=v.next=L,u=u.next}while(u!==null);v===null?p=v=r:v=v.next=r}else p=v=r;u={baseState:d.baseState,firstBaseUpdate:p,lastBaseUpdate:v,shared:d.shared,callbacks:d.callbacks},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=r:n.next=r,u.lastBaseUpdate=r}var Qu=!1;function Kr(){if(Qu){var n=$s;if(n!==null)throw n}}function zr(n,r,u,d){Qu=!1;var p=n.updateQueue;mn=!1;var v=p.firstBaseUpdate,L=p.lastBaseUpdate,C=p.shared.pending;if(C!==null){p.shared.pending=null;var k=C,q=k.next;k.next=null,L===null?v=q:L.next=q,L=k;var ee=n.alternate;ee!==null&&(ee=ee.updateQueue,C=ee.lastBaseUpdate,C!==L&&(C===null?ee.firstBaseUpdate=q:C.next=q,ee.lastBaseUpdate=k))}if(v!==null){var le=p.baseState;L=0,ee=q=k=null,C=v;do{var X=C.lane&-536870913,Q=X!==C.lane;if(Q?(Ne&X)===X:(d&X)===X){X!==0&&X===Fs&&(Qu=!0),ee!==null&&(ee=ee.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});e:{var Ae=n,Se=C;X=r;var Ye=u;switch(Se.tag){case 1:if(Ae=Se.payload,typeof Ae=="function"){le=Ae.call(Ye,le,X);break e}le=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Se.payload,X=typeof Ae=="function"?Ae.call(Ye,le,X):Ae,X==null)break e;le=g({},le,X);break e;case 2:mn=!0}}X=C.callback,X!==null&&(n.flags|=64,Q&&(n.flags|=8192),Q=p.callbacks,Q===null?p.callbacks=[X]:Q.push(X))}else Q={lane:X,tag:C.tag,payload:C.payload,callback:C.callback,next:null},ee===null?(q=ee=Q,k=le):ee=ee.next=Q,L|=X;if(C=C.next,C===null){if(C=p.shared.pending,C===null)break;Q=C,C=Q.next,Q.next=null,p.lastBaseUpdate=Q,p.shared.pending=null}}while(!0);ee===null&&(k=le),p.baseState=k,p.firstBaseUpdate=q,p.lastBaseUpdate=ee,v===null&&(p.shared.lanes=0),Rn|=L,n.lanes=L,n.memoizedState=le}}function mg(n,r){if(typeof n!="function")throw Error(i(191,n));n.call(r)}function pg(n,r){var u=n.callbacks;if(u!==null)for(n.callbacks=null,n=0;n<u.length;n++)mg(u[n],r)}var Gs=Y(null),yl=Y(0);function yg(n,r){n=Zi,ne(yl,n),ne(Gs,r),Zi=n|r.baseLanes}function Wu(){ne(yl,Zi),ne(Gs,Gs.current)}function Zu(){Zi=yl.current,J(Gs),J(yl)}var vn=0,Ce=null,ze=null,ot=null,vl=!1,js=!1,rs=!1,El=0,qr=0,Hs=null,ZS=0;function at(){throw Error(i(321))}function Ju(n,r){if(r===null)return!1;for(var u=0;u<r.length&&u<n.length;u++)if(!jt(n[u],r[u]))return!1;return!0}function ec(n,r,u,d,p,v){return vn=v,Ce=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,U.H=n===null||n.memoizedState===null?em:tm,rs=!1,v=u(d,p),rs=!1,js&&(v=Eg(r,u,d,p)),vg(n),v}function vg(n){U.H=Rl;var r=ze!==null&&ze.next!==null;if(vn=0,ot=ze=Ce=null,vl=!1,qr=0,Hs=null,r)throw Error(i(300));n===null||mt||(n=n.dependencies,n!==null&&dl(n)&&(mt=!0))}function Eg(n,r,u,d){Ce=n;var p=0;do{if(js&&(Hs=null),qr=0,js=!1,25<=p)throw Error(i(301));if(p+=1,ot=ze=null,n.updateQueue!=null){var v=n.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}U.H=rT,v=r(u,d)}while(js);return v}function JS(){var n=U.H,r=n.useState()[0];return r=typeof r.then=="function"?Yr(r):r,n=n.useState()[0],(ze!==null?ze.memoizedState:null)!==n&&(Ce.flags|=1024),r}function tc(){var n=El!==0;return El=0,n}function ic(n,r,u){r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~u}function nc(n){if(vl){for(n=n.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}vl=!1}vn=0,ot=ze=Ce=null,js=!1,qr=El=0,Hs=null}function Nt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ot===null?Ce.memoizedState=ot=n:ot=ot.next=n,ot}function ut(){if(ze===null){var n=Ce.alternate;n=n!==null?n.memoizedState:null}else n=ze.next;var r=ot===null?Ce.memoizedState:ot.next;if(r!==null)ot=r,ze=n;else{if(n===null)throw Ce.alternate===null?Error(i(467)):Error(i(310));ze=n,n={memoizedState:ze.memoizedState,baseState:ze.baseState,baseQueue:ze.baseQueue,queue:ze.queue,next:null},ot===null?Ce.memoizedState=ot=n:ot=ot.next=n}return ot}function sc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yr(n){var r=qr;return qr+=1,Hs===null&&(Hs=[]),n=dg(Hs,n,r),r=Ce,(ot===null?r.memoizedState:ot.next)===null&&(r=r.alternate,U.H=r===null||r.memoizedState===null?em:tm),n}function Sl(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Yr(n);if(n.$$typeof===A)return Lt(n)}throw Error(i(438,String(n)))}function rc(n){var r=null,u=Ce.updateQueue;if(u!==null&&(r=u.memoCache),r==null){var d=Ce.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(r={data:d.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),u===null&&(u=sc(),Ce.updateQueue=u),u.memoCache=r,u=r.data[r.index],u===void 0)for(u=r.data[r.index]=Array(n),d=0;d<n;d++)u[d]=B;return r.index++,u}function zi(n,r){return typeof r=="function"?r(n):r}function Tl(n){var r=ut();return ac(r,ze,n)}function ac(n,r,u){var d=n.queue;if(d===null)throw Error(i(311));d.lastRenderedReducer=u;var p=n.baseQueue,v=d.pending;if(v!==null){if(p!==null){var L=p.next;p.next=v.next,v.next=L}r.baseQueue=p=v,d.pending=null}if(v=n.baseState,p===null)n.memoizedState=v;else{r=p.next;var C=L=null,k=null,q=r,ee=!1;do{var le=q.lane&-536870913;if(le!==q.lane?(Ne&le)===le:(vn&le)===le){var X=q.revertLane;if(X===0)k!==null&&(k=k.next={lane:0,revertLane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),le===Fs&&(ee=!0);else if((vn&X)===X){q=q.next,X===Fs&&(ee=!0);continue}else le={lane:0,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},k===null?(C=k=le,L=v):k=k.next=le,Ce.lanes|=X,Rn|=X;le=q.action,rs&&u(v,le),v=q.hasEagerState?q.eagerState:u(v,le)}else X={lane:le,revertLane:q.revertLane,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},k===null?(C=k=X,L=v):k=k.next=X,Ce.lanes|=le,Rn|=le;q=q.next}while(q!==null&&q!==r);if(k===null?L=v:k.next=C,!jt(v,n.memoizedState)&&(mt=!0,ee&&(u=$s,u!==null)))throw u;n.memoizedState=v,n.baseState=L,n.baseQueue=k,d.lastRenderedState=v}return p===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function lc(n){var r=ut(),u=r.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=n;var d=u.dispatch,p=u.pending,v=r.memoizedState;if(p!==null){u.pending=null;var L=p=p.next;do v=n(v,L.action),L=L.next;while(L!==p);jt(v,r.memoizedState)||(mt=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),u.lastRenderedState=v}return[v,d]}function Sg(n,r,u){var d=Ce,p=ut(),v=Be;if(v){if(u===void 0)throw Error(i(407));u=u()}else u=r();var L=!jt((ze||p).memoizedState,u);L&&(p.memoizedState=u,mt=!0),p=p.queue;var C=bg.bind(null,d,p,n);if(Xr(2048,8,C,[n]),p.getSnapshot!==r||L||ot!==null&&ot.memoizedState.tag&1){if(d.flags|=2048,Vs(9,xl(),xg.bind(null,d,p,u,r),null),We===null)throw Error(i(349));v||(vn&124)!==0||Tg(d,r,u)}return u}function Tg(n,r,u){n.flags|=16384,n={getSnapshot:r,value:u},r=Ce.updateQueue,r===null?(r=sc(),Ce.updateQueue=r,r.stores=[n]):(u=r.stores,u===null?r.stores=[n]:u.push(n))}function xg(n,r,u,d){r.value=u,r.getSnapshot=d,Ag(r)&&Rg(n)}function bg(n,r,u){return u(function(){Ag(r)&&Rg(n)})}function Ag(n){var r=n.getSnapshot;n=n.value;try{var u=r();return!jt(n,u)}catch{return!0}}function Rg(n){var r=Ps(n,2);r!==null&&Yt(r,n,2)}function oc(n){var r=Nt();if(typeof n=="function"){var u=n;if(n=u(),rs){Ti(!0);try{u()}finally{Ti(!1)}}}return r.memoizedState=r.baseState=n,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zi,lastRenderedState:n},r}function Lg(n,r,u,d){return n.baseState=u,ac(n,ze,typeof d=="function"?d:zi)}function eT(n,r,u,d,p){if(Al(n))throw Error(i(485));if(n=r.action,n!==null){var v={payload:p,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){v.listeners.push(L)}};U.T!==null?u(!0):v.isTransition=!1,d(v),u=r.pending,u===null?(v.next=r.pending=v,_g(r,v)):(v.next=u.next,r.pending=u.next=v)}}function _g(n,r){var u=r.action,d=r.payload,p=n.state;if(r.isTransition){var v=U.T,L={};U.T=L;try{var C=u(p,d),k=U.S;k!==null&&k(L,C),Dg(n,r,C)}catch(q){uc(n,r,q)}finally{U.T=v}}else try{v=u(p,d),Dg(n,r,v)}catch(q){uc(n,r,q)}}function Dg(n,r,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(d){Cg(n,r,d)},function(d){return uc(n,r,d)}):Cg(n,r,u)}function Cg(n,r,u){r.status="fulfilled",r.value=u,Ig(r),n.state=u,r=n.pending,r!==null&&(u=r.next,u===r?n.pending=null:(u=u.next,r.next=u,_g(n,u)))}function uc(n,r,u){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do r.status="rejected",r.reason=u,Ig(r),r=r.next;while(r!==d)}n.action=null}function Ig(n){n=n.listeners;for(var r=0;r<n.length;r++)(0,n[r])()}function wg(n,r){return r}function Og(n,r){if(Be){var u=We.formState;if(u!==null){e:{var d=Ce;if(Be){if(st){t:{for(var p=st,v=xi;p.nodeType!==8;){if(!v){p=null;break t}if(p=gi(p.nextSibling),p===null){p=null;break t}}v=p.data,p=v==="F!"||v==="F"?p:null}if(p){st=gi(p.nextSibling),d=p.data==="F!";break e}}ts(d)}d=!1}d&&(r=u[0])}}return u=Nt(),u.memoizedState=u.baseState=r,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wg,lastRenderedState:r},u.queue=d,u=Wg.bind(null,Ce,d),d.dispatch=u,d=oc(!1),v=gc.bind(null,Ce,!1,d.queue),d=Nt(),p={state:r,dispatch:null,action:n,pending:null},d.queue=p,u=eT.bind(null,Ce,p,v,u),p.dispatch=u,d.memoizedState=n,[r,u,!1]}function kg(n){var r=ut();return Mg(r,ze,n)}function Mg(n,r,u){if(r=ac(n,r,wg)[0],n=Tl(zi)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var d=Yr(r)}catch(L){throw L===jr?ml:L}else d=r;r=ut();var p=r.queue,v=p.dispatch;return u!==r.memoizedState&&(Ce.flags|=2048,Vs(9,xl(),tT.bind(null,p,u),null)),[d,v,n]}function tT(n,r){n.action=r}function Pg(n){var r=ut(),u=ze;if(u!==null)return Mg(r,u,n);ut(),r=r.memoizedState,u=ut();var d=u.queue.dispatch;return u.memoizedState=n,[r,d,!1]}function Vs(n,r,u,d){return n={tag:n,create:u,deps:d,inst:r,next:null},r=Ce.updateQueue,r===null&&(r=sc(),Ce.updateQueue=r),u=r.lastEffect,u===null?r.lastEffect=n.next=n:(d=u.next,u.next=n,n.next=d,r.lastEffect=n),n}function xl(){return{destroy:void 0,resource:void 0}}function Ng(){return ut().memoizedState}function bl(n,r,u,d){var p=Nt();d=d===void 0?null:d,Ce.flags|=n,p.memoizedState=Vs(1|r,xl(),u,d)}function Xr(n,r,u,d){var p=ut();d=d===void 0?null:d;var v=p.memoizedState.inst;ze!==null&&d!==null&&Ju(d,ze.memoizedState.deps)?p.memoizedState=Vs(r,v,u,d):(Ce.flags|=n,p.memoizedState=Vs(1|r,v,u,d))}function Ug(n,r){bl(8390656,8,n,r)}function Bg(n,r){Xr(2048,8,n,r)}function Fg(n,r){return Xr(4,2,n,r)}function $g(n,r){return Xr(4,4,n,r)}function Gg(n,r){if(typeof r=="function"){n=n();var u=r(n);return function(){typeof u=="function"?u():r(null)}}if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function jg(n,r,u){u=u!=null?u.concat([n]):null,Xr(4,4,Gg.bind(null,r,n),u)}function cc(){}function Hg(n,r){var u=ut();r=r===void 0?null:r;var d=u.memoizedState;return r!==null&&Ju(r,d[1])?d[0]:(u.memoizedState=[n,r],n)}function Vg(n,r){var u=ut();r=r===void 0?null:r;var d=u.memoizedState;if(r!==null&&Ju(r,d[1]))return d[0];if(d=n(),rs){Ti(!0);try{n()}finally{Ti(!1)}}return u.memoizedState=[d,r],d}function fc(n,r,u){return u===void 0||(vn&1073741824)!==0?n.memoizedState=r:(n.memoizedState=u,n=qm(),Ce.lanes|=n,Rn|=n,u)}function Kg(n,r,u,d){return jt(u,r)?u:Gs.current!==null?(n=fc(n,u,d),jt(n,r)||(mt=!0),n):(vn&42)===0?(mt=!0,n.memoizedState=u):(n=qm(),Ce.lanes|=n,Rn|=n,r)}function zg(n,r,u,d,p){var v=W.p;W.p=v!==0&&8>v?v:8;var L=U.T,C={};U.T=C,gc(n,!1,r,u);try{var k=p(),q=U.S;if(q!==null&&q(C,k),k!==null&&typeof k=="object"&&typeof k.then=="function"){var ee=WS(k,d);Qr(n,r,ee,qt(n))}else Qr(n,r,d,qt(n))}catch(le){Qr(n,r,{then:function(){},status:"rejected",reason:le},qt())}finally{W.p=v,U.T=L}}function iT(){}function dc(n,r,u,d){if(n.tag!==5)throw Error(i(476));var p=qg(n).queue;zg(n,p,r,re,u===null?iT:function(){return Yg(n),u(d)})}function qg(n){var r=n.memoizedState;if(r!==null)return r;r={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zi,lastRenderedState:re},next:null};var u={};return r.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zi,lastRenderedState:u},next:null},n.memoizedState=r,n=n.alternate,n!==null&&(n.memoizedState=r),r}function Yg(n){var r=qg(n).next.queue;Qr(n,r,{},qt())}function hc(){return Lt(ga)}function Xg(){return ut().memoizedState}function Qg(){return ut().memoizedState}function nT(n){for(var r=n.return;r!==null;){switch(r.tag){case 24:case 3:var u=qt();n=pn(u);var d=yn(r,n,u);d!==null&&(Yt(d,r,u),Vr(d,r,u)),r={cache:Hu()},n.payload=r;return}r=r.return}}function sT(n,r,u){var d=qt();u={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},Al(n)?Zg(r,u):(u=ku(n,r,u,d),u!==null&&(Yt(u,n,d),Jg(u,r,d)))}function Wg(n,r,u){var d=qt();Qr(n,r,u,d)}function Qr(n,r,u,d){var p={lane:d,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(Al(n))Zg(r,p);else{var v=n.alternate;if(n.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var L=r.lastRenderedState,C=v(L,u);if(p.hasEagerState=!0,p.eagerState=C,jt(C,L))return ll(n,r,p,0),We===null&&al(),!1}catch{}finally{}if(u=ku(n,r,p,d),u!==null)return Yt(u,n,d),Jg(u,r,d),!0}return!1}function gc(n,r,u,d){if(d={lane:2,revertLane:zc(),action:d,hasEagerState:!1,eagerState:null,next:null},Al(n)){if(r)throw Error(i(479))}else r=ku(n,u,d,2),r!==null&&Yt(r,n,2)}function Al(n){var r=n.alternate;return n===Ce||r!==null&&r===Ce}function Zg(n,r){js=vl=!0;var u=n.pending;u===null?r.next=r:(r.next=u.next,u.next=r),n.pending=r}function Jg(n,r,u){if((u&4194048)!==0){var d=r.lanes;d&=n.pendingLanes,u|=d,r.lanes=u,lh(n,u)}}var Rl={readContext:Lt,use:Sl,useCallback:at,useContext:at,useEffect:at,useImperativeHandle:at,useLayoutEffect:at,useInsertionEffect:at,useMemo:at,useReducer:at,useRef:at,useState:at,useDebugValue:at,useDeferredValue:at,useTransition:at,useSyncExternalStore:at,useId:at,useHostTransitionStatus:at,useFormState:at,useActionState:at,useOptimistic:at,useMemoCache:at,useCacheRefresh:at},em={readContext:Lt,use:Sl,useCallback:function(n,r){return Nt().memoizedState=[n,r===void 0?null:r],n},useContext:Lt,useEffect:Ug,useImperativeHandle:function(n,r,u){u=u!=null?u.concat([n]):null,bl(4194308,4,Gg.bind(null,r,n),u)},useLayoutEffect:function(n,r){return bl(4194308,4,n,r)},useInsertionEffect:function(n,r){bl(4,2,n,r)},useMemo:function(n,r){var u=Nt();r=r===void 0?null:r;var d=n();if(rs){Ti(!0);try{n()}finally{Ti(!1)}}return u.memoizedState=[d,r],d},useReducer:function(n,r,u){var d=Nt();if(u!==void 0){var p=u(r);if(rs){Ti(!0);try{u(r)}finally{Ti(!1)}}}else p=r;return d.memoizedState=d.baseState=p,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:p},d.queue=n,n=n.dispatch=sT.bind(null,Ce,n),[d.memoizedState,n]},useRef:function(n){var r=Nt();return n={current:n},r.memoizedState=n},useState:function(n){n=oc(n);var r=n.queue,u=Wg.bind(null,Ce,r);return r.dispatch=u,[n.memoizedState,u]},useDebugValue:cc,useDeferredValue:function(n,r){var u=Nt();return fc(u,n,r)},useTransition:function(){var n=oc(!1);return n=zg.bind(null,Ce,n.queue,!0,!1),Nt().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,r,u){var d=Ce,p=Nt();if(Be){if(u===void 0)throw Error(i(407));u=u()}else{if(u=r(),We===null)throw Error(i(349));(Ne&124)!==0||Tg(d,r,u)}p.memoizedState=u;var v={value:u,getSnapshot:r};return p.queue=v,Ug(bg.bind(null,d,v,n),[n]),d.flags|=2048,Vs(9,xl(),xg.bind(null,d,v,u,r),null),u},useId:function(){var n=Nt(),r=We.identifierPrefix;if(Be){var u=Hi,d=ji;u=(d&~(1<<32-At(d)-1)).toString(32)+u,r=""+r+"R"+u,u=El++,0<u&&(r+="H"+u.toString(32)),r+=""}else u=ZS++,r=""+r+"r"+u.toString(32)+"";return n.memoizedState=r},useHostTransitionStatus:hc,useFormState:Og,useActionState:Og,useOptimistic:function(n){var r=Nt();r.memoizedState=r.baseState=n;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=u,r=gc.bind(null,Ce,!0,u),u.dispatch=r,[n,r]},useMemoCache:rc,useCacheRefresh:function(){return Nt().memoizedState=nT.bind(null,Ce)}},tm={readContext:Lt,use:Sl,useCallback:Hg,useContext:Lt,useEffect:Bg,useImperativeHandle:jg,useInsertionEffect:Fg,useLayoutEffect:$g,useMemo:Vg,useReducer:Tl,useRef:Ng,useState:function(){return Tl(zi)},useDebugValue:cc,useDeferredValue:function(n,r){var u=ut();return Kg(u,ze.memoizedState,n,r)},useTransition:function(){var n=Tl(zi)[0],r=ut().memoizedState;return[typeof n=="boolean"?n:Yr(n),r]},useSyncExternalStore:Sg,useId:Xg,useHostTransitionStatus:hc,useFormState:kg,useActionState:kg,useOptimistic:function(n,r){var u=ut();return Lg(u,ze,n,r)},useMemoCache:rc,useCacheRefresh:Qg},rT={readContext:Lt,use:Sl,useCallback:Hg,useContext:Lt,useEffect:Bg,useImperativeHandle:jg,useInsertionEffect:Fg,useLayoutEffect:$g,useMemo:Vg,useReducer:lc,useRef:Ng,useState:function(){return lc(zi)},useDebugValue:cc,useDeferredValue:function(n,r){var u=ut();return ze===null?fc(u,n,r):Kg(u,ze.memoizedState,n,r)},useTransition:function(){var n=lc(zi)[0],r=ut().memoizedState;return[typeof n=="boolean"?n:Yr(n),r]},useSyncExternalStore:Sg,useId:Xg,useHostTransitionStatus:hc,useFormState:Pg,useActionState:Pg,useOptimistic:function(n,r){var u=ut();return ze!==null?Lg(u,ze,n,r):(u.baseState=n,[n,u.queue.dispatch])},useMemoCache:rc,useCacheRefresh:Qg},Ks=null,Wr=0;function Ll(n){var r=Wr;return Wr+=1,Ks===null&&(Ks=[]),dg(Ks,n,r)}function Zr(n,r){r=r.props.ref,n.ref=r!==void 0?r:null}function _l(n,r){throw r.$$typeof===m?Error(i(525)):(n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)))}function im(n){var r=n._init;return r(n._payload)}function nm(n){function r(G,P){if(n){var V=G.deletions;V===null?(G.deletions=[P],G.flags|=16):V.push(P)}}function u(G,P){if(!n)return null;for(;P!==null;)r(G,P),P=P.sibling;return null}function d(G){for(var P=new Map;G!==null;)G.key!==null?P.set(G.key,G):P.set(G.index,G),G=G.sibling;return P}function p(G,P){return G=Gi(G,P),G.index=0,G.sibling=null,G}function v(G,P,V){return G.index=V,n?(V=G.alternate,V!==null?(V=V.index,V<P?(G.flags|=67108866,P):V):(G.flags|=67108866,P)):(G.flags|=1048576,P)}function L(G){return n&&G.alternate===null&&(G.flags|=67108866),G}function C(G,P,V,se){return P===null||P.tag!==6?(P=Pu(V,G.mode,se),P.return=G,P):(P=p(P,V),P.return=G,P)}function k(G,P,V,se){var ge=V.type;return ge===E?ee(G,P,V.props.children,se,V.key):P!==null&&(P.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===F&&im(ge)===P.type)?(P=p(P,V.props),Zr(P,V),P.return=G,P):(P=ul(V.type,V.key,V.props,null,G.mode,se),Zr(P,V),P.return=G,P)}function q(G,P,V,se){return P===null||P.tag!==4||P.stateNode.containerInfo!==V.containerInfo||P.stateNode.implementation!==V.implementation?(P=Nu(V,G.mode,se),P.return=G,P):(P=p(P,V.children||[]),P.return=G,P)}function ee(G,P,V,se,ge){return P===null||P.tag!==7?(P=Wn(V,G.mode,se,ge),P.return=G,P):(P=p(P,V),P.return=G,P)}function le(G,P,V){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=Pu(""+P,G.mode,V),P.return=G,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case y:return V=ul(P.type,P.key,P.props,null,G.mode,V),Zr(V,P),V.return=G,V;case S:return P=Nu(P,G.mode,V),P.return=G,P;case F:var se=P._init;return P=se(P._payload),le(G,P,V)}if(ue(P)||ae(P))return P=Wn(P,G.mode,V,null),P.return=G,P;if(typeof P.then=="function")return le(G,Ll(P),V);if(P.$$typeof===A)return le(G,hl(G,P),V);_l(G,P)}return null}function X(G,P,V,se){var ge=P!==null?P.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return ge!==null?null:C(G,P,""+V,se);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case y:return V.key===ge?k(G,P,V,se):null;case S:return V.key===ge?q(G,P,V,se):null;case F:return ge=V._init,V=ge(V._payload),X(G,P,V,se)}if(ue(V)||ae(V))return ge!==null?null:ee(G,P,V,se,null);if(typeof V.then=="function")return X(G,P,Ll(V),se);if(V.$$typeof===A)return X(G,P,hl(G,V),se);_l(G,V)}return null}function Q(G,P,V,se,ge){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return G=G.get(V)||null,C(P,G,""+se,ge);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case y:return G=G.get(se.key===null?V:se.key)||null,k(P,G,se,ge);case S:return G=G.get(se.key===null?V:se.key)||null,q(P,G,se,ge);case F:var Ie=se._init;return se=Ie(se._payload),Q(G,P,V,se,ge)}if(ue(se)||ae(se))return G=G.get(V)||null,ee(P,G,se,ge,null);if(typeof se.then=="function")return Q(G,P,V,Ll(se),ge);if(se.$$typeof===A)return Q(G,P,V,hl(P,se),ge);_l(P,se)}return null}function Ae(G,P,V,se){for(var ge=null,Ie=null,ye=P,Te=P=0,yt=null;ye!==null&&Te<V.length;Te++){ye.index>Te?(yt=ye,ye=null):yt=ye.sibling;var Ue=X(G,ye,V[Te],se);if(Ue===null){ye===null&&(ye=yt);break}n&&ye&&Ue.alternate===null&&r(G,ye),P=v(Ue,P,Te),Ie===null?ge=Ue:Ie.sibling=Ue,Ie=Ue,ye=yt}if(Te===V.length)return u(G,ye),Be&&Jn(G,Te),ge;if(ye===null){for(;Te<V.length;Te++)ye=le(G,V[Te],se),ye!==null&&(P=v(ye,P,Te),Ie===null?ge=ye:Ie.sibling=ye,Ie=ye);return Be&&Jn(G,Te),ge}for(ye=d(ye);Te<V.length;Te++)yt=Q(ye,G,Te,V[Te],se),yt!==null&&(n&&yt.alternate!==null&&ye.delete(yt.key===null?Te:yt.key),P=v(yt,P,Te),Ie===null?ge=yt:Ie.sibling=yt,Ie=yt);return n&&ye.forEach(function(Mn){return r(G,Mn)}),Be&&Jn(G,Te),ge}function Se(G,P,V,se){if(V==null)throw Error(i(151));for(var ge=null,Ie=null,ye=P,Te=P=0,yt=null,Ue=V.next();ye!==null&&!Ue.done;Te++,Ue=V.next()){ye.index>Te?(yt=ye,ye=null):yt=ye.sibling;var Mn=X(G,ye,Ue.value,se);if(Mn===null){ye===null&&(ye=yt);break}n&&ye&&Mn.alternate===null&&r(G,ye),P=v(Mn,P,Te),Ie===null?ge=Mn:Ie.sibling=Mn,Ie=Mn,ye=yt}if(Ue.done)return u(G,ye),Be&&Jn(G,Te),ge;if(ye===null){for(;!Ue.done;Te++,Ue=V.next())Ue=le(G,Ue.value,se),Ue!==null&&(P=v(Ue,P,Te),Ie===null?ge=Ue:Ie.sibling=Ue,Ie=Ue);return Be&&Jn(G,Te),ge}for(ye=d(ye);!Ue.done;Te++,Ue=V.next())Ue=Q(ye,G,Te,Ue.value,se),Ue!==null&&(n&&Ue.alternate!==null&&ye.delete(Ue.key===null?Te:Ue.key),P=v(Ue,P,Te),Ie===null?ge=Ue:Ie.sibling=Ue,Ie=Ue);return n&&ye.forEach(function(ax){return r(G,ax)}),Be&&Jn(G,Te),ge}function Ye(G,P,V,se){if(typeof V=="object"&&V!==null&&V.type===E&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case y:e:{for(var ge=V.key;P!==null;){if(P.key===ge){if(ge=V.type,ge===E){if(P.tag===7){u(G,P.sibling),se=p(P,V.props.children),se.return=G,G=se;break e}}else if(P.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===F&&im(ge)===P.type){u(G,P.sibling),se=p(P,V.props),Zr(se,V),se.return=G,G=se;break e}u(G,P);break}else r(G,P);P=P.sibling}V.type===E?(se=Wn(V.props.children,G.mode,se,V.key),se.return=G,G=se):(se=ul(V.type,V.key,V.props,null,G.mode,se),Zr(se,V),se.return=G,G=se)}return L(G);case S:e:{for(ge=V.key;P!==null;){if(P.key===ge)if(P.tag===4&&P.stateNode.containerInfo===V.containerInfo&&P.stateNode.implementation===V.implementation){u(G,P.sibling),se=p(P,V.children||[]),se.return=G,G=se;break e}else{u(G,P);break}else r(G,P);P=P.sibling}se=Nu(V,G.mode,se),se.return=G,G=se}return L(G);case F:return ge=V._init,V=ge(V._payload),Ye(G,P,V,se)}if(ue(V))return Ae(G,P,V,se);if(ae(V)){if(ge=ae(V),typeof ge!="function")throw Error(i(150));return V=ge.call(V),Se(G,P,V,se)}if(typeof V.then=="function")return Ye(G,P,Ll(V),se);if(V.$$typeof===A)return Ye(G,P,hl(G,V),se);_l(G,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,P!==null&&P.tag===6?(u(G,P.sibling),se=p(P,V),se.return=G,G=se):(u(G,P),se=Pu(V,G.mode,se),se.return=G,G=se),L(G)):u(G,P)}return function(G,P,V,se){try{Wr=0;var ge=Ye(G,P,V,se);return Ks=null,ge}catch(ye){if(ye===jr||ye===ml)throw ye;var Ie=Ht(29,ye,null,G.mode);return Ie.lanes=se,Ie.return=G,Ie}finally{}}}var zs=nm(!0),sm=nm(!1),si=Y(null),bi=null;function En(n){var r=n.alternate;ne(ft,ft.current&1),ne(si,n),bi===null&&(r===null||Gs.current!==null||r.memoizedState!==null)&&(bi=n)}function rm(n){if(n.tag===22){if(ne(ft,ft.current),ne(si,n),bi===null){var r=n.alternate;r!==null&&r.memoizedState!==null&&(bi=n)}}else Sn()}function Sn(){ne(ft,ft.current),ne(si,si.current)}function qi(n){J(si),bi===n&&(bi=null),J(ft)}var ft=Y(0);function Dl(n){for(var r=n;r!==null;){if(r.tag===13){var u=r.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||rf(u)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function mc(n,r,u,d){r=n.memoizedState,u=u(d,r),u=u==null?r:g({},r,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var pc={enqueueSetState:function(n,r,u){n=n._reactInternals;var d=qt(),p=pn(d);p.payload=r,u!=null&&(p.callback=u),r=yn(n,p,d),r!==null&&(Yt(r,n,d),Vr(r,n,d))},enqueueReplaceState:function(n,r,u){n=n._reactInternals;var d=qt(),p=pn(d);p.tag=1,p.payload=r,u!=null&&(p.callback=u),r=yn(n,p,d),r!==null&&(Yt(r,n,d),Vr(r,n,d))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var u=qt(),d=pn(u);d.tag=2,r!=null&&(d.callback=r),r=yn(n,d,u),r!==null&&(Yt(r,n,u),Vr(r,n,u))}};function am(n,r,u,d,p,v,L){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,v,L):r.prototype&&r.prototype.isPureReactComponent?!Mr(u,d)||!Mr(p,v):!0}function lm(n,r,u,d){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(u,d),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(u,d),r.state!==n&&pc.enqueueReplaceState(r,r.state,null)}function as(n,r){var u=r;if("ref"in r){u={};for(var d in r)d!=="ref"&&(u[d]=r[d])}if(n=n.defaultProps){u===r&&(u=g({},u));for(var p in n)u[p]===void 0&&(u[p]=n[p])}return u}var Cl=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function om(n){Cl(n)}function um(n){console.error(n)}function cm(n){Cl(n)}function Il(n,r){try{var u=n.onUncaughtError;u(r.value,{componentStack:r.stack})}catch(d){setTimeout(function(){throw d})}}function fm(n,r,u){try{var d=n.onCaughtError;d(u.value,{componentStack:u.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function yc(n,r,u){return u=pn(u),u.tag=3,u.payload={element:null},u.callback=function(){Il(n,r)},u}function dm(n){return n=pn(n),n.tag=3,n}function hm(n,r,u,d){var p=u.type.getDerivedStateFromError;if(typeof p=="function"){var v=d.value;n.payload=function(){return p(v)},n.callback=function(){fm(r,u,d)}}var L=u.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(n.callback=function(){fm(r,u,d),typeof p!="function"&&(Ln===null?Ln=new Set([this]):Ln.add(this));var C=d.stack;this.componentDidCatch(d.value,{componentStack:C!==null?C:""})})}function aT(n,r,u,d,p){if(u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(r=u.alternate,r!==null&&Fr(r,u,p,!0),u=si.current,u!==null){switch(u.tag){case 13:return bi===null?Gc():u.alternate===null&&rt===0&&(rt=3),u.flags&=-257,u.flags|=65536,u.lanes=p,d===zu?u.flags|=16384:(r=u.updateQueue,r===null?u.updateQueue=new Set([d]):r.add(d),Hc(n,d,p)),!1;case 22:return u.flags|=65536,d===zu?u.flags|=16384:(r=u.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([d])},u.updateQueue=r):(u=r.retryQueue,u===null?r.retryQueue=new Set([d]):u.add(d)),Hc(n,d,p)),!1}throw Error(i(435,u.tag))}return Hc(n,d,p),Gc(),!1}if(Be)return r=si.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,d!==Fu&&(n=Error(i(422),{cause:d}),Br(ei(n,u)))):(d!==Fu&&(r=Error(i(423),{cause:d}),Br(ei(r,u))),n=n.current.alternate,n.flags|=65536,p&=-p,n.lanes|=p,d=ei(d,u),p=yc(n.stateNode,d,p),Xu(n,p),rt!==4&&(rt=2)),!1;var v=Error(i(520),{cause:d});if(v=ei(v,u),ra===null?ra=[v]:ra.push(v),rt!==4&&(rt=2),r===null)return!0;d=ei(d,u),u=r;do{switch(u.tag){case 3:return u.flags|=65536,n=p&-p,u.lanes|=n,n=yc(u.stateNode,d,n),Xu(u,n),!1;case 1:if(r=u.type,v=u.stateNode,(u.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Ln===null||!Ln.has(v))))return u.flags|=65536,p&=-p,u.lanes|=p,p=dm(p),hm(p,n,u,d),Xu(u,p),!1}u=u.return}while(u!==null);return!1}var gm=Error(i(461)),mt=!1;function St(n,r,u,d){r.child=n===null?sm(r,null,u,d):zs(r,n.child,u,d)}function mm(n,r,u,d,p){u=u.render;var v=r.ref;if("ref"in d){var L={};for(var C in d)C!=="ref"&&(L[C]=d[C])}else L=d;return ns(r),d=ec(n,r,u,L,v,p),C=tc(),n!==null&&!mt?(ic(n,r,p),Yi(n,r,p)):(Be&&C&&Uu(r),r.flags|=1,St(n,r,d,p),r.child)}function pm(n,r,u,d,p){if(n===null){var v=u.type;return typeof v=="function"&&!Mu(v)&&v.defaultProps===void 0&&u.compare===null?(r.tag=15,r.type=v,ym(n,r,v,d,p)):(n=ul(u.type,null,d,r,r.mode,p),n.ref=r.ref,n.return=r,r.child=n)}if(v=n.child,!Rc(n,p)){var L=v.memoizedProps;if(u=u.compare,u=u!==null?u:Mr,u(L,d)&&n.ref===r.ref)return Yi(n,r,p)}return r.flags|=1,n=Gi(v,d),n.ref=r.ref,n.return=r,r.child=n}function ym(n,r,u,d,p){if(n!==null){var v=n.memoizedProps;if(Mr(v,d)&&n.ref===r.ref)if(mt=!1,r.pendingProps=d=v,Rc(n,p))(n.flags&131072)!==0&&(mt=!0);else return r.lanes=n.lanes,Yi(n,r,p)}return vc(n,r,u,d,p)}function vm(n,r,u){var d=r.pendingProps,p=d.children,v=n!==null?n.memoizedState:null;if(d.mode==="hidden"){if((r.flags&128)!==0){if(d=v!==null?v.baseLanes|u:u,n!==null){for(p=r.child=n.child,v=0;p!==null;)v=v|p.lanes|p.childLanes,p=p.sibling;r.childLanes=v&~d}else r.childLanes=0,r.child=null;return Em(n,r,d,u)}if((u&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},n!==null&&gl(r,v!==null?v.cachePool:null),v!==null?yg(r,v):Wu(),rm(r);else return r.lanes=r.childLanes=536870912,Em(n,r,v!==null?v.baseLanes|u:u,u)}else v!==null?(gl(r,v.cachePool),yg(r,v),Sn(),r.memoizedState=null):(n!==null&&gl(r,null),Wu(),Sn());return St(n,r,p,u),r.child}function Em(n,r,u,d){var p=Ku();return p=p===null?null:{parent:ct._currentValue,pool:p},r.memoizedState={baseLanes:u,cachePool:p},n!==null&&gl(r,null),Wu(),rm(r),n!==null&&Fr(n,r,d,!0),null}function wl(n,r){var u=r.ref;if(u===null)n!==null&&n.ref!==null&&(r.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(n===null||n.ref!==u)&&(r.flags|=4194816)}}function vc(n,r,u,d,p){return ns(r),u=ec(n,r,u,d,void 0,p),d=tc(),n!==null&&!mt?(ic(n,r,p),Yi(n,r,p)):(Be&&d&&Uu(r),r.flags|=1,St(n,r,u,p),r.child)}function Sm(n,r,u,d,p,v){return ns(r),r.updateQueue=null,u=Eg(r,d,u,p),vg(n),d=tc(),n!==null&&!mt?(ic(n,r,v),Yi(n,r,v)):(Be&&d&&Uu(r),r.flags|=1,St(n,r,u,v),r.child)}function Tm(n,r,u,d,p){if(ns(r),r.stateNode===null){var v=Ns,L=u.contextType;typeof L=="object"&&L!==null&&(v=Lt(L)),v=new u(d,v),r.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=pc,r.stateNode=v,v._reactInternals=r,v=r.stateNode,v.props=d,v.state=r.memoizedState,v.refs={},qu(r),L=u.contextType,v.context=typeof L=="object"&&L!==null?Lt(L):Ns,v.state=r.memoizedState,L=u.getDerivedStateFromProps,typeof L=="function"&&(mc(r,u,L,d),v.state=r.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(L=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),L!==v.state&&pc.enqueueReplaceState(v,v.state,null),zr(r,d,v,p),Kr(),v.state=r.memoizedState),typeof v.componentDidMount=="function"&&(r.flags|=4194308),d=!0}else if(n===null){v=r.stateNode;var C=r.memoizedProps,k=as(u,C);v.props=k;var q=v.context,ee=u.contextType;L=Ns,typeof ee=="object"&&ee!==null&&(L=Lt(ee));var le=u.getDerivedStateFromProps;ee=typeof le=="function"||typeof v.getSnapshotBeforeUpdate=="function",C=r.pendingProps!==C,ee||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(C||q!==L)&&lm(r,v,d,L),mn=!1;var X=r.memoizedState;v.state=X,zr(r,d,v,p),Kr(),q=r.memoizedState,C||X!==q||mn?(typeof le=="function"&&(mc(r,u,le,d),q=r.memoizedState),(k=mn||am(r,u,k,d,X,q,L))?(ee||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(r.flags|=4194308)):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=d,r.memoizedState=q),v.props=d,v.state=q,v.context=L,d=k):(typeof v.componentDidMount=="function"&&(r.flags|=4194308),d=!1)}else{v=r.stateNode,Yu(n,r),L=r.memoizedProps,ee=as(u,L),v.props=ee,le=r.pendingProps,X=v.context,q=u.contextType,k=Ns,typeof q=="object"&&q!==null&&(k=Lt(q)),C=u.getDerivedStateFromProps,(q=typeof C=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(L!==le||X!==k)&&lm(r,v,d,k),mn=!1,X=r.memoizedState,v.state=X,zr(r,d,v,p),Kr();var Q=r.memoizedState;L!==le||X!==Q||mn||n!==null&&n.dependencies!==null&&dl(n.dependencies)?(typeof C=="function"&&(mc(r,u,C,d),Q=r.memoizedState),(ee=mn||am(r,u,ee,d,X,Q,k)||n!==null&&n.dependencies!==null&&dl(n.dependencies))?(q||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,Q,k),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,Q,k)),typeof v.componentDidUpdate=="function"&&(r.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof v.componentDidUpdate!="function"||L===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||L===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),r.memoizedProps=d,r.memoizedState=Q),v.props=d,v.state=Q,v.context=k,d=ee):(typeof v.componentDidUpdate!="function"||L===n.memoizedProps&&X===n.memoizedState||(r.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||L===n.memoizedProps&&X===n.memoizedState||(r.flags|=1024),d=!1)}return v=d,wl(n,r),d=(r.flags&128)!==0,v||d?(v=r.stateNode,u=d&&typeof u.getDerivedStateFromError!="function"?null:v.render(),r.flags|=1,n!==null&&d?(r.child=zs(r,n.child,null,p),r.child=zs(r,null,u,p)):St(n,r,u,p),r.memoizedState=v.state,n=r.child):n=Yi(n,r,p),n}function xm(n,r,u,d){return Ur(),r.flags|=256,St(n,r,u,d),r.child}var Ec={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Sc(n){return{baseLanes:n,cachePool:ug()}}function Tc(n,r,u){return n=n!==null?n.childLanes&~u:0,r&&(n|=ri),n}function bm(n,r,u){var d=r.pendingProps,p=!1,v=(r.flags&128)!==0,L;if((L=v)||(L=n!==null&&n.memoizedState===null?!1:(ft.current&2)!==0),L&&(p=!0,r.flags&=-129),L=(r.flags&32)!==0,r.flags&=-33,n===null){if(Be){if(p?En(r):Sn(),Be){var C=st,k;if(k=C){e:{for(k=C,C=xi;k.nodeType!==8;){if(!C){C=null;break e}if(k=gi(k.nextSibling),k===null){C=null;break e}}C=k}C!==null?(r.memoizedState={dehydrated:C,treeContext:Zn!==null?{id:ji,overflow:Hi}:null,retryLane:536870912,hydrationErrors:null},k=Ht(18,null,null,0),k.stateNode=C,k.return=r,r.child=k,wt=r,st=null,k=!0):k=!1}k||ts(r)}if(C=r.memoizedState,C!==null&&(C=C.dehydrated,C!==null))return rf(C)?r.lanes=32:r.lanes=536870912,null;qi(r)}return C=d.children,d=d.fallback,p?(Sn(),p=r.mode,C=Ol({mode:"hidden",children:C},p),d=Wn(d,p,u,null),C.return=r,d.return=r,C.sibling=d,r.child=C,p=r.child,p.memoizedState=Sc(u),p.childLanes=Tc(n,L,u),r.memoizedState=Ec,d):(En(r),xc(r,C))}if(k=n.memoizedState,k!==null&&(C=k.dehydrated,C!==null)){if(v)r.flags&256?(En(r),r.flags&=-257,r=bc(n,r,u)):r.memoizedState!==null?(Sn(),r.child=n.child,r.flags|=128,r=null):(Sn(),p=d.fallback,C=r.mode,d=Ol({mode:"visible",children:d.children},C),p=Wn(p,C,u,null),p.flags|=2,d.return=r,p.return=r,d.sibling=p,r.child=d,zs(r,n.child,null,u),d=r.child,d.memoizedState=Sc(u),d.childLanes=Tc(n,L,u),r.memoizedState=Ec,r=p);else if(En(r),rf(C)){if(L=C.nextSibling&&C.nextSibling.dataset,L)var q=L.dgst;L=q,d=Error(i(419)),d.stack="",d.digest=L,Br({value:d,source:null,stack:null}),r=bc(n,r,u)}else if(mt||Fr(n,r,u,!1),L=(u&n.childLanes)!==0,mt||L){if(L=We,L!==null&&(d=u&-u,d=(d&42)!==0?1:ru(d),d=(d&(L.suspendedLanes|u))!==0?0:d,d!==0&&d!==k.retryLane))throw k.retryLane=d,Ps(n,d),Yt(L,n,d),gm;C.data==="$?"||Gc(),r=bc(n,r,u)}else C.data==="$?"?(r.flags|=192,r.child=n.child,r=null):(n=k.treeContext,st=gi(C.nextSibling),wt=r,Be=!0,es=null,xi=!1,n!==null&&(ii[ni++]=ji,ii[ni++]=Hi,ii[ni++]=Zn,ji=n.id,Hi=n.overflow,Zn=r),r=xc(r,d.children),r.flags|=4096);return r}return p?(Sn(),p=d.fallback,C=r.mode,k=n.child,q=k.sibling,d=Gi(k,{mode:"hidden",children:d.children}),d.subtreeFlags=k.subtreeFlags&65011712,q!==null?p=Gi(q,p):(p=Wn(p,C,u,null),p.flags|=2),p.return=r,d.return=r,d.sibling=p,r.child=d,d=p,p=r.child,C=n.child.memoizedState,C===null?C=Sc(u):(k=C.cachePool,k!==null?(q=ct._currentValue,k=k.parent!==q?{parent:q,pool:q}:k):k=ug(),C={baseLanes:C.baseLanes|u,cachePool:k}),p.memoizedState=C,p.childLanes=Tc(n,L,u),r.memoizedState=Ec,d):(En(r),u=n.child,n=u.sibling,u=Gi(u,{mode:"visible",children:d.children}),u.return=r,u.sibling=null,n!==null&&(L=r.deletions,L===null?(r.deletions=[n],r.flags|=16):L.push(n)),r.child=u,r.memoizedState=null,u)}function xc(n,r){return r=Ol({mode:"visible",children:r},n.mode),r.return=n,n.child=r}function Ol(n,r){return n=Ht(22,n,null,r),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function bc(n,r,u){return zs(r,n.child,null,u),n=xc(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function Am(n,r,u){n.lanes|=r;var d=n.alternate;d!==null&&(d.lanes|=r),Gu(n.return,r,u)}function Ac(n,r,u,d,p){var v=n.memoizedState;v===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:p}:(v.isBackwards=r,v.rendering=null,v.renderingStartTime=0,v.last=d,v.tail=u,v.tailMode=p)}function Rm(n,r,u){var d=r.pendingProps,p=d.revealOrder,v=d.tail;if(St(n,r,d.children,u),d=ft.current,(d&2)!==0)d=d&1|2,r.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Am(n,u,r);else if(n.tag===19)Am(n,u,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}d&=1}switch(ne(ft,d),p){case"forwards":for(u=r.child,p=null;u!==null;)n=u.alternate,n!==null&&Dl(n)===null&&(p=u),u=u.sibling;u=p,u===null?(p=r.child,r.child=null):(p=u.sibling,u.sibling=null),Ac(r,!1,p,u,v);break;case"backwards":for(u=null,p=r.child,r.child=null;p!==null;){if(n=p.alternate,n!==null&&Dl(n)===null){r.child=p;break}n=p.sibling,p.sibling=u,u=p,p=n}Ac(r,!0,u,null,v);break;case"together":Ac(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Yi(n,r,u){if(n!==null&&(r.dependencies=n.dependencies),Rn|=r.lanes,(u&r.childLanes)===0)if(n!==null){if(Fr(n,r,u,!1),(u&r.childLanes)===0)return null}else return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,u=Gi(n,n.pendingProps),r.child=u,u.return=r;n.sibling!==null;)n=n.sibling,u=u.sibling=Gi(n,n.pendingProps),u.return=r;u.sibling=null}return r.child}function Rc(n,r){return(n.lanes&r)!==0?!0:(n=n.dependencies,!!(n!==null&&dl(n)))}function lT(n,r,u){switch(r.tag){case 3:be(r,r.stateNode.containerInfo),gn(r,ct,n.memoizedState.cache),Ur();break;case 27:case 5:Ui(r);break;case 4:be(r,r.stateNode.containerInfo);break;case 10:gn(r,r.type,r.memoizedProps.value);break;case 13:var d=r.memoizedState;if(d!==null)return d.dehydrated!==null?(En(r),r.flags|=128,null):(u&r.child.childLanes)!==0?bm(n,r,u):(En(r),n=Yi(n,r,u),n!==null?n.sibling:null);En(r);break;case 19:var p=(n.flags&128)!==0;if(d=(u&r.childLanes)!==0,d||(Fr(n,r,u,!1),d=(u&r.childLanes)!==0),p){if(d)return Rm(n,r,u);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ne(ft,ft.current),d)break;return null;case 22:case 23:return r.lanes=0,vm(n,r,u);case 24:gn(r,ct,n.memoizedState.cache)}return Yi(n,r,u)}function Lm(n,r,u){if(n!==null)if(n.memoizedProps!==r.pendingProps)mt=!0;else{if(!Rc(n,u)&&(r.flags&128)===0)return mt=!1,lT(n,r,u);mt=(n.flags&131072)!==0}else mt=!1,Be&&(r.flags&1048576)!==0&&ig(r,fl,r.index);switch(r.lanes=0,r.tag){case 16:e:{n=r.pendingProps;var d=r.elementType,p=d._init;if(d=p(d._payload),r.type=d,typeof d=="function")Mu(d)?(n=as(d,n),r.tag=1,r=Tm(null,r,d,n,u)):(r.tag=0,r=vc(null,r,d,n,u));else{if(d!=null){if(p=d.$$typeof,p===O){r.tag=11,r=mm(null,r,d,n,u);break e}else if(p===M){r.tag=14,r=pm(null,r,d,n,u);break e}}throw r=de(d)||d,Error(i(306,r,""))}}return r;case 0:return vc(n,r,r.type,r.pendingProps,u);case 1:return d=r.type,p=as(d,r.pendingProps),Tm(n,r,d,p,u);case 3:e:{if(be(r,r.stateNode.containerInfo),n===null)throw Error(i(387));d=r.pendingProps;var v=r.memoizedState;p=v.element,Yu(n,r),zr(r,d,null,u);var L=r.memoizedState;if(d=L.cache,gn(r,ct,d),d!==v.cache&&ju(r,[ct],u,!0),Kr(),d=L.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:L.cache},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){r=xm(n,r,d,u);break e}else if(d!==p){p=ei(Error(i(424)),r),Br(p),r=xm(n,r,d,u);break e}else{switch(n=r.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(st=gi(n.firstChild),wt=r,Be=!0,es=null,xi=!0,u=sm(r,null,d,u),r.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Ur(),d===p){r=Yi(n,r,u);break e}St(n,r,d,u)}r=r.child}return r;case 26:return wl(n,r),n===null?(u=I0(r.type,null,r.pendingProps,null))?r.memoizedState=u:Be||(u=r.type,n=r.pendingProps,d=zl(ce.current).createElement(u),d[Rt]=r,d[Mt]=n,xt(d,u,n),gt(d),r.stateNode=d):r.memoizedState=I0(r.type,n.memoizedProps,r.pendingProps,n.memoizedState),null;case 27:return Ui(r),n===null&&Be&&(d=r.stateNode=_0(r.type,r.pendingProps,ce.current),wt=r,xi=!0,p=st,Cn(r.type)?(af=p,st=gi(d.firstChild)):st=p),St(n,r,r.pendingProps.children,u),wl(n,r),n===null&&(r.flags|=4194304),r.child;case 5:return n===null&&Be&&((p=d=st)&&(d=PT(d,r.type,r.pendingProps,xi),d!==null?(r.stateNode=d,wt=r,st=gi(d.firstChild),xi=!1,p=!0):p=!1),p||ts(r)),Ui(r),p=r.type,v=r.pendingProps,L=n!==null?n.memoizedProps:null,d=v.children,tf(p,v)?d=null:L!==null&&tf(p,L)&&(r.flags|=32),r.memoizedState!==null&&(p=ec(n,r,JS,null,null,u),ga._currentValue=p),wl(n,r),St(n,r,d,u),r.child;case 6:return n===null&&Be&&((n=u=st)&&(u=NT(u,r.pendingProps,xi),u!==null?(r.stateNode=u,wt=r,st=null,n=!0):n=!1),n||ts(r)),null;case 13:return bm(n,r,u);case 4:return be(r,r.stateNode.containerInfo),d=r.pendingProps,n===null?r.child=zs(r,null,d,u):St(n,r,d,u),r.child;case 11:return mm(n,r,r.type,r.pendingProps,u);case 7:return St(n,r,r.pendingProps,u),r.child;case 8:return St(n,r,r.pendingProps.children,u),r.child;case 12:return St(n,r,r.pendingProps.children,u),r.child;case 10:return d=r.pendingProps,gn(r,r.type,d.value),St(n,r,d.children,u),r.child;case 9:return p=r.type._context,d=r.pendingProps.children,ns(r),p=Lt(p),d=d(p),r.flags|=1,St(n,r,d,u),r.child;case 14:return pm(n,r,r.type,r.pendingProps,u);case 15:return ym(n,r,r.type,r.pendingProps,u);case 19:return Rm(n,r,u);case 31:return d=r.pendingProps,u=r.mode,d={mode:d.mode,children:d.children},n===null?(u=Ol(d,u),u.ref=r.ref,r.child=u,u.return=r,r=u):(u=Gi(n.child,d),u.ref=r.ref,r.child=u,u.return=r,r=u),r;case 22:return vm(n,r,u);case 24:return ns(r),d=Lt(ct),n===null?(p=Ku(),p===null&&(p=We,v=Hu(),p.pooledCache=v,v.refCount++,v!==null&&(p.pooledCacheLanes|=u),p=v),r.memoizedState={parent:d,cache:p},qu(r),gn(r,ct,p)):((n.lanes&u)!==0&&(Yu(n,r),zr(r,null,null,u),Kr()),p=n.memoizedState,v=r.memoizedState,p.parent!==d?(p={parent:d,cache:d},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),gn(r,ct,d)):(d=v.cache,gn(r,ct,d),d!==p.cache&&ju(r,[ct],u,!0))),St(n,r,r.pendingProps.children,u),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function Xi(n){n.flags|=4}function _m(n,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!P0(r)){if(r=si.current,r!==null&&((Ne&4194048)===Ne?bi!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||r!==bi))throw Hr=zu,cg;n.flags|=8192}}function kl(n,r){r!==null&&(n.flags|=4),n.flags&16384&&(r=n.tag!==22?rh():536870912,n.lanes|=r,Qs|=r)}function Jr(n,r){if(!Be)switch(n.tailMode){case"hidden":r=n.tail;for(var u=null;r!==null;)r.alternate!==null&&(u=r),r=r.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function tt(n){var r=n.alternate!==null&&n.alternate.child===n.child,u=0,d=0;if(r)for(var p=n.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags&65011712,d|=p.flags&65011712,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)u|=p.lanes|p.childLanes,d|=p.subtreeFlags,d|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=d,n.childLanes=u,r}function oT(n,r,u){var d=r.pendingProps;switch(Bu(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(r),null;case 1:return tt(r),null;case 3:return u=r.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),r.memoizedState.cache!==d&&(r.flags|=2048),Ki(ct),et(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(Nr(r)?Xi(r):n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,rg())),tt(r),null;case 26:return u=r.memoizedState,n===null?(Xi(r),u!==null?(tt(r),_m(r,u)):(tt(r),r.flags&=-16777217)):u?u!==n.memoizedState?(Xi(r),tt(r),_m(r,u)):(tt(r),r.flags&=-16777217):(n.memoizedProps!==d&&Xi(r),tt(r),r.flags&=-16777217),null;case 27:Es(r),u=ce.current;var p=r.type;if(n!==null&&r.stateNode!=null)n.memoizedProps!==d&&Xi(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return tt(r),null}n=oe.current,Nr(r)?ng(r):(n=_0(p,d,u),r.stateNode=n,Xi(r))}return tt(r),null;case 5:if(Es(r),u=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==d&&Xi(r);else{if(!d){if(r.stateNode===null)throw Error(i(166));return tt(r),null}if(n=oe.current,Nr(r))ng(r);else{switch(p=zl(ce.current),n){case 1:n=p.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:n=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":n=p.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":n=p.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":n=p.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof d.is=="string"?p.createElement("select",{is:d.is}):p.createElement("select"),d.multiple?n.multiple=!0:d.size&&(n.size=d.size);break;default:n=typeof d.is=="string"?p.createElement(u,{is:d.is}):p.createElement(u)}}n[Rt]=r,n[Mt]=d;e:for(p=r.child;p!==null;){if(p.tag===5||p.tag===6)n.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===r)break e;for(;p.sibling===null;){if(p.return===null||p.return===r)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}r.stateNode=n;e:switch(xt(n,u,d),u){case"button":case"input":case"select":case"textarea":n=!!d.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Xi(r)}}return tt(r),r.flags&=-16777217,null;case 6:if(n&&r.stateNode!=null)n.memoizedProps!==d&&Xi(r);else{if(typeof d!="string"&&r.stateNode===null)throw Error(i(166));if(n=ce.current,Nr(r)){if(n=r.stateNode,u=r.memoizedProps,d=null,p=wt,p!==null)switch(p.tag){case 27:case 5:d=p.memoizedProps}n[Rt]=r,n=!!(n.nodeValue===u||d!==null&&d.suppressHydrationWarning===!0||S0(n.nodeValue,u)),n||ts(r)}else n=zl(n).createTextNode(d),n[Rt]=r,r.stateNode=n}return tt(r),null;case 13:if(d=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(p=Nr(r),d!==null&&d.dehydrated!==null){if(n===null){if(!p)throw Error(i(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Rt]=r}else Ur(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;tt(r),p=!1}else p=rg(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(qi(r),r):(qi(r),null)}if(qi(r),(r.flags&128)!==0)return r.lanes=u,r;if(u=d!==null,n=n!==null&&n.memoizedState!==null,u){d=r.child,p=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(p=d.alternate.memoizedState.cachePool.pool);var v=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==p&&(d.flags|=2048)}return u!==n&&u&&(r.child.flags|=8192),kl(r,r.updateQueue),tt(r),null;case 4:return et(),n===null&&Qc(r.stateNode.containerInfo),tt(r),null;case 10:return Ki(r.type),tt(r),null;case 19:if(J(ft),p=r.memoizedState,p===null)return tt(r),null;if(d=(r.flags&128)!==0,v=p.rendering,v===null)if(d)Jr(p,!1);else{if(rt!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(v=Dl(n),v!==null){for(r.flags|=128,Jr(p,!1),n=v.updateQueue,r.updateQueue=n,kl(r,n),r.subtreeFlags=0,n=u,u=r.child;u!==null;)tg(u,n),u=u.sibling;return ne(ft,ft.current&1|2),r.child}n=n.sibling}p.tail!==null&&Xe()>Nl&&(r.flags|=128,d=!0,Jr(p,!1),r.lanes=4194304)}else{if(!d)if(n=Dl(v),n!==null){if(r.flags|=128,d=!0,n=n.updateQueue,r.updateQueue=n,kl(r,n),Jr(p,!0),p.tail===null&&p.tailMode==="hidden"&&!v.alternate&&!Be)return tt(r),null}else 2*Xe()-p.renderingStartTime>Nl&&u!==536870912&&(r.flags|=128,d=!0,Jr(p,!1),r.lanes=4194304);p.isBackwards?(v.sibling=r.child,r.child=v):(n=p.last,n!==null?n.sibling=v:r.child=v,p.last=v)}return p.tail!==null?(r=p.tail,p.rendering=r,p.tail=r.sibling,p.renderingStartTime=Xe(),r.sibling=null,n=ft.current,ne(ft,d?n&1|2:n&1),r):(tt(r),null);case 22:case 23:return qi(r),Zu(),d=r.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(r.flags|=8192):d&&(r.flags|=8192),d?(u&536870912)!==0&&(r.flags&128)===0&&(tt(r),r.subtreeFlags&6&&(r.flags|=8192)):tt(r),u=r.updateQueue,u!==null&&kl(r,u.retryQueue),u=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==u&&(r.flags|=2048),n!==null&&J(ss),null;case 24:return u=null,n!==null&&(u=n.memoizedState.cache),r.memoizedState.cache!==u&&(r.flags|=2048),Ki(ct),tt(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function uT(n,r){switch(Bu(r),r.tag){case 1:return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Ki(ct),et(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 26:case 27:case 5:return Es(r),null;case 13:if(qi(r),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Ur()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return J(ft),null;case 4:return et(),null;case 10:return Ki(r.type),null;case 22:case 23:return qi(r),Zu(),n!==null&&J(ss),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 24:return Ki(ct),null;case 25:return null;default:return null}}function Dm(n,r){switch(Bu(r),r.tag){case 3:Ki(ct),et();break;case 26:case 27:case 5:Es(r);break;case 4:et();break;case 13:qi(r);break;case 19:J(ft);break;case 10:Ki(r.type);break;case 22:case 23:qi(r),Zu(),n!==null&&J(ss);break;case 24:Ki(ct)}}function ea(n,r){try{var u=r.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var p=d.next;u=p;do{if((u.tag&n)===n){d=void 0;var v=u.create,L=u.inst;d=v(),L.destroy=d}u=u.next}while(u!==p)}}catch(C){Qe(r,r.return,C)}}function Tn(n,r,u){try{var d=r.updateQueue,p=d!==null?d.lastEffect:null;if(p!==null){var v=p.next;d=v;do{if((d.tag&n)===n){var L=d.inst,C=L.destroy;if(C!==void 0){L.destroy=void 0,p=r;var k=u,q=C;try{q()}catch(ee){Qe(p,k,ee)}}}d=d.next}while(d!==v)}}catch(ee){Qe(r,r.return,ee)}}function Cm(n){var r=n.updateQueue;if(r!==null){var u=n.stateNode;try{pg(r,u)}catch(d){Qe(n,n.return,d)}}}function Im(n,r,u){u.props=as(n.type,n.memoizedProps),u.state=n.memoizedState;try{u.componentWillUnmount()}catch(d){Qe(n,r,d)}}function ta(n,r){try{var u=n.ref;if(u!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof u=="function"?n.refCleanup=u(d):u.current=d}}catch(p){Qe(n,r,p)}}function Ai(n,r){var u=n.ref,d=n.refCleanup;if(u!==null)if(typeof d=="function")try{d()}catch(p){Qe(n,r,p)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(p){Qe(n,r,p)}else u.current=null}function wm(n){var r=n.type,u=n.memoizedProps,d=n.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":u.autoFocus&&d.focus();break e;case"img":u.src?d.src=u.src:u.srcSet&&(d.srcset=u.srcSet)}}catch(p){Qe(n,n.return,p)}}function Lc(n,r,u){try{var d=n.stateNode;IT(d,n.type,u,r),d[Mt]=r}catch(p){Qe(n,n.return,p)}}function Om(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Cn(n.type)||n.tag===4}function _c(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Om(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Cn(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Dc(n,r,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,r?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(n,r):(r=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,r.appendChild(n),u=u._reactRootContainer,u!=null||r.onclick!==null||(r.onclick=Kl));else if(d!==4&&(d===27&&Cn(n.type)&&(u=n.stateNode,r=null),n=n.child,n!==null))for(Dc(n,r,u),n=n.sibling;n!==null;)Dc(n,r,u),n=n.sibling}function Ml(n,r,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,r?u.insertBefore(n,r):u.appendChild(n);else if(d!==4&&(d===27&&Cn(n.type)&&(u=n.stateNode),n=n.child,n!==null))for(Ml(n,r,u),n=n.sibling;n!==null;)Ml(n,r,u),n=n.sibling}function km(n){var r=n.stateNode,u=n.memoizedProps;try{for(var d=n.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);xt(r,d,u),r[Rt]=n,r[Mt]=u}catch(v){Qe(n,n.return,v)}}var Qi=!1,lt=!1,Cc=!1,Mm=typeof WeakSet=="function"?WeakSet:Set,pt=null;function cT(n,r){if(n=n.containerInfo,Jc=Zl,n=Kh(n),_u(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var p=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{u.nodeType,v.nodeType}catch{u=null;break e}var L=0,C=-1,k=-1,q=0,ee=0,le=n,X=null;t:for(;;){for(var Q;le!==u||p!==0&&le.nodeType!==3||(C=L+p),le!==v||d!==0&&le.nodeType!==3||(k=L+d),le.nodeType===3&&(L+=le.nodeValue.length),(Q=le.firstChild)!==null;)X=le,le=Q;for(;;){if(le===n)break t;if(X===u&&++q===p&&(C=L),X===v&&++ee===d&&(k=L),(Q=le.nextSibling)!==null)break;le=X,X=le.parentNode}le=Q}u=C===-1||k===-1?null:{start:C,end:k}}else u=null}u=u||{start:0,end:0}}else u=null;for(ef={focusedElem:n,selectionRange:u},Zl=!1,pt=r;pt!==null;)if(r=pt,n=r.child,(r.subtreeFlags&1024)!==0&&n!==null)n.return=r,pt=n;else for(;pt!==null;){switch(r=pt,v=r.alternate,n=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&v!==null){n=void 0,u=r,p=v.memoizedProps,v=v.memoizedState,d=u.stateNode;try{var Ae=as(u.type,p,u.elementType===u.type);n=d.getSnapshotBeforeUpdate(Ae,v),d.__reactInternalSnapshotBeforeUpdate=n}catch(Se){Qe(u,u.return,Se)}}break;case 3:if((n&1024)!==0){if(n=r.stateNode.containerInfo,u=n.nodeType,u===9)sf(n);else if(u===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":sf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=r.sibling,n!==null){n.return=r.return,pt=n;break}pt=r.return}}function Pm(n,r,u){var d=u.flags;switch(u.tag){case 0:case 11:case 15:xn(n,u),d&4&&ea(5,u);break;case 1:if(xn(n,u),d&4)if(n=u.stateNode,r===null)try{n.componentDidMount()}catch(L){Qe(u,u.return,L)}else{var p=as(u.type,r.memoizedProps);r=r.memoizedState;try{n.componentDidUpdate(p,r,n.__reactInternalSnapshotBeforeUpdate)}catch(L){Qe(u,u.return,L)}}d&64&&Cm(u),d&512&&ta(u,u.return);break;case 3:if(xn(n,u),d&64&&(n=u.updateQueue,n!==null)){if(r=null,u.child!==null)switch(u.child.tag){case 27:case 5:r=u.child.stateNode;break;case 1:r=u.child.stateNode}try{pg(n,r)}catch(L){Qe(u,u.return,L)}}break;case 27:r===null&&d&4&&km(u);case 26:case 5:xn(n,u),r===null&&d&4&&wm(u),d&512&&ta(u,u.return);break;case 12:xn(n,u);break;case 13:xn(n,u),d&4&&Bm(n,u),d&64&&(n=u.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(u=ET.bind(null,u),UT(n,u))));break;case 22:if(d=u.memoizedState!==null||Qi,!d){r=r!==null&&r.memoizedState!==null||lt,p=Qi;var v=lt;Qi=d,(lt=r)&&!v?bn(n,u,(u.subtreeFlags&8772)!==0):xn(n,u),Qi=p,lt=v}break;case 30:break;default:xn(n,u)}}function Nm(n){var r=n.alternate;r!==null&&(n.alternate=null,Nm(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&ou(r)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Ze=null,Ut=!1;function Wi(n,r,u){for(u=u.child;u!==null;)Um(n,r,u),u=u.sibling}function Um(n,r,u){if(bt&&typeof bt.onCommitFiberUnmount=="function")try{bt.onCommitFiberUnmount(fi,u)}catch{}switch(u.tag){case 26:lt||Ai(u,r),Wi(n,r,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:lt||Ai(u,r);var d=Ze,p=Ut;Cn(u.type)&&(Ze=u.stateNode,Ut=!1),Wi(n,r,u),ca(u.stateNode),Ze=d,Ut=p;break;case 5:lt||Ai(u,r);case 6:if(d=Ze,p=Ut,Ze=null,Wi(n,r,u),Ze=d,Ut=p,Ze!==null)if(Ut)try{(Ze.nodeType===9?Ze.body:Ze.nodeName==="HTML"?Ze.ownerDocument.body:Ze).removeChild(u.stateNode)}catch(v){Qe(u,r,v)}else try{Ze.removeChild(u.stateNode)}catch(v){Qe(u,r,v)}break;case 18:Ze!==null&&(Ut?(n=Ze,R0(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,u.stateNode),va(n)):R0(Ze,u.stateNode));break;case 4:d=Ze,p=Ut,Ze=u.stateNode.containerInfo,Ut=!0,Wi(n,r,u),Ze=d,Ut=p;break;case 0:case 11:case 14:case 15:lt||Tn(2,u,r),lt||Tn(4,u,r),Wi(n,r,u);break;case 1:lt||(Ai(u,r),d=u.stateNode,typeof d.componentWillUnmount=="function"&&Im(u,r,d)),Wi(n,r,u);break;case 21:Wi(n,r,u);break;case 22:lt=(d=lt)||u.memoizedState!==null,Wi(n,r,u),lt=d;break;default:Wi(n,r,u)}}function Bm(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{va(n)}catch(u){Qe(r,r.return,u)}}function fT(n){switch(n.tag){case 13:case 19:var r=n.stateNode;return r===null&&(r=n.stateNode=new Mm),r;case 22:return n=n.stateNode,r=n._retryCache,r===null&&(r=n._retryCache=new Mm),r;default:throw Error(i(435,n.tag))}}function Ic(n,r){var u=fT(n);r.forEach(function(d){var p=ST.bind(null,n,d);u.has(d)||(u.add(d),d.then(p,p))})}function Vt(n,r){var u=r.deletions;if(u!==null)for(var d=0;d<u.length;d++){var p=u[d],v=n,L=r,C=L;e:for(;C!==null;){switch(C.tag){case 27:if(Cn(C.type)){Ze=C.stateNode,Ut=!1;break e}break;case 5:Ze=C.stateNode,Ut=!1;break e;case 3:case 4:Ze=C.stateNode.containerInfo,Ut=!0;break e}C=C.return}if(Ze===null)throw Error(i(160));Um(v,L,p),Ze=null,Ut=!1,v=p.alternate,v!==null&&(v.return=null),p.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)Fm(r,n),r=r.sibling}var hi=null;function Fm(n,r){var u=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Vt(r,n),Kt(n),d&4&&(Tn(3,n,n.return),ea(3,n),Tn(5,n,n.return));break;case 1:Vt(r,n),Kt(n),d&512&&(lt||u===null||Ai(u,u.return)),d&64&&Qi&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(u=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=u===null?d:u.concat(d))));break;case 26:var p=hi;if(Vt(r,n),Kt(n),d&512&&(lt||u===null||Ai(u,u.return)),d&4){var v=u!==null?u.memoizedState:null;if(d=n.memoizedState,u===null)if(d===null)if(n.stateNode===null){e:{d=n.type,u=n.memoizedProps,p=p.ownerDocument||p;t:switch(d){case"title":v=p.getElementsByTagName("title")[0],(!v||v[Rr]||v[Rt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=p.createElement(d),p.head.insertBefore(v,p.querySelector("head > title"))),xt(v,d,u),v[Rt]=n,gt(v),d=v;break e;case"link":var L=k0("link","href",p).get(d+(u.href||""));if(L){for(var C=0;C<L.length;C++)if(v=L[C],v.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&v.getAttribute("rel")===(u.rel==null?null:u.rel)&&v.getAttribute("title")===(u.title==null?null:u.title)&&v.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){L.splice(C,1);break t}}v=p.createElement(d),xt(v,d,u),p.head.appendChild(v);break;case"meta":if(L=k0("meta","content",p).get(d+(u.content||""))){for(C=0;C<L.length;C++)if(v=L[C],v.getAttribute("content")===(u.content==null?null:""+u.content)&&v.getAttribute("name")===(u.name==null?null:u.name)&&v.getAttribute("property")===(u.property==null?null:u.property)&&v.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&v.getAttribute("charset")===(u.charSet==null?null:u.charSet)){L.splice(C,1);break t}}v=p.createElement(d),xt(v,d,u),p.head.appendChild(v);break;default:throw Error(i(468,d))}v[Rt]=n,gt(v),d=v}n.stateNode=d}else M0(p,n.type,n.stateNode);else n.stateNode=O0(p,d,n.memoizedProps);else v!==d?(v===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):v.count--,d===null?M0(p,n.type,n.stateNode):O0(p,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Lc(n,n.memoizedProps,u.memoizedProps)}break;case 27:Vt(r,n),Kt(n),d&512&&(lt||u===null||Ai(u,u.return)),u!==null&&d&4&&Lc(n,n.memoizedProps,u.memoizedProps);break;case 5:if(Vt(r,n),Kt(n),d&512&&(lt||u===null||Ai(u,u.return)),n.flags&32){p=n.stateNode;try{Ds(p,"")}catch(Q){Qe(n,n.return,Q)}}d&4&&n.stateNode!=null&&(p=n.memoizedProps,Lc(n,p,u!==null?u.memoizedProps:p)),d&1024&&(Cc=!0);break;case 6:if(Vt(r,n),Kt(n),d&4){if(n.stateNode===null)throw Error(i(162));d=n.memoizedProps,u=n.stateNode;try{u.nodeValue=d}catch(Q){Qe(n,n.return,Q)}}break;case 3:if(Xl=null,p=hi,hi=ql(r.containerInfo),Vt(r,n),hi=p,Kt(n),d&4&&u!==null&&u.memoizedState.isDehydrated)try{va(r.containerInfo)}catch(Q){Qe(n,n.return,Q)}Cc&&(Cc=!1,$m(n));break;case 4:d=hi,hi=ql(n.stateNode.containerInfo),Vt(r,n),Kt(n),hi=d;break;case 12:Vt(r,n),Kt(n);break;case 13:Vt(r,n),Kt(n),n.child.flags&8192&&n.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Nc=Xe()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,Ic(n,d)));break;case 22:p=n.memoizedState!==null;var k=u!==null&&u.memoizedState!==null,q=Qi,ee=lt;if(Qi=q||p,lt=ee||k,Vt(r,n),lt=ee,Qi=q,Kt(n),d&8192)e:for(r=n.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(u===null||k||Qi||lt||ls(n)),u=null,r=n;;){if(r.tag===5||r.tag===26){if(u===null){k=u=r;try{if(v=k.stateNode,p)L=v.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{C=k.stateNode;var le=k.memoizedProps.style,X=le!=null&&le.hasOwnProperty("display")?le.display:null;C.style.display=X==null||typeof X=="boolean"?"":(""+X).trim()}}catch(Q){Qe(k,k.return,Q)}}}else if(r.tag===6){if(u===null){k=r;try{k.stateNode.nodeValue=p?"":k.memoizedProps}catch(Q){Qe(k,k.return,Q)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===n)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;u===r&&(u=null),r=r.return}u===r&&(u=null),r.sibling.return=r.return,r=r.sibling}d&4&&(d=n.updateQueue,d!==null&&(u=d.retryQueue,u!==null&&(d.retryQueue=null,Ic(n,u))));break;case 19:Vt(r,n),Kt(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,Ic(n,d)));break;case 30:break;case 21:break;default:Vt(r,n),Kt(n)}}function Kt(n){var r=n.flags;if(r&2){try{for(var u,d=n.return;d!==null;){if(Om(d)){u=d;break}d=d.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var p=u.stateNode,v=_c(n);Ml(n,v,p);break;case 5:var L=u.stateNode;u.flags&32&&(Ds(L,""),u.flags&=-33);var C=_c(n);Ml(n,C,L);break;case 3:case 4:var k=u.stateNode.containerInfo,q=_c(n);Dc(n,q,k);break;default:throw Error(i(161))}}catch(ee){Qe(n,n.return,ee)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function $m(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var r=n;$m(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),n=n.sibling}}function xn(n,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Pm(n,r.alternate,r),r=r.sibling}function ls(n){for(n=n.child;n!==null;){var r=n;switch(r.tag){case 0:case 11:case 14:case 15:Tn(4,r,r.return),ls(r);break;case 1:Ai(r,r.return);var u=r.stateNode;typeof u.componentWillUnmount=="function"&&Im(r,r.return,u),ls(r);break;case 27:ca(r.stateNode);case 26:case 5:Ai(r,r.return),ls(r);break;case 22:r.memoizedState===null&&ls(r);break;case 30:ls(r);break;default:ls(r)}n=n.sibling}}function bn(n,r,u){for(u=u&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var d=r.alternate,p=n,v=r,L=v.flags;switch(v.tag){case 0:case 11:case 15:bn(p,v,u),ea(4,v);break;case 1:if(bn(p,v,u),d=v,p=d.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(q){Qe(d,d.return,q)}if(d=v,p=d.updateQueue,p!==null){var C=d.stateNode;try{var k=p.shared.hiddenCallbacks;if(k!==null)for(p.shared.hiddenCallbacks=null,p=0;p<k.length;p++)mg(k[p],C)}catch(q){Qe(d,d.return,q)}}u&&L&64&&Cm(v),ta(v,v.return);break;case 27:km(v);case 26:case 5:bn(p,v,u),u&&d===null&&L&4&&wm(v),ta(v,v.return);break;case 12:bn(p,v,u);break;case 13:bn(p,v,u),u&&L&4&&Bm(p,v);break;case 22:v.memoizedState===null&&bn(p,v,u),ta(v,v.return);break;case 30:break;default:bn(p,v,u)}r=r.sibling}}function wc(n,r){var u=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),n=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(n=r.memoizedState.cachePool.pool),n!==u&&(n!=null&&n.refCount++,u!=null&&$r(u))}function Oc(n,r){n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&$r(n))}function Ri(n,r,u,d){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Gm(n,r,u,d),r=r.sibling}function Gm(n,r,u,d){var p=r.flags;switch(r.tag){case 0:case 11:case 15:Ri(n,r,u,d),p&2048&&ea(9,r);break;case 1:Ri(n,r,u,d);break;case 3:Ri(n,r,u,d),p&2048&&(n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&$r(n)));break;case 12:if(p&2048){Ri(n,r,u,d),n=r.stateNode;try{var v=r.memoizedProps,L=v.id,C=v.onPostCommit;typeof C=="function"&&C(L,r.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(k){Qe(r,r.return,k)}}else Ri(n,r,u,d);break;case 13:Ri(n,r,u,d);break;case 23:break;case 22:v=r.stateNode,L=r.alternate,r.memoizedState!==null?v._visibility&2?Ri(n,r,u,d):ia(n,r):v._visibility&2?Ri(n,r,u,d):(v._visibility|=2,qs(n,r,u,d,(r.subtreeFlags&10256)!==0)),p&2048&&wc(L,r);break;case 24:Ri(n,r,u,d),p&2048&&Oc(r.alternate,r);break;default:Ri(n,r,u,d)}}function qs(n,r,u,d,p){for(p=p&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var v=n,L=r,C=u,k=d,q=L.flags;switch(L.tag){case 0:case 11:case 15:qs(v,L,C,k,p),ea(8,L);break;case 23:break;case 22:var ee=L.stateNode;L.memoizedState!==null?ee._visibility&2?qs(v,L,C,k,p):ia(v,L):(ee._visibility|=2,qs(v,L,C,k,p)),p&&q&2048&&wc(L.alternate,L);break;case 24:qs(v,L,C,k,p),p&&q&2048&&Oc(L.alternate,L);break;default:qs(v,L,C,k,p)}r=r.sibling}}function ia(n,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var u=n,d=r,p=d.flags;switch(d.tag){case 22:ia(u,d),p&2048&&wc(d.alternate,d);break;case 24:ia(u,d),p&2048&&Oc(d.alternate,d);break;default:ia(u,d)}r=r.sibling}}var na=8192;function Ys(n){if(n.subtreeFlags&na)for(n=n.child;n!==null;)jm(n),n=n.sibling}function jm(n){switch(n.tag){case 26:Ys(n),n.flags&na&&n.memoizedState!==null&&QT(hi,n.memoizedState,n.memoizedProps);break;case 5:Ys(n);break;case 3:case 4:var r=hi;hi=ql(n.stateNode.containerInfo),Ys(n),hi=r;break;case 22:n.memoizedState===null&&(r=n.alternate,r!==null&&r.memoizedState!==null?(r=na,na=16777216,Ys(n),na=r):Ys(n));break;default:Ys(n)}}function Hm(n){var r=n.alternate;if(r!==null&&(n=r.child,n!==null)){r.child=null;do r=n.sibling,n.sibling=null,n=r;while(n!==null)}}function sa(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var d=r[u];pt=d,Km(d,n)}Hm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Vm(n),n=n.sibling}function Vm(n){switch(n.tag){case 0:case 11:case 15:sa(n),n.flags&2048&&Tn(9,n,n.return);break;case 3:sa(n);break;case 12:sa(n);break;case 22:var r=n.stateNode;n.memoizedState!==null&&r._visibility&2&&(n.return===null||n.return.tag!==13)?(r._visibility&=-3,Pl(n)):sa(n);break;default:sa(n)}}function Pl(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var d=r[u];pt=d,Km(d,n)}Hm(n)}for(n=n.child;n!==null;){switch(r=n,r.tag){case 0:case 11:case 15:Tn(8,r,r.return),Pl(r);break;case 22:u=r.stateNode,u._visibility&2&&(u._visibility&=-3,Pl(r));break;default:Pl(r)}n=n.sibling}}function Km(n,r){for(;pt!==null;){var u=pt;switch(u.tag){case 0:case 11:case 15:Tn(8,u,r);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var d=u.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:$r(u.memoizedState.cache)}if(d=u.child,d!==null)d.return=u,pt=d;else e:for(u=n;pt!==null;){d=pt;var p=d.sibling,v=d.return;if(Nm(d),d===u){pt=null;break e}if(p!==null){p.return=v,pt=p;break e}pt=v}}}var dT={getCacheForType:function(n){var r=Lt(ct),u=r.data.get(n);return u===void 0&&(u=n(),r.data.set(n,u)),u}},hT=typeof WeakMap=="function"?WeakMap:Map,je=0,We=null,Oe=null,Ne=0,He=0,zt=null,An=!1,Xs=!1,kc=!1,Zi=0,rt=0,Rn=0,os=0,Mc=0,ri=0,Qs=0,ra=null,Bt=null,Pc=!1,Nc=0,Nl=1/0,Ul=null,Ln=null,Tt=0,_n=null,Ws=null,Zs=0,Uc=0,Bc=null,zm=null,aa=0,Fc=null;function qt(){if((je&2)!==0&&Ne!==0)return Ne&-Ne;if(U.T!==null){var n=Fs;return n!==0?n:zc()}return oh()}function qm(){ri===0&&(ri=(Ne&536870912)===0||Be?sh():536870912);var n=si.current;return n!==null&&(n.flags|=32),ri}function Yt(n,r,u){(n===We&&(He===2||He===9)||n.cancelPendingCommit!==null)&&(Js(n,0),Dn(n,Ne,ri,!1)),Ar(n,u),((je&2)===0||n!==We)&&(n===We&&((je&2)===0&&(os|=u),rt===4&&Dn(n,Ne,ri,!1)),Li(n))}function Ym(n,r,u){if((je&6)!==0)throw Error(i(327));var d=!u&&(r&124)===0&&(r&n.expiredLanes)===0||br(n,r),p=d?pT(n,r):jc(n,r,!0),v=d;do{if(p===0){Xs&&!d&&Dn(n,r,0,!1);break}else{if(u=n.current.alternate,v&&!gT(u)){p=jc(n,r,!1),v=!1;continue}if(p===2){if(v=r,n.errorRecoveryDisabledLanes&v)var L=0;else L=n.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){r=L;e:{var C=n;p=ra;var k=C.current.memoizedState.isDehydrated;if(k&&(Js(C,L).flags|=256),L=jc(C,L,!1),L!==2){if(kc&&!k){C.errorRecoveryDisabledLanes|=v,os|=v,p=4;break e}v=Bt,Bt=p,v!==null&&(Bt===null?Bt=v:Bt.push.apply(Bt,v))}p=L}if(v=!1,p!==2)continue}}if(p===1){Js(n,0),Dn(n,r,0,!0);break}e:{switch(d=n,v=p,v){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:Dn(d,r,ri,!An);break e;case 2:Bt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(p=Nc+300-Xe(),10<p)){if(Dn(d,r,ri,!An),Ya(d,0,!0)!==0)break e;d.timeoutHandle=b0(Xm.bind(null,d,u,Bt,Ul,Pc,r,ri,os,Qs,An,v,2,-0,0),p);break e}Xm(d,u,Bt,Ul,Pc,r,ri,os,Qs,An,v,0,-0,0)}}break}while(!0);Li(n)}function Xm(n,r,u,d,p,v,L,C,k,q,ee,le,X,Q){if(n.timeoutHandle=-1,le=r.subtreeFlags,(le&8192||(le&16785408)===16785408)&&(ha={stylesheets:null,count:0,unsuspend:XT},jm(r),le=WT(),le!==null)){n.cancelPendingCommit=le(i0.bind(null,n,r,v,u,d,p,L,C,k,ee,1,X,Q)),Dn(n,v,L,!q);return}i0(n,r,v,u,d,p,L,C,k)}function gT(n){for(var r=n;;){var u=r.tag;if((u===0||u===11||u===15)&&r.flags&16384&&(u=r.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var d=0;d<u.length;d++){var p=u[d],v=p.getSnapshot;p=p.value;try{if(!jt(v(),p))return!1}catch{return!1}}if(u=r.child,r.subtreeFlags&16384&&u!==null)u.return=r,r=u;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Dn(n,r,u,d){r&=~Mc,r&=~os,n.suspendedLanes|=r,n.pingedLanes&=~r,d&&(n.warmLanes|=r),d=n.expirationTimes;for(var p=r;0<p;){var v=31-At(p),L=1<<v;d[v]=-1,p&=~L}u!==0&&ah(n,u,r)}function Bl(){return(je&6)===0?(la(0),!1):!0}function $c(){if(Oe!==null){if(He===0)var n=Oe.return;else n=Oe,Vi=is=null,nc(n),Ks=null,Wr=0,n=Oe;for(;n!==null;)Dm(n.alternate,n),n=n.return;Oe=null}}function Js(n,r){var u=n.timeoutHandle;u!==-1&&(n.timeoutHandle=-1,OT(u)),u=n.cancelPendingCommit,u!==null&&(n.cancelPendingCommit=null,u()),$c(),We=n,Oe=u=Gi(n.current,null),Ne=r,He=0,zt=null,An=!1,Xs=br(n,r),kc=!1,Qs=ri=Mc=os=Rn=rt=0,Bt=ra=null,Pc=!1,(r&8)!==0&&(r|=r&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=r;0<d;){var p=31-At(d),v=1<<p;r|=n[p],d&=~v}return Zi=r,al(),u}function Qm(n,r){Ce=null,U.H=Rl,r===jr||r===ml?(r=hg(),He=3):r===cg?(r=hg(),He=4):He=r===gm?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,zt=r,Oe===null&&(rt=1,Il(n,ei(r,n.current)))}function Wm(){var n=U.H;return U.H=Rl,n===null?Rl:n}function Zm(){var n=U.A;return U.A=dT,n}function Gc(){rt=4,An||(Ne&4194048)!==Ne&&si.current!==null||(Xs=!0),(Rn&134217727)===0&&(os&134217727)===0||We===null||Dn(We,Ne,ri,!1)}function jc(n,r,u){var d=je;je|=2;var p=Wm(),v=Zm();(We!==n||Ne!==r)&&(Ul=null,Js(n,r)),r=!1;var L=rt;e:do try{if(He!==0&&Oe!==null){var C=Oe,k=zt;switch(He){case 8:$c(),L=6;break e;case 3:case 2:case 9:case 6:si.current===null&&(r=!0);var q=He;if(He=0,zt=null,er(n,C,k,q),u&&Xs){L=0;break e}break;default:q=He,He=0,zt=null,er(n,C,k,q)}}mT(),L=rt;break}catch(ee){Qm(n,ee)}while(!0);return r&&n.shellSuspendCounter++,Vi=is=null,je=d,U.H=p,U.A=v,Oe===null&&(We=null,Ne=0,al()),L}function mT(){for(;Oe!==null;)Jm(Oe)}function pT(n,r){var u=je;je|=2;var d=Wm(),p=Zm();We!==n||Ne!==r?(Ul=null,Nl=Xe()+500,Js(n,r)):Xs=br(n,r);e:do try{if(He!==0&&Oe!==null){r=Oe;var v=zt;t:switch(He){case 1:He=0,zt=null,er(n,r,v,1);break;case 2:case 9:if(fg(v)){He=0,zt=null,e0(r);break}r=function(){He!==2&&He!==9||We!==n||(He=7),Li(n)},v.then(r,r);break e;case 3:He=7;break e;case 4:He=5;break e;case 7:fg(v)?(He=0,zt=null,e0(r)):(He=0,zt=null,er(n,r,v,7));break;case 5:var L=null;switch(Oe.tag){case 26:L=Oe.memoizedState;case 5:case 27:var C=Oe;if(!L||P0(L)){He=0,zt=null;var k=C.sibling;if(k!==null)Oe=k;else{var q=C.return;q!==null?(Oe=q,Fl(q)):Oe=null}break t}}He=0,zt=null,er(n,r,v,5);break;case 6:He=0,zt=null,er(n,r,v,6);break;case 8:$c(),rt=6;break e;default:throw Error(i(462))}}yT();break}catch(ee){Qm(n,ee)}while(!0);return Vi=is=null,U.H=d,U.A=p,je=u,Oe!==null?0:(We=null,Ne=0,al(),rt)}function yT(){for(;Oe!==null&&!nh();)Jm(Oe)}function Jm(n){var r=Lm(n.alternate,n,Zi);n.memoizedProps=n.pendingProps,r===null?Fl(n):Oe=r}function e0(n){var r=n,u=r.alternate;switch(r.tag){case 15:case 0:r=Sm(u,r,r.pendingProps,r.type,void 0,Ne);break;case 11:r=Sm(u,r,r.pendingProps,r.type.render,r.ref,Ne);break;case 5:nc(r);default:Dm(u,r),r=Oe=tg(r,Zi),r=Lm(u,r,Zi)}n.memoizedProps=n.pendingProps,r===null?Fl(n):Oe=r}function er(n,r,u,d){Vi=is=null,nc(r),Ks=null,Wr=0;var p=r.return;try{if(aT(n,p,r,u,Ne)){rt=1,Il(n,ei(u,n.current)),Oe=null;return}}catch(v){if(p!==null)throw Oe=p,v;rt=1,Il(n,ei(u,n.current)),Oe=null;return}r.flags&32768?(Be||d===1?n=!0:Xs||(Ne&536870912)!==0?n=!1:(An=n=!0,(d===2||d===9||d===3||d===6)&&(d=si.current,d!==null&&d.tag===13&&(d.flags|=16384))),t0(r,n)):Fl(r)}function Fl(n){var r=n;do{if((r.flags&32768)!==0){t0(r,An);return}n=r.return;var u=oT(r.alternate,r,Zi);if(u!==null){Oe=u;return}if(r=r.sibling,r!==null){Oe=r;return}Oe=r=n}while(r!==null);rt===0&&(rt=5)}function t0(n,r){do{var u=uT(n.alternate,n);if(u!==null){u.flags&=32767,Oe=u;return}if(u=n.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!r&&(n=n.sibling,n!==null)){Oe=n;return}Oe=n=u}while(n!==null);rt=6,Oe=null}function i0(n,r,u,d,p,v,L,C,k){n.cancelPendingCommit=null;do $l();while(Tt!==0);if((je&6)!==0)throw Error(i(327));if(r!==null){if(r===n.current)throw Error(i(177));if(v=r.lanes|r.childLanes,v|=Ou,XE(n,u,v,L,C,k),n===We&&(Oe=We=null,Ne=0),Ws=r,_n=n,Zs=u,Uc=v,Bc=p,zm=d,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,TT(ci,function(){return l0(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||d){d=U.T,U.T=null,p=W.p,W.p=2,L=je,je|=4;try{cT(n,r,u)}finally{je=L,W.p=p,U.T=d}}Tt=1,n0(),s0(),r0()}}function n0(){if(Tt===1){Tt=0;var n=_n,r=Ws,u=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||u){u=U.T,U.T=null;var d=W.p;W.p=2;var p=je;je|=4;try{Fm(r,n);var v=ef,L=Kh(n.containerInfo),C=v.focusedElem,k=v.selectionRange;if(L!==C&&C&&C.ownerDocument&&Vh(C.ownerDocument.documentElement,C)){if(k!==null&&_u(C)){var q=k.start,ee=k.end;if(ee===void 0&&(ee=q),"selectionStart"in C)C.selectionStart=q,C.selectionEnd=Math.min(ee,C.value.length);else{var le=C.ownerDocument||document,X=le&&le.defaultView||window;if(X.getSelection){var Q=X.getSelection(),Ae=C.textContent.length,Se=Math.min(k.start,Ae),Ye=k.end===void 0?Se:Math.min(k.end,Ae);!Q.extend&&Se>Ye&&(L=Ye,Ye=Se,Se=L);var G=Hh(C,Se),P=Hh(C,Ye);if(G&&P&&(Q.rangeCount!==1||Q.anchorNode!==G.node||Q.anchorOffset!==G.offset||Q.focusNode!==P.node||Q.focusOffset!==P.offset)){var V=le.createRange();V.setStart(G.node,G.offset),Q.removeAllRanges(),Se>Ye?(Q.addRange(V),Q.extend(P.node,P.offset)):(V.setEnd(P.node,P.offset),Q.addRange(V))}}}}for(le=[],Q=C;Q=Q.parentNode;)Q.nodeType===1&&le.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<le.length;C++){var se=le[C];se.element.scrollLeft=se.left,se.element.scrollTop=se.top}}Zl=!!Jc,ef=Jc=null}finally{je=p,W.p=d,U.T=u}}n.current=r,Tt=2}}function s0(){if(Tt===2){Tt=0;var n=_n,r=Ws,u=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||u){u=U.T,U.T=null;var d=W.p;W.p=2;var p=je;je|=4;try{Pm(n,r.alternate,r)}finally{je=p,W.p=d,U.T=u}}Tt=3}}function r0(){if(Tt===4||Tt===3){Tt=0,Pe();var n=_n,r=Ws,u=Zs,d=zm;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Tt=5:(Tt=0,Ws=_n=null,a0(n,n.pendingLanes));var p=n.pendingLanes;if(p===0&&(Ln=null),au(u),r=r.stateNode,bt&&typeof bt.onCommitFiberRoot=="function")try{bt.onCommitFiberRoot(fi,r,void 0,(r.current.flags&128)===128)}catch{}if(d!==null){r=U.T,p=W.p,W.p=2,U.T=null;try{for(var v=n.onRecoverableError,L=0;L<d.length;L++){var C=d[L];v(C.value,{componentStack:C.stack})}}finally{U.T=r,W.p=p}}(Zs&3)!==0&&$l(),Li(n),p=n.pendingLanes,(u&4194090)!==0&&(p&42)!==0?n===Fc?aa++:(aa=0,Fc=n):aa=0,la(0)}}function a0(n,r){(n.pooledCacheLanes&=r)===0&&(r=n.pooledCache,r!=null&&(n.pooledCache=null,$r(r)))}function $l(n){return n0(),s0(),r0(),l0()}function l0(){if(Tt!==5)return!1;var n=_n,r=Uc;Uc=0;var u=au(Zs),d=U.T,p=W.p;try{W.p=32>u?32:u,U.T=null,u=Bc,Bc=null;var v=_n,L=Zs;if(Tt=0,Ws=_n=null,Zs=0,(je&6)!==0)throw Error(i(331));var C=je;if(je|=4,Vm(v.current),Gm(v,v.current,L,u),je=C,la(0,!1),bt&&typeof bt.onPostCommitFiberRoot=="function")try{bt.onPostCommitFiberRoot(fi,v)}catch{}return!0}finally{W.p=p,U.T=d,a0(n,r)}}function o0(n,r,u){r=ei(u,r),r=yc(n.stateNode,r,2),n=yn(n,r,2),n!==null&&(Ar(n,2),Li(n))}function Qe(n,r,u){if(n.tag===3)o0(n,n,u);else for(;r!==null;){if(r.tag===3){o0(r,n,u);break}else if(r.tag===1){var d=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ln===null||!Ln.has(d))){n=ei(u,n),u=dm(2),d=yn(r,u,2),d!==null&&(hm(u,d,r,n),Ar(d,2),Li(d));break}}r=r.return}}function Hc(n,r,u){var d=n.pingCache;if(d===null){d=n.pingCache=new hT;var p=new Set;d.set(r,p)}else p=d.get(r),p===void 0&&(p=new Set,d.set(r,p));p.has(u)||(kc=!0,p.add(u),n=vT.bind(null,n,r,u),r.then(n,n))}function vT(n,r,u){var d=n.pingCache;d!==null&&d.delete(r),n.pingedLanes|=n.suspendedLanes&u,n.warmLanes&=~u,We===n&&(Ne&u)===u&&(rt===4||rt===3&&(Ne&62914560)===Ne&&300>Xe()-Nc?(je&2)===0&&Js(n,0):Mc|=u,Qs===Ne&&(Qs=0)),Li(n)}function u0(n,r){r===0&&(r=rh()),n=Ps(n,r),n!==null&&(Ar(n,r),Li(n))}function ET(n){var r=n.memoizedState,u=0;r!==null&&(u=r.retryLane),u0(n,u)}function ST(n,r){var u=0;switch(n.tag){case 13:var d=n.stateNode,p=n.memoizedState;p!==null&&(u=p.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(i(314))}d!==null&&d.delete(r),u0(n,u)}function TT(n,r){return Hn(n,r)}var Gl=null,tr=null,Vc=!1,jl=!1,Kc=!1,us=0;function Li(n){n!==tr&&n.next===null&&(tr===null?Gl=tr=n:tr=tr.next=n),jl=!0,Vc||(Vc=!0,bT())}function la(n,r){if(!Kc&&jl){Kc=!0;do for(var u=!1,d=Gl;d!==null;){if(n!==0){var p=d.pendingLanes;if(p===0)var v=0;else{var L=d.suspendedLanes,C=d.pingedLanes;v=(1<<31-At(42|n)+1)-1,v&=p&~(L&~C),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(u=!0,h0(d,v))}else v=Ne,v=Ya(d,d===We?v:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(v&3)===0||br(d,v)||(u=!0,h0(d,v));d=d.next}while(u);Kc=!1}}function xT(){c0()}function c0(){jl=Vc=!1;var n=0;us!==0&&(wT()&&(n=us),us=0);for(var r=Xe(),u=null,d=Gl;d!==null;){var p=d.next,v=f0(d,r);v===0?(d.next=null,u===null?Gl=p:u.next=p,p===null&&(tr=u)):(u=d,(n!==0||(v&3)!==0)&&(jl=!0)),d=p}la(n)}function f0(n,r){for(var u=n.suspendedLanes,d=n.pingedLanes,p=n.expirationTimes,v=n.pendingLanes&-62914561;0<v;){var L=31-At(v),C=1<<L,k=p[L];k===-1?((C&u)===0||(C&d)!==0)&&(p[L]=YE(C,r)):k<=r&&(n.expiredLanes|=C),v&=~C}if(r=We,u=Ne,u=Ya(n,n===r?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,u===0||n===r&&(He===2||He===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&Vn(d),n.callbackNode=null,n.callbackPriority=0;if((u&3)===0||br(n,u)){if(r=u&-u,r===n.callbackPriority)return r;switch(d!==null&&Vn(d),au(u)){case 2:case 8:u=kt;break;case 32:u=ci;break;case 268435456:u=xr;break;default:u=ci}return d=d0.bind(null,n),u=Hn(u,d),n.callbackPriority=r,n.callbackNode=u,r}return d!==null&&d!==null&&Vn(d),n.callbackPriority=2,n.callbackNode=null,2}function d0(n,r){if(Tt!==0&&Tt!==5)return n.callbackNode=null,n.callbackPriority=0,null;var u=n.callbackNode;if($l()&&n.callbackNode!==u)return null;var d=Ne;return d=Ya(n,n===We?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Ym(n,d,r),f0(n,Xe()),n.callbackNode!=null&&n.callbackNode===u?d0.bind(null,n):null)}function h0(n,r){if($l())return null;Ym(n,r,!0)}function bT(){kT(function(){(je&6)!==0?Hn(Si,xT):c0()})}function zc(){return us===0&&(us=sh()),us}function g0(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Ja(""+n)}function m0(n,r){var u=r.ownerDocument.createElement("input");return u.name=r.name,u.value=r.value,n.id&&u.setAttribute("form",n.id),r.parentNode.insertBefore(u,r),n=new FormData(n),u.parentNode.removeChild(u),n}function AT(n,r,u,d,p){if(r==="submit"&&u&&u.stateNode===p){var v=g0((p[Mt]||null).action),L=d.submitter;L&&(r=(r=L[Mt]||null)?g0(r.formAction):L.getAttribute("formAction"),r!==null&&(v=r,L=null));var C=new nl("action","action",null,d,p);n.push({event:C,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(us!==0){var k=L?m0(p,L):new FormData(p);dc(u,{pending:!0,data:k,method:p.method,action:v},null,k)}}else typeof v=="function"&&(C.preventDefault(),k=L?m0(p,L):new FormData(p),dc(u,{pending:!0,data:k,method:p.method,action:v},v,k))},currentTarget:p}]})}}for(var qc=0;qc<wu.length;qc++){var Yc=wu[qc],RT=Yc.toLowerCase(),LT=Yc[0].toUpperCase()+Yc.slice(1);di(RT,"on"+LT)}di(Yh,"onAnimationEnd"),di(Xh,"onAnimationIteration"),di(Qh,"onAnimationStart"),di("dblclick","onDoubleClick"),di("focusin","onFocus"),di("focusout","onBlur"),di(HS,"onTransitionRun"),di(VS,"onTransitionStart"),di(KS,"onTransitionCancel"),di(Wh,"onTransitionEnd"),Rs("onMouseEnter",["mouseout","mouseover"]),Rs("onMouseLeave",["mouseout","mouseover"]),Rs("onPointerEnter",["pointerout","pointerover"]),Rs("onPointerLeave",["pointerout","pointerover"]),qn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),qn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),qn("onBeforeInput",["compositionend","keypress","textInput","paste"]),qn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),qn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),qn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_T=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(oa));function p0(n,r){r=(r&4)!==0;for(var u=0;u<n.length;u++){var d=n[u],p=d.event;d=d.listeners;e:{var v=void 0;if(r)for(var L=d.length-1;0<=L;L--){var C=d[L],k=C.instance,q=C.currentTarget;if(C=C.listener,k!==v&&p.isPropagationStopped())break e;v=C,p.currentTarget=q;try{v(p)}catch(ee){Cl(ee)}p.currentTarget=null,v=k}else for(L=0;L<d.length;L++){if(C=d[L],k=C.instance,q=C.currentTarget,C=C.listener,k!==v&&p.isPropagationStopped())break e;v=C,p.currentTarget=q;try{v(p)}catch(ee){Cl(ee)}p.currentTarget=null,v=k}}}}function ke(n,r){var u=r[lu];u===void 0&&(u=r[lu]=new Set);var d=n+"__bubble";u.has(d)||(y0(r,n,2,!1),u.add(d))}function Xc(n,r,u){var d=0;r&&(d|=4),y0(u,n,d,r)}var Hl="_reactListening"+Math.random().toString(36).slice(2);function Qc(n){if(!n[Hl]){n[Hl]=!0,ch.forEach(function(u){u!=="selectionchange"&&(_T.has(u)||Xc(u,!1,n),Xc(u,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[Hl]||(r[Hl]=!0,Xc("selectionchange",!1,r))}}function y0(n,r,u,d){switch(G0(r)){case 2:var p=ex;break;case 8:p=tx;break;default:p=ff}u=p.bind(null,r,u,n),p=void 0,!vu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),d?p!==void 0?n.addEventListener(r,u,{capture:!0,passive:p}):n.addEventListener(r,u,!0):p!==void 0?n.addEventListener(r,u,{passive:p}):n.addEventListener(r,u,!1)}function Wc(n,r,u,d,p){var v=d;if((r&1)===0&&(r&2)===0&&d!==null)e:for(;;){if(d===null)return;var L=d.tag;if(L===3||L===4){var C=d.stateNode.containerInfo;if(C===p)break;if(L===4)for(L=d.return;L!==null;){var k=L.tag;if((k===3||k===4)&&L.stateNode.containerInfo===p)return;L=L.return}for(;C!==null;){if(L=xs(C),L===null)return;if(k=L.tag,k===5||k===6||k===26||k===27){d=v=L;continue e}C=C.parentNode}}d=d.return}Ah(function(){var q=v,ee=pu(u),le=[];e:{var X=Zh.get(n);if(X!==void 0){var Q=nl,Ae=n;switch(n){case"keypress":if(tl(u)===0)break e;case"keydown":case"keyup":Q=TS;break;case"focusin":Ae="focus",Q=xu;break;case"focusout":Ae="blur",Q=xu;break;case"beforeblur":case"afterblur":Q=xu;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=_h;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=uS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=AS;break;case Yh:case Xh:case Qh:Q=dS;break;case Wh:Q=LS;break;case"scroll":case"scrollend":Q=lS;break;case"wheel":Q=DS;break;case"copy":case"cut":case"paste":Q=gS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Ch;break;case"toggle":case"beforetoggle":Q=IS}var Se=(r&4)!==0,Ye=!Se&&(n==="scroll"||n==="scrollend"),G=Se?X!==null?X+"Capture":null:X;Se=[];for(var P=q,V;P!==null;){var se=P;if(V=se.stateNode,se=se.tag,se!==5&&se!==26&&se!==27||V===null||G===null||(se=_r(P,G),se!=null&&Se.push(ua(P,se,V))),Ye)break;P=P.return}0<Se.length&&(X=new Q(X,Ae,null,u,ee),le.push({event:X,listeners:Se}))}}if((r&7)===0){e:{if(X=n==="mouseover"||n==="pointerover",Q=n==="mouseout"||n==="pointerout",X&&u!==mu&&(Ae=u.relatedTarget||u.fromElement)&&(xs(Ae)||Ae[Ts]))break e;if((Q||X)&&(X=ee.window===ee?ee:(X=ee.ownerDocument)?X.defaultView||X.parentWindow:window,Q?(Ae=u.relatedTarget||u.toElement,Q=q,Ae=Ae?xs(Ae):null,Ae!==null&&(Ye=l(Ae),Se=Ae.tag,Ae!==Ye||Se!==5&&Se!==27&&Se!==6)&&(Ae=null)):(Q=null,Ae=q),Q!==Ae)){if(Se=_h,se="onMouseLeave",G="onMouseEnter",P="mouse",(n==="pointerout"||n==="pointerover")&&(Se=Ch,se="onPointerLeave",G="onPointerEnter",P="pointer"),Ye=Q==null?X:Lr(Q),V=Ae==null?X:Lr(Ae),X=new Se(se,P+"leave",Q,u,ee),X.target=Ye,X.relatedTarget=V,se=null,xs(ee)===q&&(Se=new Se(G,P+"enter",Ae,u,ee),Se.target=V,Se.relatedTarget=Ye,se=Se),Ye=se,Q&&Ae)t:{for(Se=Q,G=Ae,P=0,V=Se;V;V=ir(V))P++;for(V=0,se=G;se;se=ir(se))V++;for(;0<P-V;)Se=ir(Se),P--;for(;0<V-P;)G=ir(G),V--;for(;P--;){if(Se===G||G!==null&&Se===G.alternate)break t;Se=ir(Se),G=ir(G)}Se=null}else Se=null;Q!==null&&v0(le,X,Q,Se,!1),Ae!==null&&Ye!==null&&v0(le,Ye,Ae,Se,!0)}}e:{if(X=q?Lr(q):window,Q=X.nodeName&&X.nodeName.toLowerCase(),Q==="select"||Q==="input"&&X.type==="file")var ge=Uh;else if(Ph(X))if(Bh)ge=$S;else{ge=BS;var Ie=US}else Q=X.nodeName,!Q||Q.toLowerCase()!=="input"||X.type!=="checkbox"&&X.type!=="radio"?q&&gu(q.elementType)&&(ge=Uh):ge=FS;if(ge&&(ge=ge(n,q))){Nh(le,ge,u,ee);break e}Ie&&Ie(n,X,q),n==="focusout"&&q&&X.type==="number"&&q.memoizedProps.value!=null&&hu(X,"number",X.value)}switch(Ie=q?Lr(q):window,n){case"focusin":(Ph(Ie)||Ie.contentEditable==="true")&&(Os=Ie,Du=q,Pr=null);break;case"focusout":Pr=Du=Os=null;break;case"mousedown":Cu=!0;break;case"contextmenu":case"mouseup":case"dragend":Cu=!1,zh(le,u,ee);break;case"selectionchange":if(jS)break;case"keydown":case"keyup":zh(le,u,ee)}var ye;if(Au)e:{switch(n){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else ws?kh(n,u)&&(Te="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(Te="onCompositionStart");Te&&(Ih&&u.locale!=="ko"&&(ws||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&ws&&(ye=Rh()):(hn=ee,Eu="value"in hn?hn.value:hn.textContent,ws=!0)),Ie=Vl(q,Te),0<Ie.length&&(Te=new Dh(Te,n,null,u,ee),le.push({event:Te,listeners:Ie}),ye?Te.data=ye:(ye=Mh(u),ye!==null&&(Te.data=ye)))),(ye=OS?kS(n,u):MS(n,u))&&(Te=Vl(q,"onBeforeInput"),0<Te.length&&(Ie=new Dh("onBeforeInput","beforeinput",null,u,ee),le.push({event:Ie,listeners:Te}),Ie.data=ye)),AT(le,n,q,u,ee)}p0(le,r)})}function ua(n,r,u){return{instance:n,listener:r,currentTarget:u}}function Vl(n,r){for(var u=r+"Capture",d=[];n!==null;){var p=n,v=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||v===null||(p=_r(n,u),p!=null&&d.unshift(ua(n,p,v)),p=_r(n,r),p!=null&&d.push(ua(n,p,v))),n.tag===3)return d;n=n.return}return[]}function ir(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function v0(n,r,u,d,p){for(var v=r._reactName,L=[];u!==null&&u!==d;){var C=u,k=C.alternate,q=C.stateNode;if(C=C.tag,k!==null&&k===d)break;C!==5&&C!==26&&C!==27||q===null||(k=q,p?(q=_r(u,v),q!=null&&L.unshift(ua(u,q,k))):p||(q=_r(u,v),q!=null&&L.push(ua(u,q,k)))),u=u.return}L.length!==0&&n.push({event:r,listeners:L})}var DT=/\r\n?/g,CT=/\u0000|\uFFFD/g;function E0(n){return(typeof n=="string"?n:""+n).replace(DT,`
`).replace(CT,"")}function S0(n,r){return r=E0(r),E0(n)===r}function Kl(){}function qe(n,r,u,d,p,v){switch(u){case"children":typeof d=="string"?r==="body"||r==="textarea"&&d===""||Ds(n,d):(typeof d=="number"||typeof d=="bigint")&&r!=="body"&&Ds(n,""+d);break;case"className":Qa(n,"class",d);break;case"tabIndex":Qa(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Qa(n,u,d);break;case"style":xh(n,d,v);break;case"data":if(r!=="object"){Qa(n,"data",d);break}case"src":case"href":if(d===""&&(r!=="a"||u!=="href")){n.removeAttribute(u);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(u);break}d=Ja(""+d),n.setAttribute(u,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(u==="formAction"?(r!=="input"&&qe(n,r,"name",p.name,p,null),qe(n,r,"formEncType",p.formEncType,p,null),qe(n,r,"formMethod",p.formMethod,p,null),qe(n,r,"formTarget",p.formTarget,p,null)):(qe(n,r,"encType",p.encType,p,null),qe(n,r,"method",p.method,p,null),qe(n,r,"target",p.target,p,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(u);break}d=Ja(""+d),n.setAttribute(u,d);break;case"onClick":d!=null&&(n.onclick=Kl);break;case"onScroll":d!=null&&ke("scroll",n);break;case"onScrollEnd":d!=null&&ke("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}u=Ja(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,""+d):n.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,""):n.removeAttribute(u);break;case"capture":case"download":d===!0?n.setAttribute(u,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(u,d):n.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(u,d):n.removeAttribute(u);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(u):n.setAttribute(u,d);break;case"popover":ke("beforetoggle",n),ke("toggle",n),Xa(n,"popover",d);break;case"xlinkActuate":Fi(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Fi(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Fi(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Fi(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Fi(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Fi(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Fi(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Fi(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Fi(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Xa(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=rS.get(u)||u,Xa(n,u,d))}}function Zc(n,r,u,d,p,v){switch(u){case"style":xh(n,d,v);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(i(61));if(u=d.__html,u!=null){if(p.children!=null)throw Error(i(60));n.innerHTML=u}}break;case"children":typeof d=="string"?Ds(n,d):(typeof d=="number"||typeof d=="bigint")&&Ds(n,""+d);break;case"onScroll":d!=null&&ke("scroll",n);break;case"onScrollEnd":d!=null&&ke("scrollend",n);break;case"onClick":d!=null&&(n.onclick=Kl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fh.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(p=u.endsWith("Capture"),r=u.slice(2,p?u.length-7:void 0),v=n[Mt]||null,v=v!=null?v[u]:null,typeof v=="function"&&n.removeEventListener(r,v,p),typeof d=="function")){typeof v!="function"&&v!==null&&(u in n?n[u]=null:n.hasAttribute(u)&&n.removeAttribute(u)),n.addEventListener(r,d,p);break e}u in n?n[u]=d:d===!0?n.setAttribute(u,""):Xa(n,u,d)}}}function xt(n,r,u){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ke("error",n),ke("load",n);var d=!1,p=!1,v;for(v in u)if(u.hasOwnProperty(v)){var L=u[v];if(L!=null)switch(v){case"src":d=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:qe(n,r,v,L,u,null)}}p&&qe(n,r,"srcSet",u.srcSet,u,null),d&&qe(n,r,"src",u.src,u,null);return;case"input":ke("invalid",n);var C=v=L=p=null,k=null,q=null;for(d in u)if(u.hasOwnProperty(d)){var ee=u[d];if(ee!=null)switch(d){case"name":p=ee;break;case"type":L=ee;break;case"checked":k=ee;break;case"defaultChecked":q=ee;break;case"value":v=ee;break;case"defaultValue":C=ee;break;case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(i(137,r));break;default:qe(n,r,d,ee,u,null)}}vh(n,v,C,k,q,L,p,!1),Wa(n);return;case"select":ke("invalid",n),d=L=v=null;for(p in u)if(u.hasOwnProperty(p)&&(C=u[p],C!=null))switch(p){case"value":v=C;break;case"defaultValue":L=C;break;case"multiple":d=C;default:qe(n,r,p,C,u,null)}r=v,u=L,n.multiple=!!d,r!=null?_s(n,!!d,r,!1):u!=null&&_s(n,!!d,u,!0);return;case"textarea":ke("invalid",n),v=p=d=null;for(L in u)if(u.hasOwnProperty(L)&&(C=u[L],C!=null))switch(L){case"value":d=C;break;case"defaultValue":p=C;break;case"children":v=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(i(91));break;default:qe(n,r,L,C,u,null)}Sh(n,d,p,v),Wa(n);return;case"option":for(k in u)if(u.hasOwnProperty(k)&&(d=u[k],d!=null))switch(k){case"selected":n.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:qe(n,r,k,d,u,null)}return;case"dialog":ke("beforetoggle",n),ke("toggle",n),ke("cancel",n),ke("close",n);break;case"iframe":case"object":ke("load",n);break;case"video":case"audio":for(d=0;d<oa.length;d++)ke(oa[d],n);break;case"image":ke("error",n),ke("load",n);break;case"details":ke("toggle",n);break;case"embed":case"source":case"link":ke("error",n),ke("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in u)if(u.hasOwnProperty(q)&&(d=u[q],d!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:qe(n,r,q,d,u,null)}return;default:if(gu(r)){for(ee in u)u.hasOwnProperty(ee)&&(d=u[ee],d!==void 0&&Zc(n,r,ee,d,u,void 0));return}}for(C in u)u.hasOwnProperty(C)&&(d=u[C],d!=null&&qe(n,r,C,d,u,null))}function IT(n,r,u,d){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,v=null,L=null,C=null,k=null,q=null,ee=null;for(Q in u){var le=u[Q];if(u.hasOwnProperty(Q)&&le!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":k=le;default:d.hasOwnProperty(Q)||qe(n,r,Q,null,d,le)}}for(var X in d){var Q=d[X];if(le=u[X],d.hasOwnProperty(X)&&(Q!=null||le!=null))switch(X){case"type":v=Q;break;case"name":p=Q;break;case"checked":q=Q;break;case"defaultChecked":ee=Q;break;case"value":L=Q;break;case"defaultValue":C=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,r));break;default:Q!==le&&qe(n,r,X,Q,d,le)}}du(n,L,C,k,q,ee,v,p);return;case"select":Q=L=C=X=null;for(v in u)if(k=u[v],u.hasOwnProperty(v)&&k!=null)switch(v){case"value":break;case"multiple":Q=k;default:d.hasOwnProperty(v)||qe(n,r,v,null,d,k)}for(p in d)if(v=d[p],k=u[p],d.hasOwnProperty(p)&&(v!=null||k!=null))switch(p){case"value":X=v;break;case"defaultValue":C=v;break;case"multiple":L=v;default:v!==k&&qe(n,r,p,v,d,k)}r=C,u=L,d=Q,X!=null?_s(n,!!u,X,!1):!!d!=!!u&&(r!=null?_s(n,!!u,r,!0):_s(n,!!u,u?[]:"",!1));return;case"textarea":Q=X=null;for(C in u)if(p=u[C],u.hasOwnProperty(C)&&p!=null&&!d.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:qe(n,r,C,null,d,p)}for(L in d)if(p=d[L],v=u[L],d.hasOwnProperty(L)&&(p!=null||v!=null))switch(L){case"value":X=p;break;case"defaultValue":Q=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==v&&qe(n,r,L,p,d,v)}Eh(n,X,Q);return;case"option":for(var Ae in u)if(X=u[Ae],u.hasOwnProperty(Ae)&&X!=null&&!d.hasOwnProperty(Ae))switch(Ae){case"selected":n.selected=!1;break;default:qe(n,r,Ae,null,d,X)}for(k in d)if(X=d[k],Q=u[k],d.hasOwnProperty(k)&&X!==Q&&(X!=null||Q!=null))switch(k){case"selected":n.selected=X&&typeof X!="function"&&typeof X!="symbol";break;default:qe(n,r,k,X,d,Q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in u)X=u[Se],u.hasOwnProperty(Se)&&X!=null&&!d.hasOwnProperty(Se)&&qe(n,r,Se,null,d,X);for(q in d)if(X=d[q],Q=u[q],d.hasOwnProperty(q)&&X!==Q&&(X!=null||Q!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,r));break;default:qe(n,r,q,X,d,Q)}return;default:if(gu(r)){for(var Ye in u)X=u[Ye],u.hasOwnProperty(Ye)&&X!==void 0&&!d.hasOwnProperty(Ye)&&Zc(n,r,Ye,void 0,d,X);for(ee in d)X=d[ee],Q=u[ee],!d.hasOwnProperty(ee)||X===Q||X===void 0&&Q===void 0||Zc(n,r,ee,X,d,Q);return}}for(var G in u)X=u[G],u.hasOwnProperty(G)&&X!=null&&!d.hasOwnProperty(G)&&qe(n,r,G,null,d,X);for(le in d)X=d[le],Q=u[le],!d.hasOwnProperty(le)||X===Q||X==null&&Q==null||qe(n,r,le,X,d,Q)}var Jc=null,ef=null;function zl(n){return n.nodeType===9?n:n.ownerDocument}function T0(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function x0(n,r){if(n===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&r==="foreignObject"?0:n}function tf(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var nf=null;function wT(){var n=window.event;return n&&n.type==="popstate"?n===nf?!1:(nf=n,!0):(nf=null,!1)}var b0=typeof setTimeout=="function"?setTimeout:void 0,OT=typeof clearTimeout=="function"?clearTimeout:void 0,A0=typeof Promise=="function"?Promise:void 0,kT=typeof queueMicrotask=="function"?queueMicrotask:typeof A0<"u"?function(n){return A0.resolve(null).then(n).catch(MT)}:b0;function MT(n){setTimeout(function(){throw n})}function Cn(n){return n==="head"}function R0(n,r){var u=r,d=0,p=0;do{var v=u.nextSibling;if(n.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"){if(0<d&&8>d){u=d;var L=n.ownerDocument;if(u&1&&ca(L.documentElement),u&2&&ca(L.body),u&4)for(u=L.head,ca(u),L=u.firstChild;L;){var C=L.nextSibling,k=L.nodeName;L[Rr]||k==="SCRIPT"||k==="STYLE"||k==="LINK"&&L.rel.toLowerCase()==="stylesheet"||u.removeChild(L),L=C}}if(p===0){n.removeChild(v),va(r);return}p--}else u==="$"||u==="$?"||u==="$!"?p++:d=u.charCodeAt(0)-48;else d=0;u=v}while(u);va(r)}function sf(n){var r=n.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var u=r;switch(r=r.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":sf(u),ou(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}n.removeChild(u)}}function PT(n,r,u,d){for(;n.nodeType===1;){var p=u;if(n.nodeName.toLowerCase()!==r.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[Rr])switch(r){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(v=n.getAttribute("rel"),v==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(v!==p.rel||n.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||n.getAttribute("title")!==(p.title==null?null:p.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(v=n.getAttribute("src"),(v!==(p.src==null?null:p.src)||n.getAttribute("type")!==(p.type==null?null:p.type)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&v&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(r==="input"&&n.type==="hidden"){var v=p.name==null?null:""+p.name;if(p.type==="hidden"&&n.getAttribute("name")===v)return n}else return n;if(n=gi(n.nextSibling),n===null)break}return null}function NT(n,r,u){if(r==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!u||(n=gi(n.nextSibling),n===null))return null;return n}function rf(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function UT(n,r){var u=n.ownerDocument;if(n.data!=="$?"||u.readyState==="complete")r();else{var d=function(){r(),u.removeEventListener("DOMContentLoaded",d)};u.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function gi(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return n}var af=null;function L0(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(r===0)return n;r--}else u==="/$"&&r++}n=n.previousSibling}return null}function _0(n,r,u){switch(r=zl(u),n){case"html":if(n=r.documentElement,!n)throw Error(i(452));return n;case"head":if(n=r.head,!n)throw Error(i(453));return n;case"body":if(n=r.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function ca(n){for(var r=n.attributes;r.length;)n.removeAttributeNode(r[0]);ou(n)}var ai=new Map,D0=new Set;function ql(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Ji=W.d;W.d={f:BT,r:FT,D:$T,C:GT,L:jT,m:HT,X:KT,S:VT,M:zT};function BT(){var n=Ji.f(),r=Bl();return n||r}function FT(n){var r=bs(n);r!==null&&r.tag===5&&r.type==="form"?Yg(r):Ji.r(n)}var nr=typeof document>"u"?null:document;function C0(n,r,u){var d=nr;if(d&&typeof r=="string"&&r){var p=Jt(r);p='link[rel="'+n+'"][href="'+p+'"]',typeof u=="string"&&(p+='[crossorigin="'+u+'"]'),D0.has(p)||(D0.add(p),n={rel:n,crossOrigin:u,href:r},d.querySelector(p)===null&&(r=d.createElement("link"),xt(r,"link",n),gt(r),d.head.appendChild(r)))}}function $T(n){Ji.D(n),C0("dns-prefetch",n,null)}function GT(n,r){Ji.C(n,r),C0("preconnect",n,r)}function jT(n,r,u){Ji.L(n,r,u);var d=nr;if(d&&n&&r){var p='link[rel="preload"][as="'+Jt(r)+'"]';r==="image"&&u&&u.imageSrcSet?(p+='[imagesrcset="'+Jt(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(p+='[imagesizes="'+Jt(u.imageSizes)+'"]')):p+='[href="'+Jt(n)+'"]';var v=p;switch(r){case"style":v=sr(n);break;case"script":v=rr(n)}ai.has(v)||(n=g({rel:"preload",href:r==="image"&&u&&u.imageSrcSet?void 0:n,as:r},u),ai.set(v,n),d.querySelector(p)!==null||r==="style"&&d.querySelector(fa(v))||r==="script"&&d.querySelector(da(v))||(r=d.createElement("link"),xt(r,"link",n),gt(r),d.head.appendChild(r)))}}function HT(n,r){Ji.m(n,r);var u=nr;if(u&&n){var d=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+Jt(d)+'"][href="'+Jt(n)+'"]',v=p;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=rr(n)}if(!ai.has(v)&&(n=g({rel:"modulepreload",href:n},r),ai.set(v,n),u.querySelector(p)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(da(v)))return}d=u.createElement("link"),xt(d,"link",n),gt(d),u.head.appendChild(d)}}}function VT(n,r,u){Ji.S(n,r,u);var d=nr;if(d&&n){var p=As(d).hoistableStyles,v=sr(n);r=r||"default";var L=p.get(v);if(!L){var C={loading:0,preload:null};if(L=d.querySelector(fa(v)))C.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":r},u),(u=ai.get(v))&&lf(n,u);var k=L=d.createElement("link");gt(k),xt(k,"link",n),k._p=new Promise(function(q,ee){k.onload=q,k.onerror=ee}),k.addEventListener("load",function(){C.loading|=1}),k.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Yl(L,r,d)}L={type:"stylesheet",instance:L,count:1,state:C},p.set(v,L)}}}function KT(n,r){Ji.X(n,r);var u=nr;if(u&&n){var d=As(u).hoistableScripts,p=rr(n),v=d.get(p);v||(v=u.querySelector(da(p)),v||(n=g({src:n,async:!0},r),(r=ai.get(p))&&of(n,r),v=u.createElement("script"),gt(v),xt(v,"link",n),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(p,v))}}function zT(n,r){Ji.M(n,r);var u=nr;if(u&&n){var d=As(u).hoistableScripts,p=rr(n),v=d.get(p);v||(v=u.querySelector(da(p)),v||(n=g({src:n,async:!0,type:"module"},r),(r=ai.get(p))&&of(n,r),v=u.createElement("script"),gt(v),xt(v,"link",n),u.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},d.set(p,v))}}function I0(n,r,u,d){var p=(p=ce.current)?ql(p):null;if(!p)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(r=sr(u.href),u=As(p).hoistableStyles,d=u.get(r),d||(d={type:"style",instance:null,count:0,state:null},u.set(r,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){n=sr(u.href);var v=As(p).hoistableStyles,L=v.get(n);if(L||(p=p.ownerDocument||p,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(n,L),(v=p.querySelector(fa(n)))&&!v._p&&(L.instance=v,L.state.loading=5),ai.has(n)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},ai.set(n,u),v||qT(p,n,u,L.state))),r&&d===null)throw Error(i(528,""));return L}if(r&&d!==null)throw Error(i(529,""));return null;case"script":return r=u.async,u=u.src,typeof u=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=rr(u),u=As(p).hoistableScripts,d=u.get(r),d||(d={type:"script",instance:null,count:0,state:null},u.set(r,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function sr(n){return'href="'+Jt(n)+'"'}function fa(n){return'link[rel="stylesheet"]['+n+"]"}function w0(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function qT(n,r,u,d){n.querySelector('link[rel="preload"][as="style"]['+r+"]")?d.loading=1:(r=n.createElement("link"),d.preload=r,r.addEventListener("load",function(){return d.loading|=1}),r.addEventListener("error",function(){return d.loading|=2}),xt(r,"link",u),gt(r),n.head.appendChild(r))}function rr(n){return'[src="'+Jt(n)+'"]'}function da(n){return"script[async]"+n}function O0(n,r,u){if(r.count++,r.instance===null)switch(r.type){case"style":var d=n.querySelector('style[data-href~="'+Jt(u.href)+'"]');if(d)return r.instance=d,gt(d),d;var p=g({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),gt(d),xt(d,"style",p),Yl(d,u.precedence,n),r.instance=d;case"stylesheet":p=sr(u.href);var v=n.querySelector(fa(p));if(v)return r.state.loading|=4,r.instance=v,gt(v),v;d=w0(u),(p=ai.get(p))&&lf(d,p),v=(n.ownerDocument||n).createElement("link"),gt(v);var L=v;return L._p=new Promise(function(C,k){L.onload=C,L.onerror=k}),xt(v,"link",d),r.state.loading|=4,Yl(v,u.precedence,n),r.instance=v;case"script":return v=rr(u.src),(p=n.querySelector(da(v)))?(r.instance=p,gt(p),p):(d=u,(p=ai.get(v))&&(d=g({},u),of(d,p)),n=n.ownerDocument||n,p=n.createElement("script"),gt(p),xt(p,"link",d),n.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(d=r.instance,r.state.loading|=4,Yl(d,u.precedence,n));return r.instance}function Yl(n,r,u){for(var d=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=d.length?d[d.length-1]:null,v=p,L=0;L<d.length;L++){var C=d[L];if(C.dataset.precedence===r)v=C;else if(v!==p)break}v?v.parentNode.insertBefore(n,v.nextSibling):(r=u.nodeType===9?u.head:u,r.insertBefore(n,r.firstChild))}function lf(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.title==null&&(n.title=r.title)}function of(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.integrity==null&&(n.integrity=r.integrity)}var Xl=null;function k0(n,r,u){if(Xl===null){var d=new Map,p=Xl=new Map;p.set(u,d)}else p=Xl,d=p.get(u),d||(d=new Map,p.set(u,d));if(d.has(n))return d;for(d.set(n,null),u=u.getElementsByTagName(n),p=0;p<u.length;p++){var v=u[p];if(!(v[Rr]||v[Rt]||n==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var L=v.getAttribute(r)||"";L=n+L;var C=d.get(L);C?C.push(v):d.set(L,[v])}}return d}function M0(n,r,u){n=n.ownerDocument||n,n.head.insertBefore(u,r==="title"?n.querySelector("head > title"):null)}function YT(n,r,u){if(u===1||r.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return n=r.disabled,typeof r.precedence=="string"&&n==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function P0(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var ha=null;function XT(){}function QT(n,r,u){if(ha===null)throw Error(i(475));var d=ha;if(r.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var p=sr(u.href),v=n.querySelector(fa(p));if(v){n=v._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(d.count++,d=Ql.bind(d),n.then(d,d)),r.state.loading|=4,r.instance=v,gt(v);return}v=n.ownerDocument||n,u=w0(u),(p=ai.get(p))&&lf(u,p),v=v.createElement("link"),gt(v);var L=v;L._p=new Promise(function(C,k){L.onload=C,L.onerror=k}),xt(v,"link",u),r.instance=v}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(r,n),(n=r.state.preload)&&(r.state.loading&3)===0&&(d.count++,r=Ql.bind(d),n.addEventListener("load",r),n.addEventListener("error",r))}}function WT(){if(ha===null)throw Error(i(475));var n=ha;return n.stylesheets&&n.count===0&&uf(n,n.stylesheets),0<n.count?function(r){var u=setTimeout(function(){if(n.stylesheets&&uf(n,n.stylesheets),n.unsuspend){var d=n.unsuspend;n.unsuspend=null,d()}},6e4);return n.unsuspend=r,function(){n.unsuspend=null,clearTimeout(u)}}:null}function Ql(){if(this.count--,this.count===0){if(this.stylesheets)uf(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Wl=null;function uf(n,r){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Wl=new Map,r.forEach(ZT,n),Wl=null,Ql.call(n))}function ZT(n,r){if(!(r.state.loading&4)){var u=Wl.get(n);if(u)var d=u.get(null);else{u=new Map,Wl.set(n,u);for(var p=n.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<p.length;v++){var L=p[v];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(u.set(L.dataset.precedence,L),d=L)}d&&u.set(null,d)}p=r.instance,L=p.getAttribute("data-precedence"),v=u.get(L)||d,v===d&&u.set(null,p),u.set(L,p),this.count++,d=Ql.bind(this),p.addEventListener("load",d),p.addEventListener("error",d),v?v.parentNode.insertBefore(p,v.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(p,n.firstChild)),r.state.loading|=4}}var ga={$$typeof:A,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function JT(n,r,u,d,p,v,L,C){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=su(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=su(0),this.hiddenUpdates=su(null),this.identifierPrefix=d,this.onUncaughtError=p,this.onCaughtError=v,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=C,this.incompleteTransitions=new Map}function N0(n,r,u,d,p,v,L,C,k,q,ee,le){return n=new JT(n,r,u,L,C,k,q,le),r=1,v===!0&&(r|=24),v=Ht(3,null,null,r),n.current=v,v.stateNode=n,r=Hu(),r.refCount++,n.pooledCache=r,r.refCount++,v.memoizedState={element:d,isDehydrated:u,cache:r},qu(v),n}function U0(n){return n?(n=Ns,n):Ns}function B0(n,r,u,d,p,v){p=U0(p),d.context===null?d.context=p:d.pendingContext=p,d=pn(r),d.payload={element:u},v=v===void 0?null:v,v!==null&&(d.callback=v),u=yn(n,d,r),u!==null&&(Yt(u,n,r),Vr(u,n,r))}function F0(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<r?u:r}}function cf(n,r){F0(n,r),(n=n.alternate)&&F0(n,r)}function $0(n){if(n.tag===13){var r=Ps(n,67108864);r!==null&&Yt(r,n,67108864),cf(n,67108864)}}var Zl=!0;function ex(n,r,u,d){var p=U.T;U.T=null;var v=W.p;try{W.p=2,ff(n,r,u,d)}finally{W.p=v,U.T=p}}function tx(n,r,u,d){var p=U.T;U.T=null;var v=W.p;try{W.p=8,ff(n,r,u,d)}finally{W.p=v,U.T=p}}function ff(n,r,u,d){if(Zl){var p=df(d);if(p===null)Wc(n,r,d,Jl,u),j0(n,d);else if(nx(p,n,r,u,d))d.stopPropagation();else if(j0(n,d),r&4&&-1<ix.indexOf(n)){for(;p!==null;){var v=bs(p);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var L=zn(v.pendingLanes);if(L!==0){var C=v;for(C.pendingLanes|=2,C.entangledLanes|=2;L;){var k=1<<31-At(L);C.entanglements[1]|=k,L&=~k}Li(v),(je&6)===0&&(Nl=Xe()+500,la(0))}}break;case 13:C=Ps(v,2),C!==null&&Yt(C,v,2),Bl(),cf(v,2)}if(v=df(d),v===null&&Wc(n,r,d,Jl,u),v===p)break;p=v}p!==null&&d.stopPropagation()}else Wc(n,r,d,null,u)}}function df(n){return n=pu(n),hf(n)}var Jl=null;function hf(n){if(Jl=null,n=xs(n),n!==null){var r=l(n);if(r===null)n=null;else{var u=r.tag;if(u===13){if(n=o(r),n!==null)return n;n=null}else if(u===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Jl=n,null}function G0(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ot()){case Si:return 2;case kt:return 8;case ci:case Bi:return 32;case xr:return 268435456;default:return 32}default:return 32}}var gf=!1,In=null,wn=null,On=null,ma=new Map,pa=new Map,kn=[],ix="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function j0(n,r){switch(n){case"focusin":case"focusout":In=null;break;case"dragenter":case"dragleave":wn=null;break;case"mouseover":case"mouseout":On=null;break;case"pointerover":case"pointerout":ma.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":pa.delete(r.pointerId)}}function ya(n,r,u,d,p,v){return n===null||n.nativeEvent!==v?(n={blockedOn:r,domEventName:u,eventSystemFlags:d,nativeEvent:v,targetContainers:[p]},r!==null&&(r=bs(r),r!==null&&$0(r)),n):(n.eventSystemFlags|=d,r=n.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),n)}function nx(n,r,u,d,p){switch(r){case"focusin":return In=ya(In,n,r,u,d,p),!0;case"dragenter":return wn=ya(wn,n,r,u,d,p),!0;case"mouseover":return On=ya(On,n,r,u,d,p),!0;case"pointerover":var v=p.pointerId;return ma.set(v,ya(ma.get(v)||null,n,r,u,d,p)),!0;case"gotpointercapture":return v=p.pointerId,pa.set(v,ya(pa.get(v)||null,n,r,u,d,p)),!0}return!1}function H0(n){var r=xs(n.target);if(r!==null){var u=l(r);if(u!==null){if(r=u.tag,r===13){if(r=o(u),r!==null){n.blockedOn=r,QE(n.priority,function(){if(u.tag===13){var d=qt();d=ru(d);var p=Ps(u,d);p!==null&&Yt(p,u,d),cf(u,d)}});return}}else if(r===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function eo(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var u=df(n.nativeEvent);if(u===null){u=n.nativeEvent;var d=new u.constructor(u.type,u);mu=d,u.target.dispatchEvent(d),mu=null}else return r=bs(u),r!==null&&$0(r),n.blockedOn=u,!1;r.shift()}return!0}function V0(n,r,u){eo(n)&&u.delete(r)}function sx(){gf=!1,In!==null&&eo(In)&&(In=null),wn!==null&&eo(wn)&&(wn=null),On!==null&&eo(On)&&(On=null),ma.forEach(V0),pa.forEach(V0)}function to(n,r){n.blockedOn===r&&(n.blockedOn=null,gf||(gf=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,sx)))}var io=null;function K0(n){io!==n&&(io=n,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){io===n&&(io=null);for(var r=0;r<n.length;r+=3){var u=n[r],d=n[r+1],p=n[r+2];if(typeof d!="function"){if(hf(d||u)===null)continue;break}var v=bs(u);v!==null&&(n.splice(r,3),r-=3,dc(v,{pending:!0,data:p,method:u.method,action:d},d,p))}}))}function va(n){function r(k){return to(k,n)}In!==null&&to(In,n),wn!==null&&to(wn,n),On!==null&&to(On,n),ma.forEach(r),pa.forEach(r);for(var u=0;u<kn.length;u++){var d=kn[u];d.blockedOn===n&&(d.blockedOn=null)}for(;0<kn.length&&(u=kn[0],u.blockedOn===null);)H0(u),u.blockedOn===null&&kn.shift();if(u=(n.ownerDocument||n).$$reactFormReplay,u!=null)for(d=0;d<u.length;d+=3){var p=u[d],v=u[d+1],L=p[Mt]||null;if(typeof v=="function")L||K0(u);else if(L){var C=null;if(v&&v.hasAttribute("formAction")){if(p=v,L=v[Mt]||null)C=L.formAction;else if(hf(p)!==null)continue}else C=L.action;typeof C=="function"?u[d+1]=C:(u.splice(d,3),d-=3),K0(u)}}}function mf(n){this._internalRoot=n}no.prototype.render=mf.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));var u=r.current,d=qt();B0(u,d,n,r,null,null)},no.prototype.unmount=mf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;B0(n.current,2,null,n,null,null),Bl(),r[Ts]=null}};function no(n){this._internalRoot=n}no.prototype.unstable_scheduleHydration=function(n){if(n){var r=oh();n={blockedOn:null,target:n,priority:r};for(var u=0;u<kn.length&&r!==0&&r<kn[u].priority;u++);kn.splice(u,0,n),u===0&&H0(n)}};var z0=e.version;if(z0!=="19.1.0")throw Error(i(527,z0,"19.1.0"));W.findDOMNode=function(n){var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=h(r),n=n!==null?f(n):null,n=n===null?null:n.stateNode,n};var rx={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var so=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!so.isDisabled&&so.supportsFiber)try{fi=so.inject(rx),bt=so}catch{}}return Sa.createRoot=function(n,r){if(!s(n))throw Error(i(299));var u=!1,d="",p=om,v=um,L=cm,C=null;return r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(v=r.onCaughtError),r.onRecoverableError!==void 0&&(L=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(C=r.unstable_transitionCallbacks)),r=N0(n,1,!1,null,null,u,d,p,v,L,C,null),n[Ts]=r.current,Qc(n),new mf(r)},Sa.hydrateRoot=function(n,r,u){if(!s(n))throw Error(i(299));var d=!1,p="",v=om,L=um,C=cm,k=null,q=null;return u!=null&&(u.unstable_strictMode===!0&&(d=!0),u.identifierPrefix!==void 0&&(p=u.identifierPrefix),u.onUncaughtError!==void 0&&(v=u.onUncaughtError),u.onCaughtError!==void 0&&(L=u.onCaughtError),u.onRecoverableError!==void 0&&(C=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(k=u.unstable_transitionCallbacks),u.formState!==void 0&&(q=u.formState)),r=N0(n,1,!0,r,u??null,d,p,v,L,C,k,q),r.context=U0(null),u=r.current,d=qt(),d=ru(d),p=pn(d),p.callback=null,yn(u,p,d),u=d,r.current.lanes=u,Ar(r,u),Li(r),n[Ts]=r.current,Qc(n),new no(r)},Sa.version="19.1.0",Sa}var ip;function px(){if(ip)return vf.exports;ip=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),vf.exports=mx(),vf.exports}var yx=px(),Ta={},np;function vx(){if(np)return Ta;np=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.parse=o,Ta.serialize=f;const a=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,i=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,l=(()=>{const y=function(){};return y.prototype=Object.create(null),y})();function o(y,S){const E=new l,x=y.length;if(x<2)return E;const T=(S==null?void 0:S.decode)||g;let R=0;do{const D=y.indexOf("=",R);if(D===-1)break;const A=y.indexOf(";",R),O=A===-1?x:A;if(D>O){R=y.lastIndexOf(";",D-1)+1;continue}const I=c(y,R,D),N=h(y,D,I),M=y.slice(I,N);if(E[M]===void 0){let F=c(y,D+1,O),H=h(y,O,F);const B=T(y.slice(F,H));E[M]=B}R=O+1}while(R<x);return E}function c(y,S,E){do{const x=y.charCodeAt(S);if(x!==32&&x!==9)return S}while(++S<E);return E}function h(y,S,E){for(;S>E;){const x=y.charCodeAt(--S);if(x!==32&&x!==9)return S+1}return E}function f(y,S,E){const x=(E==null?void 0:E.encode)||encodeURIComponent;if(!a.test(y))throw new TypeError(`argument name is invalid: ${y}`);const T=x(S);if(!e.test(T))throw new TypeError(`argument val is invalid: ${S}`);let R=y+"="+T;if(!E)return R;if(E.maxAge!==void 0){if(!Number.isInteger(E.maxAge))throw new TypeError(`option maxAge is invalid: ${E.maxAge}`);R+="; Max-Age="+E.maxAge}if(E.domain){if(!t.test(E.domain))throw new TypeError(`option domain is invalid: ${E.domain}`);R+="; Domain="+E.domain}if(E.path){if(!i.test(E.path))throw new TypeError(`option path is invalid: ${E.path}`);R+="; Path="+E.path}if(E.expires){if(!m(E.expires)||!Number.isFinite(E.expires.valueOf()))throw new TypeError(`option expires is invalid: ${E.expires}`);R+="; Expires="+E.expires.toUTCString()}if(E.httpOnly&&(R+="; HttpOnly"),E.secure&&(R+="; Secure"),E.partitioned&&(R+="; Partitioned"),E.priority)switch(typeof E.priority=="string"?E.priority.toLowerCase():void 0){case"low":R+="; Priority=Low";break;case"medium":R+="; Priority=Medium";break;case"high":R+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${E.priority}`)}if(E.sameSite)switch(typeof E.sameSite=="string"?E.sameSite.toLowerCase():E.sameSite){case!0:case"strict":R+="; SameSite=Strict";break;case"lax":R+="; SameSite=Lax";break;case"none":R+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${E.sameSite}`)}return R}function g(y){if(y.indexOf("%")===-1)return y;try{return decodeURIComponent(y)}catch{return y}}function m(y){return s.call(y)==="[object Date]"}return Ta}vx();/**
 * react-router v7.5.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var sp="popstate";function Ex(a={}){function e(s,l){let{pathname:o="/",search:c="",hash:h=""}=ys(s.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Zf("",{pathname:o,search:c,hash:h},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function t(s,l){let o=s.document.querySelector("base"),c="";if(o&&o.getAttribute("href")){let h=s.location.href,f=h.indexOf("#");c=f===-1?h:h.slice(0,f)}return c+"#"+(typeof l=="string"?l:Ca(l))}function i(s,l){yi(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return Tx(e,t,i,a)}function nt(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function yi(a,e){if(!a){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Sx(){return Math.random().toString(36).substring(2,10)}function rp(a,e){return{usr:a.state,key:a.key,idx:e}}function Zf(a,e,t=null,i){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof e=="string"?ys(e):e,state:t,key:e&&e.key||i||Sx()}}function Ca({pathname:a="/",search:e="",hash:t=""}){return e&&e!=="?"&&(a+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(a+=t.charAt(0)==="#"?t:"#"+t),a}function ys(a){let e={};if(a){let t=a.indexOf("#");t>=0&&(e.hash=a.substring(t),a=a.substring(0,t));let i=a.indexOf("?");i>=0&&(e.search=a.substring(i),a=a.substring(0,i)),a&&(e.pathname=a)}return e}function Tx(a,e,t,i={}){let{window:s=document.defaultView,v5Compat:l=!1}=i,o=s.history,c="POP",h=null,f=g();f==null&&(f=0,o.replaceState({...o.state,idx:f},""));function g(){return(o.state||{idx:null}).idx}function m(){c="POP";let T=g(),R=T==null?null:T-f;f=T,h&&h({action:c,location:x.location,delta:R})}function y(T,R){c="PUSH";let D=Zf(x.location,T,R);t&&t(D,T),f=g()+1;let A=rp(D,f),O=x.createHref(D);try{o.pushState(A,"",O)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;s.location.assign(O)}l&&h&&h({action:c,location:x.location,delta:1})}function S(T,R){c="REPLACE";let D=Zf(x.location,T,R);t&&t(D,T),f=g();let A=rp(D,f),O=x.createHref(D);o.replaceState(A,"",O),l&&h&&h({action:c,location:x.location,delta:0})}function E(T){let R=s.location.origin!=="null"?s.location.origin:s.location.href,D=typeof T=="string"?T:Ca(T);return D=D.replace(/ $/,"%20"),nt(R,`No window.location.(origin|href) available to create URL for href: ${D}`),new URL(D,R)}let x={get action(){return c},get location(){return a(s,o)},listen(T){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(sp,m),h=T,()=>{s.removeEventListener(sp,m),h=null}},createHref(T){return e(s,T)},createURL:E,encodeLocation(T){let R=E(T);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:y,replace:S,go(T){return o.go(T)}};return x}function Fy(a,e,t="/"){return xx(a,e,t,!1)}function xx(a,e,t,i){let s=typeof e=="string"?ys(e):e,l=on(s.pathname||"/",t);if(l==null)return null;let o=$y(a);bx(o);let c=null;for(let h=0;c==null&&h<o.length;++h){let f=Mx(l);c=Ox(o[h],f,i)}return c}function $y(a,e=[],t=[],i=""){let s=(l,o,c)=>{let h={relativePath:c===void 0?l.path||"":c,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};h.relativePath.startsWith("/")&&(nt(h.relativePath.startsWith(i),`Absolute route path "${h.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(i.length));let f=ln([i,h.relativePath]),g=t.concat(h);l.children&&l.children.length>0&&(nt(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),$y(l.children,e,g,f)),!(l.path==null&&!l.index)&&e.push({path:f,score:Ix(f,l.index),routesMeta:g})};return a.forEach((l,o)=>{var c;if(l.path===""||!((c=l.path)!=null&&c.includes("?")))s(l,o);else for(let h of Gy(l.path))s(l,o,h)}),e}function Gy(a){let e=a.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),l=t.replace(/\?$/,"");if(i.length===0)return s?[l,""]:[l];let o=Gy(i.join("/")),c=[];return c.push(...o.map(h=>h===""?l:[l,h].join("/"))),s&&c.push(...o),c.map(h=>a.startsWith("/")&&h===""?"/":h)}function bx(a){a.sort((e,t)=>e.score!==t.score?t.score-e.score:wx(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var Ax=/^:[\w-]+$/,Rx=3,Lx=2,_x=1,Dx=10,Cx=-2,ap=a=>a==="*";function Ix(a,e){let t=a.split("/"),i=t.length;return t.some(ap)&&(i+=Cx),e&&(i+=Lx),t.filter(s=>!ap(s)).reduce((s,l)=>s+(Ax.test(l)?Rx:l===""?_x:Dx),i)}function wx(a,e){return a.length===e.length&&a.slice(0,-1).every((i,s)=>i===e[s])?a[a.length-1]-e[e.length-1]:0}function Ox(a,e,t=!1){let{routesMeta:i}=a,s={},l="/",o=[];for(let c=0;c<i.length;++c){let h=i[c],f=c===i.length-1,g=l==="/"?e:e.slice(l.length)||"/",m=Mo({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},g),y=h.route;if(!m&&f&&t&&!i[i.length-1].route.index&&(m=Mo({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},g)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:ln([l,m.pathname]),pathnameBase:Bx(ln([l,m.pathnameBase])),route:y}),m.pathnameBase!=="/"&&(l=ln([l,m.pathnameBase]))}return o}function Mo(a,e){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[t,i]=kx(a.path,a.caseSensitive,a.end),s=e.match(t);if(!s)return null;let l=s[0],o=l.replace(/(.)\/+$/,"$1"),c=s.slice(1);return{params:i.reduce((f,{paramName:g,isOptional:m},y)=>{if(g==="*"){let E=c[y]||"";o=l.slice(0,l.length-E.length).replace(/(.)\/+$/,"$1")}const S=c[y];return m&&!S?f[g]=void 0:f[g]=(S||"").replace(/%2F/g,"/"),f},{}),pathname:l,pathnameBase:o,pattern:a}}function kx(a,e=!1,t=!0){yi(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let i=[],s="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,h)=>(i.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return a.endsWith("*")?(i.push({paramName:"*"}),s+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":a!==""&&a!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function Mx(a){try{return a.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return yi(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),a}}function on(a,e){if(e==="/")return a;if(!a.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=a.charAt(t);return i&&i!=="/"?null:a.slice(t)||"/"}function Px(a,e="/"){let{pathname:t,search:i="",hash:s=""}=typeof a=="string"?ys(a):a;return{pathname:t?t.startsWith("/")?t:Nx(t,e):e,search:Fx(i),hash:$x(s)}}function Nx(a,e){let t=e.replace(/\/+$/,"").split("/");return a.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function xf(a,e,t,i){return`Cannot include a '${a}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Ux(a){return a.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function jy(a){let e=Ux(a);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function Hy(a,e,t,i=!1){let s;typeof a=="string"?s=ys(a):(s={...a},nt(!s.pathname||!s.pathname.includes("?"),xf("?","pathname","search",s)),nt(!s.pathname||!s.pathname.includes("#"),xf("#","pathname","hash",s)),nt(!s.search||!s.search.includes("#"),xf("#","search","hash",s)));let l=a===""||s.pathname==="",o=l?"/":s.pathname,c;if(o==null)c=t;else{let m=e.length-1;if(!i&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),m-=1;s.pathname=y.join("/")}c=m>=0?e[m]:"/"}let h=Px(s,c),f=o&&o!=="/"&&o.endsWith("/"),g=(l||o===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(f||g)&&(h.pathname+="/"),h}var ln=a=>a.join("/").replace(/\/\/+/g,"/"),Bx=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Fx=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,$x=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function Gx(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}var Vy=["POST","PUT","PATCH","DELETE"];new Set(Vy);var jx=["GET",...Vy];new Set(jx);var yr=$.createContext(null);yr.displayName="DataRouter";var Yo=$.createContext(null);Yo.displayName="DataRouterState";var Ky=$.createContext({isTransitioning:!1});Ky.displayName="ViewTransition";var Hx=$.createContext(new Map);Hx.displayName="Fetchers";var Vx=$.createContext(null);Vx.displayName="Await";var Ni=$.createContext(null);Ni.displayName="Navigation";var Fa=$.createContext(null);Fa.displayName="Location";var vi=$.createContext({outlet:null,matches:[],isDataRoute:!1});vi.displayName="Route";var Rd=$.createContext(null);Rd.displayName="RouteError";function Kx(a,{relative:e}={}){nt($a(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=$.useContext(Ni),{hash:s,pathname:l,search:o}=Ga(a,{relative:e}),c=l;return t!=="/"&&(c=l==="/"?t:ln([t,l])),i.createHref({pathname:c,search:o,hash:s})}function $a(){return $.useContext(Fa)!=null}function jn(){return nt($a(),"useLocation() may be used only in the context of a <Router> component."),$.useContext(Fa).location}var zy="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function qy(a){$.useContext(Ni).static||$.useLayoutEffect(a)}function vs(){let{isDataRoute:a}=$.useContext(vi);return a?ab():zx()}function zx(){nt($a(),"useNavigate() may be used only in the context of a <Router> component.");let a=$.useContext(yr),{basename:e,navigator:t}=$.useContext(Ni),{matches:i}=$.useContext(vi),{pathname:s}=jn(),l=JSON.stringify(jy(i)),o=$.useRef(!1);return qy(()=>{o.current=!0}),$.useCallback((h,f={})=>{if(yi(o.current,zy),!o.current)return;if(typeof h=="number"){t.go(h);return}let g=Hy(h,JSON.parse(l),s,f.relative==="path");a==null&&e!=="/"&&(g.pathname=g.pathname==="/"?e:ln([e,g.pathname])),(f.replace?t.replace:t.push)(g,f.state,f)},[e,t,l,s,a])}var qx=$.createContext(null);function Yx(a){let e=$.useContext(vi).outlet;return e&&$.createElement(qx.Provider,{value:a},e)}function vr(){let{matches:a}=$.useContext(vi),e=a[a.length-1];return e?e.params:{}}function Ga(a,{relative:e}={}){let{matches:t}=$.useContext(vi),{pathname:i}=jn(),s=JSON.stringify(jy(t));return $.useMemo(()=>Hy(a,JSON.parse(s),i,e==="path"),[a,s,i,e])}function Xx(a,e){return Yy(a,e)}function Yy(a,e,t,i){var D;nt($a(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s,static:l}=$.useContext(Ni),{matches:o}=$.useContext(vi),c=o[o.length-1],h=c?c.params:{},f=c?c.pathname:"/",g=c?c.pathnameBase:"/",m=c&&c.route;{let A=m&&m.path||"";Xy(f,!m||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let y=jn(),S;if(e){let A=typeof e=="string"?ys(e):e;nt(g==="/"||((D=A.pathname)==null?void 0:D.startsWith(g)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${g}" but pathname "${A.pathname}" was given in the \`location\` prop.`),S=A}else S=y;let E=S.pathname||"/",x=E;if(g!=="/"){let A=g.replace(/^\//,"").split("/");x="/"+E.replace(/^\//,"").split("/").slice(A.length).join("/")}let T=!l&&t&&t.matches&&t.matches.length>0?t.matches:Fy(a,{pathname:x});yi(m||T!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),yi(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=eb(T&&T.map(A=>Object.assign({},A,{params:Object.assign({},h,A.params),pathname:ln([g,s.encodeLocation?s.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?g:ln([g,s.encodeLocation?s.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),o,t,i);return e&&R?$.createElement(Fa.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...S},navigationType:"POP"}},R):R}function Qx(){let a=rb(),e=Gx(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),t=a instanceof Error?a.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",a),o=$.createElement($.Fragment,null,$.createElement("p",null," Hey developer "),$.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",$.createElement("code",{style:l},"ErrorBoundary")," or"," ",$.createElement("code",{style:l},"errorElement")," prop on your route.")),$.createElement($.Fragment,null,$.createElement("h2",null,"Unexpected Application Error!"),$.createElement("h3",{style:{fontStyle:"italic"}},e),t?$.createElement("pre",{style:s},t):null,o)}var Wx=$.createElement(Qx,null),Zx=class extends $.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,e){return e.location!==a.location||e.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:e.error,location:e.location,revalidation:a.revalidation||e.revalidation}}componentDidCatch(a,e){console.error("React Router caught the following error during render",a,e)}render(){return this.state.error!==void 0?$.createElement(vi.Provider,{value:this.props.routeContext},$.createElement(Rd.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Jx({routeContext:a,match:e,children:t}){let i=$.useContext(yr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),$.createElement(vi.Provider,{value:a},t)}function eb(a,e=[],t=null,i=null){if(a==null){if(!t)return null;if(t.errors)a=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)a=t.matches;else return null}let s=a,l=t==null?void 0:t.errors;if(l!=null){let h=s.findIndex(f=>f.route.id&&(l==null?void 0:l[f.route.id])!==void 0);nt(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let o=!1,c=-1;if(t)for(let h=0;h<s.length;h++){let f=s[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=h),f.route.id){let{loaderData:g,errors:m}=t,y=f.route.loader&&!g.hasOwnProperty(f.route.id)&&(!m||m[f.route.id]===void 0);if(f.route.lazy||y){o=!0,c>=0?s=s.slice(0,c+1):s=[s[0]];break}}}return s.reduceRight((h,f,g)=>{let m,y=!1,S=null,E=null;t&&(m=l&&f.route.id?l[f.route.id]:void 0,S=f.route.errorElement||Wx,o&&(c<0&&g===0?(Xy("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,E=null):c===g&&(y=!0,E=f.route.hydrateFallbackElement||null)));let x=e.concat(s.slice(0,g+1)),T=()=>{let R;return m?R=S:y?R=E:f.route.Component?R=$.createElement(f.route.Component,null):f.route.element?R=f.route.element:R=h,$.createElement(Jx,{match:f,routeContext:{outlet:h,matches:x,isDataRoute:t!=null},children:R})};return t&&(f.route.ErrorBoundary||f.route.errorElement||g===0)?$.createElement(Zx,{location:t.location,revalidation:t.revalidation,component:S,error:m,children:T(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):T()},null)}function Ld(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function tb(a){let e=$.useContext(yr);return nt(e,Ld(a)),e}function ib(a){let e=$.useContext(Yo);return nt(e,Ld(a)),e}function nb(a){let e=$.useContext(vi);return nt(e,Ld(a)),e}function _d(a){let e=nb(a),t=e.matches[e.matches.length-1];return nt(t.route.id,`${a} can only be used on routes that contain a unique "id"`),t.route.id}function sb(){return _d("useRouteId")}function rb(){var i;let a=$.useContext(Rd),e=ib("useRouteError"),t=_d("useRouteError");return a!==void 0?a:(i=e.errors)==null?void 0:i[t]}function ab(){let{router:a}=tb("useNavigate"),e=_d("useNavigate"),t=$.useRef(!1);return qy(()=>{t.current=!0}),$.useCallback(async(s,l={})=>{yi(t.current,zy),t.current&&(typeof s=="number"?a.navigate(s):await a.navigate(s,{fromRouteId:e,...l}))},[a,e])}var lp={};function Xy(a,e,t){!e&&!lp[a]&&(lp[a]=!0,yi(!1,t))}$.memo(lb);function lb({routes:a,future:e,state:t}){return Yy(a,void 0,t,e)}function Dd(a){return Yx(a.context)}function Dt(a){nt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ob({basename:a="/",children:e=null,location:t,navigationType:i="POP",navigator:s,static:l=!1}){nt(!$a(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=a.replace(/^\/*/,"/"),c=$.useMemo(()=>({basename:o,navigator:s,static:l,future:{}}),[o,s,l]);typeof t=="string"&&(t=ys(t));let{pathname:h="/",search:f="",hash:g="",state:m=null,key:y="default"}=t,S=$.useMemo(()=>{let E=on(h,o);return E==null?null:{location:{pathname:E,search:f,hash:g,state:m,key:y},navigationType:i}},[o,h,f,g,m,y,i]);return yi(S!=null,`<Router basename="${o}"> is not able to match the URL "${h}${f}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:$.createElement(Ni.Provider,{value:c},$.createElement(Fa.Provider,{children:e,value:S}))}function ub({children:a,location:e}){return Xx(Jf(a),e)}function Jf(a,e=[]){let t=[];return $.Children.forEach(a,(i,s)=>{if(!$.isValidElement(i))return;let l=[...e,s];if(i.type===$.Fragment){t.push.apply(t,Jf(i.props.children,l));return}nt(i.type===Dt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),nt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=Jf(i.props.children,l)),t.push(o)}),t}var xo="get",bo="application/x-www-form-urlencoded";function Xo(a){return a!=null&&typeof a.tagName=="string"}function cb(a){return Xo(a)&&a.tagName.toLowerCase()==="button"}function fb(a){return Xo(a)&&a.tagName.toLowerCase()==="form"}function db(a){return Xo(a)&&a.tagName.toLowerCase()==="input"}function hb(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function gb(a,e){return a.button===0&&(!e||e==="_self")&&!hb(a)}var ao=null;function mb(){if(ao===null)try{new FormData(document.createElement("form"),0),ao=!1}catch{ao=!0}return ao}var pb=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function bf(a){return a!=null&&!pb.has(a)?(yi(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bo}"`),null):a}function yb(a,e){let t,i,s,l,o;if(fb(a)){let c=a.getAttribute("action");i=c?on(c,e):null,t=a.getAttribute("method")||xo,s=bf(a.getAttribute("enctype"))||bo,l=new FormData(a)}else if(cb(a)||db(a)&&(a.type==="submit"||a.type==="image")){let c=a.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=a.getAttribute("formaction")||c.getAttribute("action");if(i=h?on(h,e):null,t=a.getAttribute("formmethod")||c.getAttribute("method")||xo,s=bf(a.getAttribute("formenctype"))||bf(c.getAttribute("enctype"))||bo,l=new FormData(c,a),!mb()){let{name:f,type:g,value:m}=a;if(g==="image"){let y=f?`${f}.`:"";l.append(`${y}x`,"0"),l.append(`${y}y`,"0")}else f&&l.append(f,m)}}else{if(Xo(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=xo,i=null,s=bo,o=a}return l&&s==="text/plain"&&(o=l,l=void 0),{action:i,method:t.toLowerCase(),encType:s,formData:l,body:o}}function Cd(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}async function vb(a,e){if(a.id in e)return e[a.id];try{let t=await import(a.module);return e[a.id]=t,t}catch(t){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Eb(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function Sb(a,e,t){let i=await Promise.all(a.map(async s=>{let l=e.routes[s.route.id];if(l){let o=await vb(l,t);return o.links?o.links():[]}return[]}));return Ab(i.flat(1).filter(Eb).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function op(a,e,t,i,s,l){let o=(h,f)=>t[f]?h.route.id!==t[f].route.id:!0,c=(h,f)=>{var g;return t[f].pathname!==h.pathname||((g=t[f].route.path)==null?void 0:g.endsWith("*"))&&t[f].params["*"]!==h.params["*"]};return l==="assets"?e.filter((h,f)=>o(h,f)||c(h,f)):l==="data"?e.filter((h,f)=>{var m;let g=i.routes[h.route.id];if(!g||!g.hasLoader)return!1;if(o(h,f)||c(h,f))return!0;if(h.route.shouldRevalidate){let y=h.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(a,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof y=="boolean")return y}return!0}):[]}function Tb(a,e,{includeHydrateFallback:t}={}){return xb(a.map(i=>{let s=e.routes[i.route.id];if(!s)return[];let l=[s.module];return s.clientActionModule&&(l=l.concat(s.clientActionModule)),s.clientLoaderModule&&(l=l.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(l=l.concat(s.hydrateFallbackModule)),s.imports&&(l=l.concat(s.imports)),l}).flat(1))}function xb(a){return[...new Set(a)]}function bb(a){let e={},t=Object.keys(a).sort();for(let i of t)e[i]=a[i];return e}function Ab(a,e){let t=new Set;return new Set(e),a.reduce((i,s)=>{let l=JSON.stringify(bb(s));return t.has(l)||(t.add(l),i.push({key:l,link:s})),i},[])}function Rb(a,e){let t=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return t.pathname==="/"?t.pathname="_root.data":e&&on(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function Qy(){let a=$.useContext(yr);return Cd(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function Lb(){let a=$.useContext(Yo);return Cd(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var Id=$.createContext(void 0);Id.displayName="FrameworkContext";function Wy(){let a=$.useContext(Id);return Cd(a,"You must render this element inside a <HydratedRouter> element"),a}function _b(a,e){let t=$.useContext(Id),[i,s]=$.useState(!1),[l,o]=$.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:f,onMouseLeave:g,onTouchStart:m}=e,y=$.useRef(null);$.useEffect(()=>{if(a==="render"&&o(!0),a==="viewport"){let x=R=>{R.forEach(D=>{o(D.isIntersecting)})},T=new IntersectionObserver(x,{threshold:.5});return y.current&&T.observe(y.current),()=>{T.disconnect()}}},[a]),$.useEffect(()=>{if(i){let x=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(x)}}},[i]);let S=()=>{s(!0)},E=()=>{s(!1),o(!1)};return t?a!=="intent"?[l,y,{}]:[l,y,{onFocus:xa(c,S),onBlur:xa(h,E),onMouseEnter:xa(f,S),onMouseLeave:xa(g,E),onTouchStart:xa(m,S)}]:[!1,y,{}]}function xa(a,e){return t=>{a&&a(t),t.defaultPrevented||e(t)}}function Db({page:a,...e}){let{router:t}=Qy(),i=$.useMemo(()=>Fy(t.routes,a,t.basename),[t.routes,a,t.basename]);return i?$.createElement(Ib,{page:a,matches:i,...e}):null}function Cb(a){let{manifest:e,routeModules:t}=Wy(),[i,s]=$.useState([]);return $.useEffect(()=>{let l=!1;return Sb(a,e,t).then(o=>{l||s(o)}),()=>{l=!0}},[a,e,t]),i}function Ib({page:a,matches:e,...t}){let i=jn(),{manifest:s,routeModules:l}=Wy(),{basename:o}=Qy(),{loaderData:c,matches:h}=Lb(),f=$.useMemo(()=>op(a,e,h,s,i,"data"),[a,e,h,s,i]),g=$.useMemo(()=>op(a,e,h,s,i,"assets"),[a,e,h,s,i]),m=$.useMemo(()=>{if(a===i.pathname+i.search+i.hash)return[];let E=new Set,x=!1;if(e.forEach(R=>{var A;let D=s.routes[R.route.id];!D||!D.hasLoader||(!f.some(O=>O.route.id===R.route.id)&&R.route.id in c&&((A=l[R.route.id])!=null&&A.shouldRevalidate)||D.hasClientLoader?x=!0:E.add(R.route.id))}),E.size===0)return[];let T=Rb(a,o);return x&&E.size>0&&T.searchParams.set("_routes",e.filter(R=>E.has(R.route.id)).map(R=>R.route.id).join(",")),[T.pathname+T.search]},[o,c,i,s,f,e,a,l]),y=$.useMemo(()=>Tb(g,s),[g,s]),S=Cb(g);return $.createElement($.Fragment,null,m.map(E=>$.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),y.map(E=>$.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),S.map(({key:E,link:x})=>$.createElement("link",{key:E,...x})))}function wb(...a){return e=>{a.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Zy=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Zy&&(window.__reactRouterVersion="7.5.0")}catch{}function Ob({basename:a,children:e,window:t}){let i=$.useRef();i.current==null&&(i.current=Ex({window:t,v5Compat:!0}));let s=i.current,[l,o]=$.useState({action:s.action,location:s.location}),c=$.useCallback(h=>{$.startTransition(()=>o(h))},[o]);return $.useLayoutEffect(()=>s.listen(c),[s,c]),$.createElement(ob,{basename:a,children:e,location:l.location,navigationType:l.action,navigator:s})}var Jy=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wd=$.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:s,reloadDocument:l,replace:o,state:c,target:h,to:f,preventScrollReset:g,viewTransition:m,...y},S){let{basename:E}=$.useContext(Ni),x=typeof f=="string"&&Jy.test(f),T,R=!1;if(typeof f=="string"&&x&&(T=f,Zy))try{let H=new URL(window.location.href),B=f.startsWith("//")?new URL(H.protocol+f):new URL(f),ie=on(B.pathname,E);B.origin===H.origin&&ie!=null?f=ie+B.search+B.hash:R=!0}catch{yi(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let D=Kx(f,{relative:s}),[A,O,I]=_b(i,y),N=Pb(f,{replace:o,state:c,target:h,preventScrollReset:g,relative:s,viewTransition:m});function M(H){e&&e(H),H.defaultPrevented||N(H)}let F=$.createElement("a",{...y,...I,href:T||D,onClick:R||l?e:M,ref:wb(S,O),target:h,"data-discover":!x&&t==="render"?"true":void 0});return A&&!x?$.createElement($.Fragment,null,F,$.createElement(Db,{page:D})):F});wd.displayName="Link";var Un=$.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:s=!1,style:l,to:o,viewTransition:c,children:h,...f},g){let m=Ga(o,{relative:f.relative}),y=jn(),S=$.useContext(Yo),{navigator:E,basename:x}=$.useContext(Ni),T=S!=null&&$b(m)&&c===!0,R=E.encodeLocation?E.encodeLocation(m).pathname:m.pathname,D=y.pathname,A=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;t||(D=D.toLowerCase(),A=A?A.toLowerCase():null,R=R.toLowerCase()),A&&x&&(A=on(A,x)||A);const O=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let I=D===R||!s&&D.startsWith(R)&&D.charAt(O)==="/",N=A!=null&&(A===R||!s&&A.startsWith(R)&&A.charAt(R.length)==="/"),M={isActive:I,isPending:N,isTransitioning:T},F=I?e:void 0,H;typeof i=="function"?H=i(M):H=[i,I?"active":null,N?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let B=typeof l=="function"?l(M):l;return $.createElement(wd,{...f,"aria-current":F,className:H,ref:g,style:B,to:o,viewTransition:c},typeof h=="function"?h(M):h)});Un.displayName="NavLink";var kb=$.forwardRef(({discover:a="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:s,state:l,method:o=xo,action:c,onSubmit:h,relative:f,preventScrollReset:g,viewTransition:m,...y},S)=>{let E=Bb(),x=Fb(c,{relative:f}),T=o.toLowerCase()==="get"?"get":"post",R=typeof c=="string"&&Jy.test(c),D=A=>{if(h&&h(A),A.defaultPrevented)return;A.preventDefault();let O=A.nativeEvent.submitter,I=(O==null?void 0:O.getAttribute("formmethod"))||o;E(O||A.currentTarget,{fetcherKey:e,method:I,navigate:t,replace:s,state:l,relative:f,preventScrollReset:g,viewTransition:m})};return $.createElement("form",{ref:S,method:T,action:x,onSubmit:i?h:D,...y,"data-discover":!R&&a==="render"?"true":void 0})});kb.displayName="Form";function Mb(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ev(a){let e=$.useContext(yr);return nt(e,Mb(a)),e}function Pb(a,{target:e,replace:t,state:i,preventScrollReset:s,relative:l,viewTransition:o}={}){let c=vs(),h=jn(),f=Ga(a,{relative:l});return $.useCallback(g=>{if(gb(g,e)){g.preventDefault();let m=t!==void 0?t:Ca(h)===Ca(f);c(a,{replace:m,state:i,preventScrollReset:s,relative:l,viewTransition:o})}},[h,c,f,t,i,e,a,s,l,o])}var Nb=0,Ub=()=>`__${String(++Nb)}__`;function Bb(){let{router:a}=ev("useSubmit"),{basename:e}=$.useContext(Ni),t=sb();return $.useCallback(async(i,s={})=>{let{action:l,method:o,encType:c,formData:h,body:f}=yb(i,e);if(s.navigate===!1){let g=s.fetcherKey||Ub();await a.fetch(g,t,s.action||l,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||o,formEncType:s.encType||c,flushSync:s.flushSync})}else await a.navigate(s.action||l,{preventScrollReset:s.preventScrollReset,formData:h,body:f,formMethod:s.method||o,formEncType:s.encType||c,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[a,e,t])}function Fb(a,{relative:e}={}){let{basename:t}=$.useContext(Ni),i=$.useContext(vi);nt(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),l={...Ga(a||".",{relative:e})},o=jn();if(a==null){l.search=o.search;let c=new URLSearchParams(l.search),h=c.getAll("index");if(h.some(g=>g==="")){c.delete("index"),h.filter(m=>m).forEach(m=>c.append("index",m));let g=c.toString();l.search=g?`?${g}`:""}}return(!a||a===".")&&s.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:ln([t,l.pathname])),Ca(l)}function $b(a,e={}){let t=$.useContext(Ky);nt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=ev("useViewTransitionState"),s=Ga(a,{relative:e.relative});if(!t.isTransitioning)return!1;let l=on(t.currentLocation.pathname,i)||t.currentLocation.pathname,o=on(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Mo(s.pathname,o)!=null||Mo(s.pathname,l)!=null}new TextEncoder;const un=()=>{const[a,e]=$.useState(null),[t,i]=$.useState(""),s=vs();$.useEffect(()=>{const c=localStorage.getItem("currentUser");if(c)try{const h=JSON.parse(c);e(h)}catch{e({firstName:c})}},[]);const l=()=>{localStorage.removeItem("currentUser"),e(null),s("/")},o=c=>{c.preventDefault(),t.trim()&&(s(`/search?q=${encodeURIComponent(t.trim())}`),i(""))};return _.jsxs("header",{className:"header",children:[_.jsx(Un,{to:"/",className:"logo-text",children:"Dollor Stream"}),a&&_.jsxs("nav",{className:"nav-toggle",children:[_.jsx(Un,{to:"/movies",className:({isActive:c})=>c?"tab active":"tab",children:"Movies"}),_.jsx(Un,{to:"/tv",className:({isActive:c})=>c?"tab active":"tab",children:"TV Shows"}),_.jsx(Un,{to:"/anime",className:({isActive:c})=>c?"tab active":"tab",children:"Anime"}),_.jsx(Un,{to:"/live-tv",className:({isActive:c})=>c?"tab active":"tab",children:"Live TV"})]}),a&&_.jsxs("form",{onSubmit:o,className:"search-form",children:[_.jsx("input",{type:"text",placeholder:"Search movies, TV or anime",value:t,onChange:c=>i(c.target.value),className:"search-input"}),_.jsx("button",{type:"submit",className:"search-button",children:"Search"})]}),_.jsx("div",{className:"navbar-container",children:a?_.jsxs(_.Fragment,{children:[_.jsx("span",{className:"welcome",children:a.firstName}),_.jsx("button",{onClick:l,className:"logout-button",children:"Log Out"})]}):_.jsxs(_.Fragment,{children:[_.jsx(Un,{to:"/login",className:"auth-link",children:"Log In"}),_.jsx(Un,{to:"/register",className:"auth-link",children:"Register"})]})})]})},tv="/website1/assets/bkg-BCKbtiu3.jpg",Gb=()=>_.jsxs("div",{className:"hero",children:[_.jsx("img",{src:tv,alt:"lots of movies"}),_.jsxs("div",{className:"hero-content",children:[_.jsx("h1",{children:"The number 1 streaming site of all time"}),_.jsx("p",{children:"FREE content from services like Disney+, Netflix, etc."}),_.jsx("button",{className:"subscribe-button",children:"Subcribe to get premium streaming, no pop-up with viruses and more! Plans starting at $6.99"})]}),"."]});function iv(a,e){return function(){return a.apply(e,arguments)}}const{toString:jb}=Object.prototype,{getPrototypeOf:Od}=Object,Qo=(a=>e=>{const t=jb.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ei=a=>(a=a.toLowerCase(),e=>Qo(e)===a),Wo=a=>e=>typeof e===a,{isArray:Er}=Array,Ia=Wo("undefined");function Hb(a){return a!==null&&!Ia(a)&&a.constructor!==null&&!Ia(a.constructor)&&Qt(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const nv=Ei("ArrayBuffer");function Vb(a){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(a):e=a&&a.buffer&&nv(a.buffer),e}const Kb=Wo("string"),Qt=Wo("function"),sv=Wo("number"),Zo=a=>a!==null&&typeof a=="object",zb=a=>a===!0||a===!1,Ao=a=>{if(Qo(a)!=="object")return!1;const e=Od(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},qb=Ei("Date"),Yb=Ei("File"),Xb=Ei("Blob"),Qb=Ei("FileList"),Wb=a=>Zo(a)&&Qt(a.pipe),Zb=a=>{let e;return a&&(typeof FormData=="function"&&a instanceof FormData||Qt(a.append)&&((e=Qo(a))==="formdata"||e==="object"&&Qt(a.toString)&&a.toString()==="[object FormData]"))},Jb=Ei("URLSearchParams"),[eA,tA,iA,nA]=["ReadableStream","Request","Response","Headers"].map(Ei),sA=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ja(a,e,{allOwnKeys:t=!1}={}){if(a===null||typeof a>"u")return;let i,s;if(typeof a!="object"&&(a=[a]),Er(a))for(i=0,s=a.length;i<s;i++)e.call(null,a[i],i,a);else{const l=t?Object.getOwnPropertyNames(a):Object.keys(a),o=l.length;let c;for(i=0;i<o;i++)c=l[i],e.call(null,a[c],c,a)}}function rv(a,e){e=e.toLowerCase();const t=Object.keys(a);let i=t.length,s;for(;i-- >0;)if(s=t[i],e===s.toLowerCase())return s;return null}const ds=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,av=a=>!Ia(a)&&a!==ds;function ed(){const{caseless:a}=av(this)&&this||{},e={},t=(i,s)=>{const l=a&&rv(e,s)||s;Ao(e[l])&&Ao(i)?e[l]=ed(e[l],i):Ao(i)?e[l]=ed({},i):Er(i)?e[l]=i.slice():e[l]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&ja(arguments[i],t);return e}const rA=(a,e,t,{allOwnKeys:i}={})=>(ja(e,(s,l)=>{t&&Qt(s)?a[l]=iv(s,t):a[l]=s},{allOwnKeys:i}),a),aA=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),lA=(a,e,t,i)=>{a.prototype=Object.create(e.prototype,i),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:e.prototype}),t&&Object.assign(a.prototype,t)},oA=(a,e,t,i)=>{let s,l,o;const c={};if(e=e||{},a==null)return e;do{for(s=Object.getOwnPropertyNames(a),l=s.length;l-- >0;)o=s[l],(!i||i(o,a,e))&&!c[o]&&(e[o]=a[o],c[o]=!0);a=t!==!1&&Od(a)}while(a&&(!t||t(a,e))&&a!==Object.prototype);return e},uA=(a,e,t)=>{a=String(a),(t===void 0||t>a.length)&&(t=a.length),t-=e.length;const i=a.indexOf(e,t);return i!==-1&&i===t},cA=a=>{if(!a)return null;if(Er(a))return a;let e=a.length;if(!sv(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=a[e];return t},fA=(a=>e=>a&&e instanceof a)(typeof Uint8Array<"u"&&Od(Uint8Array)),dA=(a,e)=>{const i=(a&&a[Symbol.iterator]).call(a);let s;for(;(s=i.next())&&!s.done;){const l=s.value;e.call(a,l[0],l[1])}},hA=(a,e)=>{let t;const i=[];for(;(t=a.exec(e))!==null;)i.push(t);return i},gA=Ei("HTMLFormElement"),mA=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,s){return i.toUpperCase()+s}),up=(({hasOwnProperty:a})=>(e,t)=>a.call(e,t))(Object.prototype),pA=Ei("RegExp"),lv=(a,e)=>{const t=Object.getOwnPropertyDescriptors(a),i={};ja(t,(s,l)=>{let o;(o=e(s,l,a))!==!1&&(i[l]=o||s)}),Object.defineProperties(a,i)},yA=a=>{lv(a,(e,t)=>{if(Qt(a)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=a[t];if(Qt(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},vA=(a,e)=>{const t={},i=s=>{s.forEach(l=>{t[l]=!0})};return Er(a)?i(a):i(String(a).split(e)),t},EA=()=>{},SA=(a,e)=>a!=null&&Number.isFinite(a=+a)?a:e;function TA(a){return!!(a&&Qt(a.append)&&a[Symbol.toStringTag]==="FormData"&&a[Symbol.iterator])}const xA=a=>{const e=new Array(10),t=(i,s)=>{if(Zo(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[s]=i;const l=Er(i)?[]:{};return ja(i,(o,c)=>{const h=t(o,s+1);!Ia(h)&&(l[c]=h)}),e[s]=void 0,l}}return i};return t(a,0)},bA=Ei("AsyncFunction"),AA=a=>a&&(Zo(a)||Qt(a))&&Qt(a.then)&&Qt(a.catch),ov=((a,e)=>a?setImmediate:e?((t,i)=>(ds.addEventListener("message",({source:s,data:l})=>{s===ds&&l===t&&i.length&&i.shift()()},!1),s=>{i.push(s),ds.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Qt(ds.postMessage)),RA=typeof queueMicrotask<"u"?queueMicrotask.bind(ds):typeof process<"u"&&process.nextTick||ov,Z={isArray:Er,isArrayBuffer:nv,isBuffer:Hb,isFormData:Zb,isArrayBufferView:Vb,isString:Kb,isNumber:sv,isBoolean:zb,isObject:Zo,isPlainObject:Ao,isReadableStream:eA,isRequest:tA,isResponse:iA,isHeaders:nA,isUndefined:Ia,isDate:qb,isFile:Yb,isBlob:Xb,isRegExp:pA,isFunction:Qt,isStream:Wb,isURLSearchParams:Jb,isTypedArray:fA,isFileList:Qb,forEach:ja,merge:ed,extend:rA,trim:sA,stripBOM:aA,inherits:lA,toFlatObject:oA,kindOf:Qo,kindOfTest:Ei,endsWith:uA,toArray:cA,forEachEntry:dA,matchAll:hA,isHTMLForm:gA,hasOwnProperty:up,hasOwnProp:up,reduceDescriptors:lv,freezeMethods:yA,toObjectSet:vA,toCamelCase:mA,noop:EA,toFiniteNumber:SA,findKey:rv,global:ds,isContextDefined:av,isSpecCompliantForm:TA,toJSONObject:xA,isAsyncFn:bA,isThenable:AA,setImmediate:ov,asap:RA};function Le(a,e,t,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),s&&(this.response=s,this.status=s.status?s.status:null)}Z.inherits(Le,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.status}}});const uv=Le.prototype,cv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{cv[a]={value:a}});Object.defineProperties(Le,cv);Object.defineProperty(uv,"isAxiosError",{value:!0});Le.from=(a,e,t,i,s,l)=>{const o=Object.create(uv);return Z.toFlatObject(a,o,function(h){return h!==Error.prototype},c=>c!=="isAxiosError"),Le.call(o,a.message,e,t,i,s),o.cause=a,o.name=a.name,l&&Object.assign(o,l),o};const LA=null;function td(a){return Z.isPlainObject(a)||Z.isArray(a)}function fv(a){return Z.endsWith(a,"[]")?a.slice(0,-2):a}function cp(a,e,t){return a?a.concat(e).map(function(s,l){return s=fv(s),!t&&l?"["+s+"]":s}).join(t?".":""):e}function _A(a){return Z.isArray(a)&&!a.some(td)}const DA=Z.toFlatObject(Z,{},null,function(e){return/^is[A-Z]/.test(e)});function Jo(a,e,t){if(!Z.isObject(a))throw new TypeError("target must be an object");e=e||new FormData,t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,T){return!Z.isUndefined(T[x])});const i=t.metaTokens,s=t.visitor||g,l=t.dots,o=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(s))throw new TypeError("visitor must be a function");function f(E){if(E===null)return"";if(Z.isDate(E))return E.toISOString();if(!h&&Z.isBlob(E))throw new Le("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(E)||Z.isTypedArray(E)?h&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function g(E,x,T){let R=E;if(E&&!T&&typeof E=="object"){if(Z.endsWith(x,"{}"))x=i?x:x.slice(0,-2),E=JSON.stringify(E);else if(Z.isArray(E)&&_A(E)||(Z.isFileList(E)||Z.endsWith(x,"[]"))&&(R=Z.toArray(E)))return x=fv(x),R.forEach(function(A,O){!(Z.isUndefined(A)||A===null)&&e.append(o===!0?cp([x],O,l):o===null?x:x+"[]",f(A))}),!1}return td(E)?!0:(e.append(cp(T,x,l),f(E)),!1)}const m=[],y=Object.assign(DA,{defaultVisitor:g,convertValue:f,isVisitable:td});function S(E,x){if(!Z.isUndefined(E)){if(m.indexOf(E)!==-1)throw Error("Circular reference detected in "+x.join("."));m.push(E),Z.forEach(E,function(R,D){(!(Z.isUndefined(R)||R===null)&&s.call(e,R,Z.isString(D)?D.trim():D,x,y))===!0&&S(R,x?x.concat(D):[D])}),m.pop()}}if(!Z.isObject(a))throw new TypeError("data must be an object");return S(a),e}function fp(a){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function kd(a,e){this._pairs=[],a&&Jo(a,this,e)}const dv=kd.prototype;dv.append=function(e,t){this._pairs.push([e,t])};dv.toString=function(e){const t=e?function(i){return e.call(this,i,fp)}:fp;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function CA(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hv(a,e,t){if(!e)return a;const i=t&&t.encode||CA;Z.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let l;if(s?l=s(e,t):l=Z.isURLSearchParams(e)?e.toString():new kd(e,t).toString(i),l){const o=a.indexOf("#");o!==-1&&(a=a.slice(0,o)),a+=(a.indexOf("?")===-1?"?":"&")+l}return a}class dp{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(i){i!==null&&e(i)})}}const gv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},IA=typeof URLSearchParams<"u"?URLSearchParams:kd,wA=typeof FormData<"u"?FormData:null,OA=typeof Blob<"u"?Blob:null,kA={isBrowser:!0,classes:{URLSearchParams:IA,FormData:wA,Blob:OA},protocols:["http","https","file","blob","url","data"]},Md=typeof window<"u"&&typeof document<"u",id=typeof navigator=="object"&&navigator||void 0,MA=Md&&(!id||["ReactNative","NativeScript","NS"].indexOf(id.product)<0),PA=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",NA=Md&&window.location.href||"http://localhost",UA=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Md,hasStandardBrowserEnv:MA,hasStandardBrowserWebWorkerEnv:PA,navigator:id,origin:NA},Symbol.toStringTag,{value:"Module"})),It={...UA,...kA};function BA(a,e){return Jo(a,new It.classes.URLSearchParams,Object.assign({visitor:function(t,i,s,l){return It.isNode&&Z.isBuffer(t)?(this.append(i,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function FA(a){return Z.matchAll(/\w+|\[(\w*)]/g,a).map(e=>e[0]==="[]"?"":e[1]||e[0])}function $A(a){const e={},t=Object.keys(a);let i;const s=t.length;let l;for(i=0;i<s;i++)l=t[i],e[l]=a[l];return e}function mv(a){function e(t,i,s,l){let o=t[l++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),h=l>=t.length;return o=!o&&Z.isArray(s)?s.length:o,h?(Z.hasOwnProp(s,o)?s[o]=[s[o],i]:s[o]=i,!c):((!s[o]||!Z.isObject(s[o]))&&(s[o]=[]),e(t,i,s[o],l)&&Z.isArray(s[o])&&(s[o]=$A(s[o])),!c)}if(Z.isFormData(a)&&Z.isFunction(a.entries)){const t={};return Z.forEachEntry(a,(i,s)=>{e(FA(i),s,t,0)}),t}return null}function GA(a,e,t){if(Z.isString(a))try{return(e||JSON.parse)(a),Z.trim(a)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(a)}const Ha={transitional:gv,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",s=i.indexOf("application/json")>-1,l=Z.isObject(e);if(l&&Z.isHTMLForm(e)&&(e=new FormData(e)),Z.isFormData(e))return s?JSON.stringify(mv(e)):e;if(Z.isArrayBuffer(e)||Z.isBuffer(e)||Z.isStream(e)||Z.isFile(e)||Z.isBlob(e)||Z.isReadableStream(e))return e;if(Z.isArrayBufferView(e))return e.buffer;if(Z.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(l){if(i.indexOf("application/x-www-form-urlencoded")>-1)return BA(e,this.formSerializer).toString();if((c=Z.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Jo(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return l||s?(t.setContentType("application/json",!1),GA(e)):e}],transformResponse:[function(e){const t=this.transitional||Ha.transitional,i=t&&t.forcedJSONParsing,s=this.responseType==="json";if(Z.isResponse(e)||Z.isReadableStream(e))return e;if(e&&Z.isString(e)&&(i&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?Le.from(c,Le.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:It.classes.FormData,Blob:It.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Z.forEach(["delete","get","head","post","put","patch"],a=>{Ha.headers[a]={}});const jA=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HA=a=>{const e={};let t,i,s;return a&&a.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),i=o.substring(s+1).trim(),!(!t||e[t]&&jA[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},hp=Symbol("internals");function ba(a){return a&&String(a).trim().toLowerCase()}function Ro(a){return a===!1||a==null?a:Z.isArray(a)?a.map(Ro):String(a)}function VA(a){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(a);)e[i[1]]=i[2];return e}const KA=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function Af(a,e,t,i,s){if(Z.isFunction(i))return i.call(this,e,t);if(s&&(e=t),!!Z.isString(e)){if(Z.isString(i))return e.indexOf(i)!==-1;if(Z.isRegExp(i))return i.test(e)}}function zA(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function qA(a,e){const t=Z.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(a,i+t,{value:function(s,l,o){return this[i].call(this,e,s,l,o)},configurable:!0})})}let Gt=class{constructor(e){e&&this.set(e)}set(e,t,i){const s=this;function l(c,h,f){const g=ba(h);if(!g)throw new Error("header name must be a non-empty string");const m=Z.findKey(s,g);(!m||s[m]===void 0||f===!0||f===void 0&&s[m]!==!1)&&(s[m||h]=Ro(c))}const o=(c,h)=>Z.forEach(c,(f,g)=>l(f,g,h));if(Z.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Z.isString(e)&&(e=e.trim())&&!KA(e))o(HA(e),t);else if(Z.isHeaders(e))for(const[c,h]of e.entries())l(h,c,i);else e!=null&&l(t,e,i);return this}get(e,t){if(e=ba(e),e){const i=Z.findKey(this,e);if(i){const s=this[i];if(!t)return s;if(t===!0)return VA(s);if(Z.isFunction(t))return t.call(this,s,i);if(Z.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ba(e),e){const i=Z.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||Af(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let s=!1;function l(o){if(o=ba(o),o){const c=Z.findKey(i,o);c&&(!t||Af(i,i[c],c,t))&&(delete i[c],s=!0)}}return Z.isArray(e)?e.forEach(l):l(e),s}clear(e){const t=Object.keys(this);let i=t.length,s=!1;for(;i--;){const l=t[i];(!e||Af(this,this[l],l,e,!0))&&(delete this[l],s=!0)}return s}normalize(e){const t=this,i={};return Z.forEach(this,(s,l)=>{const o=Z.findKey(i,l);if(o){t[o]=Ro(s),delete t[l];return}const c=e?zA(l):String(l).trim();c!==l&&delete t[l],t[c]=Ro(s),i[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Z.forEach(this,(i,s)=>{i!=null&&i!==!1&&(t[s]=e&&Z.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(s=>i.set(s)),i}static accessor(e){const i=(this[hp]=this[hp]={accessors:{}}).accessors,s=this.prototype;function l(o){const c=ba(o);i[c]||(qA(s,o),i[c]=!0)}return Z.isArray(e)?e.forEach(l):l(e),this}};Gt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.reduceDescriptors(Gt.prototype,({value:a},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>a,set(i){this[t]=i}}});Z.freezeMethods(Gt);function Rf(a,e){const t=this||Ha,i=e||t,s=Gt.from(i.headers);let l=i.data;return Z.forEach(a,function(c){l=c.call(t,l,s.normalize(),e?e.status:void 0)}),s.normalize(),l}function pv(a){return!!(a&&a.__CANCEL__)}function Sr(a,e,t){Le.call(this,a??"canceled",Le.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(Sr,Le,{__CANCEL__:!0});function yv(a,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?a(t):e(new Le("Request failed with status code "+t.status,[Le.ERR_BAD_REQUEST,Le.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function YA(a){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return e&&e[1]||""}function XA(a,e){a=a||10;const t=new Array(a),i=new Array(a);let s=0,l=0,o;return e=e!==void 0?e:1e3,function(h){const f=Date.now(),g=i[l];o||(o=f),t[s]=h,i[s]=f;let m=l,y=0;for(;m!==s;)y+=t[m++],m=m%a;if(s=(s+1)%a,s===l&&(l=(l+1)%a),f-o<e)return;const S=g&&f-g;return S?Math.round(y*1e3/S):void 0}}function QA(a,e){let t=0,i=1e3/e,s,l;const o=(f,g=Date.now())=>{t=g,s=null,l&&(clearTimeout(l),l=null),a.apply(null,f)};return[(...f)=>{const g=Date.now(),m=g-t;m>=i?o(f,g):(s=f,l||(l=setTimeout(()=>{l=null,o(s)},i-m)))},()=>s&&o(s)]}const Po=(a,e,t=3)=>{let i=0;const s=XA(50,250);return QA(l=>{const o=l.loaded,c=l.lengthComputable?l.total:void 0,h=o-i,f=s(h),g=o<=c;i=o;const m={loaded:o,total:c,progress:c?o/c:void 0,bytes:h,rate:f||void 0,estimated:f&&c&&g?(c-o)/f:void 0,event:l,lengthComputable:c!=null,[e?"download":"upload"]:!0};a(m)},t)},gp=(a,e)=>{const t=a!=null;return[i=>e[0]({lengthComputable:t,total:a,loaded:i}),e[1]]},mp=a=>(...e)=>Z.asap(()=>a(...e)),WA=It.hasStandardBrowserEnv?((a,e)=>t=>(t=new URL(t,It.origin),a.protocol===t.protocol&&a.host===t.host&&(e||a.port===t.port)))(new URL(It.origin),It.navigator&&/(msie|trident)/i.test(It.navigator.userAgent)):()=>!0,ZA=It.hasStandardBrowserEnv?{write(a,e,t,i,s,l){const o=[a+"="+encodeURIComponent(e)];Z.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),Z.isString(i)&&o.push("path="+i),Z.isString(s)&&o.push("domain="+s),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read(a){const e=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function JA(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function eR(a,e){return e?a.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):a}function vv(a,e,t){let i=!JA(e);return a&&(i||t==!1)?eR(a,e):e}const pp=a=>a instanceof Gt?{...a}:a;function ms(a,e){e=e||{};const t={};function i(f,g,m,y){return Z.isPlainObject(f)&&Z.isPlainObject(g)?Z.merge.call({caseless:y},f,g):Z.isPlainObject(g)?Z.merge({},g):Z.isArray(g)?g.slice():g}function s(f,g,m,y){if(Z.isUndefined(g)){if(!Z.isUndefined(f))return i(void 0,f,m,y)}else return i(f,g,m,y)}function l(f,g){if(!Z.isUndefined(g))return i(void 0,g)}function o(f,g){if(Z.isUndefined(g)){if(!Z.isUndefined(f))return i(void 0,f)}else return i(void 0,g)}function c(f,g,m){if(m in e)return i(f,g);if(m in a)return i(void 0,f)}const h={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(f,g,m)=>s(pp(f),pp(g),m,!0)};return Z.forEach(Object.keys(Object.assign({},a,e)),function(g){const m=h[g]||s,y=m(a[g],e[g],g);Z.isUndefined(y)&&m!==c||(t[g]=y)}),t}const Ev=a=>{const e=ms({},a);let{data:t,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:l,headers:o,auth:c}=e;e.headers=o=Gt.from(o),e.url=hv(vv(e.baseURL,e.url,e.allowAbsoluteUrls),a.params,a.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):"")));let h;if(Z.isFormData(t)){if(It.hasStandardBrowserEnv||It.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((h=o.getContentType())!==!1){const[f,...g]=h?h.split(";").map(m=>m.trim()).filter(Boolean):[];o.setContentType([f||"multipart/form-data",...g].join("; "))}}if(It.hasStandardBrowserEnv&&(i&&Z.isFunction(i)&&(i=i(e)),i||i!==!1&&WA(e.url))){const f=s&&l&&ZA.read(l);f&&o.set(s,f)}return e},tR=typeof XMLHttpRequest<"u",iR=tR&&function(a){return new Promise(function(t,i){const s=Ev(a);let l=s.data;const o=Gt.from(s.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:f}=s,g,m,y,S,E;function x(){S&&S(),E&&E(),s.cancelToken&&s.cancelToken.unsubscribe(g),s.signal&&s.signal.removeEventListener("abort",g)}let T=new XMLHttpRequest;T.open(s.method.toUpperCase(),s.url,!0),T.timeout=s.timeout;function R(){if(!T)return;const A=Gt.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),I={data:!c||c==="text"||c==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:A,config:a,request:T};yv(function(M){t(M),x()},function(M){i(M),x()},I),T=null}"onloadend"in T?T.onloadend=R:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(R)},T.onabort=function(){T&&(i(new Le("Request aborted",Le.ECONNABORTED,a,T)),T=null)},T.onerror=function(){i(new Le("Network Error",Le.ERR_NETWORK,a,T)),T=null},T.ontimeout=function(){let O=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const I=s.transitional||gv;s.timeoutErrorMessage&&(O=s.timeoutErrorMessage),i(new Le(O,I.clarifyTimeoutError?Le.ETIMEDOUT:Le.ECONNABORTED,a,T)),T=null},l===void 0&&o.setContentType(null),"setRequestHeader"in T&&Z.forEach(o.toJSON(),function(O,I){T.setRequestHeader(I,O)}),Z.isUndefined(s.withCredentials)||(T.withCredentials=!!s.withCredentials),c&&c!=="json"&&(T.responseType=s.responseType),f&&([y,E]=Po(f,!0),T.addEventListener("progress",y)),h&&T.upload&&([m,S]=Po(h),T.upload.addEventListener("progress",m),T.upload.addEventListener("loadend",S)),(s.cancelToken||s.signal)&&(g=A=>{T&&(i(!A||A.type?new Sr(null,a,T):A),T.abort(),T=null)},s.cancelToken&&s.cancelToken.subscribe(g),s.signal&&(s.signal.aborted?g():s.signal.addEventListener("abort",g)));const D=YA(s.url);if(D&&It.protocols.indexOf(D)===-1){i(new Le("Unsupported protocol "+D+":",Le.ERR_BAD_REQUEST,a));return}T.send(l||null)})},nR=(a,e)=>{const{length:t}=a=a?a.filter(Boolean):[];if(e||t){let i=new AbortController,s;const l=function(f){if(!s){s=!0,c();const g=f instanceof Error?f:this.reason;i.abort(g instanceof Le?g:new Sr(g instanceof Error?g.message:g))}};let o=e&&setTimeout(()=>{o=null,l(new Le(`timeout ${e} of ms exceeded`,Le.ETIMEDOUT))},e);const c=()=>{a&&(o&&clearTimeout(o),o=null,a.forEach(f=>{f.unsubscribe?f.unsubscribe(l):f.removeEventListener("abort",l)}),a=null)};a.forEach(f=>f.addEventListener("abort",l));const{signal:h}=i;return h.unsubscribe=()=>Z.asap(c),h}},sR=function*(a,e){let t=a.byteLength;if(t<e){yield a;return}let i=0,s;for(;i<t;)s=i+e,yield a.slice(i,s),i=s},rR=async function*(a,e){for await(const t of aR(a))yield*sR(t,e)},aR=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const e=a.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},yp=(a,e,t,i)=>{const s=rR(a,e);let l=0,o,c=h=>{o||(o=!0,i&&i(h))};return new ReadableStream({async pull(h){try{const{done:f,value:g}=await s.next();if(f){c(),h.close();return}let m=g.byteLength;if(t){let y=l+=m;t(y)}h.enqueue(new Uint8Array(g))}catch(f){throw c(f),f}},cancel(h){return c(h),s.return()}},{highWaterMark:2})},eu=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Sv=eu&&typeof ReadableStream=="function",lR=eu&&(typeof TextEncoder=="function"?(a=>e=>a.encode(e))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),Tv=(a,...e)=>{try{return!!a(...e)}catch{return!1}},oR=Sv&&Tv(()=>{let a=!1;const e=new Request(It.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!e}),vp=64*1024,nd=Sv&&Tv(()=>Z.isReadableStream(new Response("").body)),No={stream:nd&&(a=>a.body)};eu&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!No[e]&&(No[e]=Z.isFunction(a[e])?t=>t[e]():(t,i)=>{throw new Le(`Response type '${e}' is not supported`,Le.ERR_NOT_SUPPORT,i)})})})(new Response);const uR=async a=>{if(a==null)return 0;if(Z.isBlob(a))return a.size;if(Z.isSpecCompliantForm(a))return(await new Request(It.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(Z.isArrayBufferView(a)||Z.isArrayBuffer(a))return a.byteLength;if(Z.isURLSearchParams(a)&&(a=a+""),Z.isString(a))return(await lR(a)).byteLength},cR=async(a,e)=>{const t=Z.toFiniteNumber(a.getContentLength());return t??uR(e)},fR=eu&&(async a=>{let{url:e,method:t,data:i,signal:s,cancelToken:l,timeout:o,onDownloadProgress:c,onUploadProgress:h,responseType:f,headers:g,withCredentials:m="same-origin",fetchOptions:y}=Ev(a);f=f?(f+"").toLowerCase():"text";let S=nR([s,l&&l.toAbortSignal()],o),E;const x=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let T;try{if(h&&oR&&t!=="get"&&t!=="head"&&(T=await cR(g,i))!==0){let I=new Request(e,{method:"POST",body:i,duplex:"half"}),N;if(Z.isFormData(i)&&(N=I.headers.get("content-type"))&&g.setContentType(N),I.body){const[M,F]=gp(T,Po(mp(h)));i=yp(I.body,vp,M,F)}}Z.isString(m)||(m=m?"include":"omit");const R="credentials"in Request.prototype;E=new Request(e,{...y,signal:S,method:t.toUpperCase(),headers:g.normalize().toJSON(),body:i,duplex:"half",credentials:R?m:void 0});let D=await fetch(E);const A=nd&&(f==="stream"||f==="response");if(nd&&(c||A&&x)){const I={};["status","statusText","headers"].forEach(H=>{I[H]=D[H]});const N=Z.toFiniteNumber(D.headers.get("content-length")),[M,F]=c&&gp(N,Po(mp(c),!0))||[];D=new Response(yp(D.body,vp,M,()=>{F&&F(),x&&x()}),I)}f=f||"text";let O=await No[Z.findKey(No,f)||"text"](D,a);return!A&&x&&x(),await new Promise((I,N)=>{yv(I,N,{data:O,headers:Gt.from(D.headers),status:D.status,statusText:D.statusText,config:a,request:E})})}catch(R){throw x&&x(),R&&R.name==="TypeError"&&/fetch/i.test(R.message)?Object.assign(new Le("Network Error",Le.ERR_NETWORK,a,E),{cause:R.cause||R}):Le.from(R,R&&R.code,a,E)}}),sd={http:LA,xhr:iR,fetch:fR};Z.forEach(sd,(a,e)=>{if(a){try{Object.defineProperty(a,"name",{value:e})}catch{}Object.defineProperty(a,"adapterName",{value:e})}});const Ep=a=>`- ${a}`,dR=a=>Z.isFunction(a)||a===null||a===!1,xv={getAdapter:a=>{a=Z.isArray(a)?a:[a];const{length:e}=a;let t,i;const s={};for(let l=0;l<e;l++){t=a[l];let o;if(i=t,!dR(t)&&(i=sd[(o=String(t)).toLowerCase()],i===void 0))throw new Le(`Unknown adapter '${o}'`);if(i)break;s[o||"#"+l]=i}if(!i){const l=Object.entries(s).map(([c,h])=>`adapter ${c} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?l.length>1?`since :
`+l.map(Ep).join(`
`):" "+Ep(l[0]):"as no adapter specified";throw new Le("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:sd};function Lf(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new Sr(null,a)}function Sp(a){return Lf(a),a.headers=Gt.from(a.headers),a.data=Rf.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),xv.getAdapter(a.adapter||Ha.adapter)(a).then(function(i){return Lf(a),i.data=Rf.call(a,a.transformResponse,i),i.headers=Gt.from(i.headers),i},function(i){return pv(i)||(Lf(a),i&&i.response&&(i.response.data=Rf.call(a,a.transformResponse,i.response),i.response.headers=Gt.from(i.response.headers))),Promise.reject(i)})}const bv="1.8.4",tu={};["object","boolean","number","function","string","symbol"].forEach((a,e)=>{tu[a]=function(i){return typeof i===a||"a"+(e<1?"n ":" ")+a}});const Tp={};tu.transitional=function(e,t,i){function s(l,o){return"[Axios v"+bv+"] Transitional option '"+l+"'"+o+(i?". "+i:"")}return(l,o,c)=>{if(e===!1)throw new Le(s(o," has been removed"+(t?" in "+t:"")),Le.ERR_DEPRECATED);return t&&!Tp[o]&&(Tp[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,o,c):!0}};tu.spelling=function(e){return(t,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function hR(a,e,t){if(typeof a!="object")throw new Le("options must be an object",Le.ERR_BAD_OPTION_VALUE);const i=Object.keys(a);let s=i.length;for(;s-- >0;){const l=i[s],o=e[l];if(o){const c=a[l],h=c===void 0||o(c,l,a);if(h!==!0)throw new Le("option "+l+" must be "+h,Le.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Le("Unknown option "+l,Le.ERR_BAD_OPTION)}}const Lo={assertOptions:hR,validators:tu},_i=Lo.validators;let hs=class{constructor(e){this.defaults=e,this.interceptors={request:new dp,response:new dp}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const l=s.stack?s.stack.replace(/^.+\n/,""):"";try{i.stack?l&&!String(i.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+l):i.stack=l}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=ms(this.defaults,t);const{transitional:i,paramsSerializer:s,headers:l}=t;i!==void 0&&Lo.assertOptions(i,{silentJSONParsing:_i.transitional(_i.boolean),forcedJSONParsing:_i.transitional(_i.boolean),clarifyTimeoutError:_i.transitional(_i.boolean)},!1),s!=null&&(Z.isFunction(s)?t.paramsSerializer={serialize:s}:Lo.assertOptions(s,{encode:_i.function,serialize:_i.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Lo.assertOptions(t,{baseUrl:_i.spelling("baseURL"),withXsrfToken:_i.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=l&&Z.merge(l.common,l[t.method]);l&&Z.forEach(["delete","get","head","post","put","patch","common"],E=>{delete l[E]}),t.headers=Gt.concat(o,l);const c=[];let h=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(t)===!1||(h=h&&x.synchronous,c.unshift(x.fulfilled,x.rejected))});const f=[];this.interceptors.response.forEach(function(x){f.push(x.fulfilled,x.rejected)});let g,m=0,y;if(!h){const E=[Sp.bind(this),void 0];for(E.unshift.apply(E,c),E.push.apply(E,f),y=E.length,g=Promise.resolve(t);m<y;)g=g.then(E[m++],E[m++]);return g}y=c.length;let S=t;for(m=0;m<y;){const E=c[m++],x=c[m++];try{S=E(S)}catch(T){x.call(this,T);break}}try{g=Sp.call(this,S)}catch(E){return Promise.reject(E)}for(m=0,y=f.length;m<y;)g=g.then(f[m++],f[m++]);return g}getUri(e){e=ms(this.defaults,e);const t=vv(e.baseURL,e.url,e.allowAbsoluteUrls);return hv(t,e.params,e.paramsSerializer)}};Z.forEach(["delete","get","head","options"],function(e){hs.prototype[e]=function(t,i){return this.request(ms(i||{},{method:e,url:t,data:(i||{}).data}))}});Z.forEach(["post","put","patch"],function(e){function t(i){return function(l,o,c){return this.request(ms(c||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}hs.prototype[e]=t(),hs.prototype[e+"Form"]=t(!0)});let gR=class Av{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const i=this;this.promise.then(s=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](s);i._listeners=null}),this.promise.then=s=>{let l;const o=new Promise(c=>{i.subscribe(c),l=c}).then(s);return o.cancel=function(){i.unsubscribe(l)},o},e(function(l,o,c){i.reason||(i.reason=new Sr(l,o,c),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Av(function(s){e=s}),cancel:e}}};function mR(a){return function(t){return a.apply(null,t)}}function pR(a){return Z.isObject(a)&&a.isAxiosError===!0}const rd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(rd).forEach(([a,e])=>{rd[e]=a});function Rv(a){const e=new hs(a),t=iv(hs.prototype.request,e);return Z.extend(t,hs.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(s){return Rv(ms(a,s))},t}const Fe=Rv(Ha);Fe.Axios=hs;Fe.CanceledError=Sr;Fe.CancelToken=gR;Fe.isCancel=pv;Fe.VERSION=bv;Fe.toFormData=Jo;Fe.AxiosError=Le;Fe.Cancel=Fe.CanceledError;Fe.all=function(e){return Promise.all(e)};Fe.spread=mR;Fe.isAxiosError=pR;Fe.mergeConfig=ms;Fe.AxiosHeaders=Gt;Fe.formToJSON=a=>mv(Z.isHTMLForm(a)?new FormData(a):a);Fe.getAdapter=xv.getAdapter;Fe.HttpStatusCode=rd;Fe.default=Fe;const{Axios:PC,AxiosError:NC,CanceledError:UC,isCancel:BC,CancelToken:FC,VERSION:$C,all:GC,Cancel:jC,isAxiosError:HC,spread:VC,toFormData:KC,AxiosHeaders:zC,HttpStatusCode:qC,formToJSON:YC,getAdapter:XC,mergeConfig:QC}=Fe,yR=()=>{const[a,e]=$.useState([]),[t,i]=$.useState({}),[s,l]=$.useState({}),[o,c]=$.useState({}),[h,f]=$.useState(!1);async function g(){const m=await Fe.get("https://api.themoviedb.org/3/movie/now_playing?language=en-US&page=1&api_key=036f8385b9a88d59ba689f2a060877f7");e(m.data.results),i(a[Math.floor(Math.random()*a.length)]),l(a[Math.floor(Math.random()*a.length)]),c(a[Math.floor(Math.random()*a.length)]),f(!0)}return $.useEffect(()=>{g()},[h]),_.jsxs("div",{className:"feature",children:[_.jsx("h2",{children:"Now Playing"}),_.jsxs("div",{className:"movies",children:[_.jsx("img",{src:`https://image.tmdb.org/t/p/w500${t==null?void 0:t.poster_path}`,alt:"random movie 1"}),_.jsx("img",{src:`https://image.tmdb.org/t/p/w500${s==null?void 0:s.poster_path}`,alt:"random movie 2"}),_.jsx("img",{src:`https://image.tmdb.org/t/p/w500${o==null?void 0:o.poster_path}`,alt:"random movie 3"})]})]})},cn=()=>_.jsxs("div",{className:"footer",children:[_.jsx("p",{children:"Questions? Call +1 (123) 456-7890"}),_.jsx("p",{children:"(Use ublock origin or any adblocker to block player ads I can't control them)"}),_.jsxs("div",{className:"footer-links",children:[_.jsx("a",{href:"",children:"Contact Us"}),_.jsx("a",{href:"",children:"Terms and Conditions"}),_.jsx("a",{href:"",children:"Privacy Policy"}),_.jsx("a",{href:"",children:"Support"})]}),_.jsx("p",{children:" 2025 Dollor"})]}),vR=()=>_.jsxs(_.Fragment,{children:[_.jsx(un,{}),_.jsx(Gb,{}),_.jsx(yR,{}),_.jsx(cn,{})]}),ER=()=>{const[a,e]=$.useState(""),[t,i]=$.useState(""),s=vs(),l=o=>{o.preventDefault();const h=JSON.parse(localStorage.getItem("users")||"{}")[a];h&&h.password===t?(localStorage.setItem("currentUser",a),s("/movies")):alert("Invalid email or password!")};return _.jsxs("div",{children:[_.jsx(un,{}),_.jsx("div",{className:"form-container",children:_.jsxs("form",{onSubmit:o=>l(o),children:[_.jsx("label",{htmlFor:"email",children:"Email:"}),_.jsx("input",{type:"email",name:"email",required:!0,value:a,onChange:o=>e(o.target.value)}),_.jsx("label",{htmlFor:"password",children:"Password:"}),_.jsx("input",{type:"password",name:"password",required:!0,value:t,onChange:o=>i(o.target.value)}),_.jsx("input",{type:"submit",value:"Log In",required:!0})]})}),_.jsx(cn,{})]})},SR=()=>{const[a,e]=$.useState(""),[t,i]=$.useState(""),[s,l]=$.useState(""),[o,c]=$.useState(""),[h,f]=$.useState(""),g=vs(),m=y=>{if(y.preventDefault(),o!==h){alert("Passwords don't match!");return}const S=JSON.parse(localStorage.getItem("users")||"{}");if(S[s]){alert("That email is already registered!");return}S[s]={firstName:a,lastName:t,password:o},localStorage.setItem("users",JSON.stringify(S)),alert("Registration successful! Please log in."),g("/login")};return _.jsxs("div",{children:[_.jsx(un,{}),_.jsx("div",{className:"form-container",children:_.jsxs("form",{onSubmit:y=>m(y),children:[_.jsx("label",{children:"First Name:"}),_.jsx("input",{type:"text",required:!0,value:a,onChange:y=>e(y.target.value)}),_.jsx("label",{children:"Last Name:"}),_.jsx("input",{type:"text",required:!0,value:t,onChange:y=>i(y.target.value)}),_.jsx("label",{children:"Email:"}),_.jsx("input",{type:"email",required:!0,value:s,onChange:y=>l(y.target.value)}),_.jsx("label",{children:"Password:"}),_.jsx("input",{type:"password",value:o,onChange:y=>c(y.target.value),required:!0}),_.jsx("label",{children:"Re-enter Password:"}),_.jsx("input",{type:"password",value:h,onChange:y=>f(y.target.value),required:!0}),_.jsx("input",{type:"submit",value:"Sign Up",required:!0})]})}),_.jsx(cn,{})]})},TR=a=>{const e=vs(),t=()=>{localStorage.removeItem("currentUser"),e("/login")};return _.jsxs("div",{className:"genres",children:[a.genresList.map(i=>_.jsx("a",{href:`/movies/genre/${i.id}`,children:i.genre},i.id)),_.jsx("button",{onClick:t,children:"Log Out"})]})},xR=()=>{const a=[{genre:"Action",id:28},{genre:"Family",id:10751},{genre:"Science Fiction",id:878},{genre:"Adventure",id:12},{genre:"Fantasy",id:14},{genre:"War",id:10752},{genre:"Animation",id:16},{genre:"History",id:36},{genre:"Thriller",id:53},{genre:"Comedy",id:35}];return _.jsxs("div",{children:[_.jsx(un,{}),_.jsxs("div",{className:"movies-view",children:[_.jsx(TR,{genresList:a}),_.jsx(Dd,{})]}),_.jsx(cn,{})]})},bR=[{id:8,name:"Netflix",color:"#e50914"},{id:337,name:"Disney+",color:"#113ccf"},{id:9,name:"Amazon Prime",color:"#00a8e1"},{id:387,name:"HBO Max",color:"#6e00f5"},{id:15,name:"Hulu",color:"#1ce783"},{id:350,name:"Apple TV+",color:"#999999"},{id:386,name:"Peacock",color:"#1f5fe4"},{id:531,name:"Paramount+",color:"#004b91"},{id:2552,name:"Starz",color:"#ec691f"}],AR=()=>{const[a,e]=$.useState([]),[t,i]=$.useState(0),[s,l]=$.useState(1),[o,c]=$.useState(!1),[h,f]=$.useState(null),[g,m]=$.useState("US"),[y,S]=$.useState([]),{genre_id:E}=vr(),x=async()=>{try{const A=await Fe.get("https://api.themoviedb.org/3/configuration/countries?api_key=036f8385b9a88d59ba689f2a060877f7");S(A.data)}catch(A){console.error("Error fetching countries:",A)}},T=async()=>{let A=`https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=en-US&page=${s}&sort_by=popularity.desc&with_genres=${E}&api_key=036f8385b9a88d59ba689f2a060877f7`;h&&(A+=`&with_watch_providers=${h}&watch_region=${g}`);try{const O=await Fe.get(A);e(O.data.results),i(O.data.total_pages>500?500:O.data.total_pages),c(!0)}catch(O){console.error("Error fetching movies:",O),e([]),i(0),c(!0)}},R=A=>{const O=s+A;O>=1&&O<=t&&(l(O),c(!1))},D=A=>{const O=Math.max(1,Math.min(A,t));l(O),c(!1)};return $.useEffect(()=>{x()},[]),$.useEffect(()=>{T()},[o,s,h,E,g]),_.jsxs("div",{className:"genre-view",children:[_.jsxs("div",{className:"country-dropdown",style:{marginBottom:"10px"},children:[_.jsx("label",{htmlFor:"country",children:"Choose a country: "}),_.jsx("select",{id:"country",value:g,onChange:A=>{m(A.target.value),l(1),c(!1)},children:y.map(A=>_.jsx("option",{value:A.iso_3166_1,children:A.english_name},A.iso_3166_1))})]}),_.jsxs("div",{className:"provider-buttons",children:[bR.map(A=>_.jsx("button",{onClick:()=>{f(A.id),l(1),c(!1)},style:{backgroundColor:h===A.id?A.color:"#eee",color:h===A.id?"white":"black",border:"none",margin:"5px",padding:"8px 12px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"0.3s ease"},children:A.name},A.id)),h&&_.jsx("button",{onClick:()=>{f(null),l(1),c(!1)},style:{backgroundColor:"#888",color:"white",border:"none",margin:"5px",padding:"8px 12px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"0.3s ease"},children:"Clear Filter"})]}),_.jsx("div",{className:"movie-grid",children:a.length>0?a.map(A=>_.jsx("a",{href:`/movies/details/${A.id}`,children:_.jsx("img",{src:`https://image.tmdb.org/t/p/w500${A.poster_path}`,alt:A.title})},A.id)):_.jsx("p",{style:{textAlign:"center",width:"100%"},children:"No movies found for this filter."})}),_.jsxs("div",{className:"pagination",children:[_.jsx("button",{onClick:()=>D(1),disabled:s===1,children:"1"}),_.jsx("button",{onClick:()=>R(-1),disabled:s===1,children:"<"}),_.jsx("span",{children:s}),_.jsx("button",{onClick:()=>R(1),disabled:s===t,children:">"}),_.jsx("button",{onClick:()=>D(t),disabled:s===t,children:t})]})]})},RR=()=>{var T,R,D;const[a,e]=$.useState({}),[t,i]=$.useState([]),[s,l]=$.useState([]),[o,c]=$.useState({}),[h,f]=$.useState("vidsrc.to"),[g,m]=$.useState("US"),y=vr(),S=[{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"IN",name:"India"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"IT",name:"Italy"},{code:"ES",name:"Spain"},{code:"BR",name:"Brazil"},{code:"MX",name:"Mexico"},{code:"JP",name:"Japan"},{code:"KR",name:"South Korea"},{code:"CN",name:"China"},{code:"RU",name:"Russia"},{code:"ZA",name:"South Africa"},{code:"SE",name:"Sweden"},{code:"FI",name:"Finland"},{code:"NO",name:"Norway"},{code:"DK",name:"Denmark"},{code:"PL",name:"Poland"},{code:"BE",name:"Belgium"},{code:"NL",name:"Netherlands"},{code:"AR",name:"Argentina"},{code:"CH",name:"Switzerland"},{code:"AT",name:"Austria"},{code:"PT",name:"Portugal"},{code:"GR",name:"Greece"},{code:"HU",name:"Hungary"},{code:"CZ",name:"Czech Republic"},{code:"UA",name:"Ukraine"},{code:"EE",name:"Estonia"},{code:"LV",name:"Latvia"},{code:"LT",name:"Lithuania"},{code:"RO",name:"Romania"},{code:"BG",name:"Bulgaria"}],E=async()=>{var A;try{const O=await Fe.get(`https://api.themoviedb.org/3/movie/${y.id}?language=en-US&api_key=036f8385b9a88d59ba689f2a060877f7`),I=await Fe.get(`https://api.themoviedb.org/3/movie/${y.id}/videos?language=en-US&api_key=036f8385b9a88d59ba689f2a060877f7`),N=await Fe.get(`https://api.themoviedb.org/3/movie/${y.id}/watch/providers?api_key=036f8385b9a88d59ba689f2a060877f7`);e(O.data),i(I.data.results),c(((A=N.data.results)==null?void 0:A[g])||{})}catch(O){console.error("Error fetching movie data:",O)}};$.useEffect(()=>{E()},[y.id,g]),$.useEffect(()=>{const A=t.filter(O=>O.type==="Trailer");l(A)},[t]);const x=A=>{m(A.target.value)};return _.jsxs("div",{className:"detail-view",children:[_.jsx("h2",{children:a.title}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"country-select",children:"Select Country:"}),_.jsx("select",{id:"country-select",value:g,onChange:x,children:S.map(A=>_.jsx("option",{value:A.code,children:A.name},A.code))})]}),_.jsxs("div",{children:[(((T=o.flatrate)==null?void 0:T.length)>0||((R=o.buy)==null?void 0:R.length)>0)&&_.jsx("h3",{children:"Stream"}),o.flatrate&&o.flatrate.length>0&&_.jsx("div",{style:{textAlign:"center",marginBottom:"1rem"},children:_.jsx("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:o.flatrate.map(A=>_.jsx("a",{href:`https://www.themoviedb.org/movie/${y.id}/watch`,target:"_blank",rel:"noopener noreferrer",title:A.provider_name,style:{display:"inline-block",padding:0},children:_.jsx("img",{src:`https://image.tmdb.org/t/p/original${A.logo_path}`,alt:A.provider_name,style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer"}})},A.provider_id))})}),o.buy&&o.buy.length>0&&_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx("h4",{children:"Buy Digitally:"}),_.jsx("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:o.buy.map(A=>_.jsx("a",{href:`https://www.themoviedb.org/movie/${y.id}/watch`,target:"_blank",rel:"noopener noreferrer",title:A.provider_name,style:{display:"inline-block",padding:0},children:_.jsx("img",{src:`https://image.tmdb.org/t/p/original${A.logo_path}`,alt:A.provider_name,style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer"}})},A.provider_id))})]}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("h4",{children:"Buy Physically:"}),_.jsxs("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap"},children:[_.jsx("a",{href:`https://www.amazon.com/s?k=${encodeURIComponent(a.title+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Amazon (DVD/Blu-ray)",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://image.tmdb.org/t/p/original/seGSXajazLMCKGB5hnRCidtjay1.jpg",alt:"Amazon DVD/Blu-ray",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.walmart.com/search/?query=${encodeURIComponent(a.title+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Walmart",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSz1Y86WWaVlA-qPIKjhDrxpIf_gPnP4Btw1A&s",alt:"Walmart",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.bestbuy.com/site/searchpage.jsp?st=${encodeURIComponent(a.title+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Best Buy",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://partners.bestbuy.com/image/image_gallery?uuid=7e4efc4e-432f-f497-fe99-ec311c640241&groupId=20126",alt:"Best Buy",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.blu-ray.com/search/?quicksearch=1&quicksearch_country=US&quicksearch_keyword=${encodeURIComponent(a.title)}&section=bluraymovies`,target:"_blank",rel:"noopener noreferrer",title:"Blu-ray.com",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/81/81046.png",alt:"Blu-ray.com",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})})]})]})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Original Title:"}),_.jsx("p",{children:a.original_title})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Spoken Languages:"}),(D=a.spoken_languages)==null?void 0:D.map(A=>_.jsx("p",{children:A.name},A.name))]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Release Date:"}),_.jsx("p",{children:a.release_date})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Popularity:"}),_.jsx("p",{children:a.popularity})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Vote Average:"}),_.jsx("p",{children:a.vote_average})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Vote Count:"}),_.jsx("p",{children:a.vote_count})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Overview:"}),_.jsx("p",{children:a.overview})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Trailers:"}),s.map(A=>_.jsx("iframe",{width:"640",height:"360",src:`https://youtube.com/embed/${A.key}`,title:A.name,allowFullScreen:!0,frameBorder:"0"},A.id))]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Watch Movie:"}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("strong",{children:"Server:"})," ",_.jsx("button",{onClick:()=>f("vidsrc.to"),disabled:h==="vidsrc.to",children:"VidSrc.to"}),_.jsx("button",{onClick:()=>f("vidsrc.cc"),disabled:h==="vidsrc.cc",children:"VidSrc.cc"})]}),_.jsx("iframe",{src:h==="vidsrc.to"?`https://vidsrc.to/embed/movie/${y.id}`:`https://vidsrc.cc/v2/embed/movie/${y.id}`,width:"100%",height:"500",allowFullScreen:!0,frameBorder:"0",title:"Movie Stream Player"})]})]})},LR=a=>{const e=vs(),t=()=>{localStorage.removeItem("currentUser"),e("/login")};return _.jsxs("div",{className:"genres",children:[a.genresList.map(i=>_.jsx("a",{href:`/tv/genre/${i.id}`,children:i.genre},i.id)),_.jsx("button",{onClick:t,children:"Log Out"})]})},_R=[{genre:"Action & Adventure",id:10759},{genre:"Animation",id:16},{genre:"Comedy",id:35},{genre:"Crime",id:80},{genre:"Documentary",id:99},{genre:"Drama",id:18},{genre:"Family",id:10751},{genre:"Kids",id:10762},{genre:"Mystery",id:9648},{genre:"News",id:10763},{genre:"Reality",id:10764},{genre:"Sci-Fi & Fantasy",id:10765},{genre:"Soap",id:10766},{genre:"Talk",id:10767},{genre:"War & Politics",id:10768},{genre:"Western",id:37}];function DR(){return _.jsxs(_.Fragment,{children:[_.jsx(un,{}),_.jsxs("div",{className:"movies-view",children:[_.jsx(LR,{genresList:_R}),_.jsx(Dd,{})]}),_.jsx(cn,{})]})}const CR=()=>{var R,D,A;const[a,e]=$.useState({}),[t,i]=$.useState([]),[s,l]=$.useState([]),[o,c]=$.useState({}),[h,f]=$.useState("vidsrc.to"),[g,m]=$.useState("US"),y=vr(),S=[{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"IN",name:"India"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"IT",name:"Italy"},{code:"ES",name:"Spain"},{code:"BR",name:"Brazil"},{code:"MX",name:"Mexico"},{code:"JP",name:"Japan"},{code:"KR",name:"South Korea"},{code:"CN",name:"China"},{code:"RU",name:"Russia"},{code:"ZA",name:"South Africa"},{code:"SE",name:"Sweden"},{code:"FI",name:"Finland"},{code:"NO",name:"Norway"},{code:"DK",name:"Denmark"},{code:"PL",name:"Poland"},{code:"BE",name:"Belgium"},{code:"NL",name:"Netherlands"},{code:"AR",name:"Argentina"},{code:"CH",name:"Switzerland"},{code:"AT",name:"Austria"},{code:"PT",name:"Portugal"},{code:"GR",name:"Greece"},{code:"HU",name:"Hungary"},{code:"CZ",name:"Czech Republic"},{code:"UA",name:"Ukraine"},{code:"EE",name:"Estonia"},{code:"LV",name:"Latvia"},{code:"LT",name:"Lithuania"},{code:"RO",name:"Romania"},{code:"BG",name:"Bulgaria"}],E=async()=>{var O;try{const I=await Fe.get(`https://api.themoviedb.org/3/tv/${y.id}?language=en-US&api_key=036f8385b9a88d59ba689f2a060877f7`),N=await Fe.get(`https://api.themoviedb.org/3/tv/${y.id}/videos?language=en-US&api_key=036f8385b9a88d59ba689f2a060877f7`),M=await Fe.get(`https://api.themoviedb.org/3/tv/${y.id}/watch/providers?api_key=036f8385b9a88d59ba689f2a060877f7`);e(I.data),i(N.data.results),c(((O=M.data.results)==null?void 0:O[g])||{})}catch(I){console.error("Failed to fetch TV data:",I)}};$.useEffect(()=>{E()},[y.id,g]),$.useEffect(()=>{const O=t.filter(I=>I.type==="Trailer");l(O)},[t]);const x=()=>h==="vidsrc.to"?`https://vidsrc.to/embed/tv/${y.id}`:h==="vidsrc.cc"?`https://vidsrc.cc/v2/embed/tv/${y.id}`:"",T=O=>{m(O.target.value)};return _.jsxs("div",{className:"tv-detail",children:[_.jsx("h2",{children:a.name}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"country-select",children:"Select Country:"}),_.jsx("select",{id:"country-select",value:g,onChange:T,children:S.map(O=>_.jsx("option",{value:O.code,children:O.name},O.code))})]}),_.jsxs("div",{children:[(((R=o.flatrate)==null?void 0:R.length)>0||((D=o.buy)==null?void 0:D.length)>0)&&_.jsx("h3",{children:"Stream"}),o.flatrate&&o.flatrate.length>0&&_.jsx("div",{style:{textAlign:"center",marginBottom:"1rem"},children:_.jsx("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:o.flatrate.map(O=>_.jsx("a",{href:`https://www.themoviedb.org/tv/${y.id}/watch`,target:"_blank",rel:"noopener noreferrer",title:O.provider_name,style:{display:"inline-block",padding:0},children:_.jsx("img",{src:`https://image.tmdb.org/t/p/original${O.logo_path}`,alt:O.provider_name,style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer"}})},O.provider_id))})}),o.buy&&o.buy.length>0&&_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx("h4",{children:"Buy Digitally:"}),_.jsx("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:o.buy.map(O=>_.jsx("a",{href:`https://www.themoviedb.org/tv/${y.id}/watch`,target:"_blank",rel:"noopener noreferrer",title:O.provider_name,style:{display:"inline-block",padding:0},children:_.jsx("img",{src:`https://image.tmdb.org/t/p/original${O.logo_path}`,alt:O.provider_name,style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer"}})},O.provider_id))})]}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("h4",{children:"Buy Physically:"}),_.jsxs("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap"},children:[_.jsx("a",{href:`https://www.amazon.com/s?k=${encodeURIComponent(a.name+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Amazon (DVD/Blu-ray)",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://image.tmdb.org/t/p/original/seGSXajazLMCKGB5hnRCidtjay1.jpg",alt:"Amazon DVD/Blu-ray",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.walmart.com/search/?query=${encodeURIComponent(a.name+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Walmart",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSz1Y86WWaVlA-qPIKjhDrxpIf_gPnP4Btw1A&s",alt:"Walmart",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.bestbuy.com/site/searchpage.jsp?st=${encodeURIComponent(a.name+" DVD")}`,target:"_blank",rel:"noopener noreferrer",title:"Best Buy",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://partners.bestbuy.com/image/image_gallery?uuid=7e4efc4e-432f-f497-fe99-ec311c640241&groupId=20126",alt:"Best Buy",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.blu-ray.com/search/?quicksearch=1&quicksearch_country=US&quicksearch_keyword=${encodeURIComponent(a.name)}&section=bluraymovies`,target:"_blank",rel:"noopener noreferrer",title:"Blu-ray.com",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/81/81046.png",alt:"Blu-ray.com",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})})]})]})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Original Name:"}),_.jsx("p",{children:a.original_name})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Languages:"}),(A=a.languages)==null?void 0:A.map(O=>_.jsx("p",{children:O},O))]}),_.jsxs("div",{children:[_.jsx("h3",{children:"First Air Date:"}),_.jsx("p",{children:a.first_air_date})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Popularity:"}),_.jsx("p",{children:a.popularity})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Vote Average:"}),_.jsx("p",{children:a.vote_average})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Vote Count:"}),_.jsx("p",{children:a.vote_count})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Overview:"}),_.jsx("p",{children:a.overview})]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Trailers:"}),s.map(O=>_.jsx("iframe",{width:"640",height:"360",src:`https://youtube.com/embed/${O.key}`,title:O.name,allowFullScreen:!0,frameBorder:"0"},O.id))]}),_.jsxs("div",{children:[_.jsx("h3",{children:"Watch Show:"}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("strong",{children:"Server:"})," ",_.jsx("button",{onClick:()=>f("vidsrc.to"),disabled:h==="vidsrc.to",children:"VidSrc.to"}),_.jsx("button",{onClick:()=>f("vidsrc.cc"),disabled:h==="vidsrc.cc",children:"VidSrc.cc"})]}),_.jsx("iframe",{src:x(),width:"100%",height:"500",allowFullScreen:!0,frameBorder:"0",title:"TV Stream Player"})]})]})},IR=[{id:8,name:"Netflix",color:"#e50914"},{id:337,name:"Disney+",color:"#113ccf"},{id:9,name:"Amazon Prime",color:"#00a8e1"},{id:387,name:"HBO Max",color:"#6e00f5"},{id:15,name:"Hulu",color:"#1ce783"},{id:350,name:"Apple TV+",color:"#999999"},{id:386,name:"Peacock",color:"#1f5fe4"},{id:531,name:"Paramount+",color:"#004b91"},{id:2552,name:"Starz",color:"#ec691f"}],wR=()=>{const[a,e]=$.useState([]),[t,i]=$.useState(0),[s,l]=$.useState(1),[o,c]=$.useState(!1),[h,f]=$.useState(null),[g,m]=$.useState("US"),[y,S]=$.useState([]),{genre_id:E}=vr(),x=async()=>{try{const A=await Fe.get("https://api.themoviedb.org/3/configuration/countries?api_key=036f8385b9a88d59ba689f2a060877f7");S(A.data)}catch(A){console.error("Error fetching countries:",A)}},T=async()=>{let A=`https://api.themoviedb.org/3/discover/tv?api_key=036f8385b9a88d59ba689f2a060877f7&language=en-US&page=${s}&sort_by=popularity.desc&with_genres=${E}&include_null_first_air_dates=false`;h&&(A+=`&with_watch_providers=${h}&watch_region=${g}`);try{const O=await Fe.get(A);e(O.data.results),i(O.data.total_pages>500?500:O.data.total_pages),c(!0)}catch(O){console.error("Error fetching TV shows:",O),e([]),i(0),c(!0)}},R=A=>{const O=s+A;O>=1&&O<=t&&(l(O),c(!1))},D=A=>{const O=Math.max(1,Math.min(A,t));l(O),c(!1)};return $.useEffect(()=>{x()},[]),$.useEffect(()=>{T()},[o,s,h,E,g]),_.jsxs("div",{className:"genre-view",children:[_.jsxs("div",{className:"country-dropdown",style:{marginBottom:"10px"},children:[_.jsx("label",{htmlFor:"country",children:"Choose a country: "}),_.jsx("select",{id:"country",value:g,onChange:A=>{m(A.target.value),l(1),c(!1)},children:y.map(A=>_.jsx("option",{value:A.iso_3166_1,children:A.english_name},A.iso_3166_1))})]}),_.jsxs("div",{className:"provider-buttons",children:[IR.map(A=>_.jsx("button",{onClick:()=>{f(A.id),l(1),c(!1)},style:{backgroundColor:h===A.id?A.color:"#eee",color:h===A.id?"white":"black",border:"none",margin:"5px",padding:"8px 12px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"0.3s ease"},children:A.name},A.id)),h&&_.jsx("button",{onClick:()=>{f(null),l(1),c(!1)},style:{backgroundColor:"#888",color:"white",border:"none",margin:"5px",padding:"8px 12px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",transition:"0.3s ease"},children:"Clear Filter"})]}),_.jsx("div",{className:"movie-grid",children:a.length>0?a.map(A=>_.jsx("a",{href:`/tv/${A.id}`,children:_.jsx("img",{src:`https://image.tmdb.org/t/p/w500${A.poster_path}`,alt:A.name})},A.id)):_.jsx("p",{style:{textAlign:"center",width:"100%"},children:"No TV shows found for this filter."})}),_.jsxs("div",{className:"pagination",children:[_.jsx("button",{onClick:()=>D(1),disabled:s===1,children:"1"}),_.jsx("button",{onClick:()=>R(-1),disabled:s===1,children:"<"}),_.jsx("span",{children:s}),_.jsx("button",{onClick:()=>R(1),disabled:s===t,children:">"}),_.jsx("button",{onClick:()=>D(t),disabled:s===t,children:t})]})]})},OR=()=>{const a=vs(),[e,t]=$.useState([]),[i,s]=$.useState(!0),l=()=>{localStorage.removeItem("currentUser"),a("/login")};return $.useEffect(()=>{const o=localStorage.getItem("animeGenres");o?(t(JSON.parse(o)),s(!1)):fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"query { GenreCollection }"})}).then(c=>c.json()).then(c=>{var g;const f=(((g=c==null?void 0:c.data)==null?void 0:g.GenreCollection)||[]).filter(m=>typeof m=="string"&&m.toLowerCase()!=="hentai");t(f),localStorage.setItem("animeGenres",JSON.stringify(f)),s(!1)}).catch(c=>{console.error("Failed to fetch genres:",c),s(!1)})},[]),i?_.jsx("p",{children:"Loading genres..."}):_.jsxs("div",{className:"genres",children:[e.map(o=>_.jsx("a",{href:`/anime/genre/${o}`,children:o},o)),_.jsx("button",{onClick:l,children:"Log Out"})]})},kR=()=>_.jsxs("div",{children:[_.jsx(un,{}),_.jsxs("div",{className:"movies-view",children:[_.jsx(OR,{}),_.jsx(Dd,{})]}),_.jsx(cn,{})]}),MR=()=>{const[a,e]=$.useState([]),[t,i]=$.useState(1),[s,l]=$.useState(500),[o,c]=$.useState(!1),{genre:h}=vr(),f=async()=>{const S=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query ($genre: String, $page: Int) {
            Page(page: $page, perPage: 20) {
              pageInfo {
                total
                currentPage
                lastPage
              }
              media(genre: $genre, type: ANIME, sort: POPULARITY_DESC) {
                id
                coverImage { large }
                title {
                  romaji
                  english
                }
              }
            }
          }
        `,variables:{genre:h,page:t}})})).json();e(S.data.Page.media);const E=S.data.Page.pageInfo.lastPage;l(Math.min(500,E)),c(!0)},g=y=>{const S=Math.max(1,Math.min(t+y,s));i(S),c(!1)},m=y=>{const S=Math.max(1,Math.min(y,s));i(S),c(!1)};return $.useEffect(()=>{f()},[o]),_.jsxs("div",{className:"genre-view",children:[a.map(y=>{const S=y.title.english||y.title.romaji;return _.jsxs("a",{href:`/anime/details/${y.id}`,style:{position:"relative",display:"inline-block",margin:"10px"},children:[_.jsx("img",{src:y.coverImage.large,alt:S,style:{display:"block",width:"200px",height:"300px",objectFit:"cover"}}),_.jsx("div",{style:{position:"absolute",bottom:0,width:"100%",background:"rgba(0,0,0,0.6)",color:"#fff",textAlign:"center",padding:"5px",fontSize:"14px"},children:S})]},y.id)}),_.jsxs("div",{style:{marginTop:"20px"},children:[_.jsx("button",{onClick:()=>m(1),children:"1"}),_.jsx("button",{onClick:()=>g(-1),children:"<"}),_.jsx("span",{children:t}),_.jsx("button",{onClick:()=>g(1),children:">"}),_.jsx("button",{onClick:()=>m(s),children:s})]})]})},PR=()=>{var R,D,A,O;const{anime_id:a}=vr(),[e,t]=$.useState(null),[i,s]=$.useState(1),[l,o]=$.useState("sub"),[c,h]=$.useState("vidsrc"),[f,g]=$.useState("");if($.useEffect(()=>{fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
          query ($id: Int) {
            Media(id: $id, type: ANIME) {
              id
              title {
                romaji
                english
              }
              description(asHtml: false)
              genres
              coverImage {
                large
              }
              trailer {
                id
                site
              }
              episodes
              averageScore
              popularity
              startDate {
                year
                month
                day
              }
              externalLinks {
                site
                url
              }
            }
          }
        `,variables:{id:parseInt(a)}})}).then(I=>I.json()).then(I=>t(I.data.Media))},[a]),$.useEffect(()=>{if(e){if(c==="vidsrc")g(`https://vidsrc.cc/v2/embed/anime/ani${e.id}/${i}/${l}`);else if(c==="vidsrc.icu"){const I=l==="dub"?1:0;g(`https://vidsrc.icu/embed/anime/${e.id}/${i}/${I}`)}else if(c==="hianimez"){const I=e.title.english||e.title.romaji,N=encodeURIComponent(I);g(`https://hianimez.to/search?keyword=${N}`)}}},[e,i,l,c]),!e)return _.jsx("div",{children:"Loading..."});const m=e.title.english||e.title.romaji,y=((R=e.trailer)==null?void 0:R.site)==="youtube"?e.trailer.id:null,S=e.startDate?`${e.startDate.year||"?"}-${((D=e.startDate.month)==null?void 0:D.toString().padStart(2,"0"))||"??"}-${((A=e.startDate.day)==null?void 0:A.toString().padStart(2,"0"))||"??"}`:"N/A",E=(O=e.externalLinks)==null?void 0:O.find(I=>I.site==="Crunchyroll"),x=()=>s(I=>I+1),T=()=>s(I=>I>1?I-1:1);return _.jsxs("div",{className:"detail-view",children:[_.jsx("h1",{children:m}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("h3",{children:"Stream:"}),_.jsx("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap"},children:E&&_.jsx("a",{href:E.url,target:"_blank",rel:"noopener noreferrer",title:"Crunchyroll",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://media.themoviedb.org/t/p/original/fzN5Jok5Ig1eJ7gyNGoMhnLSCfh.jpg",alt:"Crunchyroll",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})})})]}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("h3",{children:"Buy Digitally:"}),_.jsxs("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap"},children:[_.jsx("a",{href:`https://www.amazon.com/gp/video/search?phrase=${encodeURIComponent(m)}&k=${encodeURIComponent(m)}&ref=atv_rs_redirect`,target:"_blank",rel:"noopener noreferrer",title:"Amazon Digital",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg",alt:"Amazon Digital",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.youtube.com/results?search_query=${encodeURIComponent(m)}`,target:"_blank",rel:"noopener noreferrer",title:"YouTube",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://image.tmdb.org/t/p/original/pTnn5JwWr4p3pG8H6VrpiQo7Vs0.jpg",alt:"YouTube",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})})]})]}),_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsx("h3",{children:"Buy Physically:"}),_.jsxs("div",{style:{display:"inline-flex",gap:"10px",flexWrap:"wrap"},children:[_.jsx("a",{href:`https://www.amazon.com/s?k=${encodeURIComponent(m)}+anime+dvd`,target:"_blank",rel:"noopener noreferrer",title:"Amazon (DVD/Blu-ray)",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://image.tmdb.org/t/p/original/seGSXajazLMCKGB5hnRCidtjay1.jpg",alt:"Amazon DVD/Blu-ray",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.walmart.com/search/?query=${encodeURIComponent(m)}+anime`,target:"_blank",rel:"noopener noreferrer",title:"Walmart",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSz1Y86WWaVlA-qPIKjhDrxpIf_gPnP4Btw1A&s",alt:"Walmart",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.bestbuy.com/site/searchpage.jsp?st=${encodeURIComponent(m)}+anime`,target:"_blank",rel:"noopener noreferrer",title:"Best Buy",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://partners.bestbuy.com/image/image_gallery?uuid=7e4efc4e-432f-f497-fe99-ec311c640241&groupId=20126",alt:"Best Buy",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://store.crunchyroll.com/search?q=${encodeURIComponent(m)}&prefn1=departments&prefv1=Home%20Entertainment%20%26%20Books`,target:"_blank",rel:"noopener noreferrer",title:"Crunchyroll Store",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://a.storyblok.com/f/178900/400x400/c440e1ad67/squarelogos_crlogo_store_lockup_orange_400x400.png",alt:"Crunchyroll Store",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})}),_.jsx("a",{href:`https://www.blu-ray.com/search/?quicksearch=1&quicksearch_country=US&quicksearch_keyword=${encodeURIComponent(m)}&section=bluraymovies`,target:"_blank",rel:"noopener noreferrer",title:"Blu-ray.com",style:{display:"inline-block",padding:0},children:_.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/81/81046.png",alt:"Blu-ray.com",style:{width:"50px",height:"50px",borderRadius:"8px",cursor:"pointer",objectFit:"contain",backgroundColor:"white"}})})]})]}),_.jsxs("div",{className:"additional-details",style:{marginBottom:"20px"},children:[_.jsxs("p",{children:[_.jsx("strong",{children:"Start Date:"})," ",S]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Episodes:"})," ",e.episodes||"N/A"]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Average Score:"})," ",e.averageScore?`${e.averageScore}/100`:"N/A"]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Popularity:"})," ",e.popularity||"N/A"]})]}),_.jsx("img",{src:e.coverImage.large,alt:m}),_.jsx("p",{children:e.description}),_.jsxs("p",{children:[_.jsx("strong",{children:"Genres:"})," ",e.genres.join(", ")]}),y&&_.jsxs(_.Fragment,{children:[_.jsx("h3",{children:"Official Trailer"}),_.jsx("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${y}`,title:"Anime Trailer",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})]}),_.jsxs("div",{className:"selector",children:[_.jsx("h3",{children:"Episode Navigation"}),_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[_.jsx("button",{onClick:T,children:"Previous"}),_.jsx("input",{type:"number",min:"1",value:i,onChange:I=>s(Math.max(1,Number(I.target.value))),style:{width:"4rem",textAlign:"center"}}),_.jsx("button",{onClick:x,children:"Next"})]}),_.jsxs("div",{style:{marginTop:"1rem"},children:[_.jsx("strong",{children:"Language:"})," ",_.jsx("button",{onClick:()=>o("sub"),disabled:l==="sub",children:"Sub"}),_.jsx("button",{onClick:()=>o("dub"),disabled:l==="dub",children:"Dub"}),_.jsx("br",{}),_.jsx("br",{}),_.jsx("strong",{children:"Server:"})," ",_.jsx("button",{onClick:()=>h("vidsrc"),disabled:c==="vidsrc",children:"Vidsrc"}),_.jsx("button",{onClick:()=>h("vidsrc.icu"),disabled:c==="vidsrc.icu",children:"Vidsrc.ICU"}),_.jsx("button",{onClick:()=>h("hianimez"),disabled:c==="hianimez",children:"Hianimez"})]})]}),f?_.jsx("iframe",{src:f,title:`Episode ${i}`,allowFullScreen:!0,className:"video-frame",width:"100%",height:"500px"}):_.jsx("p",{children:"Error loading stream. Please try a different server."})]})};function NR(){return _.jsxs("div",{className:"error-view",style:{backgroundImage:`url(${tv})`},children:[_.jsx(un,{}),_.jsxs("div",{className:"error-content",children:[_.jsx("h1",{children:"404 - Page Not Found"}),_.jsx("p",{children:"Sorry, the page you are looking for does not exist."})]}),_.jsx(cn,{})]})}var _f,xp;function UR(){if(xp)return _f;xp=1;var a="Expected a function",e=NaN,t="[object Symbol]",i=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,o=/^0o[0-7]+$/i,c=parseInt,h=typeof ro=="object"&&ro&&ro.Object===Object&&ro,f=typeof self=="object"&&self&&self.Object===Object&&self,g=h||f||Function("return this")(),m=Object.prototype,y=m.toString,S=Math.max,E=Math.min,x=function(){return g.Date.now()};function T(I,N,M){var F,H,B,ie,ae,ve,de=0,ue=!1,U=!1,W=!0;if(typeof I!="function")throw new TypeError(a);N=O(N)||0,R(M)&&(ue=!!M.leading,U="maxWait"in M,B=U?S(O(M.maxWait)||0,N):B,W="trailing"in M?!!M.trailing:W);function re(xe){var be=F,et=H;return F=H=void 0,de=xe,ie=I.apply(et,be),ie}function K(xe){return de=xe,ae=setTimeout(J,N),ue?re(xe):ie}function w(xe){var be=xe-ve,et=xe-de,Ui=N-be;return U?E(Ui,B-et):Ui}function Y(xe){var be=xe-ve,et=xe-de;return ve===void 0||be>=N||be<0||U&&et>=B}function J(){var xe=x();if(Y(xe))return ne(xe);ae=setTimeout(J,w(xe))}function ne(xe){return ae=void 0,W&&F?re(xe):(F=H=void 0,ie)}function oe(){ae!==void 0&&clearTimeout(ae),de=0,F=ve=H=ae=void 0}function he(){return ae===void 0?ie:ne(x())}function ce(){var xe=x(),be=Y(xe);if(F=arguments,H=this,ve=xe,be){if(ae===void 0)return K(ve);if(U)return ae=setTimeout(J,N),re(ve)}return ae===void 0&&(ae=setTimeout(J,N)),ie}return ce.cancel=oe,ce.flush=he,ce}function R(I){var N=typeof I;return!!I&&(N=="object"||N=="function")}function D(I){return!!I&&typeof I=="object"}function A(I){return typeof I=="symbol"||D(I)&&y.call(I)==t}function O(I){if(typeof I=="number")return I;if(A(I))return e;if(R(I)){var N=typeof I.valueOf=="function"?I.valueOf():I;I=R(N)?N+"":N}if(typeof I!="string")return I===0?I:+I;I=I.replace(i,"");var M=l.test(I);return M||o.test(I)?c(I.slice(2),M?2:8):s.test(I)?e:+I}return _f=T,_f}var BR=UR();const FR=lx(BR),bp="036f8385b9a88d59ba689f2a060877f7",$R=()=>{const a=jn(),t=new URLSearchParams(a.search).get("q"),[i,s]=$.useState([]),[l,o]=$.useState(1),[c,h]=$.useState(1),[f,g]=$.useState(1),[m,y]=$.useState(!0),S=async(T,R=1,D=1,A=1)=>{var O,I;try{const[N,M,F]=await Promise.all([fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(T)}&page=${R}&api_key=${bp}`).then(K=>K.json()),fetch(`https://api.themoviedb.org/3/search/tv?query=${encodeURIComponent(T)}&page=${D}&api_key=${bp}`).then(K=>K.json()),fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
              query ($search: String, $page: Int) {
                Page(page: $page, perPage: 10) {
                  media(search: $search, type: ANIME) {
                    id
                    title {
                      romaji
                      english
                    }
                    description(asHtml: false)
                    coverImage {
                      large
                    }
                    popularity
                  }
                }
              }
            `,variables:{search:T,page:A}})}).then(K=>K.json())]),H=N.results||[],B=M.results||[],ie=((I=(O=F.data)==null?void 0:O.Page)==null?void 0:I.media)||[],ae=H.map((K,w)=>({type:"movie",id:K.id,title:K.title,overview:K.overview,popularity:K.popularity||0,normalizedPopularity:K.popularity||0,relevanceRank:w,poster:K.poster_path?`https://image.tmdb.org/t/p/w300${K.poster_path}`:"https://via.placeholder.com/120x180?text=No+Image"})),ve=B.map((K,w)=>({type:"tv",id:K.id,title:K.name,overview:K.overview,popularity:K.popularity||0,normalizedPopularity:K.popularity||0,relevanceRank:w,poster:K.poster_path?`https://image.tmdb.org/t/p/w300${K.poster_path}`:"https://via.placeholder.com/120x180?text=No+Image"})),de=ie.map((K,w)=>{var Y,J,ne;return{type:"anime",id:K.id,title:((Y=K.title)==null?void 0:Y.english)||((J=K.title)==null?void 0:J.romaji),overview:K.description,popularity:K.popularity||0,normalizedPopularity:(K.popularity||0)/1e3,relevanceRank:w,poster:((ne=K.coverImage)==null?void 0:ne.large)||"https://via.placeholder.com/120x180?text=No+Image"}}),ue=[...ae,...ve,...de];ue.sort((K,w)=>K.relevanceRank!==w.relevanceRank?K.relevanceRank-w.relevanceRank:w.normalizedPopularity-K.normalizedPopularity),s(R===1&&D===1&&A===1?ue:K=>[...K,...ue]);const U=N.page<N.total_pages,W=M.page<M.total_pages,re=ie.length===10;y(U||W||re)}catch(N){console.error("Error fetching search results:",N)}},E=$.useCallback(FR((T,R,D,A)=>S(T,R,D,A),300),[]);$.useEffect(()=>{t&&(o(1),h(1),g(1),E(t,1,1,1))},[t]);const x=()=>{const T=l+1,R=c+1,D=f+1;o(T),h(R),g(D),S(t,T,R,D)};return _.jsxs("div",{children:[_.jsx(un,{}),_.jsxs("div",{className:"search-container",style:{padding:"20px",textAlign:"center"},children:[_.jsxs("h2",{children:['Search results for: "',t,'"']}),_.jsx("div",{className:"movie-results",style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:i.map((T,R)=>_.jsxs("div",{className:"movie-card",style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",margin:"12px 0",width:"80%",borderBottom:"1px solid #ccc"},children:[_.jsxs("div",{style:{flex:1,textAlign:"left"},children:[_.jsxs("h3",{style:{marginBottom:"8px"},children:[_.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",marginRight:"8px",fontWeight:"bold",fontSize:"14px",color:T.type==="anime"?"black":"white",backgroundColor:T.type==="movie"?"red":T.type==="tv"?"black":"white",border:T.type==="anime"?"1px solid black":"none"},children:T.type==="movie"?"Movie":T.type==="tv"?"TV Show":"Anime"}),_.jsx(wd,{to:T.type==="movie"?`/movies/details/${T.id}`:T.type==="tv"?`/tv/${T.id}`:`/anime/details/${T.id}`,style:{textDecoration:"none",color:"hotpink",fontWeight:"bold",transition:"color 0.2s"},onMouseEnter:D=>D.target.style.color="red",onMouseLeave:D=>D.target.style.color="hotpink",children:T.title})]}),_.jsx("p",{style:{margin:0},children:T.overview})]}),T.poster&&_.jsx("img",{src:T.poster,alt:T.title,style:{width:"120px",height:"180px",objectFit:"cover",marginLeft:"20px",borderRadius:"4px"}})]},`${T.type}-${T.id}-${R}`))}),m&&_.jsx("button",{onClick:x,style:{marginTop:"20px"},children:"Load More"})]}),_.jsx(cn,{})]})},fe=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},GR=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=jR},jR=Number.MAX_SAFE_INTEGER||9007199254740991;let pe=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),z=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a}({}),b=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a}({});var we={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},me={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ar{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class HR{constructor(e,t,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ar(e),this.fast_=new ar(t),this.defaultTTFB_=s,this.ttfb_=new ar(e)}update(e,t){const{slow_:i,fast_:s,ttfb_:l}=this;i.halfLife!==e&&(this.slow_=new ar(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==t&&(this.fast_=new ar(t,s.getEstimate(),s.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new ar(e,l.getEstimate(),l.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,s=e/1e3,l=i/s;this.fast_.sample(s,l),this.slow_.sample(s,l)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function VR(a,e,t){return(e=zR(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function Ke(){return Ke=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(a[i]=t[i])}return a},Ke.apply(null,arguments)}function Ap(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(a,s).enumerable})),t.push.apply(t,i)}return t}function $e(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ap(Object(t),!0).forEach(function(i){VR(a,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):Ap(Object(t)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(t,i))})}return a}function KR(a,e){if(typeof a!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var i=t.call(a,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function zR(a){var e=KR(a,"string");return typeof e=="symbol"?e:e+""}class fn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Bn,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const Bn=function(){},qR={trace:Bn,debug:Bn,log:Bn,warn:Bn,info:Bn,error:Bn};function ad(){return Ke({},qR)}function YR(a,e){const t=self.console[a];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${a}] >`):Bn}function Rp(a,e,t){return e[a]?e[a].bind(e):YR(a,t)}const ld=ad();function XR(a,e,t){const i=ad();if(typeof console=="object"&&a===!0||typeof a=="object"){const s=["debug","log","info","warn","error"];s.forEach(l=>{i[l]=Rp(l,a,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.2`)}catch{return ad()}s.forEach(l=>{ld[l]=Rp(l,a)})}else Ke(ld,i);return i}const Me=ld;function $n(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function QR(a){return typeof self<"u"&&a===self.ManagedMediaSource}function Lv(a,e){const t=Object.keys(a),i=Object.keys(e),s=t.length,l=i.length;return!s||!l||s===l&&!t.some(o=>i.indexOf(o)===-1)}function Wt(a,e=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(a);if(e){const g=f.indexOf("\0");return g!==-1?f.substring(0,g):f}return f.replace(/\0/g,"")}const t=a.length;let i,s,l,o="",c=0;for(;c<t;){if(i=a[c++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:s=a[c++],o+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=a[c++],l=a[c++],o+=String.fromCharCode((i&15)<<12|(s&63)<<6|(l&63)<<0);break}}return o}const Ii={hexDump:function(a){let e="";for(let t=0;t<a.length;t++){let i=a[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function WR(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Df={exports:{}},Lp;function ZR(){return Lp||(Lp=1,function(a,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,f,g){if(g=g||{},h=h.trim(),f=f.trim(),!f){if(!g.alwaysNormalize)return h;var m=c.parseURL(h);if(!m)throw new Error("Error trying to parse base URL.");return m.path=c.normalizePath(m.path),c.buildURLFromParts(m)}var y=c.parseURL(f);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return g.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):f;var S=c.parseURL(h);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var E=s.exec(S.path);S.netLoc=E[1],S.path=E[2]}S.netLoc&&!S.path&&(S.path="/");var x={scheme:S.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(x.netLoc=S.netLoc,y.path[0]!=="/"))if(!y.path)x.path=S.path,y.params||(x.params=S.params,y.query||(x.query=S.query));else{var T=S.path,R=T.substring(0,T.lastIndexOf("/")+1)+y.path;x.path=c.normalizePath(R)}return x.path===null&&(x.path=g.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(x)},parseURL:function(h){var f=i.exec(h);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(l,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};a.exports=c})()}(Df)),Df.exports}var Pd=ZR();class Nd{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ve={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class _v{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,eL(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let s;i.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ve.AUDIO]:null,[Ve.VIDEO]:null,[Ve.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Nd),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Pd.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ve.AUDIO]=null,e[Ve.VIDEO]=null,e[Ve.AUDIOVIDEO]=null}}function Et(a){return a.sn!=="initSegment"}class Cf extends _v{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(fe(e)&&fe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=fe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!fe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Et(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,s,l,o=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:i,startDTS:s,endDTS:l,partial:o};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,i),h.startDTS=Math.min(h.startDTS,s),h.endDTS=Math.max(h.endDTS,l)}}class JR extends _v{constructor(e,t,i,s,l){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Dv(a,e){const t=Object.getPrototypeOf(a);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||Dv(t,e)}}function eL(a,e){const t=Dv(a,e);t&&(t.enumerable=!0,Object.defineProperty(a,e,t))}const Uo=Math.pow(2,32)-1,tL=[].push,Cv={video:1,audio:2,id3:3,text:4};function dt(a){return String.fromCharCode.apply(null,a)}function Iv(a,e){const t=a[e]<<8|a[e+1];return t<0?65536+t:t}function Ee(a,e){const t=wv(a,e);return t<0?4294967296+t:t}function _p(a,e){let t=Ee(a,e);return t*=Math.pow(2,32),t+=Ee(a,e+4),t}function wv(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}function If(a,e,t){a[e]=t>>24,a[e+1]=t>>16&255,a[e+2]=t>>8&255,a[e+3]=t&255}function iL(a){const e=a.byteLength;for(let t=0;t<e;){const i=Ee(a,t);if(i>8&&a[t+4]===109&&a[t+5]===111&&a[t+6]===111&&a[t+7]===102)return!0;t=i>1?t+i:e}return!1}function Re(a,e){const t=[];if(!e.length)return t;const i=a.byteLength;for(let s=0;s<i;){const l=Ee(a,s),o=dt(a.subarray(s+4,s+8)),c=l>1?s+l:i;if(o===e[0])if(e.length===1)t.push(a.subarray(s+8,c));else{const h=Re(a.subarray(s+8,c),e.slice(1));h.length&&tL.apply(t,h)}s=c}return t}function nL(a){const e=[],t=a[0];let i=8;const s=Ee(a,i);i+=4;let l=0,o=0;t===0?(l=Ee(a,i),o=Ee(a,i+4),i+=8):(l=_p(a,i),o=_p(a,i+8),i+=16),i+=2;let c=a.length+o;const h=Iv(a,i);i+=2;for(let f=0;f<h;f++){let g=i;const m=Ee(a,g);g+=4;const y=m&2147483647;if((m&2147483648)>>>31===1)return Me.warn("SIDX has hierarchical references (not supported)"),null;const E=Ee(a,g);g+=4,e.push({referenceSize:y,subsegmentDuration:E,info:{duration:E/s,start:c,end:c+y-1}}),c+=y,g+=4,i=g}return{earliestPresentationTime:l,timescale:s,version:t,referencesCount:h,references:e}}function Ov(a){const e=[],t=Re(a,["moov","trak"]);for(let s=0;s<t.length;s++){const l=t[s],o=Re(l,["tkhd"])[0];if(o){let c=o[0];const h=Ee(o,c===0?12:20),f=Re(l,["mdia","mdhd"])[0];if(f){c=f[0];const g=Ee(f,c===0?12:20),m=Re(l,["mdia","hdlr"])[0];if(m){const y=dt(m.subarray(8,12)),S={soun:Ve.AUDIO,vide:Ve.VIDEO}[y],E=Re(l,["mdia","minf","stbl","stsd"])[0],x=sL(E);S?(e[h]={timescale:g,type:S,stsd:x},e[S]=$e({timescale:g,id:h},x)):e[h]={timescale:g,type:y,stsd:x}}}}}return Re(a,["moov","mvex","trex"]).forEach(s=>{const l=Ee(s,4),o=e[l];o&&(o.default={duration:Ee(s,12),flags:Ee(s,20)})}),e}function sL(a){const e=a.subarray(8),t=e.subarray(86),i=dt(e.subarray(4,8));let s=i,l;const o=i==="enca"||i==="encv";if(o){const f=Re(e,[i])[0].subarray(i==="enca"?28:78);Re(f,["sinf"]).forEach(m=>{const y=Re(m,["schm"])[0];if(y){const S=dt(y.subarray(4,8));if(S==="cbcs"||S==="cenc"){const E=Re(m,["frma"])[0];E&&(s=dt(E))}}})}const c=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Re(t,["avcC"])[0];h&&h.length>3&&(s+="."+oo(h[1])+oo(h[2])+oo(h[3]),l=lo(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=Re(e,[i])[0],f=Re(h.subarray(28),["esds"])[0];if(f&&f.length>7){let g=4;if(f[g++]!==3)break;g=wf(f,g),g+=2;const m=f[g++];if(m&128&&(g+=2),m&64&&(g+=f[g++]),f[g++]!==4)break;g=wf(f,g);const y=f[g++];if(y===64)s+="."+oo(y);else break;if(g+=12,f[g++]!==5)break;g=wf(f,g);const S=f[g++];let E=(S&248)>>3;E===31&&(E+=1+((S&7)<<3)+((f[g]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{const h=Re(t,["hvcC"])[0];if(h&&h.length>12){const f=h[1],g=["","A","B","C"][f>>6],m=f&31,y=Ee(h,2),S=(f&32)>>5?"H":"L",E=h[12],x=h.subarray(6,12);s+="."+g+m,s+="."+y.toString(16).toUpperCase(),s+="."+S+E;let T="";for(let R=x.length;R--;){const D=x[R];(D||T)&&(T="."+D.toString(16).toUpperCase()+T)}s+=T}l=lo(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=lo(s,t)||s;break}case"vp09":{const h=Re(t,["vpcC"])[0];if(h&&h.length>6){const f=h[4],g=h[5],m=h[6]>>4&15;s+="."+Ci(f)+"."+Ci(g)+"."+Ci(m)}break}case"av01":{const h=Re(t,["av1C"])[0];if(h&&h.length>2){const f=h[1]>>>5,g=h[1]&31,m=h[2]>>>7?"H":"M",y=(h[2]&64)>>6,S=(h[2]&32)>>5,E=f===2&&y?S?12:10:y?10:8,x=(h[2]&16)>>4,T=(h[2]&8)>>3,R=(h[2]&4)>>2,D=h[2]&3;s+="."+f+"."+Ci(g)+m+"."+Ci(E)+"."+x+"."+T+R+D+"."+Ci(1)+"."+Ci(1)+"."+Ci(1)+"."+0,l=lo("dav1",t)}break}}return{codec:s,encrypted:o,supplemental:l}}function lo(a,e){const t=Re(e,["dvvC"]),i=t.length?t[0]:Re(e,["dvcC"])[0];if(i){const s=i[2]>>1&127,l=i[2]<<5&32|i[3]>>3&31;return a+"."+Ci(s)+"."+Ci(l)}}function wf(a,e){const t=e+5;for(;a[e++]&128&&e<t;);return e}function oo(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function Ci(a){return(a<10?"0":"")+a}function rL(a,e){if(!a||!e)return a;const t=e.keyId;return t&&e.isCommonEncryption&&Re(a,["moov","trak"]).forEach(s=>{const o=Re(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Re(o,["enca"]);const h=c.length>0;h||(c=Re(o,["encv"])),c.forEach(f=>{const g=h?f.subarray(28):f.subarray(78);Re(g,["sinf"]).forEach(y=>{const S=kv(y);if(S){const E=S.subarray(8,24);E.some(x=>x!==0)||(Me.log(`[eme] Patching keyId in 'enc${h?"a":"v"}>sinf>>tenc' box: ${Ii.hexDump(E)} -> ${Ii.hexDump(t)}`),S.set(t,8))}})})}),a}function kv(a){const e=Re(a,["schm"])[0];if(e){const t=dt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Re(a,["schi","tenc"])[0]}return null}function aL(a,e){return Re(e,["moof","traf"]).reduce((t,i)=>{const s=Re(i,["tfdt"])[0],l=s[0],o=Re(i,["tfhd"]).reduce((c,h)=>{const f=Ee(h,4),g=a[f];if(g){let m=Ee(s,4);if(l===1){if(m===Uo)return Me.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),c;m*=Uo+1,m+=Ee(s,8)}const y=g.timescale||9e4,S=m/y;if(fe(S)&&(c===null||S<c))return S}return c},null);return o!==null&&fe(o)&&(t===null||o<t)?o:t},null)}function lL(a,e){let t=0,i=0,s=0;const l=Re(a,["moof","traf"]);for(let o=0;o<l.length;o++){const c=l[o],h=Re(c,["tfhd"])[0],f=Ee(h,4),g=e[f];if(!g)continue;const m=g.default,y=Ee(h,0)|(m==null?void 0:m.flags);let S=m==null?void 0:m.duration;y&8&&(y&2?S=Ee(h,12):S=Ee(h,8));const E=g.timescale||9e4,x=Re(c,["trun"]);for(let T=0;T<x.length;T++){if(t=oL(x[T]),!t&&S){const R=Ee(x[T],4);t=S*R}g.type===Ve.VIDEO?i+=t/E:g.type===Ve.AUDIO&&(s+=t/E)}}if(i===0&&s===0){let o=1/0,c=0,h=0;const f=Re(a,["sidx"]);for(let g=0;g<f.length;g++){const m=nL(f[g]);if(m!=null&&m.references){o=Math.min(o,m.earliestPresentationTime/m.timescale);const y=m.references.reduce((S,E)=>S+E.info.duration||0,0);c=Math.max(c,y+m.earliestPresentationTime/m.timescale),h=c-o}}if(h&&fe(h))return h}return i||s}function oL(a){const e=Ee(a,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const s=Ee(a,4);for(let l=0;l<s;l++){if(e&256){const o=Ee(a,t);i+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return i}function uL(a,e,t){Re(e,["moof","traf"]).forEach(i=>{Re(i,["tfhd"]).forEach(s=>{const l=Ee(s,4),o=a[l];if(!o)return;const c=o.timescale||9e4;Re(i,["tfdt"]).forEach(h=>{const f=h[0],g=t*c;if(g){let m=Ee(h,4);if(f===0)m-=g,m=Math.max(m,0),If(h,4,m);else{m*=Math.pow(2,32),m+=Ee(h,8),m-=g,m=Math.max(m,0);const y=Math.floor(m/(Uo+1)),S=Math.floor(m%(Uo+1));If(h,4,y),If(h,8,S)}}})})})}function cL(a){const e={valid:null,remainder:null},t=Re(a,["moof"]);if(t.length<2)return e.remainder=a,e;const i=t[t.length-1];return e.valid=a.slice(0,i.byteOffset-8),e.remainder=a.slice(i.byteOffset-8),e}function ui(a,e){const t=new Uint8Array(a.length+e.length);return t.set(a),t.set(e,a.length),t}function Dp(a,e){const t=[],i=e.samples,s=e.timescale,l=e.id;let o=!1;return Re(i,["moof"]).map(h=>{const f=h.byteOffset-8;Re(h,["traf"]).map(m=>{const y=Re(m,["tfdt"]).map(S=>{const E=S[0];let x=Ee(S,4);return E===1&&(x*=Math.pow(2,32),x+=Ee(S,8)),x/s})[0];return y!==void 0&&(a=y),Re(m,["tfhd"]).map(S=>{const E=Ee(S,4),x=Ee(S,0)&16777215,T=(x&1)!==0,R=(x&2)!==0,D=(x&8)!==0;let A=0;const O=(x&16)!==0;let I=0;const N=(x&32)!==0;let M=8;E===l&&(T&&(M+=8),R&&(M+=4),D&&(A=Ee(S,M),M+=4),O&&(I=Ee(S,M),M+=4),N&&(M+=4),e.type==="video"&&(o=iu(e.codec)),Re(m,["trun"]).map(F=>{const H=F[0],B=Ee(F,0)&16777215,ie=(B&1)!==0;let ae=0;const ve=(B&4)!==0,de=(B&256)!==0;let ue=0;const U=(B&512)!==0;let W=0;const re=(B&1024)!==0,K=(B&2048)!==0;let w=0;const Y=Ee(F,4);let J=8;ie&&(ae=Ee(F,J),J+=4),ve&&(J+=4);let ne=ae+f;for(let oe=0;oe<Y;oe++){if(de?(ue=Ee(F,J),J+=4):ue=A,U?(W=Ee(F,J),J+=4):W=I,re&&(J+=4),K&&(H===0?w=Ee(F,J):w=wv(F,J),J+=4),e.type===Ve.VIDEO){let he=0;for(;he<W;){const ce=Ee(i,ne);if(ne+=4,fL(o,i[ne])){const xe=i.subarray(ne,ne+ce);Ud(xe,o?2:1,a+w/s,t)}ne+=ce,he+=ce+4}}a+=ue/s}}))})})}),t}function iu(a){if(!a)return!1;const e=a.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function fL(a,e){if(a){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Ud(a,e,t,i){const s=Mv(a);let l=0;l+=e;let o=0,c=0,h=0;for(;l<s.length;){o=0;do{if(l>=s.length)break;h=s[l++],o+=h}while(h===255);c=0;do{if(l>=s.length)break;h=s[l++],c+=h}while(h===255);const f=s.length-l;let g=l;if(c<f)l+=c;else if(c>f){Me.error(`Malformed SEI payload. ${c} is too small, only ${f} bytes left to parse.`);break}if(o===4){if(s[g++]===181){const y=Iv(s,g);if(g+=2,y===49){const S=Ee(s,g);if(g+=4,S===1195456820){const E=s[g++];if(E===3){const x=s[g++],T=31&x,R=64&x,D=R?2+T*3:0,A=new Uint8Array(D);if(R){A[0]=x;for(let O=1;O<D;O++)A[O]=s[g++]}i.push({type:E,payloadType:o,pts:t,bytes:A})}}}}}else if(o===5&&c>16){const m=[];for(let E=0;E<16;E++){const x=s[g++].toString(16);m.push(x.length==1?"0"+x:x),(E===3||E===5||E===7||E===9)&&m.push("-")}const y=c-16,S=new Uint8Array(y);for(let E=0;E<y;E++)S[E]=s[g++];i.push({payloadType:o,pts:t,uuid:m.join(""),userData:Wt(S),userDataBytes:S})}}}function Mv(a){const e=a.byteLength,t=[];let i=1;for(;i<e-2;)a[i]===0&&a[i+1]===0&&a[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return a;const s=e-t.length,l=new Uint8Array(s);let o=0;for(i=0;i<s;o++,i++)o===t[0]&&(o++,t.shift()),l[i]=a[o];return l}function dL(a){const e=a[0];let t="",i="",s=0,l=0,o=0,c=0,h=0,f=0;if(e===0){for(;dt(a.subarray(f,f+1))!=="\0";)t+=dt(a.subarray(f,f+1)),f+=1;for(t+=dt(a.subarray(f,f+1)),f+=1;dt(a.subarray(f,f+1))!=="\0";)i+=dt(a.subarray(f,f+1)),f+=1;i+=dt(a.subarray(f,f+1)),f+=1,s=Ee(a,12),l=Ee(a,16),c=Ee(a,20),h=Ee(a,24),f=28}else if(e===1){f+=4,s=Ee(a,f),f+=4;const m=Ee(a,f);f+=4;const y=Ee(a,f);for(f+=4,o=2**32*m+y,GR(o)||(o=Number.MAX_SAFE_INTEGER,Me.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ee(a,f),f+=4,h=Ee(a,f),f+=4;dt(a.subarray(f,f+1))!=="\0";)t+=dt(a.subarray(f,f+1)),f+=1;for(t+=dt(a.subarray(f,f+1)),f+=1;dt(a.subarray(f,f+1))!=="\0";)i+=dt(a.subarray(f,f+1)),f+=1;i+=dt(a.subarray(f,f+1)),f+=1}const g=a.subarray(f,a.byteLength);return{schemeIdUri:t,value:i,timeScale:s,presentationTime:o,presentationTimeDelta:l,eventDuration:c,id:h,payload:g}}function hL(a,...e){const t=e.length;let i=8,s=t;for(;s--;)i+=e[s].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(a,4),s=0,i=8;s<t;s++)l.set(e[s],i),i+=e[s].byteLength;return l}function gL(a,e,t){if(a.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let l;i>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),hL([112,115,115,104],new Uint8Array([i,0,0,0]),a,l,s,o,t||new Uint8Array)}function mL(a){const e=[];if(a instanceof ArrayBuffer){const t=a.byteLength;let i=0;for(;i+32<t;){const s=new DataView(a,i),l=pL(s);e.push(l),i+=l.size}}return e}function pL(a){const e=a.getUint32(0),t=a.byteOffset,i=a.byteLength;if(i<e)return{offset:t,size:i};if(a.getUint32(4)!==1886614376)return{offset:t,size:e};const l=a.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:t,size:e};const o=a.buffer,c=Ii.hexDump(new Uint8Array(o,t+12,16)),h=a.getUint32(28);let f=null,g=null;if(l===0){if(e-32<h||h<22)return{offset:t,size:e};g=new Uint8Array(o,t+32,h)}else if(l===1){if(!h||i<t+32+h*16+16)return{offset:t,size:e};f=[];for(let m=0;m<h;m++)f.push(new Uint8Array(o,t+32+m*16,16))}return{version:l,systemId:c,kids:f,data:g,offset:t,size:e}}const Pv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),gr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Nv(a,e){const t=gr[e];return!!t&&!!t[a.slice(0,4)]}function od(a,e,t=!0){return!a.split(",").some(i=>!Uv(i,e,t))}function Uv(a,e,t=!0){var i;const s=$n(t);return(i=s==null?void 0:s.isTypeSupported(wa(a,e)))!=null?i:!1}function wa(a,e){return`${e}/mp4;codecs=${a}`}function Cp(a){if(a){const e=a.substring(0,4);return gr.video[e]}return 2}function Bo(a){const e=Pv();return a.split(",").reduce((t,i)=>{const l=e&&iu(i)?9:gr.video[i];return l?(l*2+t)/(t?3:2):(gr.audio[i]+t)/(t?2:1)},0)}const Of={};function yL(a,e=!0){if(Of[a])return Of[a];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[a];for(let s=0;s<t.length;s++){var i;if(Uv(t[s],"audio",e))return Of[a]=t[s],t[s];if(t[s]==="mp3"&&(i=$n(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return a}const vL=/flac|opus|mp4a\.40\.34/i;function Fo(a,e=!0){return a.replace(vL,t=>yL(t.toLowerCase(),e))}function EL(a,e){const t=[];if(a){const i=a.split(",");for(let s=0;s<i.length;s++)Nv(i[s],"video")||t.push(i[s])}return e&&t.push(e),t.join(",")}function _o(a,e){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1))return a;if(e){const t=e.split(",");if(t.length>1){if(a){for(let i=t.length;i--;)if(t[i].substring(0,4)===a.substring(0,4))return t[i]}return t[0]}}return e||a}function SL(a){const e=a.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");if(i.length>2){let s=i.shift()+".";s+=parseInt(i.shift()).toString(16),s+=("000"+parseInt(i.shift()).toString(16)).slice(-4),e[t]=s}}return e.join(",")}function TL(a){if(a.startsWith("av01.")){const e=a.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return a}function Ip(a){const e=$n(a)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Bv(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Fv={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function $v(a,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:a}}const wp={};function xL(a,e,t,i,s,l){const o=a.audioCodec?a.audioGroups:null,c=l==null?void 0:l.audioCodec,h=l==null?void 0:l.channels,f=h?parseInt(h):c?1/0:2;let g=null;if(o!=null&&o.length)try{o.length===1&&o[0]?g=e.groups[o[0]].channels:g=o.reduce((m,y)=>{if(y){const S=e.groups[y];if(!S)throw new Error(`Audio track group ${y} not found`);Object.keys(S.channels).forEach(E=>{m[E]=(m[E]||0)+S.channels[E]})}return m},{2:0})}catch{return!0}return a.videoCodec!==void 0&&(a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(i,30)||a.videoRange!=="SDR"&&a.videoRange!==t||a.bitrate>Math.max(s,8e6))||!!g&&fe(f)&&Object.keys(g).some(m=>parseInt(m)>f)}function Gv(a,e,t){const i=a.videoCodec,s=a.audioCodec;if(!i&&!s||!t)return Promise.resolve(Fv);const l=[];if(i){const o={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},c=a.videoRange;c!=="SDR"&&(o.transferFunction=c.toLowerCase());const h=i.split(","),f=navigator.userAgent;if(h.some(g=>iu(g))&&Pv())return Promise.resolve($v(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${f})`),l));l.push.apply(l,h.map(g=>({type:"media-source",video:$e($e({},o),{},{contentType:wa(TL(g),"video")})})))}return s&&a.audioGroups&&a.audioGroups.forEach(o=>{var c;o&&((c=e.groups[o])==null||c.tracks.forEach(h=>{if(h.groupId===o){const f=h.channels||"",g=parseFloat(f);fe(g)&&g>2&&l.push.apply(l,s.split(",").map(m=>({type:"media-source",audio:{contentType:wa(m,"audio"),channels:""+g}})))}}))}),Promise.all(l.map(o=>{const c=bL(o);return wp[c]||(wp[c]=t.decodingInfo(o))})).then(o=>({supported:!o.some(c=>!c.supported),configurations:l,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:l,decodingInfoResults:[],error:o}))}function bL(a){const{audio:e,video:t}=a,i=t||e;if(i){const s=Bv(i.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}const ud=["NONE","TYPE-0","TYPE-1",null];function AL(a){return ud.indexOf(a)>-1}const $o=["SDR","PQ","HLG"];function RL(a){return!!a&&$o.indexOf(a)>-1}var Do={No:"",Yes:"YES",v2:"v2"};function Op(a){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=a,s=i<e/2;return e&&s?t?Do.v2:Do.Yes:Do.No}class kp{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Oa{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Mp(this._audioGroups,e)}hasSubtitleGroup(e){return Mp(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Mp(a,e){return!e||!a?!1:a.indexOf(e)!==-1}function LL(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(a.media!==e.media)return a.matches===!0}return!1}function _L(a,e){let t=!1,i=[];if(a&&(t=a!=="SDR",i=[a]),e){i=e.allowedVideoRanges||$o.slice(0);const s=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&LL(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const DL=a=>{const e=new WeakSet;return(t,i)=>{if(a&&(i=a(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Je=(a,e)=>JSON.stringify(a,DL(e));function CL(a,e,t,i,s){const l=Object.keys(a),o=i==null?void 0:i.channels,c=i==null?void 0:i.audioCodec,h=s==null?void 0:s.videoCodec,f=o&&parseInt(o)===2;let g=!1,m=!1,y=1/0,S=1/0,E=1/0,x=1/0,T=0,R=[];const{preferHDR:D,allowedVideoRanges:A}=_L(e,s);for(let F=l.length;F--;){const H=a[l[F]];g||(g=H.channels[2]>0),y=Math.min(y,H.minHeight),S=Math.min(S,H.minFramerate),E=Math.min(E,H.minBitrate),A.filter(ie=>H.videoRanges[ie]>0).length>0&&(m=!0)}y=fe(y)?y:0,S=fe(S)?S:0;const O=Math.max(1080,y),I=Math.max(30,S);E=fe(E)?E:t,t=Math.max(E,t),m||(e=void 0);const N=l.length>1;return{codecSet:l.reduce((F,H)=>{const B=a[H];if(H===F)return F;if(R=m?A.filter(ie=>B.videoRanges[ie]>0):[],N){if(B.minBitrate>t)return Di(H,`min bitrate of ${B.minBitrate} > current estimate of ${t}`),F;if(!B.hasDefaultAudio)return Di(H,"no renditions with default or auto-select sound found"),F;if(c&&H.indexOf(c.substring(0,4))%5!==0)return Di(H,`audio codec preference "${c}" not found`),F;if(o&&!f){if(!B.channels[o])return Di(H,`no renditions with ${o} channel sound found (channels options: ${Object.keys(B.channels)})`),F}else if((!c||f)&&g&&B.channels[2]===0)return Di(H,"no renditions with stereo sound found"),F;if(B.minHeight>O)return Di(H,`min resolution of ${B.minHeight} > maximum of ${O}`),F;if(B.minFramerate>I)return Di(H,`min framerate of ${B.minFramerate} > maximum of ${I}`),F;if(!R.some(ie=>B.videoRanges[ie]>0))return Di(H,`no variants with VIDEO-RANGE of ${Je(R)} found`),F;if(h&&H.indexOf(h.substring(0,4))%5!==0)return Di(H,`video codec preference "${h}" not found`),F;if(B.maxScore<T)return Di(H,`max score of ${B.maxScore} < selected max of ${T}`),F}return F&&(Bo(H)>=Bo(F)||B.fragmentError>a[F].fragmentError)?F:(x=B.minIndex,T=B.maxScore,H)},void 0),videoRanges:R,preferHDR:D,minFramerate:S,minBitrate:E,minIndex:x}}function Di(a,e){Me.log(`[abr] start candidates with "${a}" ignored because ${e}`)}function jv(a){return a.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const s=t.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function IL(a,e,t,i){return a.slice(t,i+1).reduce((s,l,o)=>{if(!l.codecSet)return s;const c=l.audioGroups;let h=s[l.codecSet];h||(s[l.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,l.bitrate);const f=Math.min(l.height,l.width);return h.minHeight=Math.min(h.minHeight,f),h.minFramerate=Math.min(h.minFramerate,l.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,l.score),h.fragmentError+=l.fragmentError,h.videoRanges[l.videoRange]=(h.videoRanges[l.videoRange]||0)+1,c&&c.forEach(g=>{if(!g)return;const m=e.groups[g];m&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(y=>{h.channels[y]=(h.channels[y]||0)+m.channels[y]}))}),s},{})}function Pp(a){if(!a)return a;const{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:l}=a;return{lang:e,assocLang:t,characteristics:i,channels:s,audioCodec:l}}function Oi(a,e,t){if("attrs"in a){const i=e.indexOf(a);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if(gs(a,s,t))return i}return-1}function gs(a,e,t){const{groupId:i,name:s,lang:l,assocLang:o,default:c}=a,h=a.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(l===void 0||wL(l,e.lang))&&(l===void 0||e.assocLang===o)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in a)||OL(a.characteristics||"",e.characteristics))&&(t===void 0||t(a,e))}function wL(a,e="--"){return a.length===e.length?a===e:a.startsWith(e)||e.startsWith(a)}function OL(a,e=""){const t=a.split(","),i=e.split(",");return t.length===i.length&&!t.some(s=>i.indexOf(s)===-1)}function fs(a,e){const{audioCodec:t,channels:i}=a;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function kL(a,e,t,i,s){const l=e[i],c=e.reduce((y,S,E)=>{const x=S.uri;return(y[x]||(y[x]=[])).push(E),y},{})[l.uri];c.length>1&&(i=Math.max.apply(Math,c));const h=l.videoRange,f=l.frameRate,g=l.codecSet.substring(0,4),m=Np(e,i,y=>{if(y.videoRange!==h||y.frameRate!==f||y.codecSet.substring(0,4)!==g)return!1;const S=y.audioGroups,E=t.filter(x=>!S||S.indexOf(x.groupId)!==-1);return Oi(a,E,s)>-1});return m>-1?m:Np(e,i,y=>{const S=y.audioGroups,E=t.filter(x=>!S||S.indexOf(x.groupId)!==-1);return Oi(a,E,s)>-1})}function Np(a,e,t){for(let i=e;i>-1;i--)if(t(a[i]))return i;for(let i=e+1;i<a.length;i++)if(t(a[i]))return i;return-1}function Go(a,e){var t;return!!a&&a!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ML extends fn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:s,partCurrent:l,hls:o}=this,{autoLevelEnabled:c,media:h}=o;if(!s||!h)return;const f=performance.now(),g=l?l.stats:s.stats,m=l?l.duration:s.duration,y=f-g.loading.start,S=o.minAutoLevel,E=s.level,x=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||E<=S){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=x>-1&&x!==E,R=!!t||T;if(!R&&(h.paused||!h.playbackRate||!h.readyState))return;const D=o.mainForwardBufferInfo;if(!R&&D===null)return;const A=this.bwEstimator.getEstimateTTFB(),O=Math.abs(h.playbackRate);if(y<=Math.max(A,1e3*(m/(O*2))))return;const I=D?D.len/O:0,N=g.loading.first?g.loading.first-g.loading.start:-1,M=g.loaded&&N>-1,F=this.getBwEstimate(),H=o.levels,B=H[E],ie=Math.max(g.loaded,Math.round(m*(s.bitrate||B.averageBitrate)/8));let ae=M?y-N:y;ae<1&&M&&(ae=Math.min(y,g.loaded*8/F));const ve=M?g.loaded*1e3/ae:0,de=A/1e3,ue=ve?(ie-g.loaded)/ve:ie*8/F+de;if(ue<=I)return;const U=ve?ve*8:F,W=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,re=this.hls.config.abrBandWidthUpFactor;let K=Number.POSITIVE_INFINITY,w;for(w=E-1;w>S;w--){const oe=H[w].maxBitrate,he=!H[w].details||W;if(K=this.getTimeToLoadFrag(de,U,m*oe,he),K<Math.min(I,m+de))break}if(K>=ue||K>m*10)return;M?this.bwEstimator.sample(y-Math.min(A,N),g.loaded):this.bwEstimator.sampleTTFB(y);const Y=H[w].maxBitrate;this.getBwEstimate()*re>Y&&this.resetEstimator(Y);const J=this.findBestLevel(Y,S,w,0,I,1,1);J>-1&&(w=J),this.warn(`Fragment ${s.sn}${l?" part "+l.index:""} of level ${E} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${I.toFixed(3)} s
      Estimated load time for current fragment: ${ue.toFixed(3)} s
      Estimated load time for down switch fragment: ${K.toFixed(3)} s
      TTFB estimate: ${N|0} ms
      Current BW estimate: ${fe(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${w} @ ${Y|0} bps`),o.nextLoadLevel=o.nextAutoLevel=w,this.clearTimer();const ne=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===w&&w>0){const oe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${w>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${oe.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,w>S){let he=this.findBestLevel(this.hls.levels[S].bitrate,S,w,0,oe,1,1);he===-1&&(he=S),this.hls.nextLoadLevel=this.hls.nextAutoLevel=he,this.resetEstimator(this.hls.levels[he].bitrate)}}};T||ue>K*2?ne():this.timer=self.setInterval(ne,K*1e3),o.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:l,stats:g})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new HR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:s,partCurrent:l}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const o=performance.now(),c=l?l.stats:i.stats,h=o-c.loading.start,f=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&f>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(m,f),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,i,s){const l=e+i/t,o=s?e+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:s}=t.stats,l=s.end-s.first;fe(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const s=i?i.stats:t.stats;if(t.type===me.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=i?i.duration:t.duration,o=this.hls.levels[t.level],c=(o.loaded?o.loaded.bytes:0)+s.loaded,h=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:c,duration:h},o.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const l={stats:s,frag:t,part:i,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,l),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:s}=t,l=s!=null&&s.stats.loaded?s.stats:i.stats;if(l.aborted||this.ignoreFragment(i))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==me.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,l=this.findBestLevel(i,t,e,0,s,1,1);if(l>-1)return l;const o=this.hls.firstLevel,c=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,l)&&o[e].loadError<=o[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:l,minAutoLevel:o}=i,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),f=this.getStarvationDelay();let g=l.abrBandWidthFactor,m=l.abrBandWidthUpFactor;if(f){const T=this.findBestLevel(h,o,s,f,0,g,m);if(T>=0)return this.rebufferNotice=-1,T}let y=c?Math.min(c,l.maxStarvationDelay):l.maxStarvationDelay;if(!f){const T=this.bitrateTestDelay;T&&(y=(c?Math.min(c,l.maxLoadingDelay):l.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),g=m=1)}const S=this.findBestLevel(h,o,s,f,y,g,m);if(this.rebufferNotice!==S&&(this.rebufferNotice=S,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${S}`)),S>-1)return S;const E=i.levels[o],x=i.loadLevelObj;return x&&(E==null?void 0:E.bitrate)<x.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,s,l,o,c){var h;const f=s+l,g=this.lastLoadedFragLevel,m=g===-1?this.hls.firstLevel:g,{fragCurrent:y,partCurrent:S}=this,{levels:E,allAudioTracks:x,loadLevel:T,config:R}=this.hls;if(E.length===1)return 0;const D=E[m],A=!!((h=this.hls.latestLevelDetails)!=null&&h.live),O=T===-1||g===-1;let I,N="SDR",M=(D==null?void 0:D.frameRate)||0;const{audioPreference:F,videoPreference:H}=R,B=this.audioTracksByGroup||(this.audioTracksByGroup=jv(x));let ie=-1;if(O){if(this.firstSelection!==-1)return this.firstSelection;const U=this.codecTiers||(this.codecTiers=IL(E,B,t,i)),W=CL(U,N,e,F,H),{codecSet:re,videoRanges:K,minFramerate:w,minBitrate:Y,minIndex:J,preferHDR:ne}=W;ie=J,I=re,N=ne?K[K.length-1]:K[0],M=w,e=Math.max(e,Y),this.log(`picked start tier ${Je(W)}`)}else I=D==null?void 0:D.codecSet,N=D==null?void 0:D.videoRange;const ae=S?S.duration:y?y.duration:0,ve=this.bwEstimator.getEstimateTTFB()/1e3,de=[];for(let U=i;U>=t;U--){var ue;const W=E[U],re=U>m;if(!W)continue;if(R.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const he=navigator.mediaCapabilities;typeof(he==null?void 0:he.decodingInfo)=="function"&&(xL(W,B,N,M,e,F)||iu(W.videoCodec))?(W.supportedPromise=Gv(W,B,he),W.supportedPromise.then(ce=>{if(!this.hls)return;W.supportedResult=ce;const xe=this.hls.levels,be=xe.indexOf(W);ce.error?this.warn(`MediaCapabilities decodingInfo error: "${ce.error}" for level ${be} ${Je(ce)}`):ce.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${be} ${Je(ce)}`),be>-1&&xe.length>1&&(this.log(`Removing unsupported level ${be}`),this.hls.removeLevel(be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):W.supportedResult=Fv}if((I&&W.codecSet!==I||N&&W.videoRange!==N||re&&M>W.frameRate||!re&&M>0&&M<W.frameRate||W.supportedResult&&!((ue=W.supportedResult.decodingInfoResults)!=null&&ue[0].smooth))&&(!O||U!==ie)){de.push(U);continue}const K=W.details,w=(S?K==null?void 0:K.partTarget:K==null?void 0:K.averagetargetduration)||ae;let Y;re?Y=c*e:Y=o*e;const J=ae&&s>=ae*2&&l===0?W.averageBitrate:W.maxBitrate,ne=this.getTimeToLoadFrag(ve,Y,J*w,K===void 0);if(Y>=J&&(U===g||W.loadError===0&&W.fragmentError===0)&&(ne<=ve||!fe(ne)||A&&!this.bitrateTestDelay||ne<f)){const he=this.forcedAutoLevel;return U!==T&&(he===-1||he!==T)&&(de.length&&this.trace(`Skipped level(s) ${de.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${E[de[0]].codecs}" ${E[de[0]].videoRange}; not compatible with "${I}" ${N}`),this.info(`switch candidate:${m}->${U} adjustedbw(${Math.round(Y)})-bitrate=${Math.round(Y-J)} ttfb:${ve.toFixed(1)} avgDuration:${w.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${ne.toFixed(1)} firstSelection:${O} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${T}`)),O&&(this.firstSelection=U),U}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Bd={search:function(a,e){let t=0,i=a.length-1,s=null,l=null;for(;t<=i;){s=(t+i)/2|0,l=a[s];const o=e(l);if(o>0)t=s+1;else if(o<0)i=s-1;else return l}return null}};function PL(a,e,t){if(e===null||!Array.isArray(a)||!a.length||!fe(e))return null;const i=a[0].programDateTime;if(e<(i||0))return null;const s=a[a.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let l=0;l<a.length;++l){const o=a[l];if(UL(e,t,o))return o}return null}function ps(a,e,t=0,i=0,s=.005){let l=null;if(a){l=e[1+a.sn-e[0].sn]||null;const c=a.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),l&&a.level!==l.level&&l.end<=a.end&&(l=e[2+a.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(l=e[0]);if(l&&((!a||a.level===l.level)&&Up(t,i,l)===0||NL(l,a,Math.min(s,i))))return l;const o=Bd.search(e,Up.bind(null,t,i));return o&&(o!==a||!l)?o:l}function NL(a,e,t){if(e&&e.start===0&&e.level<a.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((s,l)=>(l[0]==="INF"&&(s+=parseFloat(l[1])),s),t);return a.start<=i}return!1}function Up(a=0,e=0,t){if(t.start<=a&&t.start+t.duration>a)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=a?1:t.start-i>a&&t.start?-1:0}function UL(a,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>a}function Hv(a,e){return Bd.search(a,t=>t.cc<e?1:t.cc>e?-1:0)}function BL(a,e,t){if(a&&a.startCC<=e&&a.endCC>=e){const i=t.start,s=t.end;let l=a.fragments;if(!t.relurl){const{fragmentHint:o}=a;o&&(l=l.concat(o))}return Bd.search(l,o=>o.cc<e||o.end<=i?1:o.cc>e||o.start>=s?-1:0)}return null}function jo(a){switch(a.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Bp(a,e){const t=jo(e);return a.default[`${t?"timeout":"error"}Retry`]}function Fd(a,e){const t=a.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*a.retryDelayMs,a.maxRetryDelayMs)}function Fp(a){return $e($e({},a),{errorRetry:null,timeoutRetry:null})}function Ho(a,e,t,i){if(!a)return!1;const s=i==null?void 0:i.code,l=e<a.maxNumRetry&&(FL(s)||!!t);return a.shouldRetry?a.shouldRetry(a,e,t,i,l):l}function FL(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}var Ct={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},pi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class $L extends fn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===me.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const s=this.hls,l=t.context;switch(t.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case z.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=ka();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ct.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o,c;const f=t.parent===me.MAIN?t.level:s.loadLevel;t.details===z.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(c=o.levelDetails)!=null&&c.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const f=s.loadLevelObj;if(f&&(l.type===we.AUDIO_TRACK&&f.hasAudioGroup(l.groupId)||l.type===we.SUBTITLE_TRACK&&f.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Ct.SendAlternateToPenaltyBox,t.errorAction.flags=pi.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const f=s.loadLevelObj,g=f==null?void 0:f.attrs["HDCP-LEVEL"];g?t.errorAction={action:Ct.SendAlternateToPenaltyBox,flags:pi.MoveAllAlternatesMatchingHDCP,hdcpLevel:g}:this.keySystemError(t)}return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!t.errorAction){var h;t.errorAction=this.getLevelSwitchAction(t,(h=t.level)!=null?h:s.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:t.errorAction=ka();return}t.type===pe.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,s=Bp(i.config.playlistLoadPolicy,e),l=this.playlistError++;if(Ho(s,l,jo(e),e.response))return{action:Ct.RetryRequest,flags:pi.None,retryConfig:s,retryCount:l};const c=this.getLevelSwitchAction(e,t);return s&&(c.retryConfig=s,c.retryCount=l),c}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),s=t.levels[i],{fragLoadPolicy:l,keyLoadPolicy:o}=t.config,c=Bp(e.details.startsWith("key")?o:l,e),h=t.levels.reduce((g,m)=>g+m.fragmentError,0);if(s&&(e.details!==z.FRAG_GAP&&s.fragmentError++,Ho(c,h,jo(e),e.response)))return{action:Ct.RetryRequest,flags:pi.None,retryConfig:c,retryCount:h};const f=this.getLevelSwitchAction(e,i);return c&&(f.retryConfig=c,f.retryCount=h),f}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const s=this.hls.levels[t];if(s){var l,o;const f=e.details;s.loadError++,f===z.BUFFER_APPEND_ERROR&&s.fragmentError++;let g=-1;const{levels:m,loadLevel:y,minAutoLevel:S,maxAutoLevel:E}=i;i.autoLevelEnabled||(i.loadLevel=-1);const x=(l=e.frag)==null?void 0:l.type,R=(x===me.AUDIO&&f===z.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===z.BUFFER_ADD_CODEC_ERROR||f===z.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:N})=>s.audioCodec!==N),A=e.sourceBufferName==="video"&&(f===z.BUFFER_ADD_CODEC_ERROR||f===z.BUFFER_APPEND_ERROR)&&m.some(({codecSet:N,audioCodec:M})=>s.codecSet!==N&&s.audioCodec===M),{type:O,groupId:I}=(o=e.context)!=null?o:{};for(let N=m.length;N--;){const M=(N+y)%m.length;if(M!==y&&M>=S&&M<=E&&m[M].loadError===0){var c,h;const F=m[M];if(f===z.FRAG_GAP&&x===me.MAIN&&e.frag){const H=m[M].details;if(H){const B=ps(e.frag,H.fragments,e.frag.start);if(B!=null&&B.gap)continue}}else{if(O===we.AUDIO_TRACK&&F.hasAudioGroup(I)||O===we.SUBTITLE_TRACK&&F.hasSubtitleGroup(I))continue;if(x===me.AUDIO&&(c=s.audioGroups)!=null&&c.some(H=>F.hasAudioGroup(H))||x===me.SUBTITLE&&(h=s.subtitleGroups)!=null&&h.some(H=>F.hasSubtitleGroup(H))||R&&s.audioCodec===F.audioCodec||!R&&s.audioCodec!==F.audioCodec||A&&s.codecSet===F.codecSet)continue}g=M;break}}if(g>-1&&i.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:Ct.SendAlternateToPenaltyBox,flags:pi.None,nextAutoLevel:g}}return{action:Ct.SendAlternateToPenaltyBox,flags:pi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case Ct.DoNothing:break;case Ct.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==z.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:s,hdcpLevel:l,nextAutoLevel:o}=i;switch(s){case pi.None:this.switchLevel(e,o);break;case pi.MoveAllAlternatesMatchingHDCP:l&&(t.maxHdcpLevel=ud[ud.indexOf(l)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===z.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Bv(e.mimeType),s=this.hls.levels;for(let l=s.length;l--;)s[l][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(l)}}}function ka(a){const e={action:Ct.DoNothing,flags:pi.None};return a&&(e.resolved=!0),e}var ht={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class GL{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let s=i.length;s--;){const l=i[s];if(!l)break;const o=l.end;if(l.start<=e&&o!==null&&e<=o)return l}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:s}=this,l=Object.keys(s);for(let o=l.length;o--;){const c=s[l[o]];if((c==null?void 0:c.body.type)===t&&(!i||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,i,s,l){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||l)){h.body.type===i&&this.removeFragment(h.body);return}const f=h.range[e];if(f){if(f.time.length===0){this.removeFragment(h.body);return}f.time.some(g=>{const m=!this.isTimeBuffered(g.startPTS,g.endPTS,t);return m&&this.removeFragment(h.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,s=lr(i),l=this.fragments[s];if(!l||l.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(c=>{const h=i.elementaryStreams[c];if(!h)return;const f=t[c],g=o||h.partial===!0;l.range[c]=this.getBufferedTimes(i,e.part,g,f)}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=i.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),uo(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=$p(i,s=>s.fragment.sn>=e))}fragBuffered(e,t){const i=lr(e);let s=this.fragments[i];!s&&t&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,i,s){const l={time:[],partial:i},o=e.start,c=e.end,h=e.minEndPTS||c,f=e.maxStartPTS||o;for(let g=0;g<s.length;g++){const m=s.start(g)-this.bufferPadding,y=s.end(g)+this.bufferPadding;if(f>=m&&h<=y){l.time.push({startPTS:Math.max(o,s.start(g)),endPTS:Math.min(c,s.end(g))});break}else if(o<y&&c>m){const S=Math.max(o,s.start(g)),E=Math.min(c,s.end(g));E>S&&(l.partial=!0,l.time.push({startPTS:S,endPTS:E}))}else if(c<=m)break}return l}getPartialFragment(e){let t=null,i,s,l,o=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(f=>{const g=h[f];g&&uo(g)&&(s=g.body.start-c,l=g.body.end+c,e>=s&&e<=l&&(i=Math.min(e-s,l-e),o<=i&&(t=g.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||uo(t))}getState(e){const t=lr(e),i=this.fragments[t];return i?i.buffered?uo(i)?ht.PARTIAL:ht.OK:ht.APPENDING:ht.NOT_LOADED}isTimeBuffered(e,t,i){let s,l;for(let o=0;o<i.length;o++){if(s=i.start(o)-this.bufferPadding,l=i.end(o)+this.bufferPadding,e>=s&&t<=l)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,s=t.part?null:t,l=lr(i);this.fragments[l]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:s,timeRanges:l,type:o}=t;if(i.sn==="initSegment")return;const c=i.type;if(s){let f=this.activePartLists[c];f||(this.activePartLists[c]=f=[]),f.push(s)}this.timeRanges=l;const h=l[o];this.detectEvictedFragments(o,h,c,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=lr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let s=i.length;s--;){const l=t[i[s]];if((l==null?void 0:l.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,s,l){s&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const c=this.fragments[o];if(!c)return;const h=c.body;h.type!==i||s&&!h.gap||h.start<t&&h.end>e&&(c.buffered||l)&&this.removeFragment(h)})}removeFragment(e){const t=lr(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=$p(i,l=>l.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(s=>s.clearElementaryStreamInfo())}}function uo(a){var e,t,i;return a.buffered&&(a.body.gap||((e=a.range.video)==null?void 0:e.partial)||((t=a.range.audio)==null?void 0:t.partial)||((i=a.range.audiovideo)==null?void 0:i.partial))}function lr(a){return`${a.type}_${a.level}_${a.sn}`}function $p(a,e){return a.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Gn={cbc:0,ctr:1};class jL{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Gn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Gn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function HL(a){const e=a.byteLength,t=e&&new DataView(a.buffer).getUint8(e-1);return t?a.slice(0,e-t):a}class VL{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=t.getUint32(s*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,s=i[0],l=i[1],o=i[2],c=i[3],h=this.invSubMix,f=h[0],g=h[1],m=h[2],y=h[3],S=new Uint32Array(256);let E=0,x=0,T=0;for(T=0;T<256;T++)T<128?S[T]=T<<1:S[T]=T<<1^283;for(T=0;T<256;T++){let R=x^x<<1^x<<2^x<<3^x<<4;R=R>>>8^R&255^99,e[E]=R,t[R]=E;const D=S[E],A=S[D],O=S[A];let I=S[R]*257^R*16843008;s[E]=I<<24|I>>>8,l[E]=I<<16|I>>>16,o[E]=I<<8|I>>>24,c[E]=I,I=O*16843009^A*65537^D*257^E*16843008,f[R]=I<<24|I>>>8,g[R]=I<<16|I>>>16,m[R]=I<<8|I>>>24,y[R]=I,E?(E=D^S[S[S[O^D]]],x^=S[S[x]]):E=x=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<t.length&&i;)i=t[s]===this.key[s],s++;if(i)return;this.key=t;const l=this.keySize=t.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let c,h;const f=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),m=this.sBox,y=this.rcon,S=this.invSubMix,E=S[0],x=S[1],T=S[2],R=S[3];let D,A;for(c=0;c<o;c++){if(c<l){D=f[c]=t[c];continue}A=D,c%l===0?(A=A<<8|A>>>24,A=m[A>>>24]<<24|m[A>>>16&255]<<16|m[A>>>8&255]<<8|m[A&255],A^=y[c/l|0]<<24):l>6&&c%l===4&&(A=m[A>>>24]<<24|m[A>>>16&255]<<16|m[A>>>8&255]<<8|m[A&255]),f[c]=D=(f[c-l]^A)>>>0}for(h=0;h<o;h++)c=o-h,h&3?A=f[c]:A=f[c-4],h<4||c<=4?g[h]=A:g[h]=E[m[A>>>24]]^x[m[A>>>16&255]]^T[m[A>>>8&255]]^R[m[A&255]],g[h]=g[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const s=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,c=this.invSubMix,h=c[0],f=c[1],g=c[2],m=c[3],y=this.uint8ArrayToUint32Array_(i);let S=y[0],E=y[1],x=y[2],T=y[3];const R=new Int32Array(e),D=new Int32Array(R.length);let A,O,I,N,M,F,H,B,ie,ae,ve,de,ue,U;const W=this.networkToHostOrderSwap;for(;t<R.length;){for(ie=W(R[t]),ae=W(R[t+1]),ve=W(R[t+2]),de=W(R[t+3]),M=ie^l[0],F=de^l[1],H=ve^l[2],B=ae^l[3],ue=4,U=1;U<s;U++)A=h[M>>>24]^f[F>>16&255]^g[H>>8&255]^m[B&255]^l[ue],O=h[F>>>24]^f[H>>16&255]^g[B>>8&255]^m[M&255]^l[ue+1],I=h[H>>>24]^f[B>>16&255]^g[M>>8&255]^m[F&255]^l[ue+2],N=h[B>>>24]^f[M>>16&255]^g[F>>8&255]^m[H&255]^l[ue+3],M=A,F=O,H=I,B=N,ue=ue+4;A=o[M>>>24]<<24^o[F>>16&255]<<16^o[H>>8&255]<<8^o[B&255]^l[ue],O=o[F>>>24]<<24^o[H>>16&255]<<16^o[B>>8&255]<<8^o[M&255]^l[ue+1],I=o[H>>>24]<<24^o[B>>16&255]<<16^o[M>>8&255]<<8^o[F&255]^l[ue+2],N=o[B>>>24]<<24^o[M>>16&255]<<16^o[F>>8&255]<<8^o[H&255]^l[ue+3],D[t]=W(A^S),D[t+1]=W(N^E),D[t+2]=W(I^x),D[t+3]=W(O^T),S=ie,E=ae,x=ve,T=de,t=t+4}return D.buffer}}class KL{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=zL(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function zL(a){switch(a){case Gn.cbc:return"AES-CBC";case Gn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${a}`)}}const qL=16;class $d{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?HL(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,s){return this.useSoftware?new Promise((l,o)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,i,s);const h=this.flush();h?l(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,s)}softwareDecrypt(e,t,i,s){const{currentIV:l,currentResult:o,remainderData:c}=this;if(s!==Gn.cbc||t.byteLength!==16)return Me.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=ui(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;l&&(i=l);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new VL),f.expandKey(t);const g=o;return this.currentResult=f.decrypt(h.buffer,0,i),this.currentIV=h.slice(-16).buffer,g||null}webCryptoDecrypt(e,t,i,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,s));this.key=t,this.fastAesKey=new KL(this.subtle,t,s)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new jL(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(Me.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,t,i,s)))}onWebCryptoError(e,t,i,s){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,s);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%qL;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Me.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Gp=Math.pow(2,17);class YL{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new nn({type:pe.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,l=s.fLoader,o=s.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(E=>E[0]==="GAP")){h(Hp(e));return}else e.gap=!1;const f=this.loader=l?new l(s):new o(s),g=jp(e);e.loader=f;const m=Fp(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Gp};e.stats=f.stats;const S={onSuccess:(E,x,T,R)=>{this.resetLoader(e,f);let D=E.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),c({frag:e,part:null,payload:D,networkDetails:R})},onError:(E,x,T,R)=>{this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:$e({url:i,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:T,stats:R}))},onAbort:(E,x,T)=>{this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:(E,x,T)=>{this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:T,stats:E}))}};t&&(S.onProgress=(E,x,T,R)=>t({frag:e,part:null,payload:T,networkDetails:R})),f.load(g,y,S)})}loadPart(e,t,i){this.abort();const s=this.config,l=s.fLoader,o=s.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Hp(e,t));return}const f=this.loader=l?new l(s):new o(s),g=jp(e,t);e.loader=f;const m=Fp(s.fragLoadPolicy.default),y={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Gp};t.stats=f.stats,f.load(g,y,{onSuccess:(S,E,x,T)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:S.data,networkDetails:T};i(R),c(R)},onError:(S,E,x,T)=>{this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:$e({url:g.url,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:x,stats:T}))},onAbort:(S,E,x)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:x,stats:S}))},onTimeout:(S,E,x)=>{this.resetLoader(e,f),h(new nn({type:pe.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:x,stats:S}))}})})}updateStatsFromPart(e,t){const i=e.stats,s=t.stats,l=s.total;if(i.loaded+=s.loaded,l){const h=Math.round(e.duration/t.duration),f=Math.min(Math.round(i.loaded/l),h),m=(h-f)*Math.round(i.loaded/f);i.total=i.loaded+m}else i.total=Math.max(i.loaded,i.total);const o=i.loading,c=s.loading;o.start?o.first+=c.first-c.start:(o.start=c.start,o.first=c.first),o.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function jp(a,e=null){const t=e||a,i={frag:a,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,l=t.byteRangeEndOffset;if(fe(s)&&fe(l)){var o;let c=s,h=l;if(a.sn==="initSegment"&&XL((o=a.decryptdata)==null?void 0:o.method)){const f=l-s;f%16&&(h=l+(16-f%16)),s!==0&&(i.resetIV=!0,c=s-16)}i.rangeStart=c,i.rangeEnd=h}return i}function Hp(a,e){const t=new Error(`GAP ${a.gap?"tag":"attribute"} found`),i={type:pe.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:a,error:t,networkDetails:null};return e&&(i.part=e),(e||a).stats.aborted=!0,new nn(i)}function XL(a){return a==="AES-128"||a==="AES-256"}class nn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Vv extends fn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Gd{constructor(e,t,i,s=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=co(),this.buffering={audio:co(),video:co(),audiovideo:co()},this.level=e,this.sn=t,this.id=i,this.size=s,this.part=l,this.partial=o}}function co(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Vp={length:0,start:()=>0,end:()=>0};class De{static isBuffered(e,t){if(e){const i=De.getBuffered(e);for(let s=i.length;s--;)if(t>=i.start(s)&&t<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=De.getBuffered(e);return De.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const s=De.bufferedRanges(e);if(s.length)return De.bufferedInfo(s,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((g,m)=>g.start-m.start||m.end-g.end);let s=-1,l=[];if(i)for(let g=0;g<e.length;g++){t>=e[g].start&&t<=e[g].end&&(s=g);const m=l.length;if(m){const y=l[m-1].end;e[g].start-y<i?e[g].end>y&&(l[m-1].end=e[g].end):l.push(e[g])}else l.push(e[g])}else l=e;let o=0,c,h=t,f=t;for(let g=0;g<l.length;g++){const m=l[g].start,y=l[g].end;if(s===-1&&t>=m&&t<=y&&(s=g),t+i>=m&&t<y)h=m,f=y,o=f-t;else if(t+i<m){c=m;break}}return{len:o,start:h||0,end:f||0,nextStart:c,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Vp}catch(t){return Me.log("failed to get media.buffered",t),Vp}}}const Kv=/\{\$([a-zA-Z0-9-_]+)\}/g;function Kp(a){return Kv.test(a)}function cd(a,e){if(a.variableList!==null||a.hasVariableRefs){const t=a.variableList;return e.replace(Kv,i=>{const s=i.substring(2,i.length-1),l=t==null?void 0:t[s];return l===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):l})}return e}function zp(a,e,t){let i=a.variableList;i||(a.variableList=i={});let s,l;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(s))l=o.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(o){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else s=e.NAME,l=e.VALUE;s in i?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=l||""}function QL(a,e,t){const i=e.IMPORT;if(t&&i in t){let s=a.variableList;s||(a.variableList=s={}),s[i]=t[i]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const WL=/^(\d+)x(\d+)$/,qp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class it{constructor(e,t){typeof e=="string"&&(e=it.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)i[s]=parseInt(t.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,l)=>(s[l.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=WL.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const s={},l='"';for(qp.lastIndex=0;(i=qp.exec(e))!==null;){const o=i[1].trim();let c=i[2];const h=c.indexOf(l)===0&&c.lastIndexOf(l)===c.length-1;let f=!1;if(h)c=c.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(t&&(h||f))c=cd(t,c);else if(!f&&!h)switch(o){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Me.warn(`${e}: attribute ${o} is missing quotes`)}s[o]=c}return s}}const ZL="com.apple.hls.interstitial";function JL(a){return a!=="ID"&&a!=="CLASS"&&a!=="CUE"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function e1(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}class zv{constructor(e,t,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:i,t){const l=t.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==l[o]){Me.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ke(new it({}),l,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);fe(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Me.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(fe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===ZL}get isValid(){return!!this.id&&!this._badValueForSameId&&fe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const t1=10;class i1{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?fe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||t1}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function fr(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function jd(a){switch(a){case"AES-128":case"AES-256":return Gn.cbc;case"AES-256-CTR":return Gn.ctr;default:throw new Error(`invalid full segment method ${a}`)}}function Hd(a){return Uint8Array.from(atob(a),e=>e.charCodeAt(0))}function fd(a){return Uint8Array.from(unescape(encodeURIComponent(a)),e=>e.charCodeAt(0))}function n1(a){const e=fd(a).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function s1(a){const e=function(i,s,l){const o=i[s];i[s]=i[l],i[l]=o};e(a,0,3),e(a,1,2),e(a,4,5),e(a,6,7)}function r1(a){const e=a.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const l=s[0]==="base64",o=s[1];l?(i.splice(-1,1),t=Hd(o)):t=n1(o)}}return t}const Vo=typeof self<"u"?self:void 0;var Ge={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},$t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function kf(a){switch(a){case $t.FAIRPLAY:return Ge.FAIRPLAY;case $t.PLAYREADY:return Ge.PLAYREADY;case $t.WIDEVINE:return Ge.WIDEVINE;case $t.CLEARKEY:return Ge.CLEARKEY}}var fo={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Mf(a){if(a===fo.WIDEVINE)return Ge.WIDEVINE;if(a===fo.PLAYREADY)return Ge.PLAYREADY;if(a===fo.CENC||a===fo.CLEARKEY)return Ge.CLEARKEY}function Pf(a){switch(a){case Ge.FAIRPLAY:return $t.FAIRPLAY;case Ge.PLAYREADY:return $t.PLAYREADY;case Ge.WIDEVINE:return $t.WIDEVINE;case Ge.CLEARKEY:return $t.CLEARKEY}}function ho(a){const{drmSystems:e,widevineLicenseUrl:t}=a,i=e?[Ge.FAIRPLAY,Ge.WIDEVINE,Ge.PLAYREADY,Ge.CLEARKEY].filter(s=>!!e[s]):[];return!i[Ge.WIDEVINE]&&t&&i.push(Ge.WIDEVINE),i}const qv=function(a){return Vo!=null&&(a=Vo.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function a1(a,e,t,i){let s;switch(a){case Ge.FAIRPLAY:s=["cenc","sinf"];break;case Ge.WIDEVINE:case Ge.PLAYREADY:s=["cenc"];break;case Ge.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return l1(s,e,t,i)}function l1(a,e,t,i){return[{initDataTypes:a,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function o1(a){var e;return a.sessionType==="persistent-license"||!!((e=a.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Yv(a){const e=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const c=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(c){const h=Hd(c).subarray(0,16);return s1(h),h}}return null}let go={};class Ma{static clearKeyUriToKeyIdMap(){go={}}constructor(e,t,i,s=[1],l=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=s,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!fr(e)}isSupported(){if(this.method){if(fr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case $t.FAIRPLAY:case $t.WIDEVINE:case $t.PLAYREADY:case $t.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(fr(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Me.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=u1(e);return new Ma(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=r1(this.uri);if(t)switch(this.keyFormat){case $t.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case $t.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=gL(i,null,t),this.keyId=Yv(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const s=new Uint8Array(16);s.set(i,16-i.length),i=s}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=go[this.uri];if(!i){const s=Object.keys(go).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,s),go[this.uri]=i}this.keyId=i}return this}}function u1(a){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=a>>8*(15-t)&255;return e}const Yp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Xp=/#EXT-X-MEDIA:(.*)/g,c1=/^#EXT(?:INF|-X-TARGETDURATION):/m,Nf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),f1=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ki{static findGroup(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===t)return s}}static resolve(e,t){return Pd.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return c1.test(e)}static parseMasterPlaylist(e,t){const i=Kp(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},l=[];Yp.lastIndex=0;let o;for(;(o=Yp.exec(e))!=null;)if(o[1]){var c;const f=new it(o[1],s),g=cd(s,o[2]),m={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:ki.resolve(g,t)},y=f.decimalResolution("RESOLUTION");y&&(m.width=y.width,m.height=y.height),Zp(f.CODECS,m);const S=f["SUPPLEMENTAL-CODECS"];S&&(m.supplemental={},Zp(S,m.supplemental)),(c=m.unknownCodecs)!=null&&c.length||l.push(m),s.levels.push(m)}else if(o[3]){const f=o[3],g=o[4];switch(f){case"SESSION-DATA":{const m=new it(g,s),y=m["DATA-ID"];y&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[y]=m);break}case"SESSION-KEY":{const m=Qp(g,t,s);m.encrypted&&m.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(m)):Me.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const m=new it(g,s);zp(s,m,t)}break}case"CONTENT-STEERING":{const m=new it(g,s);s.contentSteering={uri:ki.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Wp(g);break}}}const h=l.length>0&&l.length<s.levels.length;return s.levels=h?l:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,i){let s;const l={},o=i.levels,c={AUDIO:o.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:o.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Xp.lastIndex=0;(s=Xp.exec(e))!==null;){const f=new it(s[1],i),g=f.TYPE;if(g){const m=c[g],y=l[g]||[];l[g]=y;const S=f.LANGUAGE,E=f["ASSOC-LANGUAGE"],x=f.CHANNELS,T=f.CHARACTERISTICS,R=f["INSTREAM-ID"],D={attrs:f,bitrate:0,id:h++,groupId:f["GROUP-ID"]||"",name:f.NAME||S||"",type:g,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:S,url:f.URI?ki.resolve(f.URI,t):""};if(E&&(D.assocLang=E),x&&(D.channels=x),T&&(D.characteristics=T),R&&(D.instreamId=R),m!=null&&m.length){const A=ki.findGroup(m,D.groupId)||m[0];Jp(D,A,"audioCodec"),Jp(D,A,"textCodec")}y.push(D)}}return l}static parseLevelPlaylist(e,t,i,s,l,o){var c;const h={url:t},f=new i1(t),g=f.fragments,m=[];let y=null,S=0,E=0,x=0,T=0,R=0,D=null,A=new Cf(s,h),O,I,N,M=-1,F=!1,H=null,B;if(Nf.lastIndex=0,f.m3u8=e,f.hasVariableRefs=Kp(e),((c=Nf.exec(e))==null?void 0:c[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(O=Nf.exec(e))!==null;){F&&(F=!1,A=new Cf(s,h),A.playlistOffset=x,A.start=x,A.sn=S,A.cc=T,R&&(A.bitrate=R),A.level=i,y&&(A.initSegment=y,y.rawProgramDateTime&&(A.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),H&&(A.setByteRange(H),H=null)));const de=O[1];if(de){A.duration=parseFloat(de);const ue=(" "+O[2]).slice(1);A.title=ue||null,A.tagList.push(ue?["INF",de,ue]:["INF",de])}else if(O[3]){if(fe(A.duration)){A.playlistOffset=x,A.start=x,N&&ty(A,N,f),A.sn=S,A.level=i,A.cc=T,g.push(A);const ue=(" "+O[3]).slice(1);A.relurl=cd(f,ue),dd(A,D,m),D=A,x+=A.duration,S++,E=0,F=!0}}else{if(O=O[0].match(f1),!O){Me.warn("No matches on slow regex match for level playlist!");continue}for(I=1;I<O.length&&O[I]===void 0;I++);const ue=(" "+O[I]).slice(1),U=(" "+O[I+1]).slice(1),W=O[I+2]?(" "+O[I+2]).slice(1):null;switch(ue){case"BYTERANGE":D?A.setByteRange(U,D):A.setByteRange(U);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=U,A.tagList.push(["PROGRAM-DATE-TIME",U]),M===-1&&(M=g.length);break;case"PLAYLIST-TYPE":f.type&&en(f,ue,O),f.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?en(f,ue,O):g.length>0&&iy(f,ue,O),S=f.startSN=parseInt(U);break;case"SKIP":{f.skippedSegments&&en(f,ue,O);const re=new it(U,f),K=re.decimalInteger("SKIPPED-SEGMENTS");if(fe(K)){f.skippedSegments+=K;for(let Y=K;Y--;)g.push(null);S+=K}const w=re.enumeratedString("RECENTLY-REMOVED-DATERANGES");w&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(w.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&en(f,ue,O),f.targetduration=Math.max(parseInt(U),1);break;case"VERSION":f.version!==null&&en(f,ue,O),f.version=parseInt(U);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||en(f,ue,O),f.live=!1;break;case"#":(U||W)&&A.tagList.push(W?[U,W]:[U]);break;case"DISCONTINUITY":T++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([ue]);break;case"BITRATE":A.tagList.push([ue,U]),R=parseInt(U)*1e3,fe(R)?A.bitrate=R:R=0;break;case"DATERANGE":{const re=new it(U,f),K=new zv(re,f.dateRanges[re.ID],f.dateRangeTagCount);f.dateRangeTagCount++,K.isValid||f.skippedSegments?f.dateRanges[K.id]=K:Me.warn(`Ignoring invalid DATERANGE tag: "${U}"`),A.tagList.push(["EXT-X-DATERANGE",U]);break}case"DEFINE":{{const re=new it(U,f);"IMPORT"in re?QL(f,re,o):zp(f,re,t)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?en(f,ue,O):g.length>0&&iy(f,ue,O),f.startCC=T=parseInt(U);break;case"KEY":{const re=Qp(U,t,f);if(re.isSupported()){if(re.method==="NONE"){N=void 0;break}N||(N={}),N[re.keyFormat]&&(N=Ke({},N)),N[re.keyFormat]=re}else Me.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${U}"`);break}case"START":f.startTimeOffset=Wp(U);break;case"MAP":{const re=new it(U,f);if(A.duration){const K=new Cf(s,h);ey(K,re,i,N),y=K,A.initSegment=y,y.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=y.rawProgramDateTime)}else{const K=A.byteRangeEndOffset;if(K){const w=A.byteRangeStartOffset;H=`${K-w}@${w}`}else H=null;ey(A,re,i,N),y=A,F=!0}y.cc=T;break}case"SERVER-CONTROL":{B&&en(f,ue,O),B=new it(U),f.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),f.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&en(f,ue,O);const re=new it(U);f.partTarget=re.decimalFloatingPoint("PART-TARGET");break}case"PART":{let re=f.partList;re||(re=f.partList=[]);const K=E>0?re[re.length-1]:void 0,w=E++,Y=new it(U,f),J=new JR(Y,A,h,w,K);re.push(J),A.duration+=J.duration;break}case"PRELOAD-HINT":{const re=new it(U,f);f.preloadHint=re;break}case"RENDITION-REPORT":{const re=new it(U,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(re);break}default:Me.warn(`line parsed but not handled: ${O}`);break}}}D&&!D.relurl?(g.pop(),x-=D.duration,f.partList&&(f.fragmentHint=D)):f.partList&&(dd(A,D,m),A.cc=T,f.fragmentHint=A,N&&ty(A,N,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const ie=g.length,ae=g[0],ve=g[ie-1];if(x+=f.skippedSegments*f.targetduration,x>0&&ie&&ve){f.averagetargetduration=x/ie;const de=ve.sn;f.endSN=de!=="initSegment"?de:0,f.live||(ve.endList=!0),ae&&f.startCC===void 0&&(f.startCC=ae.cc),M>0&&(h1(g,M),ae&&m.unshift(ae))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(x+=f.fragmentHint.duration),f.totalduration=x,m.length&&f.dateRangeTagCount&&ae&&Xv(m,f),f.endCC=T,f}}function Xv(a,e){const t=a.length,i=a[t-1],s=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let o=l.length;o--;){const c=e.dateRanges[l[o]],h=c.startDate.getTime();c.tagAnchor=i.ref;for(let f=t;f--;){const g=d1(e,h,a,f,s);if(g!==-1){c.tagAnchor=e.fragments[g].ref;break}}}}function d1(a,e,t,i,s){const l=t[i];if(l){const c=l.programDateTime;if(e>=c||i===0){var o;const h=(((o=t[i+1])==null?void 0:o.start)||s)-l.start;if(e<=c+h*1e3){const f=t[i].sn-a.startSN,g=a.fragments;if(g.length>t.length){const y=(t[i+1]||g[g.length-1]).sn-a.startSN;for(let S=y;S>f;S--){const E=g[S].programDateTime;if(e>=E&&e<E+g[S].duration*1e3)return S}}return f}}}return-1}function Qp(a,e,t){var i,s;const l=new it(a,t),o=(i=l.METHOD)!=null?i:"",c=l.URI,h=l.hexadecimalInteger("IV"),f=l.KEYFORMATVERSIONS,g=(s=l.KEYFORMAT)!=null?s:"identity";c&&l.IV&&!h&&Me.error(`Invalid IV: ${l.IV}`);const m=c?ki.resolve(c,e):"",y=(f||"1").split("/").map(Number).filter(Number.isFinite);return new Ma(o,m,g,y,h)}function Wp(a){const t=new it(a).decimalFloatingPoint("TIME-OFFSET");return fe(t)?t:null}function Zp(a,e){let t=(a||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=t.filter(l=>Nv(l,i));s.length&&(e[`${i}Codec`]=s.map(l=>l.split("/")[0]).join(","),t=t.filter(l=>s.indexOf(l)===-1))}),e.unknownCodecs=t}function Jp(a,e,t){const i=e[t];i&&(a[t]=i)}function h1(a,e){let t=a[e];for(let i=e;i--;){const s=a[i];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function dd(a,e,t){a.rawProgramDateTime?t.push(a):e!=null&&e.programDateTime&&(a.programDateTime=e.endProgramDateTime)}function ey(a,e,t,i){a.relurl=e.URI,e.BYTERANGE&&a.setByteRange(e.BYTERANGE),a.level=t,a.sn="initSegment",i&&(a.levelkeys=i),a.initSegment=null}function ty(a,e,t){a.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(a)}function en(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function iy(a,e,t){a.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Uf(a,e){const t=e.startPTS;if(fe(t)){let i=0,s;e.sn>a.sn?(i=t-a.start,s=a):(i=a.start-t,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>a.sn?a.cc===e.cc&&a.minEndPTS?e.setStart(a.start+(a.minEndPTS-a.start)):e.setStart(a.start+a.duration):e.setStart(Math.max(a.start-e.duration,0))}function Qv(a,e,t,i,s,l){i-t<=0&&(Me.warn("Fragment should have a positive duration",e),i=t+e.duration,l=s+e.duration);let c=t,h=i;const f=e.startPTS,g=e.endPTS;if(fe(f)){const T=Math.abs(f-t);fe(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,c=Math.max(t,f),t=Math.min(t,f),s=Math.min(s,e.startDTS),h=Math.min(i,g),i=Math.max(i,g),l=Math.max(l,e.endDTS)}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=s,e.endPTS=i,e.minEndPTS=h,e.endDTS=l;const y=e.sn;if(!a||y<a.startSN||y>a.endSN)return 0;let S;const E=y-a.startSN,x=a.fragments;for(x[E]=e,S=E;S>0;S--)Uf(x[S],x[S-1]);for(S=E;S<x.length-1;S++)Uf(x[S],x[S+1]);return a.fragmentHint&&Uf(x[x.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,m}function g1(a,e){if(a===e)return;let t=null;const i=a.fragments;for(let h=i.length-1;h>=0;h--){const f=i[h].initSegment;if(f){t=f;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let s;y1(a,e,(h,f,g,m)=>{if(!e.startCC&&f.cc!==h.cc){var y,S;const E=h.cc-f.cc;for(let x=g;x<m.length;x++)m[x].cc+=E;e.startCC=(y=(S=Jv(a,e.startSN-1))==null?void 0:S.cc)!=null?y:m[0].cc,e.endCC=m[m.length-1].cc}fe(h.startPTS)&&fe(h.endPTS)&&(f.setStart(f.startPTS=h.startPTS),f.startDTS=h.startDTS,f.maxStartPTS=h.maxStartPTS,f.endPTS=h.endPTS,f.endDTS=h.endDTS,f.minEndPTS=h.minEndPTS,f.setDuration(h.endPTS-h.startPTS),f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(f.elementaryStreams=h.elementaryStreams),f.loader=h.loader,h.hasStats&&(f.stats=h.stats),h.initSegment&&(f.initSegment=h.initSegment,t=h.initSegment)});const l=e.fragments,o=e.fragmentHint?l.concat(e.fragmentHint):l;if(t&&o.forEach(h=>{var f;h&&(!h.initSegment||h.initSegment.relurl===((f=t)==null?void 0:f.relurl))&&(h.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=l.some(h=>!h),e.deltaUpdateFailed){Me.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)l.shift();e.startSN=l[0].sn}else{e.endCC=l[l.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=m1(a.dateRanges,e));const h=a.fragments.filter(f=>f.rawProgramDateTime);if(a.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<o.length;f++)o[f].programDateTime===null&&dd(o[f],o[f-1],h);Xv(h,e)}p1(a.partList,e.partList,(h,f)=>{f.elementaryStreams=h.elementaryStreams,f.stats=h.stats}),s?Qv(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Wv(a,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=a.driftStartTime,e.driftStart=a.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=a.driftEndTime,e.driftEnd=a.driftEnd,e.advancedDateTime=a.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=a.requestScheduled)}function m1(a,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,s=Ke({},a);i&&i.forEach(c=>{delete s[c]});const o=Object.keys(s).length;return o&&Object.keys(t).forEach(c=>{const h=s[c],f=new zv(t[c].attr,h);f.isValid?(s[c]=f,h||(f.tagOrder+=o)):Me.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Je(t[c].attr)}"`)}),s}function p1(a,e,t){if(a&&e){let i=0;for(let s=0,l=a.length;s<=l;s++){const o=a[s],c=e[s+i];o&&c&&o.index===c.index&&o.fragment.sn===c.fragment.sn?t(o,c):i--}}}function y1(a,e,t){const i=e.skippedSegments,s=Math.max(a.startSN,e.startSN)-e.startSN,l=(a.fragmentHint?1:0)+(i?e.endSN:Math.min(a.endSN,e.endSN))-e.startSN,o=e.startSN-a.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let f=s;f<=l;f++){const g=h[o+f];let m=c[f];if(i&&!m&&g&&(m=e.fragments[f]=g),g&&m){if(t(g,m,f,c),g.url&&g.url!==m.url){e.playlistParsingError=ny(`media sequence mismatch ${m.sn}:`,a,e,g,m);return}else if(g.cc!==m.cc){e.playlistParsingError=ny(`discontinuity sequence mismatch (${g.cc}!=${m.cc})`,a,e,g,m);return}}}}function ny(a,e,t,i,s){return new Error(`${a} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Wv(a,e,t=!0){const i=e.startSN+e.skippedSegments-a.startSN,s=a.fragments,l=i>=0;let o=0;if(l&&i<s.length)o=s[i].start;else if(l&&e.startSN===a.endSN+1)o=a.fragmentEnd;else if(l&&t)o=a.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=a.fragmentStart;else return;hd(e,o)}function hd(a,e){if(e){const t=a.fragments;for(let i=a.skippedSegments;i<t.length;i++)t[i].addStart(e);a.fragmentHint&&a.fragmentHint.addStart(e)}}function Zv(a,e=1/0){let t=1e3*a.targetduration;if(a.updated){const i=a.fragments;if(i.length&&t*4>e){const l=i[i.length-1].duration*1e3;l<t&&(t=l)}}else t/=2;return Math.round(t)}function Jv(a,e,t){if(!a)return null;let i=a.fragments[e-a.startSN];return i||(i=a.fragmentHint,i&&i.sn===e)?i:e<a.startSN&&t&&t.sn===e?t:null}function sy(a,e,t){return a?eE(a.partList,e,t):null}function eE(a,e,t){if(a)for(let i=a.length;i--;){const s=a[i];if(s.index===t&&s.fragment.sn===e)return s}return null}function tE(a){a.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function La(a,e){for(let i=0,s=a.length;i<s;i++){var t;if(((t=a[i])==null?void 0:t.cc)===e)return a[i]}return null}function v1(a,e){return!!(a&&e.startCC<a.endCC&&e.endCC>a.startCC)}function ry(a,e){if(a){const t=a.start+e;a.start=a.startPTS=t,a.endPTS=t+a.duration}}function iE(a,e){const t=e.fragments;for(let i=0,s=t.length;i<s;i++)ry(t[i],a);e.fragmentHint&&ry(e.fragmentHint,a),e.alignedSliding=!0}function E1(a,e){a&&(nE(e,a),!e.alignedSliding&&a&&Ko(e,a),!e.alignedSliding&&a&&!e.skippedSegments&&Wv(a,e,!1))}function nE(a,e){if(!v1(e,a))return;const t=Math.min(e.endCC,a.endCC),i=La(e.fragments,t),s=La(a.fragments,t);if(!i||!s)return;Me.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const l=i.start-s.start;iE(l,a)}function Ko(a,e){if(!a.hasProgramDateTime||!e.hasProgramDateTime)return;const t=a.fragments,i=e.fragments;if(!t.length||!i.length)return;let s,l;const o=Math.min(e.endCC,a.endCC);e.startCC<o&&a.startCC<o&&(s=La(i,o),l=La(t,o)),(!s||!l)&&(s=i[Math.floor(i.length/2)],l=La(t,s.cc)||t[Math.floor(t.length/2)]);const c=s.programDateTime,h=l.programDateTime;if(!c||!h)return;const f=(h-c)/1e3-(l.start-s.start);iE(f,a)}const S1={toString:function(a){let e="";const t=a.length;for(let i=0;i<t;i++)e+=`[${a.start(i).toFixed(3)}-${a.end(i).toFixed(3)}]`;return e}},te={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Vd extends Vv{constructor(e,t,i,s,l){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=te.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:c,media:h,mediaBuffer:f,state:g}=this,m=h?h.currentTime:0,y=De.bufferInfo(f||h,m,o.maxBufferHole);if(this.log(`media seeking to ${fe(m)?m.toFixed(3):m}, state: ${g}`),this.state===te.ENDED)this.resetLoadingState();else if(c){const S=o.maxFragLookUpTolerance,E=c.start-S,x=c.start+c.duration+S;if(!y.len||x<y.start||E>y.end){const T=m>x;(m<E||T)&&(T&&c.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(m>S&&(this.lastCurrentTime=m),!this.loadingParts){const E=Math.max(y.end,m),x=this.shouldLoadParts(this.getLevelDetails(),E);x&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=x)}}!this.hls.hasEnoughToStart&&!y.len&&(this.log(`setting startPosition to ${m} because of seek before start`),this.nextLoadPosition=this.startPosition=m),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new YL(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new $d(e.config)}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===te.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=te.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const l=e.nextStart;if(l&&l>s&&l<t.edge||this.media.currentTime<e.start)return!1;const c=t.partList;if(c!=null&&c.length){const f=c[c.length-1];return De.isBuffered(this.media,f.start+f.duration/2)}const h=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===te.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),s.removeEventListener("seeking",this.onMediaSeeking),s.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=te.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const s=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,t,i,s).then(l=>{if(!l)return;const o=this.state,c=l.frag;if(this.fragContextChanged(c)){(o===te.FRAG_LOADING||!this.fragCurrent&&o===te.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=te.IDLE);return}"payload"in l&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(b.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===te.STOPPED||this.state===te.ERROR||(this.warn(`Frag error: ${(l==null?void 0:l.message)||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===ht.APPENDING){const l=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),c=Math.max(e.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===ht.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:i};this.hls.trigger(b.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:l,payload:o}=i,c=l.decryptdata;if(o&&o.byteLength>0&&c!=null&&c.key&&c.iv&&fr(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),c.key.buffer,c.iv.buffer,jd(c.method)).catch(f=>{throw s.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:l}),f}).then(f=>{const g=self.performance.now();return s.trigger(b.FRAG_DECRYPTED,{frag:l,payload:f,stats:{tstart:h,tdecrypt:g}}),i.payload=f,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===te.STOPPED||this.state===te.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==te.STOPPED&&(this.state=te.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?S1.toString(De.getBuffered(i)):"(detached)"})`),Et(e)){var s;if(e.type!==me.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(c=>!!o[c])){this.state=te.IDLE;return}}const l=(s=this.levels)==null?void 0:s[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=te.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:s,partsLoaded:l}=e,o=!l||l.length===0||l.some(h=>!h),c=new Gd(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!o);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,s){var l;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let c=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=te.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(b.KEY_LOADED,m),this.state===te.KEY_LOADING&&(this.state=te.IDLE),m}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments);const h=this.fragPrevious;if(Et(e)&&(!h||e.sn!==h.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${e.sn}`),this.loadingParts=m)}if(i=Math.max(e.start,i||0),this.loadingParts&&Et(e)){const m=o.partList;if(m&&s){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);const y=this.getNextPart(m,e,i);if(y>-1){const S=m[y];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${y}/${m.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=te.FRAG_LOADING;let E;return c?E=c.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,S,t,s)).catch(x=>this.handleFragLoadError(x)):E=this.doFragPartsLoad(e,S,t,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:S,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(m,i))return Promise.resolve(null)}}if(Et(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),fe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=te.FRAG_LOADING;const f=this.config.progressive;let g;return f&&c?g=c.then(m=>!m||this.fragContextChanged(m==null?void 0:m.frag)?null:this.fragmentLoader.load(e,s)).catch(m=>this.handleFragLoadError(m)):g=Promise.all([this.fragmentLoader.load(e,f?s:void 0),c]).then(([m])=>(!f&&m&&s&&s(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,i,s){return new Promise((l,o)=>{var c;const h=[],f=(c=i.details)==null?void 0:c.partList,g=m=>{this.fragmentLoader.loadPart(e,m,s).then(y=>{h[m.index]=y;const S=y.part;this.hls.trigger(b.FRAG_LOADED,y);const E=sy(i.details,e.sn,m.index+1)||eE(f,e.sn,m.index+1);if(E)g(E);else return l({frag:e,part:S,partsLoaded:h})}).catch(o)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==te.PARSING){!this.fragCurrent&&this.state!==te.STOPPED&&this.state!==te.ERROR&&(this.state=te.IDLE);return}const{frag:i,part:s,level:l}=t,o=self.performance.now();i.stats.parsing.end=o,s&&(s.stats.parsing.end=o);const c=this.getLevelDetails(),f=c&&i.sn>c.endSN||this.shouldLoadParts(c,i.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(i,s,l,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const l=e.partList[0],o=l.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:s,sn:l,part:o}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const c=t[s],h=c.details,f=o>-1?sy(h,l,o):null,g=f?f.fragment:Jv(h,l,i);return g?(i&&i!==g&&(g.stats=i.stats),{frag:g,part:f,level:c}):null}bufferFragmentData(e,t,i,s,l){var o;if(!e||this.state!==te.PARSING)return;const{data1:c,data2:h}=e;let f=c;if(c&&h&&(f=ui(c,h)),!((o=f)!=null&&o.length))return;const g={type:e.type,frag:t,part:i,chunkMeta:s,parent:t.type,data:f};if(this.hls.trigger(b.BUFFER_APPENDING,g),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!De.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,s=De.bufferInfo(t,i,0),l=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),c=Math.max(Math.min(e.start-o,s.end-o),i+o);e.start-c>o&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var i;const s=this.getLoadPosition();if(!fe(s))return null;const o=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,o)}getFwdBufferInfoAtPos(e,t,i,s){const l=De.bufferInfo(e,t,s);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(l.nextStart<=o.end||o.gap)){const c=Math.max(Math.min(l.nextStart,o.end)-t,s);return De.bufferInfo(e,t,c)}}return l}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,s=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,s);return l>=s?(i.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,t=me.MAIN){var i;const s=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const i=t.fragments,s=i.length;if(!s)return null;const{config:l}=this,o=i[0].start,c=l.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const m=l.initialLiveManifestSize;if(s<m)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var f;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t,i);const y=this.hls.startPosition,S=this.hls.liveSyncPosition,E=h?(y!==-1&&y>=o?y:S)||h.start:e;this.log(`Setting startPosition to ${E} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${S} frag.start: ${(f=h)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=E}}else e<=o&&(h=i[0]);if(!h){const m=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,m,t)}let g=this.filterReplacedPrimary(h,t);if(!g&&h){const m=h.sn-t.startSN;g=this.filterReplacedPrimary(i[m+1]||null,t)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===ht.OK||i===ht.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,s,l){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(c!==null&&i.len+c.len>=l){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(ay(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ay(this.hls.config)&&e.type!==me.SUBTITLE){const i=this.hls.interstitialsManager,s=i==null?void 0:i.bufferingItem;if(s){const o=s.event;if(o){if(o.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const l=i==null?void 0:i.playerQueue;if(l)for(let o=l.length;o--;){const c=l[o].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let s=-1,l=!1,o=!0;for(let c=0,h=e.length;c<h;c++){const f=e[c];if(o=o&&!f.independent,s>-1&&i<f.start)break;const g=f.loaded;g?s=-1:(l||f.independent||o)&&f.fragment===t&&(s=c),l=g}return s}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=PL(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){const o=t[l-e.startSN];i.cc===o.cc&&(s=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=Hv(t,i.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(s=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,i){const{config:s}=this;let{fragPrevious:l}=this,{fragments:o,endSN:c}=i;const{fragmentHint:h}=i,{maxFragLookUpTolerance:f}=s,g=i.partList,m=!!(this.loadingParts&&g!=null&&g.length&&h);m&&h&&!this.bitrateTest&&g[g.length-1].fragment.sn===h.sn&&(o=o.concat(h),c=h.sn);let y;if(e<t){var S;const x=e<this.lastCurrentTime||e>t-f||(S=this.media)!=null&&S.paused||!this.startFragRequested?0:f;y=ps(l,o,e,x)}else y=o[o.length-1];if(y){const E=y.sn-i.startSN,x=this.fragmentTracker.getState(y);if((x===ht.OK||x===ht.PARTIAL&&y.gap)&&(l=y),l&&y.sn===l.sn&&(!m||g[0].fragment.sn>y.sn||!i.live&&!m)&&l&&y.level===l.level){const R=o[E+1];y.sn<c&&this.fragmentTracker.getState(R)!==ht.OK?y=R:y=null}}return y}alignPlaylists(e,t,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,o=!t,c=e.alignedSliding&&fe(l);if(o||!c&&!l){E1(i,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),h}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const s=this.timelineOffset;if(i===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:e.startTimeOffset;o!==null&&fe(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Et(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==te.FRAG_LOADING_WAITING_RETRY)&&(this.state=te.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const E=this.getCurrentContext(t.chunkMeta);E&&(t.frag=E.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const l=t.details===z.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction,{action:c,flags:h,retryCount:f=0,retryConfig:g}=o||{},m=!!o&&!!g,y=m&&c===Ct.RetryRequest,S=m&&!o.resolved&&h===pi.MoveAllAlternatesMatchingHost;if(!y&&S&&Et(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((y||S)&&f<g.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const E=Fd(g,f);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${E}ms`),o.resolved=!0,this.retryDate=self.performance.now()+E,this.state=te.FRAG_LOADING_WAITING_RETRY}else if(g&&o)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!l&&c!==Ct.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else c===Ct.SendAlternateToPenaltyBox?this.state=te.WAITING_LEVEL:this.state=te.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===te.PARSING||this.state===te.PARSED){const t=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),l=s&&s.len>.5;l&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===me.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==te.STOPPED&&(this.state=te.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const s=De.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,i),this.state===te.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==te.STOPPED&&(this.state=te.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,s){const l=i.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,f)=>{const g=e.elementaryStreams[f];if(g){const m=g.endPTS-g.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${m})`),h||!1;const y=s?0:Qv(l,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:l,level:i,drift:y,type:f,frag:e,start:g.startPTS,end:g.endPTS}),!0}return h},!1)){var c;if(i.fragmentError===0&&this.treatAsGap(e,i),((c=this.transmuxer)==null?void 0:c.error)===null){const h=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(h.message),this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:h,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=te.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===me.MAIN?"level":"track"}fragInfo(e,t=!0,i){var s,l;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=t&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ay(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}class sE{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=T1(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function T1(a,e){const t=new Uint8Array(e);let i=0;for(let s=0;s<a.length;s++){const l=a[s];t.set(l,i),i+=l.length}return t}var Bf={exports:{}},ly;function x1(){return ly||(ly=1,function(a){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(h,f,g){this.fn=h,this.context=f,this.once=g||!1}function l(h,f,g,m,y){if(typeof g!="function")throw new TypeError("The listener must be a function");var S=new s(g,m||h,y),E=t?t+f:f;return h._events[E]?h._events[E].fn?h._events[E]=[h._events[E],S]:h._events[E].push(S):(h._events[E]=S,h._eventsCount++),h}function o(h,f){--h._eventsCount===0?h._events=new i:delete h._events[f]}function c(){this._events=new i,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],g,m;if(this._eventsCount===0)return f;for(m in g=this._events)e.call(g,m)&&f.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},c.prototype.listeners=function(f){var g=t?t+f:f,m=this._events[g];if(!m)return[];if(m.fn)return[m.fn];for(var y=0,S=m.length,E=new Array(S);y<S;y++)E[y]=m[y].fn;return E},c.prototype.listenerCount=function(f){var g=t?t+f:f,m=this._events[g];return m?m.fn?1:m.length:0},c.prototype.emit=function(f,g,m,y,S,E){var x=t?t+f:f;if(!this._events[x])return!1;var T=this._events[x],R=arguments.length,D,A;if(T.fn){switch(T.once&&this.removeListener(f,T.fn,void 0,!0),R){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,g),!0;case 3:return T.fn.call(T.context,g,m),!0;case 4:return T.fn.call(T.context,g,m,y),!0;case 5:return T.fn.call(T.context,g,m,y,S),!0;case 6:return T.fn.call(T.context,g,m,y,S,E),!0}for(A=1,D=new Array(R-1);A<R;A++)D[A-1]=arguments[A];T.fn.apply(T.context,D)}else{var O=T.length,I;for(A=0;A<O;A++)switch(T[A].once&&this.removeListener(f,T[A].fn,void 0,!0),R){case 1:T[A].fn.call(T[A].context);break;case 2:T[A].fn.call(T[A].context,g);break;case 3:T[A].fn.call(T[A].context,g,m);break;case 4:T[A].fn.call(T[A].context,g,m,y);break;default:if(!D)for(I=1,D=new Array(R-1);I<R;I++)D[I-1]=arguments[I];T[A].fn.apply(T[A].context,D)}}return!0},c.prototype.on=function(f,g,m){return l(this,f,g,m,!1)},c.prototype.once=function(f,g,m){return l(this,f,g,m,!0)},c.prototype.removeListener=function(f,g,m,y){var S=t?t+f:f;if(!this._events[S])return this;if(!g)return o(this,S),this;var E=this._events[S];if(E.fn)E.fn===g&&(!y||E.once)&&(!m||E.context===m)&&o(this,S);else{for(var x=0,T=[],R=E.length;x<R;x++)(E[x].fn!==g||y&&!E[x].once||m&&E[x].context!==m)&&T.push(E[x]);T.length?this._events[S]=T.length===1?T[0]:T:o(this,S)}return this},c.prototype.removeAllListeners=function(f){var g;return f?(g=t?t+f:f,this._events[g]&&o(this,g)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c}(Bf)),Bf.exports}var b1=x1(),Kd=WR(b1);const Pa="1.6.2",mr={};function A1(){return typeof __HLS_WORKER_BUNDLE__=="function"}function R1(){const a=mr[Pa];if(a)return a.clientCount++,a;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return mr[Pa]=s,s}function L1(a){const e=mr[a];if(e)return e.clientCount++,e;const t=new self.URL(a,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return mr[a]=s,s}function _1(a){const e=mr[a||Pa];if(e&&e.clientCount--===1){const{worker:i,objectURL:s}=e;delete mr[a||Pa],s&&self.URL.revokeObjectURL(s),i.terminate()}}function rE(a,e){return e+10<=a.length&&a[e]===51&&a[e+1]===68&&a[e+2]===73&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function zd(a,e){return e+10<=a.length&&a[e]===73&&a[e+1]===68&&a[e+2]===51&&a[e+3]<255&&a[e+4]<255&&a[e+6]<128&&a[e+7]<128&&a[e+8]<128&&a[e+9]<128}function nu(a,e){let t=0;return t=(a[e]&127)<<21,t|=(a[e+1]&127)<<14,t|=(a[e+2]&127)<<7,t|=a[e+3]&127,t}function Na(a,e){const t=e;let i=0;for(;zd(a,e);){i+=10;const s=nu(a,e+6);i+=s,rE(a,e+10)&&(i+=10),e+=i}if(i>0)return a.subarray(t,t+i)}function D1(a,e,t,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[t+2],o=l>>2&15;if(o>12){const S=new Error(`invalid ADTS sampling index:${o}`);a.emit(b.ERROR,b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:S,reason:S.message});return}const c=(l>>6&3)+1,h=e[t+3]>>6&3|(l&1)<<2,f="mp4a.40."+c,g=s[o];let m=o;(c===5||c===29)&&(m-=3);const y=[c<<3|(m&14)>>1,(m&1)<<7|h<<3];return Me.log(`manifest codec:${i}, parsed codec:${f}, channels:${h}, rate:${g} (ADTS object type:${c} sampling index:${o})`),{config:y,samplerate:g,channelCount:h,codec:f,parsedCodec:f,manifestCodec:i}}function aE(a,e){return a[e]===255&&(a[e+1]&246)===240}function lE(a,e){return a[e+1]&1?7:9}function qd(a,e){return(a[e+3]&3)<<11|a[e+4]<<3|(a[e+5]&224)>>>5}function C1(a,e){return e+5<a.length}function zo(a,e){return e+1<a.length&&aE(a,e)}function I1(a,e){return C1(a,e)&&aE(a,e)&&qd(a,e)<=a.length-e}function w1(a,e){if(zo(a,e)){const t=lE(a,e);if(e+t>=a.length)return!1;const i=qd(a,e);if(i<=t)return!1;const s=e+i;return s===a.length||zo(a,s)}return!1}function oE(a,e,t,i,s){if(!a.samplerate){const l=D1(e,t,i,s);if(!l)return;Ke(a,l)}}function uE(a){return 1024*9e4/a}function O1(a,e){const t=lE(a,e);if(e+t<=a.length){const i=qd(a,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function cE(a,e,t,i,s){const l=uE(a.samplerate),o=i+s*l,c=O1(e,t);let h;if(c){const{frameLength:m,headerLength:y}=c,S=y+m,E=Math.max(0,t+S-e.length);E?(h=new Uint8Array(S-y),h.set(e.subarray(t+y,e.length),0)):h=e.subarray(t+y,t+S);const x={unit:h,pts:o};return E||a.samples.push(x),{sample:x,length:S,missing:E}}const f=e.length-t;return h=new Uint8Array(f),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:o},length:f,missing:-1}}function k1(a,e){return zd(a,e)&&nu(a,e+6)+10<=a.length-e}function M1(a){if(a.size<2)return;const e=Wt(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}}function P1(a){if(a.size<2)return;if(a.type==="TXXX"){let t=1;const i=Wt(a.data.subarray(t),!0);t+=i.length+1;const s=Wt(a.data.subarray(t));return{key:a.type,info:i,data:s}}const e=Wt(a.data.subarray(1));return{key:a.type,info:"",data:e}}function N1(a){if(a.type==="WXXX"){if(a.size<2)return;let t=1;const i=Wt(a.data.subarray(t),!0);t+=i.length+1;const s=Wt(a.data.subarray(t));return{key:a.type,info:i,data:s}}const e=Wt(a.data);return{key:a.type,info:"",data:e}}function U1(a){return btoa(String.fromCharCode(...a))}function fE(a,e){if(a<0)return-fE(-a,e);const t=Math.pow(10,e);if(Math.abs(a*t%1-.5)<Number.EPSILON){const s=Math.floor(a*t);return(s%2===0?s:s+1)/t}else return Math.round(a*t)/t}function B1(a,e){const t=new URL(a),i=new URL(e);if(t.origin!==i.origin)return a;const s=t.pathname.split("/").slice(1),l=i.pathname.split("/").slice(1,-1);for(;s[0]===l[0];)s.shift(),l.shift();for(;l.length;)l.shift(),s.unshift("..");return s.join("/")}function F1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const l=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?l:l&3|8).toString(16)})}}}function $1(a){return a instanceof ArrayBuffer?a:a.byteOffset==0&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer}function Ff(a,e=0,t=1/0){return G1(a,e,t,Uint8Array)}function G1(a,e,t,i){const s=j1(a);let l=1;"BYTES_PER_ELEMENT"in i&&(l=i.BYTES_PER_ELEMENT);const o=H1(a)?a.byteOffset:0,c=(o+a.byteLength)/l,h=(o+e)/l,f=Math.floor(Math.max(0,Math.min(h,c))),g=Math.floor(Math.min(f+Math.max(t,0),c));return new i(s,f,g-f)}function j1(a){return a instanceof ArrayBuffer?a:a.buffer}function H1(a){return a&&a.buffer instanceof ArrayBuffer&&a.byteLength!==void 0&&a.byteOffset!==void 0}function V1(a){const e={key:a.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(a.size<2)return;if(a.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=a.data.subarray(1).indexOf(0);if(i===-1)return;const s=Wt(Ff(a.data,1,i)),l=a.data[2+i],o=a.data.subarray(3+i).indexOf(0);if(o===-1)return;const c=Wt(Ff(a.data,3+i,o));let h;return s==="-->"?h=Wt(Ff(a.data,4+i+o)):h=$1(a.data.subarray(4+i+o)),e.mimeType=s,e.pictureType=l,e.description=c,e.data=h,e}function K1(a){return a.type==="PRIV"?M1(a):a.type[0]==="W"?N1(a):a.type==="APIC"?V1(a):P1(a)}function z1(a){const e=String.fromCharCode(a[0],a[1],a[2],a[3]),t=nu(a,4),i=10;return{type:e,size:t,data:a.subarray(i,i+t)}}const mo=10,q1=10;function dE(a){let e=0;const t=[];for(;zd(a,e);){const i=nu(a,e+6);a[e+5]>>6&1&&(e+=mo),e+=mo;const s=e+i;for(;e+q1<s;){const l=z1(a.subarray(e)),o=K1(l);o&&t.push(o),e+=l.size+mo}rE(a,e)&&(e+=mo)}return t}function hE(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function Y1(a){if(a.data.byteLength===8){const e=new Uint8Array(a.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Yd(a){const e=dE(a);for(let t=0;t<e.length;t++){const i=e[t];if(hE(i))return Y1(i)}}let Xt=function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a}({});function wi(a="",e=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Xd{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=ui(this.cachedData,e),this.cachedData=null);let i=Na(e,0),s=i?i.length:0,l;const o=this._audioTrack,c=this._id3Track,h=i?Yd(i):void 0,f=e.length;for((this.basePTS===null||this.frameIndex===0&&fe(h))&&(this.basePTS=X1(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY});s<f;){if(this.canParse(e,s)){const g=this.appendFrame(o,e,s);g?(this.frameIndex++,this.lastPTS=g.sample.pts,s+=g.length,l=s):s=f}else k1(e,s)?(i=Na(e,s),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,l=s):s++;if(s===f&&l!==f){const g=e.slice(l);this.cachedData?this.cachedData=ui(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:wi(),id3Track:c,textTrack:wi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:wi(),id3Track:this._id3Track,textTrack:wi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const X1=(a,e,t)=>{if(fe(a))return a*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let po=null;const Q1=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],W1=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Z1=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],J1=[0,1,1,4];function gE(a,e,t,i,s){if(t+24>e.length)return;const l=mE(e,t);if(l&&t+l.frameLength<=e.length){const o=l.samplesPerFrame*9e4/l.sampleRate,c=i+s*o,h={unit:e.subarray(t,t+l.frameLength),pts:c,dts:c};return a.config=[],a.channelCount=l.channelCount,a.samplerate=l.sampleRate,a.samples.push(h),{sample:h,length:l.frameLength,missing:0}}}function mE(a,e){const t=a[e+1]>>3&3,i=a[e+1]>>1&3,s=a[e+2]>>4&15,l=a[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&l!==3){const o=a[e+2]>>1&1,c=a[e+3]>>6,h=t===3?3-i:i===3?3:4,f=Q1[h*14+s-1]*1e3,m=W1[(t===3?0:t===2?1:2)*3+l],y=c===3?1:2,S=Z1[t][i],E=J1[i],x=S*8*E,T=Math.floor(S*f/m+o)*E;if(po===null){const A=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);po=A?parseInt(A[1]):0}return!!po&&po<=87&&i===2&&f>=224e3&&c===0&&(a[e+3]=a[e+3]|128),{sampleRate:m,channelCount:y,frameLength:T,samplesPerFrame:x}}}function Qd(a,e){return a[e]===255&&(a[e+1]&224)===224&&(a[e+1]&6)!==0}function pE(a,e){return e+1<a.length&&Qd(a,e)}function e_(a,e){return Qd(a,e)&&4<=a.length-e}function yE(a,e){if(e+1<a.length&&Qd(a,e)){const i=mE(a,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const l=e+s;return l===a.length||pE(a,l)}return!1}class t_ extends Xd{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Na(e,0);let s=(i==null?void 0:i.length)||0;if(yE(e,s))return!1;for(let l=e.length;s<l;s++)if(w1(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return I1(e,t)}appendFrame(e,t,i){oE(e,this.observer,t,i,e.manifestCodec);const s=cE(e,t,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const vE=(a,e)=>{let t=0,i=5;e+=i;const s=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=a[e];const c=Math.min(i,8),h=8-c;l[0]=4278190080>>>24+h<<h,s[0]=(o[0]&l[0])>>h,t=t?t<<c|s[0]:s[0],e+=1,i-=c}return t};class i_ extends Xd{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const s=EE(e,t,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Na(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Yd(t)!==void 0&&vE(e,i)<16}}function EE(a,e,t,i,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const l=e[t+4]>>6;if(l>=3)return-1;const c=[48e3,44100,32e3][l],h=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+l]*2;if(t+g>e.length)return-1;const m=e[t+6]>>5;let y=0;m===2?y+=2:(m&1&&m!==1&&(y+=2),m&4&&(y+=2));const S=(e[t+6]<<8|e[t+7])>>12-y&1,x=[2,1,2,3,3,4,4,5][m]+S,T=e[t+5]>>3,R=e[t+5]&7,D=new Uint8Array([l<<6|T<<1|R>>2,(R&3)<<6|m<<3|S<<2|h>>4,h<<4&224]),A=1536/c*9e4,O=i+s*A,I=e.subarray(t,t+g);return a.config=D,a.channelCount=x,a.samplerate=c,a.samples.push({unit:I,pts:O}),g}class n_ extends Xd{resetInitSegment(e,t,i,s){super.resetInitSegment(e,t,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Na(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&Yd(t)!==void 0&&vE(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(yE(e,i))return Me.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return e_(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return gE(e,t,i,this.basePTS,this.frameIndex)}}const s_=/\/emsg[-/]ID3/i;class r_{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,s){const l=this.videoTrack=wi("video",1),o=this.audioTrack=wi("audio",1),c=this.txtTrack=wi("text",1);if(this.id3Track=wi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=Ov(e);if(h.video){const{id:f,timescale:g,codec:m,supplemental:y}=h.video;l.id=f,l.timescale=c.timescale=g,l.codec=m,l.supplemental=y}if(h.audio){const{id:f,timescale:g,codec:m}=h.audio;o.id=f,o.timescale=g,o.codec=m}c.id=Cv.text,l.sampleDuration=0,l.duration=o.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return iL(e)}demux(e,t){this.timeOffset=t;let i=e;const s=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=ui(this.remainderData,e));const c=cL(i);this.remainderData=c.remainder,s.samples=c.valid||new Uint8Array}else s.samples=i;const o=this.extractID3Track(s,t);return l.samples=Dp(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return i.samples=Dp(e,t),{videoTrack:t,audioTrack:wi(),id3Track:s,textTrack:wi()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const s=Re(e.samples,["emsg"]);s&&s.forEach(l=>{const o=dL(l);if(s_.test(o.schemeIdUri)){const c=oy(o,t);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const f=o.payload;i.samples.push({data:f,len:f.byteLength,dts:c,pts:c,type:Xt.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=oy(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:c,pts:c,type:Xt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function oy(a,e){return fe(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale}class a_{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new $d(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Gn.cbc)}decryptAacSample(e,t,i){const s=e[t].unit;if(s.length<=16)return;const l=s.subarray(16,s.length-s.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(c=>{const h=new Uint8Array(c);s.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let s=0;for(let l=32;l<e.length-16;l+=160,s+=16)i.set(e.subarray(l,l+16),s);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let s=0;for(let l=32;l<e.length-16;l+=160,s+=16)e.set(i.subarray(s,s+16),l);return e}decryptAvcSample(e,t,i,s,l){const o=Mv(l.data),c=this.getAvcEncryptedData(o);this.decryptBuffer(c.buffer).then(h=>{l.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,s)})}decryptAvcSamples(e,t,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){s();return}const l=e[t].units;for(;!(i>=l.length);i++){const o=l[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,s,o),!this.decrypter.isSync()))return}}}}class SE{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const l=i.units;s=l[l.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,s=i.length;if(s){const l=i[s-1];e.pts=l.pts,e.dts=l.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const s=t.byteLength;let l=e.naluState||0;const o=l,c=[];let h=0,f,g,m,y=-1,S=0;for(l===-1&&(y=0,S=this.getNALuType(t,0),l=0,h=1);h<s;){if(f=t[h++],!l){l=f?0:1;continue}if(l===1){l=f?0:2;continue}if(!f)l=3;else if(f===1){if(g=h-l-1,y>=0){const E={data:t.subarray(y,g),type:S};c.push(E)}else{const E=this.getLastNalUnit(e.samples);E&&(o&&h<=4-o&&E.state&&(E.data=E.data.subarray(0,E.data.byteLength-o)),g>0&&(E.data=ui(E.data,t.subarray(0,g)),E.state=0))}h<s?(m=this.getNALuType(t,h),y=h,S=m,l=0):l=-1}else l=0}if(y>=0&&l>=0){const E={data:t.subarray(y,s),type:S,state:l};c.push(E)}if(c.length===0){const E=this.getLastNalUnit(e.samples);E&&(E.data=ui(E.data,t))}return e.naluState=l,c}}class _a{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,s=new Uint8Array(4),l=Math.min(4,t);if(l===0)throw new Error("no bytes available");s.set(e.subarray(i,i+l)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Me.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class uy extends SE{parsePES(e,t,i,s){const l=this.parseNALu(e,i.data,s);let o=this.VideoSample,c,h=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var g,m;switch(f.type){case 1:{let x=!1;c=!0;const T=f.data;if(h&&T.length>4){const R=this.readSliceType(T);(R===2||R===4||R===7||R===9)&&(x=!0)}if(x){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=x;break}case 5:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{c=!0,Ud(f.data,1,i.pts,t.samples);break}case 7:{var S,E;c=!0,h=!0;const x=f.data,T=this.readSPS(x);if(!e.sps||e.width!==T.width||e.height!==T.height||((S=e.pixelRatio)==null?void 0:S[0])!==T.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[x];const R=x.subarray(1,4);let D="avc1.";for(let A=0;A<3;A++){let O=R[A].toString(16);O.length<2&&(O="0"+O),D+=O}e.codec=D}break}case 8:c=!0,e.pps=[f.data];break;case 9:c=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:c=!0;break;default:c=!1;break}o&&c&&o.units.push(f)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new _a(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,s=8,l;for(let o=0;o<e;o++)s!==0&&(l=t.readEG(),s=(i+l+256)%256),i=s===0?i:s}readSPS(e){const t=new _a(e);let i=0,s=0,l=0,o=0,c,h,f;const g=t.readUByte.bind(t),m=t.readBits.bind(t),y=t.readUEG.bind(t),S=t.readBoolean.bind(t),E=t.skipBits.bind(t),x=t.skipEG.bind(t),T=t.skipUEG.bind(t),R=this.skipScalingList.bind(this);g();const D=g();if(m(5),E(3),g(),T(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){const F=y();if(F===3&&E(1),T(),T(),E(1),S())for(h=F!==3?8:12,f=0;f<h;f++)S()&&(f<6?R(16,t):R(64,t))}T();const A=y();if(A===0)y();else if(A===1)for(E(1),x(),x(),c=y(),f=0;f<c;f++)x();T(),E(1);const O=y(),I=y(),N=m(1);N===0&&E(1),E(1),S()&&(i=y(),s=y(),l=y(),o=y());let M=[1,1];if(S()&&S())switch(g()){case 1:M=[1,1];break;case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:{M=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((O+1)*16-i*2-s*2),height:(2-N)*(I+1)*16-(N?2:4)*(l+o),pixelRatio:M}}}class cy extends SE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,s){const l=this.parseNALu(e,i.data,s);let o=this.VideoSample,c,h=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var g,m;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var y;(y=o)!=null&&y.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:c=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:c=!0,Ud(f.data,2,i.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(f.data)),this.initVPS=f.data),e.vps=[f.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],f.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const S=this.readSPS(f.data);e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.codec=S.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const E in S.params)e.params[E]=S.params[E]}this.pushParameterSet(e.sps,f.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const S=this.readPPS(f.data);for(const E in S)e.params[E]=S[E]}this.pushParameterSet(e.pps,f.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(m=o)!=null&&m.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:c=!1;break}o&&c&&o.units.push(f)}),s&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[i]=e[s],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new _a(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){const t=new _a(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const s=t.readBits(2),l=t.readBoolean(),o=t.readBits(5),c=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=t.readUByte(),S=t.readUByte(),E=t.readUByte(),x=t.readUByte(),T=t.readUByte(),R=t.readUByte(),D=[],A=[];for(let Pe=0;Pe<i;Pe++)D.push(t.readBoolean()),A.push(t.readBoolean());if(i>0)for(let Pe=i;Pe<8;Pe++)t.readBits(2);for(let Pe=0;Pe<i;Pe++)D[Pe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),A[Pe]&&t.readUByte();t.readUEG();const O=t.readUEG();O==3&&t.skipBits(1);const I=t.readUEG(),N=t.readUEG(),M=t.readBoolean();let F=0,H=0,B=0,ie=0;M&&(F+=t.readUEG(),H+=t.readUEG(),B+=t.readUEG(),ie+=t.readUEG());const ae=t.readUEG(),ve=t.readUEG(),de=t.readUEG(),ue=t.readBoolean();for(let Pe=ue?0:i;Pe<=i;Pe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Xe=0;Xe<4;Xe++)for(let Ot=0;Ot<(Xe===3?2:6);Ot++)if(!t.readBoolean())t.readUEG();else{const kt=Math.min(64,1<<4+(Xe<<1));Xe>1&&t.readEG();for(let ci=0;ci<kt;ci++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const re=t.readUEG();let K=0;for(let Pe=0;Pe<re;Pe++){let Xe=!1;if(Pe!==0&&(Xe=t.readBoolean()),Xe){Pe===re&&t.readUEG(),t.readBoolean(),t.readUEG();let Ot=0;for(let Si=0;Si<=K;Si++){const kt=t.readBoolean();let ci=!1;kt||(ci=t.readBoolean()),(kt||ci)&&Ot++}K=Ot}else{const Ot=t.readUEG(),Si=t.readUEG();K=Ot+Si;for(let kt=0;kt<Ot;kt++)t.readUEG(),t.readBoolean();for(let kt=0;kt<Si;kt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Pe=t.readUEG();for(let Xe=0;Xe<Pe;Xe++){for(let Ot=0;Ot<de+4;Ot++)t.readBits(1);t.readBits(1)}}let Y=0,J=1,ne=1,oe=!0,he=1,ce=0;t.readBoolean(),t.readBoolean();let xe=!1;if(t.readBoolean()){if(t.readBoolean()){const Bi=t.readUByte(),xr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Ss=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Bi>0&&Bi<16?(J=xr[Bi-1],ne=Ss[Bi-1]):Bi===255&&(J=t.readBits(16),ne=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),xe=t.readBoolean(),xe&&(F+=t.readUEG(),H+=t.readUEG(),B+=t.readUEG(),ie+=t.readUEG()),t.readBoolean()&&(he=t.readBits(32),ce=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Ss=t.readBoolean(),Va=t.readBoolean();let fi=!1;(Ss||Va)&&(fi=t.readBoolean(),fi&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),fi&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let bt=0;bt<=i;bt++){oe=t.readBoolean();const Ti=oe||t.readBoolean();let At=!1;Ti?t.readEG():At=t.readBoolean();const Ka=At?1:t.readUEG()+1;if(Ss)for(let Kn=0;Kn<Ka;Kn++)t.readUEG(),t.readUEG(),fi&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Va)for(let Kn=0;Kn<Ka;Kn++)t.readUEG(),t.readUEG(),fi&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Y=t.readUEG())}let et=I,Ui=N;if(M||xe){let Pe=1,Xe=1;O===1?Pe=Xe=2:O==2&&(Pe=2),et=I-Pe*H-Pe*F,Ui=N-Xe*ie-Xe*B}const Es=s?["A","B","C"][s]:"",Tr=c<<24|h<<16|f<<8|g;let Hn=0;for(let Pe=0;Pe<32;Pe++)Hn=(Hn|(Tr>>Pe&1)<<31-Pe)>>>0;let Vn=Hn.toString(16);return o===1&&Vn==="2"&&(Vn="6"),{codecString:`hvc1.${Es}${o}.${Vn}.${l?"H":"L"}${R}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:s,general_profile_compatibility_flags:[c,h,f,g],general_constraint_indicator_flags:[m,y,S,E,x,T],general_level_idc:R,bit_depth:ae+8,bit_depth_luma_minus8:ae,bit_depth_chroma_minus8:ve,min_spatial_segmentation_idc:Y,chroma_format_idc:O,frame_rate:{fixed:oe,fps:ce/he}},width:et,height:Ui,pixelRatio:[J,ne]}}readPPS(e){const t=new _a(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),l=t.readBoolean();let o=1;return l&&s?o=0:l?o=3:s&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const vt=188;class Fn{constructor(e,t,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,t){const i=Fn.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(vt*5,t-vt)+1,s=0;for(;s<i;){let l=!1,o=-1,c=0;for(let h=s;h<t;h+=vt)if(e[h]===71&&(t-h===vt||e[h+vt]===71)){if(c++,o===-1&&(o=h,o!==0&&(i=Math.min(o+vt*99,e.length-vt)+1)),l||(l=gd(e,h)===0),l&&c>1&&(o===0&&c>2||h+vt>i))return o}else{if(c)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Cv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Fn.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Fn.createTrack("audio",s),this._id3Track=Fn.createTrack("id3"),this._txtTrack=Fn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,s=!1){i||(this.sampleAes=null);let l;const o=this._videoTrack,c=this._audioTrack,h=this._id3Track,f=this._txtTrack;let g=o.pid,m=o.pesData,y=c.pid,S=h.pid,E=c.pesData,x=h.pesData,T=null,R=this.pmtParsed,D=this._pmtId,A=e.length;if(this.remainderData&&(e=ui(this.remainderData,e),A=e.length,this.remainderData=null),A<vt&&!s)return this.remainderData=e,{audioTrack:c,videoTrack:o,id3Track:h,textTrack:f};const O=Math.max(0,Fn.syncOffset(e));A-=(A-O)%vt,A<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,A,e.buffer.byteLength-A));let I=0;for(let M=O;M<A;M+=vt)if(e[M]===71){const F=!!(e[M+1]&64),H=gd(e,M),B=(e[M+3]&48)>>4;let ie;if(B>1){if(ie=M+5+e[M+4],ie===M+vt)continue}else ie=M+4;switch(H){case g:if(F){if(m&&(l=or(m,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new uy;break;case"hevc":this.videoParser=new cy;break}this.videoParser!==null&&this.videoParser.parsePES(o,f,l,!1)}m={data:[],size:0}}m&&(m.data.push(e.subarray(ie,M+vt)),m.size+=M+vt-ie);break;case y:if(F){if(E&&(l=or(E,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,l);break;case"mp3":this.parseMPEGPES(c,l);break;case"ac3":this.parseAC3PES(c,l);break}E={data:[],size:0}}E&&(E.data.push(e.subarray(ie,M+vt)),E.size+=M+vt-ie);break;case S:F&&(x&&(l=or(x,this.logger))&&this.parseID3PES(h,l),x={data:[],size:0}),x&&(x.data.push(e.subarray(ie,M+vt)),x.size+=M+vt-ie);break;case 0:F&&(ie+=e[ie]+1),D=this._pmtId=l_(e,ie);break;case D:{F&&(ie+=e[ie]+1);const ae=o_(e,ie,this.typeSupported,i,this.observer,this.logger);g=ae.videoPid,g>0&&(o.pid=g,o.segmentCodec=ae.segmentVideoCodec),y=ae.audioPid,y>0&&(c.pid=y,c.segmentCodec=ae.segmentAudioCodec),S=ae.id3Pid,S>0&&(h.pid=S),T!==null&&!R&&(this.logger.warn(`MPEG-TS PMT found at ${M} after unknown PID '${T}'. Backtracking to sync byte @${O} to parse all TS packets.`),T=null,M=O-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=H;break}}else I++;I>0&&md(this.observer,new Error(`Found ${I} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=m,c.pesData=E,h.pesData=x;const N={audioTrack:c,videoTrack:o,id3Track:h,textTrack:f};return s&&this.extractRemainingSamples(N),N}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:s,textTrack:l}=e,o=i.pesData,c=t.pesData,h=s.pesData;let f;if(o&&(f=or(o,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new uy;break;case"hevc":this.videoParser=new cy;break}this.videoParser!==null&&(this.videoParser.parsePES(i,l,f,!0),i.pesData=null)}else i.pesData=o;if(c&&(f=or(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f);break;case"ac3":this.parseAC3PES(t,f);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(f=or(h,this.logger))?(this.parseID3PES(s,f),s.pesData=null):s.pesData=h}demuxSampleAes(e,t,i){const s=this.demux(e,i,!0,!this.config.progressive),l=this.sampleAes=new a_(this.observer,this.config,t);return this.decrypt(s,l)}decrypt(e,t){return new Promise(i=>{const{audioTrack:s,videoTrack:l}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{l.samples?t.decryptAvcSamples(l.samples,0,0,()=>{i(e)}):i(e)}):l.samples&&t.decryptAvcSamples(l.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const s=this.aacOverFlow;let l=t.data;if(s){this.aacOverFlow=null;const m=s.missing,y=s.sample.unit.byteLength;if(m===-1)l=ui(s.sample.unit,l);else{const S=y-m;s.sample.unit.set(l.subarray(0,m),S),e.samples.push(s.sample),i=s.missing}}let o,c;for(o=i,c=l.length;o<c-1&&!zo(l,o);o++);if(o!==i){let m;const y=o<c-1;if(y?m=`AAC PES did not start with ADTS header,offset:${o}`:m="No ADTS header found in AAC PES",md(this.observer,new Error(m),y,this.logger),!y)return}oE(e,this.observer,l,o,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(s){const m=uE(e.samplerate);h=s.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,g;for(;o<c;)if(g=cE(e,l,o,h,f),o+=g.length,g.missing){this.aacOverFlow=g;break}else for(f++;o<c-1&&!zo(l,o);o++);}parseMPEGPES(e,t){const i=t.data,s=i.length;let l=0,o=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<s;)if(pE(i,o)){const h=gE(e,i,o,c,l);if(h)o+=h.length,l++;else break}else o++}parseAC3PES(e,t){{const i=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=i.length;let o=0,c=0,h;for(;c<l&&(h=EE(e,i,c,s,o++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ke({},t,{type:this._videoTrack?Xt.emsg:Xt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function gd(a,e){return((a[e+1]&31)<<8)+a[e+2]}function l_(a,e){return(a[e+10]&31)<<8|a[e+11]}function o_(a,e,t,i,s,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(a[e+1]&15)<<8|a[e+2],h=e+3+c-4,f=(a[e+10]&15)<<8|a[e+11];for(e+=12+f;e<h;){const g=gd(a,e),m=(a[e+3]&15)<<8|a[e+4];switch(a[e]){case 207:if(!i){$f("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=g);break;case 21:o.id3Pid===-1&&(o.id3Pid=g);break;case 219:if(!i){$f("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=g);break;case 3:case 4:!t.mpeg&&!t.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="mp3");break;case 193:if(!i){$f("AC-3",l);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&m>0){let y=e+5,S=m;for(;S>2;){switch(a[y]){case 106:t.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=g,o.segmentAudioCodec="ac3");break}const x=a[y+1]+2;y+=x,S-=x}}break;case 194:case 135:return md(s,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=g,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=m+5}return o}function md(a,e,t,i){i.warn(`parsing error: ${e.message}`),a.emit(b.ERROR,b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function $f(a,e){e.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function or(a,e){let t=0,i,s,l,o,c;const h=a.data;if(!a||a.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=ui(h[0],h[1]),h.splice(1,1);if(i=h[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>a.size-6)return null;const g=i[7];g&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,g&64?(c=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-c>60*9e4&&(e.warn(`${Math.round((o-c)/9e4)}s delta between PTS and DTS, align them`),o=c)):c=o),l=i[8];let m=l+9;if(a.size<=m)return null;a.size-=m;const y=new Uint8Array(a.size);for(let S=0,E=h.length;S<E;S++){i=h[S];let x=i.byteLength;if(m)if(m>x){m-=x;continue}else i=i.subarray(m),x-=m,m=0;y.set(i,t),t+=x}return s&&(s-=l+3),{data:y,pts:o,dts:c,len:s}}return null}class u_{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Pn=Math.pow(2,32)-1;class j{static init(){j.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in j.types)j.types.hasOwnProperty(e)&&(j.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);j.HDLR_TYPES={video:t,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);j.STTS=j.STSC=j.STCO=l,j.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),j.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),j.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),j.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);j.FTYP=j.box(j.types.ftyp,o,h,o,c),j.DINF=j.box(j.types.dinf,j.box(j.types.dref,s))}static box(e,...t){let i=8,s=t.length;const l=s;for(;s--;)i+=t[s].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),s=0,i=8;s<l;s++)o.set(t[s],i),i+=t[s].byteLength;return o}static hdlr(e){return j.box(j.types.hdlr,j.HDLR_TYPES[e])}static mdat(e){return j.box(j.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(Pn+1)),s=Math.floor(t%(Pn+1));return j.box(j.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return j.box(j.types.mdia,j.mdhd(e.timescale||0,e.duration||0),j.hdlr(e.type),j.minf(e))}static mfhd(e){return j.box(j.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?j.box(j.types.minf,j.box(j.types.smhd,j.SMHD),j.DINF,j.stbl(e)):j.box(j.types.minf,j.box(j.types.vmhd,j.VMHD),j.DINF,j.stbl(e))}static moof(e,t,i){return j.box(j.types.moof,j.mfhd(e),j.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=j.trak(e[t]);return j.box.apply(null,[j.types.moov,j.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(j.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=j.trex(e[t]);return j.box.apply(null,[j.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(Pn+1)),s=Math.floor(t%(Pn+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return j.box(j.types.mvhd,l)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let s,l;for(s=0;s<t.length;s++)l=t[s].flags,i[s+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return j.box(j.types.sdtp,i)}static stbl(e){return j.box(j.types.stbl,j.stsd(e),j.box(j.types.stts,j.STTS),j.box(j.types.stsc,j.STSC),j.box(j.types.stsz,j.STSZ),j.box(j.types.stco,j.STCO))}static avc1(e){let t=[],i=[],s,l,o;for(s=0;s<e.sps.length;s++)l=e.sps[s],o=l.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(l));for(s=0;s<e.pps.length;s++)l=e.pps[s],o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(l));const c=j.box(j.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),h=e.width,f=e.height,g=e.pixelRatio[0],m=e.pixelRatio[1];return j.box(j.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return j.box(j.types.mp4a,j.audioStsd(e),j.box(j.types.esds,j.esds(e)))}static mp3(e){return j.box(j.types[".mp3"],j.audioStsd(e))}static ac3(e){return j.box(j.types["ac-3"],j.audioStsd(e),j.box(j.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return j.box(j.types.stsd,j.STSD,j.mp4a(e));if(t==="ac3"&&e.config)return j.box(j.types.stsd,j.STSD,j.ac3(e));if(t==="mp3"&&e.codec==="mp3")return j.box(j.types.stsd,j.STSD,j.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return j.box(j.types.stsd,j.STSD,j.avc1(e));if(t==="hevc"&&e.vps)return j.box(j.types.stsd,j.STSD,j.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),s=e.width||0,l=e.height||0,o=Math.floor(i/(Pn+1)),c=Math.floor(i%(Pn+1));return j.box(j.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,t){const i=j.sdtp(e),s=e.id,l=Math.floor(t/(Pn+1)),o=Math.floor(t%(Pn+1));return j.box(j.types.traf,j.box(j.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),j.box(j.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),j.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,j.box(j.types.trak,j.tkhd(e),j.mdia(e))}static trex(e){const t=e.id;return j.box(j.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],s=i.length,l=12+16*s,o=new Uint8Array(l);let c,h,f,g,m,y;for(t+=8+l,o.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<s;c++)h=i[c],f=h.duration,g=h.size,m=h.flags,y=h.cts,o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return j.box(j.types.trun,o)}static initSegment(e){j.types||j.init();const t=j.moov(e);return ui(j.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],s=4,l=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=l.length;for(let E=0;E<i.length;E+=1){o+=3;for(let x=0;x<i[E].length;x+=1)o+=2+i[E][x].length}const c=new Uint8Array(o);c.set(l,0),o=l.length;const h=i.length-1;for(let E=0;E<i.length;E+=1){c.set(new Uint8Array([32+E|(E===h?128:0),0,i[E].length]),o),o+=3;for(let x=0;x<i[E].length;x+=1)c.set(new Uint8Array([i[E][x].length>>8,i[E][x].length&255]),o),o+=2,c.set(i[E][x],o),o+=i[E][x].length}const f=j.box(j.types.hvcC,c),g=e.width,m=e.height,y=e.pixelRatio[0],S=e.pixelRatio[1];return j.box(j.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,S>>24,S>>16&255,S>>8&255,S&255])))}}j.types=void 0;j.HDLR_TYPES=void 0;j.STTS=void 0;j.STSC=void 0;j.STCO=void 0;j.STSZ=void 0;j.VMHD=void 0;j.SMHD=void 0;j.STSD=void 0;j.FTYP=void 0;j.DINF=void 0;const TE=9e4;function Wd(a,e,t=1,i=!1){const s=a*e*t;return i?Math.round(s):s}function c_(a,e,t=1,i=!1){return Wd(a,e,1/t,i)}function Aa(a,e=!1){return Wd(a,1e3,1/TE,e)}function f_(a,e=1){return Wd(a,TE,1/e)}const d_=10*1e3,h_=1024,g_=1152,m_=1536;let ur=null,Gf=null;function fy(a,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}class Co{constructor(e,t,i,s){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=s,this.ISGenerated=!1,ur===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ur=o?parseInt(o[1]):0}if(Gf===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Gf=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,s=e.reduce((l,o)=>{let c=o.pts,h=c-l;return h<-4294967296&&(t=!0,c=oi(c,i),h=c-l),h>0?l:c},i);return t&&this.logger.debug("PTS rollover detected"),s}remux(e,t,i,s,l,o,c,h){let f,g,m,y,S,E,x=l,T=l;const R=e.pid>-1,D=t.pid>-1,A=t.samples.length,O=e.samples.length>0,I=c&&A>0||A>1;if((!R||O)&&(!D||I)||this.ISGenerated||c){if(this.ISGenerated){var M,F,H,B;const de=this.videoTrackConfig;(de&&(t.width!==de.width||t.height!==de.height||((M=t.pixelRatio)==null?void 0:M[0])!==((F=de.pixelRatio)==null?void 0:F[0])||((H=t.pixelRatio)==null?void 0:H[1])!==((B=de.pixelRatio)==null?void 0:B[1]))||!de&&I||this.nextAudioPts===null&&O)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,l,o));const ie=this.isVideoContiguous;let ae=-1,ve;if(I&&(ae=p_(t.samples),!ie&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,ae>0){this.logger.warn(`[mp4-remuxer]: Dropped ${ae} out of ${A} video samples due to a missing keyframe`);const de=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ae),t.dropped+=ae,T+=(t.samples[0].pts-de)/t.inputTimeScale,ve=T}else ae===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${A} video samples`),E=!1);if(this.ISGenerated){if(O&&I){const de=this.getVideoStartPts(t.samples),U=(oi(e.samples[0].pts,de)-de)/t.inputTimeScale;x+=Math.max(0,U),T+=Math.max(0,-U)}if(O){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),m=this.generateIS(e,t,l,o)),g=this.remuxAudio(e,x,this.isAudioContiguous,o,D||I||h===me.AUDIO?T:void 0),I){const de=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),m=this.generateIS(e,t,l,o)),f=this.remuxVideo(t,T,ie,de)}}else I&&(f=this.remuxVideo(t,T,ie,0));f&&(f.firstKeyFrame=ae,f.independent=ae!==-1,f.firstKeyFramePTS=ve)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(S=xE(i,l,this._initPTS,this._initDTS)),s.samples.length&&(y=bE(s,l,this._initPTS))),{audio:g,video:f,initSegment:m,independent:E,text:y,id3:S}}generateIS(e,t,i,s){const l=e.samples,o=t.samples,c=this.typeSupported,h={},f=this._initPTS;let g=!f||s,m="audio/mp4",y,S,E;if(g&&(y=S=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(m="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):j.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(E=e.inputTimeScale,!f||E!==f.timescale?y=S=l[0].pts-Math.round(E*i):g=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:j.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(E=t.inputTimeScale,!f||E!==f.timescale){const x=this.getVideoStartPts(o),T=Math.round(E*i);S=Math.min(S,oi(o[0].dts,x)-T),y=Math.min(y,x-T)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:y,timescale:E},this._initDTS={baseTime:S,timescale:E}):y=E=void 0,{tracks:h,initPTS:y,timescale:E}}remuxVideo(e,t,i,s){const l=e.inputTimeScale,o=e.samples,c=[],h=o.length,f=this._initPTS;let g=this.nextAvcDts,m=8,y=this.videoSampleDuration,S,E,x=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,R=!1;if(!i||g===null){const K=t*l,w=o[0].pts-oi(o[0].dts,o[0].pts);ur&&g!==null&&Math.abs(K-w-g)<15e3?i=!0:g=K-w}const D=f.baseTime*l/f.timescale;for(let K=0;K<h;K++){const w=o[K];w.pts=oi(w.pts-D,g),w.dts=oi(w.dts-D,g),w.dts<o[K>0?K-1:K].dts&&(R=!0)}R&&o.sort(function(K,w){const Y=K.dts-w.dts,J=K.pts-w.pts;return Y||J}),S=o[0].dts,E=o[o.length-1].dts;const A=E-S,O=A?Math.round(A/(h-1)):y||e.inputTimeScale/30;if(i){const K=S-g,w=K>O,Y=K<-1;if((w||Y)&&(w?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Aa(K,!0)} ms (${K}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Aa(-K,!0)} ms (${K}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Y||g>=o[0].pts||ur)){S=g;const J=o[0].pts-K;if(w)o[0].dts=S,o[0].pts=J;else{let ne=!0;for(let oe=0;oe<o.length&&!(o[oe].dts>J&&ne);oe++){const he=o[oe].pts;if(o[oe].dts-=K,o[oe].pts-=K,oe<o.length-1){const ce=o[oe+1].pts,xe=o[oe].pts,be=ce<=xe,et=ce<=he;ne=be==et}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Aa(J,!0)}/${Aa(S,!0)}, delta: ${Aa(K,!0)} ms`)}}S=Math.max(0,S);let I=0,N=0,M=S;for(let K=0;K<h;K++){const w=o[K],Y=w.units,J=Y.length;let ne=0;for(let oe=0;oe<J;oe++)ne+=Y[oe].data.length;N+=ne,I+=J,w.length=ne,w.dts<M?(w.dts=M,M+=O/4|0||1):M=w.dts,x=Math.min(w.pts,x),T=Math.max(w.pts,T)}E=o[h-1].dts;const F=N+4*I+8;let H;try{H=new Uint8Array(F)}catch(K){this.observer.emit(b.ERROR,b.ERROR,{type:pe.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:F,reason:`fail allocating video mdat ${F}`});return}const B=new DataView(H.buffer);B.setUint32(0,F),H.set(j.types.mdat,4);let ie=!1,ae=Number.POSITIVE_INFINITY,ve=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,ue=Number.NEGATIVE_INFINITY;for(let K=0;K<h;K++){const w=o[K],Y=w.units;let J=0;for(let he=0,ce=Y.length;he<ce;he++){const xe=Y[he],be=xe.data,et=xe.data.byteLength;B.setUint32(m,et),m+=4,H.set(be,m),m+=et,J+=4+et}let ne;if(K<h-1)y=o[K+1].dts-w.dts,ne=o[K+1].pts-w.pts;else{const he=this.config,ce=K>0?w.dts-o[K-1].dts:O;if(ne=K>0?w.pts-o[K-1].pts:O,he.stretchShortVideoTrack&&this.nextAudioPts!==null){const xe=Math.floor(he.maxBufferHole*l),be=(s?x+s*l:this.nextAudioPts)-w.pts;be>xe?(y=be-ce,y<0?y=ce:ie=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${be/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=ce}else y=ce}const oe=Math.round(w.pts-w.dts);ae=Math.min(ae,y),de=Math.max(de,y),ve=Math.min(ve,ne),ue=Math.max(ue,ne),c.push(fy(w.key,y,J,oe))}if(c.length){if(ur){if(ur<70){const K=c[0].flags;K.dependsOn=2,K.isNonSync=0}}else if(Gf&&ue-ve<de-ae&&O/de<.025&&c[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let K=S;for(let w=0,Y=c.length;w<Y;w++){const J=K+c[w].duration,ne=K+c[w].cts;if(w<Y-1){const oe=J+c[w+1].cts;c[w].duration=oe-ne}else c[w].duration=w?c[w-1].duration:O;c[w].cts=0,K=J}}}y=ie||!y?O:y,this.nextAvcDts=g=E+y,this.videoSampleDuration=y,this.isVideoContiguous=!0;const re={data1:j.moof(e.sequenceNumber++,S,Ke(e,{samples:c})),data2:H,startPTS:x/l,endPTS:(T+y)/l,startDTS:S/l,endDTS:g/l,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,re}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return g_;case"ac3":return m_;default:return h_}}remuxAudio(e,t,i,s,l){const o=e.inputTimeScale,c=e.samplerate?e.samplerate:o,h=o/c,f=this.getSamplesPerFrame(e),g=f*h,m=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,S=[],E=l!==void 0;let x=e.samples,T=y?0:8,R=this.nextAudioPts||-1;const D=t*o,A=m.baseTime*o/m.timescale;if(this.isAudioContiguous=i=i||x.length&&R>0&&(s&&Math.abs(D-R)<9e3||Math.abs(oi(x[0].pts-A,D)-R)<20*g),x.forEach(function(U){U.pts=oi(U.pts-A,D)}),!i||R<0){if(x=x.filter(U=>U.pts>=0),!x.length)return;l===0?R=0:s&&!E?R=Math.max(0,D):R=x[0].pts}if(e.segmentCodec==="aac"){const U=this.config.maxAudioFramesDrift;for(let W=0,re=R;W<x.length;W++){const K=x[W],w=K.pts,Y=w-re,J=Math.abs(1e3*Y/o);if(Y<=-U*g&&E)W===0&&(this.logger.warn(`Audio frame @ ${(w/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Y/o)} ms.`),this.nextAudioPts=R=re=w);else if(Y>=U*g&&J<d_&&E){let ne=Math.round(Y/g);re=w-ne*g,re<0&&(ne--,re+=g),W===0&&(this.nextAudioPts=R=re),this.logger.warn(`[mp4-remuxer]: Injecting ${ne} audio frame @ ${(re/o).toFixed(3)}s due to ${Math.round(1e3*Y/o)} ms gap.`);for(let oe=0;oe<ne;oe++){const he=Math.max(re,0);let ce=u_.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ce||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=K.unit.subarray()),x.splice(W,0,{unit:ce,pts:he}),re+=g,W++}}K.pts=re,re+=g}}let O=null,I=null,N,M=0,F=x.length;for(;F--;)M+=x[F].unit.byteLength;for(let U=0,W=x.length;U<W;U++){const re=x[U],K=re.unit;let w=re.pts;if(I!==null){const J=S[U-1];J.duration=Math.round((w-I)/h)}else if(i&&e.segmentCodec==="aac"&&(w=R),O=w,M>0){M+=T;try{N=new Uint8Array(M)}catch(J){this.observer.emit(b.ERROR,b.ERROR,{type:pe.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:J,bytes:M,reason:`fail allocating audio mdat ${M}`});return}y||(new DataView(N.buffer).setUint32(0,M),N.set(j.types.mdat,4))}else return;N.set(K,T);const Y=K.byteLength;T+=Y,S.push(fy(!0,f,Y,0)),I=w}const H=S.length;if(!H)return;const B=S[S.length-1];this.nextAudioPts=R=I+h*B.duration;const ie=y?new Uint8Array(0):j.moof(e.sequenceNumber++,O/h,Ke({},e,{samples:S}));e.samples=[];const ae=O/o,ve=R/o,ue={data1:ie,data2:N,startPTS:ae,endPTS:ve,startDTS:ae,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:H};return this.isAudioContiguous=!0,ue}}function oi(a,e){let t;if(e===null)return a;for(e<a?t=-8589934592:t=8589934592;Math.abs(a-e)>4294967296;)a+=t;return a}function p_(a){for(let e=0;e<a.length;e++)if(a[e].key)return e;return-1}function xE(a,e,t,i){const s=a.samples.length;if(!s)return;const l=a.inputTimeScale;for(let c=0;c<s;c++){const h=a.samples[c];h.pts=oi(h.pts-t.baseTime*l/t.timescale,e*l)/l,h.dts=oi(h.dts-i.baseTime*l/i.timescale,e*l)/l}const o=a.samples;return a.samples=[],{samples:o}}function bE(a,e,t){const i=a.samples.length;if(!i)return;const s=a.inputTimeScale;for(let o=0;o<i;o++){const c=a.samples[o];c.pts=oi(c.pts-t.baseTime*s/t.timescale,e*s)/s}a.samples.sort((o,c)=>o.pts-c.pts);const l=a.samples;return a.samples=[],{samples:l}}class y_{constructor(e,t,i,s){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=s}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,s){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(rL(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=Ov(e);s.audio&&(t=dy(s.audio,Ve.AUDIO)),s.video&&(i=dy(s.video,Ve.VIDEO));const l={};s.audio&&s.video?l.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:s.audio?l.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?l.video={container:"video/mp4",codec:i,supplemental:s.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,i,s,l,o){var c,h;let{initPTS:f,lastEndTime:g}=this;const m={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};fe(g)||(g=this.lastEndTime=l||0);const y=t.samples;if(!(y!=null&&y.length))return m;const S={initPTS:void 0,timescale:1};let E=this.initData;if((c=E)!=null&&c.length||(this.generateInitSegment(y),E=this.initData),!((h=E)!=null&&h.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),m;this.emitInitSegment&&(S.tracks=this.initTracks,this.emitInitSegment=!1);const x=lL(y,E),T=aL(E,y),R=T===null?l:T;(o||!f)&&(v_(f,R,l,x)||S.timescale!==f.timescale)&&(S.initPTS=R-l,f&&f.timescale===1&&this.logger.warn(`Adjusting initPTS @${l} from ${f.baseTime/f.timescale} to ${S.initPTS}`),this.initPTS=f={baseTime:S.initPTS,timescale:1});const D=e?R-f.baseTime/f.timescale:g,A=D+x;uL(E,y,f.baseTime/f.timescale),x>0?this.lastEndTime=A:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const O=!!E.audio,I=!!E.video;let N="";O&&(N+="audio"),I&&(N+="video");const M={data1:y,startPTS:D,startDTS:D,endPTS:A,endDTS:A,type:N,hasAudio:O,hasVideo:I,nb:1,dropped:0};return m.audio=M.type==="audio"?M:void 0,m.video=M.type!=="audio"?M:void 0,m.initSegment=S,m.id3=xE(i,l,f,f),s.samples.length&&(m.text=bE(s,l,f)),m}}function v_(a,e,t,i){if(a===null)return!0;const s=Math.max(i,1),l=e-a.baseTime/a.timescale;return Math.abs(l-t)>s}function dy(a,e){const t=a==null?void 0:a.codec;return t&&t.length>4?t:e===Ve.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?Fo(t,!1):(Me.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(Me.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let sn;try{sn=self.performance.now.bind(self.performance)}catch{sn=Date.now}const Io=[{demux:r_,remux:y_},{demux:Fn,remux:Co},{demux:t_,remux:Co},{demux:n_,remux:Co}];Io.splice(2,0,{demux:i_,remux:Co});class hy{constructor(e,t,i,s,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=l,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,s){const l=i.transmuxing;l.executeStart=sn();let o=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;s&&(this.currentTransmuxState=s);const{contiguous:f,discontinuity:g,trackSwitch:m,accurateTimeOffset:y,timeOffset:S,initSegmentChange:E}=s||c,{audioCodec:x,videoCodec:T,defaultInitPts:R,duration:D,initSegmentData:A}=h,O=E_(o,t);if(O&&fr(O.method)){const F=this.getDecrypter(),H=jd(O.method);if(F.isSync()){let B=F.softwareDecrypt(o,O.key.buffer,O.iv.buffer,H);if(i.part>-1){const ae=F.flush();B=ae&&ae.buffer}if(!B)return l.executeEnd=sn(),jf(i);o=new Uint8Array(B)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(o,O.key.buffer,O.iv.buffer,H).then(B=>{const ie=this.push(B,null,i);return this.decryptionPromise=null,ie}),this.decryptionPromise}const I=this.needsProbing(g,m);if(I){const F=this.configureTransmuxer(o);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),l.executeEnd=sn(),jf(i)}(g||m||E||I)&&this.resetInitSegment(A,x,T,D,t),(g||E||I)&&this.resetInitialTimestamp(R),f||this.resetContiguity();const N=this.transmux(o,O,S,y,i);this.asyncResult=Ua(N);const M=this.currentTransmuxState;return M.contiguous=!0,M.discontinuity=!1,M.trackSwitch=!1,l.executeEnd=sn(),N}flush(e){const t=e.transmuxing;t.executeStart=sn();const{decrypter:i,currentTransmuxState:s,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const o=[],{timeOffset:c}=s;if(i){const m=i.flush();m&&o.push(this.push(m.buffer,null,e))}const{demuxer:h,remuxer:f}=this;if(!h||!f){t.executeEnd=sn();const m=[jf(e)];return this.asyncResult?Promise.resolve(m):m}const g=h.flush(c);return Ua(g)?(this.asyncResult=!0,g.then(m=>(this.flushRemux(o,m,e),o))):(this.flushRemux(o,g,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:s,videoTrack:l,id3Track:o,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===me.MAIN?"level":"track"} ${i.level}`);const g=this.remuxer.remux(s,l,o,c,f,h,!0,this.id);e.push({remuxResult:g,chunkMeta:i}),i.transmuxing.executeEnd=sn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,s,l){const{demuxer:o,remuxer:c}=this;!o||!c||(o.resetInitSegment(e,t,i,s),c.resetInitSegment(e,t,i,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,s,l){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,s,l):o=this.transmuxUnencrypted(e,i,s,l),o}transmuxUnencrypted(e,t,i,s){const{audioTrack:l,videoTrack:o,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,c,h,t,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,i,s,l){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,s,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:s}=this;let l;for(let m=0,y=Io.length;m<y;m++){var o;if((o=Io[m].demux)!=null&&o.probe(e,this.logger)){l=Io[m];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,f=l.remux,g=l.demux;(!h||!(h instanceof f))&&(this.remuxer=new f(i,t,s,this.logger)),(!c||!(c instanceof g))&&(this.demuxer=new g(i,t,s,this.logger),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new $d(this.config)),e}}function E_(a,e){let t=null;return a.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const jf=a=>({remuxResult:{},chunkMeta:a});function Ua(a){return"then"in a&&a.then instanceof Function}class S_{constructor(e,t,i,s,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=s,this.defaultInitPts=l||null}}class T_{constructor(e,t,i,s,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=l,this.initSegmentChange=o}}let gy=0;class AE{constructor(e,t,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=gy++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const f=h.data,g=this.hls;if(!(!g||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var m;const y=(m=this.workerContext)==null?void 0:m.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{g.logger[f.data.logType]&&g.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,g.trigger(f.event,f.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const f=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const l=e.config;this.hls=e,this.id=t,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const o=(h,f)=>{f=f||{},f.frag=this.frag||void 0,h===b.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(h,f)};this.observer=new Kd,this.observer.on(b.FRAG_DECRYPTED,o),this.observer.on(b.ERROR,o);const c=Ip(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(l.workerPath||A1()){try{l.workerPath?(h.log(`loading Web Worker ${l.workerPath} for "${t}"`),this.workerContext=L1(l.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=R1());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Je(l)})}catch(g){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new hy(this.observer,c,l,"",t,e.logger)}return}}this.transmuxer=new hy(this.observer,c,l,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=gy++;const t=this.hls.config,i=Ip(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Je(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),_1(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,s,l,o,c,h,f,g){var m,y;f.transmuxing.start=self.performance.now();const{instanceNo:S,transmuxer:E}=this,x=o?o.start:l.start,T=l.decryptdata,R=this.frag,D=!(R&&l.cc===R.cc),A=!(R&&f.level===R.level),O=R?f.sn-R.sn:-1,I=this.part?f.part-this.part.index:-1,N=O===0&&f.id>1&&f.id===(R==null?void 0:R.stats.chunkCount),M=!A&&(O===1||O===0&&(I===1||N&&I<=0)),F=self.performance.now();(A||O||l.stats.parsing.start===0)&&(l.stats.parsing.start=F),o&&(I||!M)&&(o.stats.parsing.start=F);const H=!(R&&((m=l.initSegment)==null?void 0:m.url)===((y=R.initSegment)==null?void 0:y.url)),B=new T_(D,M,h,A,x,H);if(!M||D||H){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===me.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${D}
        trackSwitch: ${A}
        contiguous: ${M}
        accurateTimeOffset: ${h}
        timeOffset: ${x}
        initSegmentChange: ${H}`);const ie=new S_(i,s,t,c,g);this.configureTransmuxer(ie)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:S,cmd:"demux",data:e,decryptdata:T,chunkMeta:f,state:B},e instanceof ArrayBuffer?[e]:[]);else if(E){const ie=E.push(e,T,f,B);Ua(ie)?ie.then(ae=>{this.handleTransmuxComplete(ae)}).catch(ae=>{this.transmuxerError(ae,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(ie)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const s=i.flush(e);Ua(s)?s.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const my=100;class x_ extends Vd{constructor(e,t,i){super(e,t,i,"audio-stream-controller",me.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:l}){if(i===me.MAIN){const o=t.cc,c=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:l},this.log(`InitPTS for cc: ${o} found from main: ${s}/${l}`),this.mainAnchor=t,this.state===te.WAITING_INIT_PTS){const h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==o)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&c&&c.cc!==o?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,c.abortRequests(),this.resetLoadingState()):this.state===te.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),i=e.cc;return BL(t,i,e)||t&&Hv(t.fragments,i)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=te.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(my),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=te.IDLE):this.state=te.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case te.IDLE:this.doTickIdle();break;case te.WAITING_TRACK:{const{levels:t,trackId:i}=this,s=t==null?void 0:t[i],l=s==null?void 0:s.details;if(l&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(l))break;this.state=te.WAITING_INIT_PTS}break}case te.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:s,trackId:l}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[l])||null),this.state=te.IDLE}break}case te.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:s,cache:l,complete:o}=t,c=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=te.FRAG_LOADING;const h=l.flush().buffer,f={frag:i,part:s,payload:h,networkDetails:null};this._handleFragmentLoadProgress(f),o&&super._handleFragmentLoadComplete(f)}else c&&c.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${c.cc}`),this.nextLoadPosition=this.findSyncFrag(c).start,this.clearWaitingFragment())}else this.state=te.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==te.STOPPED&&(this.state=te.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:s,trackId:l}=this,o=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[l]))return;const c=i[l],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=te.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,Ve.AUDIO,me.AUDIO));const g=this.getFwdBufferInfo(f,me.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,h)){t.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=te.ENDED;return}const m=g.len,y=t.maxBufferLength,S=h.fragments,E=S[0].start,x=this.getLoadPosition(),T=this.flushing?x:g.end;if(this.switchingTrack&&s){const A=x;h.PTSKnown&&A<E&&(g.end>E||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=E+.05)}if(m>=y&&!this.switchingTrack&&T<S[S.length-1].start)return;let R=this.getNextFragment(T,h);if(R&&this.isLoopLoading(R,T)&&(R=this.getNextFragmentLoopLoading(R,h,g,me.MAIN,y)),!R){this.bufferFlushed=!0;return}let D=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&D&&Et(R)&&!R.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(D)===ht.OK&&(this.mainFragLoading=D=null),D&&Et(D))){if(R.start>D.end){const O=this.fragmentTracker.getFragAtPos(T,me.MAIN);O&&O.end>D.end&&(D=O,this.mainFragLoading={frag:O,targetBufferTime:null})}if(R.start>D.end)return}this.loadFragment(R,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Oa(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==te.STOPPED&&(this.setInterval(my),this.state=te.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(b.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:s}=this,{details:l,id:o,groupId:c,track:h}=t;if(!s){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${c}"`);return}const f=this.mainDetails;if(!f||l.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=t,this.state!==te.STOPPED&&(this.state=te.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${c}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const g=s[o];let m=0;if(l.live||(i=g.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(g.details){var y;m=this.alignPlaylists(l,g.details,(y=this.levelLastLoaded)==null?void 0:y.details)}l.alignedSliding||(nE(l,f),l.alignedSliding||Ko(l,f),m=l.fragmentStart)}g.details=l,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(f,m),this.hls.trigger(b.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:t.groupId}),this.state===te.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=te.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:l}=e,{config:o,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const f=h[c];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const g=f.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const m=o.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new AE(this.hls,me.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const S=this.initPTS[i.cc],E=(t=i.initSegment)==null?void 0:t.data;if(S!==void 0){const T=s?s.index:-1,R=T!==-1,D=new Gd(i.level,i.sn,i.stats.chunkCount,l.byteLength,T,R);y.push(l,E,m,"",i,s,g.totalduration,!1,D,S)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:x}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new sE,complete:!1};x.push(new Uint8Array(l)),this.state!==te.STOPPED&&(this.state=te.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===me.MAIN&&Et(t.frag)&&(this.mainFragLoading=t,this.state===te.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:s}=t;if(i.type!==me.AUDIO){!this.audioOnly&&i.type===me.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Et(i)){this.fragPrevious=i;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,$e({},l)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=te.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.AUDIO,t);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===te.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===we.AUDIO_TRACK&&(this.state=te.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ve.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ve.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===te.ENDED&&(this.state=te.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,me.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:s}=this,{remuxResult:l,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:h,part:f,level:g}=c,{details:m}=g,{audio:y,text:S,id3:E,initSegment:x}=l;if(this.fragContextChanged(h)||!m){this.fragmentTracker.removeFragment(h);return}if(this.state=te.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),x!=null&&x.tracks){const T=h.initSegment||h;this._bufferInitSegment(g,x.tracks,T,o),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:x.tracks})}if(y){const{startPTS:T,endPTS:R,startDTS:D,endDTS:A}=y;f&&(f.elementaryStreams[Ve.AUDIO]={startPTS:T,endPTS:R,startDTS:D,endDTS:A}),h.setElementaryStreamInfo(Ve.AUDIO,T,R,D,A),this.bufferFragmentData(y,h,f,o)}if(E!=null&&(t=E.samples)!=null&&t.length){const T=Ke({id:i,frag:h,details:m},E);s.trigger(b.FRAG_PARSING_METADATA,T)}if(S){const T=Ke({id:i,frag:h,details:m},S);s.trigger(b.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,s){if(this.state!==te.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const l=t.audio;l.id=me.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger(b.BUFFER_CODECS,t);const c=l.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:c};this.hls.trigger(b.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===ht.NOT_LOADED||s===ht.PARTIAL){var l;if(!Et(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=te.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Ko(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:s,characteristics:l,audioCodec:o,channels:c}=this.bufferedTrack;gs({name:t,lang:i,assocLang:s,characteristics:l,audioCodec:o,channels:c},e,fs)||(Go(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,$e({},e))}}class Zd extends fn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const s=t==null?void 0:t.renditionReports;if(s){let l=-1;for(let o=0;o<s.length;o++){const c=s[o];let h;try{h=new self.URL(c.URI,t.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),h=c.URI||""}if(h===e){l=o;break}else h===e.substring(0,h.length)&&(l=o)}if(l!==-1){const o=s[l],c=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let h=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&g>t.partTarget&&(h+=1)}const f=i&&Op(i);return new kp(c,h>=0?h:void 0,f)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:s,stats:l}=t,o=self.performance.now(),c=l.loading.first?Math.max(0,o-l.loading.first):0;s.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==s.appliedTimelineOffset){const g=Math.max(h||0,0);s.appliedTimelineOffset=g,s.fragments.forEach(m=>{m.start=m.playlistOffset+g})}if(s.live||i!=null&&i.live){const g="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(i),i&&s.fragments.length>0){g1(i,s);const D=s.playlistParsingError;if(D){this.warn(D);const A=this.hls;if(!A.config.ignorePlaylistParsingErrors){var f;const{networkDetails:O}=t;A.trigger(b.ERROR,{type:pe.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:D,reason:D.message,level:t.level||void 0,parent:(f=s.fragments[0])==null?void 0:f.type,networkDetails:O,stats:l});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=l.loading.start);const m=this.hls.mainForwardBufferInfo,y=m?m.end-m.len:0,S=(s.edge-y)*1e3,E=Zv(s,S);if(s.requestScheduled+E<o?s.requestScheduled=o:s.requestScheduled+=E,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let x,T,R;if(s.canBlockReload&&s.endSN&&s.advanced){const D=this.hls.config.lowLatencyMode,A=s.lastPartSn,O=s.endSN,I=s.lastPartIndex,N=I!==-1,M=A===O;N?M?(T=O+1,R=D?0:I):(T=A,R=D?I+1:s.maxPartIndex):T=O+1;const F=s.age,H=F+s.ageHeader;let B=Math.min(H-s.partTarget,s.targetduration*1.5);if(B>0){if(H>s.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,R=void 0;else if(i!=null&&i.tuneInGoal&&H-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${B} with playlist age: ${s.age}`),B=0;else{const ie=Math.floor(B/s.targetduration);if(T+=ie,R!==void 0){const ae=Math.round(B%s.targetduration/s.partTarget);R+=ae}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${B} skip sn ${ie} to part ${R}`)}s.tuneInGoal=B}if(x=this.getDeliveryDirectives(s,t.deliveryDirectives,T,R),D||!M){s.requestScheduled=o,this.loadingPlaylist(g,x);return}}else(s.canBlockReload||s.canSkipUntil)&&(x=this.getDeliveryDirectives(s,t.deliveryDirectives,T,R));x&&T!==void 0&&s.canBlockReload&&(s.requestScheduled=l.loading.first+Math.max(E-c*2,E/2)),this.scheduleLoading(g,x,s)}else this.clearTimer()}scheduleLoading(e,t,i){const s=i||e.details;if(!s){this.loadingPlaylist(e,t);return}const l=self.performance.now(),o=s.requestScheduled;if(l>=o){this.loadingPlaylist(e,t);return}const c=o-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,i,s){let l=Op(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,s=t.part,l=Do.No),new kp(i,s,l)}checkRetry(e){const t=e.details,i=jo(e),s=e.errorAction,{action:l,retryCount:o=0,retryConfig:c}=s||{},h=!!s&&!!c&&(l===Ct.RetryRequest||!s.resolved&&l===Ct.SendAlternateToPenaltyBox);if(h){var f;if(o>=c.maxNumRetry)return!1;if(i&&(f=e.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=Fd(c,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,s.resolved=!0}return h}}function RE(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!Ba(a[t].attrs,e[t].attrs))return!1;return!0}function Ba(a,e,t){const i=a["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>a[s]!==e[s])}function pd(a,e){return e.label.toLowerCase()===a.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(a.lang||"").toLowerCase())}class b_ extends Zd{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:s,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,s=this.groupIds;let l=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(c=>(s==null?void 0:s.indexOf(c))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!i||i.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,S)=>{y.id=S});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!l&&h){const y=Oi(h,c,fs);if(y>-1)l=c[y];else{const S=Oi(h,this.tracks);l=this.tracks[S]}}let f=this.findTrackId(l);f===-1&&l&&(f=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,g);const m=this.trackId;if(f!==-1&&m===-1)this.setAudioTrack(f);else if(c.length&&m===-1){var o;const y=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===we.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&gs(e,s,fs))return s;const l=Oi(e,this.tracksInGroup,fs);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(s){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const c=kL(e,t.levels,i,o,fs);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const o=Oi(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e],l=s.details&&!s.details.live;if(e===this.trackId&&s===i&&l||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,$e({},s)),l))return;const o=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||gs(e,s,fs)))return i}if(e){const{name:i,lang:s,assocLang:l,characteristics:o,audioCodec:c,channels:h}=e;for(let f=0;f<t.length;f++){const g=t[f];if(gs({name:i,lang:s,assocLang:l,characteristics:o,audioCodec:c,channels:h},g,fs))return f}for(let f=0;f<t.length;f++){const g=t[f];if(Ba(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<t.length;f++){const g=t[f];if(Ba(e.attrs,g.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Go(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o==null?void 0:o.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})}}class A_{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(l){var i;if(s.onError(l),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],s=i==null?void 0:i.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const py=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,LE="HlsJsTrackRemovedError";class R_ extends Error{constructor(e){super(e),this.name=LE}}class L_ extends fn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:l}=this;i&&this.log("Media source opened"),!(!s||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:s,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=QR($n(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this),e.off(b.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Ke(i,s.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(i[o]=Ke({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,s=$n(this.appendSource);if(this.transferData=this.overrides=void 0,i&&s){const l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(o),l)this._objectUrl=i.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const h=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||h&&o instanceof h,yy(i),__(i,c),i.load()}catch{i.src=c}else i.src=c}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,s=t.tracks,l=s?Object.keys(s):null,o=l?l.length:0,c=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(s&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Je(i,(h,f)=>h==="initSegment"?void 0:f)};
transfer tracks: ${Je(s,(h,f)=>h==="initSegment"?void 0:f)}}`),!Lv(s,i)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,f=this.details,g=Math.max(h,(f==null?void 0:f.fragments[0].start)||0);if(g-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${g} currentTime: ${h}`),this.onMediaDetaching(b.MEDIA_DETACHING,{}),this.onMediaAttaching(b.MEDIA_ATTACHING,t),e.currentTime=g;return}this.transferData=void 0,l.forEach(h=>{const f=h,g=s[f];if(g){const m=g.buffer;if(m){const y=this.fragmentTracker,S=g.id;if(y.hasFragments(S)||y.hasParts(S)){const T=De.getBuffered(m);y.detectEvictedFragments(f,T,S,null,!0)}const E=Hf(f),x=[f,m];this.sourceBuffers[E]=x,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,g)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=l.readyState==="open";try{const h=l.sourceBuffers;for(let f=h.length;f--;)c&&h[f].abort(),l.removeSourceBuffer(h[f]);c&&l.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(s.removeAttribute("src"),this.appendSource&&yy(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(b.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Hf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new A_(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!l&&this.sourceBufferCount&&this.media&&s.some(c=>!i[c]);if(l||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(c=>{var h,f,g;const m=t[c],{id:y,codec:S,levelCodec:E,container:x,metadata:T,supplemental:R}=m;let D=i[c];const A=(h=this.transferData)==null||(f=h.tracks)==null?void 0:f[c],O=A!=null&&A.buffer?A:D,I=(O==null?void 0:O.pendingCodec)||(O==null?void 0:O.codec),N=O==null?void 0:O.levelCodec;D||(D=i[c]={buffer:void 0,listeners:[],codec:S,supplemental:R,container:x,levelCodec:E,metadata:T,id:y});const M=_o(I,N),F=M==null?void 0:M.replace(py,"$1");let H=_o(S,E);const B=(g=H)==null?void 0:g.replace(py,"$1");H&&M&&F!==B&&(c.slice(0,5)==="audio"&&(H=Fo(H,this.appendSource)),this.log(`switching codec ${I} to ${H}`),H!==(D.pendingCodec||D.codec)&&(D.pendingCodec=H),D.container=x,this.appendChangeType(c,x,H))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const s=`${t};codecs=${i}`,l={label:`change-type=${s}`,execute:()=>{const o=this.tracks[e];if(o){const c=o.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),c.changeType(s),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,s=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,me.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>s||h!=null&&h.buffer&&De.isBuffered(h.buffer,s)||((c=this.fragmentTracker.getAppendedFrag(s,me.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:s,type:l,parent:o,frag:c,part:h,chunkMeta:f}=t,g=f.buffering[l],m=c.sn,y=self.performance.now();g.start=y;const S=c.stats.buffering,E=h?h.stats.buffering:null;S.start===0&&(S.start=y),E&&E.start===0&&(E.start=y);const x=i.audio;let T=!1;l==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const R=this.tracks.video,D=R==null?void 0:R.buffer;if(D&&m!=="initSegment"){const I=h||c,N=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend){const F=I.start+I.duration*.05,H=D.buffered,B=this.currentOp("video");!H.length&&!B?this.blockAudio(I):!B&&!De.isBuffered(D,F)&&this.lastVideoAppendEnd<F&&this.blockAudio(I)}else if(l==="video"){const M=I.end;if(N){const F=N.frag.start;(M>F||M<this.lastVideoAppendEnd||De.isBuffered(D,F))&&this.unblockAudio()}this.lastVideoAppendEnd=M}}const A=(h||c).start,O={label:`append-${l}`,execute:()=>{if(g.executeStart=self.performance.now(),T){const I=this.tracks[l];if(I){const N=I.buffer;if(N){const M=A-N.timestampOffset;Math.abs(M)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${A} (delta: ${M}) sn: ${m})`),N.timestampOffset=A)}}}this.appendExecutor(s,l)},onStart:()=>{},onComplete:()=>{const I=self.performance.now();g.executeEnd=g.end=I,S.first===0&&(S.first=I),E&&E.first===0&&(E.first=I);const N={};this.sourceBuffers.forEach(([M,F])=>{M&&(N[M]=De.getBuffered(F))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:l,frag:c,part:h,chunkMeta:f,parent:c.type,timeRanges:N})},onError:I=>{var N;const M={type:pe.MEDIA_ERROR,parent:c.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:c,part:h,chunkMeta:f,error:I,err:I,fatal:!1},F=(N=this.media)==null?void 0:N.error;if(I.code===DOMException.QUOTA_EXCEEDED_ERR)M.details=z.BUFFER_FULL_ERROR;else if(I.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!F)M.errorAction=ka(!0);else if(I.name===LE&&this.sourceBufferCount===0)M.errorAction=ka(!0);else{const H=++this.appendErrors[l];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${F||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||F)&&(M.fatal=!0)}this.hls.trigger(b.ERROR,M)}};this.append(O,l,this.isPending(this.tracks[l]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:i,startOffset:s,endOffset:l}=t;i?this.append(this.getFlushOp(i,s,l),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,s,l),o)})}onFragParsed(e,t){const{frag:i,part:s}=t,l=[],o=s?s.elementaryStreams:i.elementaryStreams;o[Ve.AUDIOVIDEO]?l.push("audiovideo"):(o[Ve.AUDIO]&&l.push("audio"),o[Ve.VIDEO]&&l.push("video"));const c=()=>{const h=self.performance.now();i.stats.buffering.end=h,s&&(s.stats.buffering.end=h);const f=s?s.stats:i.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:i,part:s,stats:f,id:i.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(c,l).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const c=this.tracks[o];(!t.type||t.type===o)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${o} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var c;return o&&!((c=this.tracks[o])!=null&&c.ended)})&&(s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(b.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(b.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===z.BUFFER_APPEND_ERROR&&t.frag){var i;const s=(i=t.errorAction)==null?void 0:i.nextAutoLevel;fe(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const s=e.config,l=i.currentTime,o=t.levelTargetDuration,c=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(fe(c)&&c>=0){const h=Math.max(c,o),f=Math.floor(l/o)*o-h;this.flushBackBuffer(l,o,f)}if(fe(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const h=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),f=Math.max(h,o),g=Math.floor(l/o)*o+f;this.flushFrontBuffer(l,o,g)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([s,l])=>{if(l){const c=De.getBuffered(l);if(c.length>0&&i>c.start(0)){var o;this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:i});const h=this.tracks[s];if((o=this.details)!=null&&o.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(h!=null&&h.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([s,l])=>{if(l){const o=De.getBuffered(l),c=o.length;if(c<2)return;const h=o.start(c-1),f=o.end(c-1);if(i>h||e>=h&&e<=f)return;this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const f=Math.max(0,t.fragmentStart),g=Math.max(f,s);return{duration:1/0,start:f,end:g}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return fe(l)?{duration:l}:null;const o=this.media.duration,c=fe(i.duration)?i.duration:0;return s>c&&s>o||!fe(o)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(fe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${i}.`),s.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Je(i)}`),this.tracksReady){var s;const l=(s=this.transferData)==null?void 0:s.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const s=this.tracks[t];e[t]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(b.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const o=l,c=e[o];if(this.isPending(c)){const h=this.getTrackCodec(c,o),f=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${f})${this.currentOp(o)?" Queued":""} ${Je(c)}`);try{const g=i.addSourceBuffer(f),m=Hf(o),y=[o,g];t[m]=y,c.buffer=g}catch(g){var s;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(o),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[o],this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:o,mimeType:f,parent:c.id});return}this.trackSourceBuffer(o,c)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let s=e.codec;i&&(t==="video"||t==="audiovideo")&&od(i,"video")&&(s=EL(s,i));const l=_o(s,e.levelCodec);return l?t.slice(0,5)==="audio"?Fo(l,this.appendSource):l:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,o)=>{const c=o.removedRanges;c!=null&&c.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,t),this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const l=this.currentOp(e);l&&l.onError(s)}removeExecutor(e,t,i){const{media:s,mediaSource:l}=this,o=this.tracks[e],c=o==null?void 0:o.buffer;if(!s||!l||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=fe(s.duration)?s.duration:1/0,f=fe(l.duration)?l.duration:1/0,g=Math.max(0,t),m=Math.min(i,h,f);m>g&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${g},${m}] from the ${e} SourceBuffer`),c.remove(g,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],s=i==null?void 0:i.buffer;if(!s)throw new R_(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,s=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const s=(i=this.tracks[t])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const s=this.tracks[e];if(!s)return;const l=s.buffer;if(!l)return;const o=i.bind(this,e);s.listeners.push({event:t,listener:o}),l.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function yy(a){const e=a.querySelectorAll("source");[].slice.call(e).forEach(t=>{a.removeChild(t)})}function __(a,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,a.appendChild(t)}function Hf(a){return a==="audio"?1:0}class Jd{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&fe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((s,l)=>this.isLevelAllowed(s)&&l<=e);return this.clientRect=null,Jd.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const s=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let l=e.length-1;const o=Math.max(t,i);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=o||h.height>=o)&&s(h,e[c+1])){l=c;break}}return l}}const D_={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ft=D_,C_={HLS:"h"},I_=C_,w_="CMCD-Object",O_="CMCD-Request",k_="CMCD-Session",M_="CMCD-Status",Ra={OBJECT:w_,REQUEST:O_,SESSION:k_,STATUS:M_},P_={[Ra.OBJECT]:["br","d","ot","tb"],[Ra.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ra.SESSION]:["cid","pr","sf","sid","st","v"],[Ra.STATUS]:["bs","rtp"]};class pr{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof pr?i:new pr(i))),this.value=e,this.params=t}}const N_="Dict";function U_(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function B_(a,e,t,i){return new Error(`failed to ${a} "${U_(e)}" as ${t}`,{cause:i})}function Pi(a,e,t){return B_("serialize",a,e,t)}class _E{constructor(e){this.description=e}}const vy="Bare Item",F_="Boolean";function $_(a){if(typeof a!="boolean")throw Pi(a,F_);return a?"?1":"?0"}const G_="Byte Sequence";function j_(a){if(ArrayBuffer.isView(a)===!1)throw Pi(a,G_);return`:${U1(a)}:`}const H_="Integer";function V_(a){return a<-999999999999999||999999999999999<a}function DE(a){if(V_(a))throw Pi(a,H_);return a.toString()}function K_(a){return`@${DE(a.getTime()/1e3)}`}const z_="Decimal";function q_(a){const e=fE(a,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Pi(a,z_);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Y_="String",X_=/[\x00-\x1f\x7f]+/;function Q_(a){if(X_.test(a))throw Pi(a,Y_);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function W_(a){return a.description||a.toString().slice(7,-1)}const Z_="Token";function Ey(a){const e=W_(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Pi(e,Z_);return e}function yd(a){switch(typeof a){case"number":if(!fe(a))throw Pi(a,vy);return Number.isInteger(a)?DE(a):q_(a);case"string":return Q_(a);case"symbol":return Ey(a);case"boolean":return $_(a);case"object":if(a instanceof Date)return K_(a);if(a instanceof Uint8Array)return j_(a);if(a instanceof _E)return Ey(a);default:throw Pi(a,vy)}}const J_="Key";function vd(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw Pi(a,J_);return a}function eh(a){return a==null?"":Object.entries(a).map(([e,t])=>t===!0?`;${vd(e)}`:`;${vd(e)}=${yd(t)}`).join("")}function CE(a){return a instanceof pr?`${yd(a.value)}${eh(a.params)}`:yd(a)}function eD(a){return`(${a.value.map(CE).join(" ")})${eh(a.params)}`}function tD(a,e={whitespace:!0}){if(typeof a!="object")throw Pi(a,N_);const t=a instanceof Map?a.entries():Object.entries(a),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,l])=>{l instanceof pr||(l=new pr(l));let o=vd(s);return l.value===!0?o+=eh(l.params):(o+="=",Array.isArray(l.value)?o+=eD(l):o+=CE(l)),o}).join(`,${i}`)}function iD(a,e){return tD(a,e)}function nD(a){return a==="ot"||a==="sf"||a==="st"}function sD(a){return typeof a=="number"?fe(a):a!=null&&a!==""&&a!==!1}const wo=a=>Math.round(a),rD=(a,e)=>(e!=null&&e.baseUrl&&(a=B1(a,e.baseUrl)),encodeURIComponent(a)),yo=a=>wo(a/100)*100,aD={br:wo,d:wo,bl:yo,dl:yo,mtp:yo,nor:rD,rtp:yo,tb:wo};function lD(a,e){const t={};if(a==null||typeof a!="object")return t;const i=Object.keys(a).sort(),s=Ke({},aD,e==null?void 0:e.formatters),l=e==null?void 0:e.filter;return i.forEach(o=>{if(l!=null&&l(o))return;let c=a[o];const h=s[o];h&&(c=h(c,e)),!(o==="v"&&c===1)&&(o=="pr"&&c===1||sD(c)&&(nD(o)&&typeof c=="string"&&(c=new _E(c)),t[o]=c))}),t}function IE(a,e={}){return a?iD(lD(a,e),Ke({whitespace:!1},e)):""}function oD(a,e={}){const t={};if(!a)return t;const i=Object.entries(a),s=Object.entries(P_).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),l=i.reduce((o,c)=>{var h,f;const[g,m]=c,y=((h=s.find(S=>S[1].includes(g)))===null||h===void 0?void 0:h[0])||Ra.REQUEST;return(f=o[y])!==null&&f!==void 0||(o[y]={}),o[y][g]=m,o},{});return Object.entries(l).reduce((o,[c,h])=>(o[c]=IE(h,e),o),t)}function uD(a,e,t){return Ke(a,oD(e,t))}const cD="CMCD";function fD(a,e={}){if(!a)return"";const t=IE(a,e);return`${cD}=${encodeURIComponent(t)}`}const Sy=/CMCD=[^&#]+/;function dD(a,e,t){const i=fD(e,t);if(!i)return a;if(Sy.test(a))return a.replace(Sy,i);const s=a.includes("?")?"&":"?";return`${a}${s}${i}`}class hD{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Ft.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=s=>{try{const{frag:l,part:o}=s,c=this.hls.levels[l.level],h=this.getObjectType(l),f={d:(o||l).duration*1e3,ot:h};(h===Ft.VIDEO||h===Ft.AUDIO||h==Ft.MUXED)&&(f.br=c.bitrate/1e3,f.tb=this.getTopBandwidth(h)/1e3,f.bl=this.getBufferLength(h));const g=o?this.getNextPart(o):this.getNextFrag(l);g!=null&&g.url&&g.url!==l.url&&(f.nor=g.url),this.apply(s,f)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,s;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:I_.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const i=t.ot===Ft.INIT||t.ot===Ft.VIDEO||t.ot===Ft.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,c)=>(s.includes(c)&&(o[c]=t[c]),o),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),uD(e.headers,t,l)):e.url=dD(e.url,t,l)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var t,i;const{index:s,fragment:l}=e,o=(t=this.hls.levels[l.level])==null||(i=t.details)==null?void 0:i.partList;if(o){const{sn:c}=l;for(let h=o.length-1;h>=0;h--){const f=o[h];if(f.index===s&&f.fragment.sn===c)return o[h+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ft.TIMED_TEXT;if(e.sn==="initSegment")return Ft.INIT;if(t==="audio")return Ft.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ft.VIDEO:Ft.MUXED}getTopBandwidth(e){let t=0,i;const s=this.hls;if(e===Ft.AUDIO)i=s.audioTracks;else{const l=s.maxAutoLevel,o=l>-1?l+1:s.levels.length;i=s.levels.slice(0,o)}for(const l of i)l.bitrate>t&&(t=l.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Ft.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:De.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,c){t(l),this.loader.load(l,o,c)}}}}const gD=3e5;class mD extends fn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===Ct.SendAlternateToPenaltyBox&&i.flags===pi.MoveAllAlternatesMatchingHost){const s=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:f}=t.context;c&&s?o=this.getPathwayForGroupId(c,f,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&s&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==o),i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${s&&s.length} priorities: ${Je(l)} penalized: ${Je(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(l=>{s-i[l]>gD&&delete i[l]});for(let l=0;l<e.length;l++){const o=e[l];if(o in i)continue;if(o===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,tE(t),this.hls.trigger(b.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[c];h&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let l=0;l<s.length;l++)if(t===we.AUDIO_TRACK&&s[l].hasAudioGroup(e)||t===we.SUBTITLE_TRACK&&s[l].hasSubtitleGroup(e))return s[l].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},s={};e.forEach(l=>{const{ID:o,"BASE-ID":c,"URI-REPLACEMENT":h}=l;if(t.some(g=>g.pathwayId===o))return;const f=this.getLevelsForPathway(c).map(g=>{const m=new it(g.attrs);m["PATHWAY-ID"]=o;const y=m.AUDIO&&`${m.AUDIO}_clone_${o}`,S=m.SUBTITLES&&`${m.SUBTITLES}_clone_${o}`;y&&(i[m.AUDIO]=y,m.AUDIO=y),S&&(s[m.SUBTITLES]=S,m.SUBTITLES=S);const E=wE(g.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),x=new Oa({attrs:m,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:E,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let T=1;T<g.audioGroups.length;T++)x.addGroupId("audio",`${g.audioGroups[T]}_clone_${o}`);if(g.subtitleGroups)for(let T=1;T<g.subtitleGroups.length;T++)x.addGroupId("text",`${g.subtitleGroups[T]}_clone_${o}`);return x});t.push(...f),Ty(this.audioTracks,i,h,o),Ty(this.subtitleTracks,s,h,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+g)}const l={responseType:"json",url:s.href},o=t.steeringManifestLoadPolicy.default,c=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},f={onSuccess:(g,m,y,S)=>{this.log(`Loaded steering manifest: "${s}"`);const E=g.data;if((E==null?void 0:E.VERSION)!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;const{"RELOAD-URI":x,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":R}=E;if(x)try{this.uri=new self.URL(x,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${x}`);return}this.scheduleRefresh(this.uri||y.url),T&&this.clonePathways(T);const D={steeringManifest:E,url:s.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,D),R&&this.updatePathwayPriority(R)},onError:(g,m,y,S)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${m.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let E=this.timeToLoad*1e3;if(g.code===429){const x=this.loader;if(typeof(x==null?void 0:x.getResponseHeader)=="function"){const T=x.getResponseHeader("Retry-After");T&&(E=parseFloat(T)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,E)},onTimeout:(g,m,y)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(l,h,f)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Ty(a,e,t,i){a&&Object.keys(e).forEach(s=>{const l=a.filter(o=>o.groupId===s).map(o=>{const c=Ke({},o);return c.details=void 0,c.attrs=new it(c.attrs),c.url=c.attrs.URI=wE(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[s],c.attrs["PATHWAY-ID"]=i,c});a.push(...l)})}function wE(a,e,t,i){const{HOST:s,PARAMS:l,[t]:o}=i;let c;e&&(c=o==null?void 0:o[e],c&&(a=c));const h=new self.URL(a);return s&&!c&&(h.host=s),l&&Object.keys(l).sort().forEach(f=>{f&&h.searchParams.set(f,l[f])}),h.href}class dr extends fn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=dr.CDMCleanupPromise?[dr.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:i,initData:s}=t,l=`"${t.type}" event: init data type: "${i}"`;if(this.debug(l),s!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=ho(this.config));const c=o.map(Pf).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(o=>{const c=kf(o);let h,f;if(i==="sinf"){if(c!==Ge.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const E=dt(new Uint8Array(s));try{const x=Hd(JSON.parse(E).sinf),T=kv(x);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(T.subarray(8,24)),f=Ge.FAIRPLAY}catch(x){this.warn(`${l} Failed to parse sinf: ${x}`);return}}else{if(c!==Ge.WIDEVINE&&c!==Ge.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${c}`);return}const E=mL(s),x=E.filter(R=>!!R.systemId&&Mf(R.systemId)===c);x.length>1&&this.warn(`${l} Using first of ${x.length} pssh found for selected key-system ${c}`);const T=x[0];if(!T){E.length===0||E.some(R=>!R.systemId)?this.warn(`${l} contains incomplete or invalid pssh data`):this.log(`ignoring ${l} for ${E.map(R=>Mf(R.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(f=Mf(T.systemId),T.version===0&&T.data)if(f===Ge.WIDEVINE){const R=T.data.length-22;h=new Uint8Array(T.data.subarray(R,R+16))}else f===Ge.PLAYREADY&&(h=Yv(T.data))}if(!f||!h)return;const g=Ii.hexDump(h),{keyIdToKeySessionPromise:m,mediaKeySessions:y}=this;let S=m[g];for(let E=0;E<y.length;E++){const x=y[E],T=x.decryptdata;if(!T.keyId)continue;const R=Ii.hexDump(T.keyId);if(g===R||T.uri.replace(/-/g,"").indexOf(g)!==-1){if(S=m[R],T.pssh)break;delete m[R],T.pssh=new Uint8Array(s),T.keyId=h,S=m[g]=S.then(()=>this.generateRequestWithPreferredKeySession(x,i,s,"encrypted-event-key-match")),S.catch(D=>this.handleError(D));break}}if(!S){if(f!==c){this.log(`Ignoring "${t.type}" event with ${f} init data for selected key-system ${c}`);return}S=m[g]=this.getKeySystemSelectionPromise([f]).then(({keySystem:E,mediaKeys:x})=>{var T;this.throwIfDestroyed();const R=new Ma("ISO-23001-7",g,(T=Pf(E))!=null?T:"");return R.pssh=new Uint8Array(s),R.keyId=h,this.attemptSetMediaKeys(E,x).then(()=>{this.throwIfDestroyed();const D=this.createMediaKeySessionContext({decryptdata:R,keySystem:E,mediaKeys:x});return this.generateRequestWithPreferredKeySession(D,i,s,"encrypted-event-no-match")})}),S.catch(E=>this.handleError(E))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===Ge.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,c,h)=>!!o&&h.indexOf(o)===c,s=t.map(o=>o.audioCodec).filter(i),l=t.map(o=>o.videoCodec).filter(i);return s.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,c)=>{const h=f=>{const g=f.shift();this.getMediaKeysPromise(g,s,l).then(m=>o({keySystem:g,mediaKeys:m})).catch(m=>{f.length?h(f):m instanceof li?c(m):c(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return qv===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,t)}getMediaKeysPromise(e,t,i){const s=a1(e,t,i,this.config.drmSystemOptions),l=this.keySystemAccessPromises[e];let o=l==null?void 0:l.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Je(s)}`),o=this.requestMediaKeySystemAccess(e,s);const c=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(h=>{this.log(`Failed to obtain access to key-system "${e}": ${h}`)}),o.then(h=>{this.log(`Access for key-system "${h.keySystem}" obtained`);const f=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=h.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),f.then(m=>m?this.setMediaKeysServerCertificate(g,e,m):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),c.mediaKeys})}return o.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Ii.hexDump(e.keyId||[])}`);const s=i.createSession(),l={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ii.hexDump(e.keyId)}updateKeySession(e,t){var i;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Ii.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const s=ho(this.config),l=e.map(kf).filter(o=>!!o&&s.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(l).then(({keySystem:o})=>{const c=Pf(o);c?t(c):i(new Error(`Unable to find format for key-system "${o}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),s=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let l=this.keyIdToKeySessionPromise[i];return l||(l=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:h})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(c,h).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:h,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=l.then(c=>{const h="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,h,f,"playlist-key")})).catch(c=>this.handleError(c))),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof li?this.hls.trigger(b.ERROR,e.data):this.hls.trigger(b.ERROR,{type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const s=kf(e.keyFormat),l=s?[s]:ho(this.config);return this.attemptKeySystemAccess(l)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=ho(this.config)),e.length===0)throw new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Je({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>i.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,t,i,s){var l,o;const c=(l=this.config.drmSystems)==null||(o=l[e.keySystem])==null?void 0:o.generateRequest;if(c)try{const E=c.call(this.hls,t,i,e);if(!E)throw new Error("Invalid response from configured generateRequest filter");t=E.initDataType,i=E.initData?E.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){var h;if(this.warn(E.message),(h=this.hls)!=null&&h.config.debug)throw E}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const f=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${f} (init data type: ${t} length: ${i?i.byteLength:null})`);const g=new Kd,m=e._onmessage=E=>{const x=e.mediaKeysSession;if(!x){g.emit("error",new Error("invalid state"));return}const{messageType:T,message:R}=E;this.log(`"${T}" message event for session "${x.sessionId}" message size: ${R.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,R).catch(D=>{g.eventNames().length?g.emit("error",D):this.handleError(D)}):T==="license-release"?e.keySystem===Ge.FAIRPLAY&&(this.updateKeySession(e,fd("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${T}"`)},y=e._onkeystatuseschange=E=>{if(!e.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const T=e.keyStatus;g.emit("keyStatus",T),T==="expired"&&(this.warn(`${e.keySystem} expired for key ${f}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",m),e.mediaKeysSession.addEventListener("keystatuseschange",y);const S=new Promise((E,x)=>{g.on("error",x),g.on("keyStatus",T=>{T.startsWith("usable")?E():T==="output-restricted"?x(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):T==="internal-error"?x(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${T}"`)):T==="expired"?x(new Error("key expired while generating request")):this.warn(`unhandled key status change "${T}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var E;this.log(`Request generated for key-session "${(E=e.mediaKeysSession)==null?void 0:E.sessionId}" keyId: ${f}`)}).catch(E=>{throw new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:E,fatal:!1},`Error generating key-session request: ${E}`)}).then(()=>S).catch(E=>{throw g.removeAllListeners(),this.removeSession(e),E}).then(()=>(g.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const s=i;i=t,t=s}this.log(`key status change "${t}" for keyStatuses keyId: ${Ii.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ii.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,s=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,c)=>{const h={responseType:"arraybuffer",url:l},f=t.certLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,E,x)=>{o(y.data)},onError:(y,S,E,x)=>{c(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:$e({url:h.url,data:void 0},y)},`"${e}" certificate request failed (${l}). Status: ${y.code} (${y.text})`))},onTimeout:(y,S,E)=>{c(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:E,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(y,S,E)=>{c(new Error("aborted"))}};s.load(h,g,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((s,l)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),s(e)}).catch(o=>{l(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(i,"application/xml"),l=s.querySelectorAll("HttpHeader");if(l.length>0){let g;for(let m=0,y=l.length;m<y;m++){var o,c;g=l[m];const S=(o=g.querySelector("name"))==null?void 0:o.textContent,E=(c=g.querySelector("value"))==null?void 0:c.textContent;S&&E&&e.setRequestHeader(S,E)}}const h=s.querySelector("Challenge"),f=h==null?void 0:h.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return fd(atob(f))}setupLicenseXHR(e,t,i,s){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,t,i,s)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),l.call(this.hls,e,t,i,s)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((s,l)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const f=this.config.licenseResponseCallback;if(f)try{h=f.call(this.hls,c,o,e)}catch(g){this.error(g)}s(h)}else{const h=i.errorRetry,f=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||c.status>=400&&c.status<500)l(new li({type:pe.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:o,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${o}). Status: ${c.status} (${c.statusText})`));else{const g=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(s,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,o,e,t).then(({xhr:h,licenseChallenge:f})=>{e.keySystem==Ge.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(h,f)),h.send(f)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const i=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ma.clearKeyUriToKeyIdMap();const s=i.length;dr.CDMCleanupPromise=Promise.all(i.map(l=>this.removeSession(l)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(l=>{var o;this.log(`Could not clear media keys: ${l}`),(o=this.hls)==null||o.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))).then(()=>{s&&(this.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(l=>{var o;this.log(`Could not close sessions and clear media keys: ${l}`),(o=this.hls)==null||o.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((s,l)=>(s.indexOf(l.keyFormat)===-1&&s.push(l.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{drmSystemOptions:l}=this.config;return(o1(l)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c)}):Promise.resolve()).catch(c=>{var h;this.log(`Could not remove session: ${c}`),(h=this.hls)==null||h.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{var h;this.log(`Could not close session: ${c}`),(h=this.hls)==null||h.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}}}dr.CDMCleanupPromise=void 0;class li extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class pD{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const s=performance.now();if(t){if(this.lastTime){const l=s-this.lastTime,o=i-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*o/l,f=this.hls;if(f.trigger(b.FPS_DROP,{currentDropped:o,currentDecoded:c,totalDroppedFrames:i}),h>0&&o>f.config.fpsDroppedMonitoringThreshold*c){let g=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=g)&&(g=g-1,f.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:f.currentLevel}),f.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function OE(a,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=a,e.dispatchEvent(t)}function kE(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(e.id))try{if(a.addCue(e),!a.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Me.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,a.addCue(s)}catch(s){Me.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(a.mode=t)}function cr(a,e){const t=a.mode;if(t==="disabled"&&(a.mode="hidden"),a.cues)for(let i=a.cues.length;i--;)e&&a.cues[i].removeEventListener("enter",e),a.removeCue(a.cues[i]);t==="disabled"&&(a.mode=t)}function Ed(a,e,t,i){const s=a.mode;if(s==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const l=vD(a.cues,e,t);for(let o=0;o<l.length;o++)(!i||i(l[o]))&&a.removeCue(l[o])}s==="disabled"&&(a.mode=s)}function yD(a,e){if(e<=a[0].startTime)return 0;const t=a.length-1;if(e>a[t].endTime)return-1;let i=0,s=t,l;for(;i<=s;)if(l=Math.floor((s+i)/2),e<a[l].startTime)s=l-1;else if(e>a[l].startTime&&i<t)i=l+1;else return l;return a[i].startTime-e<e-a[s].startTime?i:s}function vD(a,e,t){const i=[],s=yD(a,e);if(s>-1)for(let l=s,o=a.length;l<o;l++){const c=a[l];if(c.startTime>=e&&c.endTime<=t)i.push(c);else if(c.startTime>t)return i}return i}function Oo(a){const e=[];for(let t=0;t<a.length;t++){const i=a[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(a[t])}return e}class ED extends Zd{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Oo(this.media.textTracks);for(let l=0;l<i.length;l++)if(i[l].mode==="hidden")t=i[l];else if(i[l].mode==="showing"){t=i[l];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Oo(i.textTracks).forEach(o=>{cr(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:s,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${o==null?void 0:o.groupId}`);return}const c=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${s} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,s=this.groupIds;let l=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(g=>!i||i.indexOf(g.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(g=>g.default)&&(this.selectDefaultTrack=!1),o.forEach((g,m)=>{g.id=m});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const c=this.hls.config.subtitlePreference;if(!l&&c){this.selectDefaultTrack=!1;const g=Oi(c,o);if(g>-1)l=o[g];else{const m=Oi(c,this.tracks);l=this.tracks[m]}}let h=this.findTrackId(l);h===-1&&l&&(h=this.findTrackId(null));const f={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,f),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const l=t[s];if(!(i&&!l.default||!i&&!e)&&(!e||gs(l,e)))return s}if(e){for(let s=0;s<t.length;s++){const l=t[s];if(Ba(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const l=t[s];if(Ba(e.attrs,l.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const s=t[i];if(pd(s,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===we.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&gs(e,i))return i;const s=Oi(e,this.tracksInGroup);if(s>-1){const l=this.tracksInGroup[s];return this.setSubtitleTrack(s),l}else{if(i)return null;{const l=Oi(e,t);if(l>-1)return t[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,s=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,c=o==null?void 0:o.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Oo(e.textTracks),i=this.currentTrack;let s;if(i&&(s=t.filter(l=>pd(i,l))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(l=>{l.mode!=="disabled"&&l!==s&&(l.mode="disabled")}),s){const l=this.subtitleDisplay?"showing":"hidden";s.mode!==l&&(s.mode=l)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!fe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&l)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:o,groupId:c="",name:h,type:f,url:g}=s;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:o,groupId:c,name:h,type:f,url:g});const m=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(m)}}function Da(a){let e=5381,t=a.length;for(;t;)e=e*33^a.charCodeAt(--t);return(e>>>0).toString()}const hr=.025;let qo=function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a}({});function SD(a,e,t){return`${a.identifier}-${t+1}-${Da(e)}`}class TD{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Vf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Vf(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=fe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Vf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<hr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?qo.Range:qo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return xD(this)}}function Vf(a,e){return a-e.start<e.duration/2&&!(Math.abs(a-(e.start+e.duration))<hr)?e.start:e.start+e.duration}function ME(a,e,t){const i=new self.URL(a,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function xD(a){return`["${a.identifier}" ${a.cue.pre?"<pre>":a.cue.post?"<post>":""}${a.timelineStart.toFixed(2)}-${a.resumeTime.toFixed(2)}]`}function Sd(a){const e=a.timelineStart,t=a.duration||0;return`["${a.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class bD{constructor(e,t,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const f=this.interstitial.playoutLimit,g=this.currentTime;this.startOffset+g>=f&&this.hls.trigger(b.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(t);this.interstitial=i,this.assetItem=s;let o=s.uri;try{o=ME(o,l.sessionId).href}catch{}l.loadSource(o);const c=()=>{this.hasDetails=!0};l.once(b.LEVEL_LOADED,c),l.once(b.AUDIO_TRACK_LOADED,c),l.once(b.SUBTITLE_TRACK_LOADED,c),l.on(b.MEDIA_ATTACHING,(h,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&f.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,s=De.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=De.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${Sd(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const xy=.033;class AD extends fn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=s[i])!=null&&l.event;){var l;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let s=0;s<i.length;s++){let l=i[s];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return s}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let s=e;s<=t&&i[s];s++){const l=i[s].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var i;if(((i=t[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,t){const i=e.assetList,s=i.length;if(s>1)for(let l=0;l<s;l++){const o=i[l];if(!o.error){const c=o.timelineStart;if(t===c||t>c&&t<c+(o.duration||0))return l}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const s=i.assetList,l=s[s.length-1];if(l)return l.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:s}=i,l=this.events,o=this.parseDateRanges(s,{url:i.url},t),c=Object.keys(s),h=l?l.filter(f=>!c.includes(f.identifier)):[];o.length&&o.sort((f,g)=>{const m=f.cue.pre,y=f.cue.post,S=g.cue.pre,E=g.cue.post;if(m&&!S)return-1;if(S&&!m||y&&!E)return 1;if(E&&!y)return-1;if(!m&&!S&&!y&&!E){const x=f.startTime,T=g.startTime;if(x!==T)return x-T}return f.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=o,h.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(e,h)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,l=this.parseSchedule(i,e);(t.length||(s==null?void 0:s.length)!==l.length||l.some((c,h)=>Math.abs(c.playout.start-s[h].playout.start)>.005||Math.abs(c.playout.end-s[h].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){const s=[],l=Object.keys(e);for(let o=0;o<l.length;o++){const c=l[o],h=e[c];if(h.isInterstitial){let f=this.eventMap[c];f?f.setDateRange(h):(f=new TD(h,t),this.eventMap[c]=f,i===!1&&(f.appendInPlace=i)),s.push(f)}}return s}parseSchedule(e,t){const i=[],s=t.main.details,l=s.live?1/0:s.edge;let o=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,f=0;if(e.forEach((g,m)=>{const y=g.cue.pre,S=g.cue.post,E=e[m-1]||null,x=g.appendInPlace,T=S?l:g.startOffset,R=g.duration,D=g.timelineOccupancy===qo.Range?R:0,A=g.resumptionOffset,O=(E==null?void 0:E.startTime)===T,I=T+g.cumulativeDuration;let N=x?I+R:T+A;if(y||!S&&T<=0){const F=f;f+=D,g.timelineStart=I;const H=o;o+=R,i.push({event:g,start:I,end:N,playout:{start:H,end:o},integrated:{start:F,end:f}})}else if(T<=l){if(!O){const B=T-h;if(B>xy){const ie=h,ae=f;f+=B;const ve=o;o+=B;const de={previousEvent:e[m-1]||null,nextEvent:g,start:ie,end:ie+B,playout:{start:ve,end:o},integrated:{start:ae,end:f}};i.push(de)}else B>0&&E&&(E.cumulativeDuration+=B,i[i.length-1].end=T)}S&&(N=I),g.timelineStart=I;const F=f;f+=D;const H=o;o+=R,i.push({event:g,start:I,end:N,playout:{start:H,end:o},integrated:{start:F,end:f}})}else return;const M=g.resumeTime;S||M>l?h=l:h=M}),h<l){var c;const g=h,m=f,y=l-h;f+=y;const S=o;o+=y,i.push({previousEvent:((c=i[i.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:g+y,playout:{start:S,end:o},integrated:{start:m,end:f}})}this.setDurations(l,o,f)}else i.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,s=i.live?1/0:i.edge;let l=0,o=-1;e.forEach((c,h)=>{const f=c.cue.pre,g=c.cue.post,m=f?0:g?s:c.startTime;this.updateAssetDurations(c),o===m?c.cumulativeDuration=l:(l=0,o=m),!g&&c.snapOptions.in&&(c.resumeAnchor=ps(null,i.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<xy&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const S=fe(c.resumeOffset)?c.resumeOffset:c.duration;l+=S})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>hr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):t?!Object.keys(t).some(o=>{const c=t[o].details,h=c.edge;if(i>=h)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${h}`),!1;const f=ps(null,c.fragments,i);if(!f)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const g=o==="audio"?.175:0;return Math.abs(f.start-i)<hr+g||Math.abs(f.end-i)<hr+g?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,s=!1,l=!1;e.assetList.forEach((o,c)=>{const h=t+i;o.startOffset=i,o.timelineStart=h,s||(s=o.duration===null),l||(l=!!o.error);const f=o.error?0:o.duration||0;i+=f}),s&&!l?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Nn(a){return`[${a.event?'"'+a.event.identifier+'"':"primary"}: ${a.start.toFixed(2)}-${a.end.toFixed(2)}]`}class RD{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let s;try{s=ME(i,this.hls.sessionId,e.baseUrl)}catch(y){const S=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,y,i);this.hls.trigger(b.ERROR,S);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const l=this.hls.config,o=l.loader,c=new o(l),h={responseType:"json",url:s.href},f=l.interstitialAssetListLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,E,x)=>{const T=y.data,R=T==null?void 0:T.ASSETS;if(!Array.isArray(R)){const D=this.assignAssetListError(e,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),E.url,S,x);this.hls.trigger(b.ERROR,D);return}e.assetListResponse=T,this.hls.trigger(b.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:x})},onError:(y,S,E,x)=>{const T=this.assignAssetListError(e,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${S.url})`),S.url,x,E);this.hls.trigger(b.ERROR,T)},onTimeout:(y,S,E)=>{const x=this.assignAssetListError(e,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${S.url})`),S.url,y,E);this.hls.trigger(b.ERROR,x)}};return c.load(h,g,m),this.hls.trigger(b.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,i,s,l,o){return e.error=i,{type:pe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:i,networkDetails:o,stats:l}}}function an(a,e,t){Mi(a,e,t),a.addEventListener(e,t)}function Mi(a,e,t){a.removeEventListener(e,t)}function by(a){a==null||a.play().catch(()=>{})}class LD extends fn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const o=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const c=this.playingItem;if(!c){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(),this.checkBuffer(),o&&i<c.start||i>=c.end){var h;const y=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o){const S=this.findItemIndex(c);if(y>S){const E=this.schedule.findJumpRestrictedIndex(S+1,y);if(E>S){this.setSchedulePosition(E);return}}}this.setSchedulePosition(y);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(c)){const y=c.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,y))}return}const g=f.timelineStart,m=f.duration||0;(o&&i<g||i>=g+m)&&this.setScheduleToAssetAtTime(i,f)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const c=this.findItemIndex(s);this.setSchedulePosition(c+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,l)},this.onScheduleUpdate=(i,s)=>{const l=this.schedule,o=this.playingItem,c=l.events||[],h=l.items||[],f=l.durations,g=i.map(S=>S.identifier),m=!!(c.length||g.length);if(m&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(S=>Nn(S))}`),g.length&&this.log(`Removed events ${g}`),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const E=S.assetItem.timelineStart,x=S.timelineOffset-E;if(x)try{S.timelineOffset=E}catch(T){Math.abs(x)>hr&&this.warn(`${T} ("${S.assetId}" ${S.timelineOffset}->${E})`)}}}),o){const S=this.updateItem(o,this.timelinePos);this.itemsMatch(o,S)&&(this.playingItem=S,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const y=this.bufferingItem;if(y){const S=this.updateItem(y,this.bufferedPos);this.itemsMatch(y,S)?this.bufferingItem=S:y.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(y.event,null))}if(i.forEach(S=>{S.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),m||s){if(this.hls.trigger(b.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:f,removedIds:g}),this.isInterstitial(o)&&g.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new RD(e),this.schedule=new AD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(b.MEDIA_ENDED,this.onMediaEnded,this),e.on(b.ERROR,this.onError,this),e.on(b.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(b.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(b.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(b.MEDIA_ENDED,this.onMediaEnded,this),e.off(b.ERROR,this.onError,this),e.off(b.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Mi(e,"play",this.onPlay),Mi(e,"pause",this.onPause),Mi(e,"seeking",this.onSeeking),Mi(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;an(i,"seeking",this.onSeeking),an(i,"timeupdate",this.onTimeupdate),an(i,"play",this.onPlay),an(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const l=this.findItemIndex(i);this.setSchedulePosition(l)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=m=>m&&e.getAssetPlayer(m.identifier),s=(m,y,S,E,x)=>{if(m){let T=m[y].start;const R=m.event;if(R){if(y==="playout"||R.timelineOccupancy!==qo.Point){const D=i(S);(D==null?void 0:D.interstitial)===R&&(T+=D.assetItem.startOffset+D[x])}}else{const D=E==="bufferedPos"?o():e[E];T+=D-m.start}return T}return 0},l=(m,y)=>{if(m!==0&&y!=="primary"&&e.schedule.length){var S;const E=e.schedule.findItemIndexAtTime(m),x=(S=e.schedule.items)==null?void 0:S[E];if(x){const T=x[y].start-x.start;return m+T}}return m},o=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?c("primary"):Math.max(m,0)},c=m=>{var y;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:e.schedule.durations[m]},h=(m,y)=>{var S,E;const x=e.effectivePlayingItem;if(x!=null&&(S=x.event)!=null&&S.restrictions.skip)return;e.log(`seek to ${m} "${y}"`);const T=e.effectivePlayingItem,R=e.schedule.findItemIndexAtTime(m,y),D=(E=e.schedule.items)==null?void 0:E[R],A=e.getBufferingPlayer(),O=A==null?void 0:A.interstitial,I=O==null?void 0:O.appendInPlace,N=T&&e.itemsMatch(T,D);if(T&&(I||N)){const F=i(e.playingAsset),H=(F==null?void 0:F.media)||e.primaryMedia;if(H){const B=y==="primary"?H.currentTime:s(T,y,e.playingAsset,"timelinePos","currentTime"),ie=m-B,ae=(I?B:H.currentTime)+ie;if(ae>=0&&(!F||I||ae<=F.duration)){H.currentTime=ae;return}}}if(D){let F=m;if(y!=="primary"){const B=D[y].start,ie=m-B;F=D.start+ie}const H=!e.isInterstitial(D);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(H||D.event.appendInPlace)){const B=e.media||(I?A==null?void 0:A.media:null);B&&(B.currentTime=F)}else if(T){const B=e.findItemIndex(T);if(R>B){const ae=e.schedule.findJumpRestrictedIndex(B+1,R);if(ae>B){e.setSchedulePosition(ae);return}}let ie=0;if(H)e.timelinePos=F,e.checkBuffer();else{var M;const ae=D==null||(M=D.event)==null?void 0:M.assetList;if(ae){const ve=m-(D[y]||D).start;for(let de=ae.length;de--;){const ue=ae[de];if(ue.duration&&ve>=ue.startOffset&&ve<ue.startOffset+ue.duration){ie=de;break}}}}e.setSchedulePosition(R,ie)}}},f=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const y=t();return e.isInterstitial(y)?y:null},g={get currentTime(){const m=f(),y=e.effectivePlayingItem;return y&&y===m?s(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(m){const y=f(),S=e.effectivePlayingItem;S&&S===y&&h(m+S.playout.start,"playout")},get duration(){const m=f();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const y=(m=f())==null?void 0:m.event.assetList;return y?y.map(S=>e.getAssetPlayer(S.identifier)):[]},get playingIndex(){var m;const y=(m=f())==null?void 0:m.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return f()}};this.manager={get events(){var m,y;return((m=e.schedule)==null||(y=m.events)==null?void 0:y.slice(0))||[]},get schedule(){var m,y;return((m=e.schedule)==null||(y=m.items)==null?void 0:y.slice(0))||[]},get interstitialPlayer(){return f()?g:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return o()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){h(m,"primary")},get duration(){return c("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){h(m,"integrated")},get duration(){return c("integrated")},get seekableStart(){var m;return l(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,y=m==null?void 0:m.event;if(y&&!y.restrictions.skip){const S=e.findItemIndex(m);if(y.appendInPlace){const E=m.playout.start+m.event.duration;h(E+.001,"playout")}else e.advanceAfterAssetEnded(y,S,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let l=this.media;!l&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(l=this.primaryMedia);const o=(i=l)==null?void 0:i.currentTime;if(!(o===void 0||!fe(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Je(l)}`),this.detachedData=l}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var i,s;if(e.media===t)return;let l=null;const o=this.hls,c=e!==o,h=c&&e.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;let g;if(o.media)h&&(l=o.transferMedia(),this.detachedData=l),g="Primary";else if(f){const S=this.getBufferingPlayer();S?(l=S.transferMedia(),g=`${S}`):g="detached MediaSource"}else g="detached media";if(!l){if(f)l=this.detachedData,this.log(`using detachedData: MediaSource ${Je(l)}`);else if(!this.detachedData||o.media===t){const S=this.playerQueue;S.length>1&&S.forEach(E=>{if(c&&E.interstitial.appendInPlace!==h){const x=E.interstitial;this.clearInterstitial(E.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=l&&"mediaSource"in l&&((s=l.mediaSource)==null?void 0:s.readyState)!=="closed",y=m&&l?l:t;if(this.log(`${m?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${g}`),y===l){const S=c&&e.assetId===this.schedule.assetIdAtEnd;y.overrides={duration:this.schedule.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const l=this.hls.startPosition;if(this.timelinePos=l,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,c=e.findItemIndexAtTime(o);this.setSchedulePosition(c)}}else if(s&&!this.playingItem){const l=e.findItemIndex(s);this.setSchedulePosition(l)}}advanceAfterAssetEnded(e,t,i){const s=i+1;if(!e.isAssetPastPlayoutLimit(s)&&!e.assetList[s].error)this.setSchedulePosition(t,s);else{const l=this.schedule.items;if(l){const o=t+1,c=l.length;if(o>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.timelinePos=h,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,s=t.parentIdentifier,l=i.getEvent(s);if(l){const o=i.findEventIndex(s),c=i.findAssetIndex(l,e);this.setSchedulePosition(o,c)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const s=e>=0?i[e]:null,l=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(l)){var c;const f=l.event,g=this.playingAsset,m=g==null?void 0:g.identifier,y=m?this.getAssetPlayer(m):null;if(y&&m&&(!this.eventItemsMatch(l,s)||t!==void 0&&m!==((c=f.assetList)==null?void 0:c[t].identifier))){var h;const S=f.findAssetIndex(g);this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${f.assetList.length} ${Sd(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(b.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:S,event:f,schedule:i.slice(0),scheduleIndex:e,player:y}),this.retreiveMediaSource(m,s),y.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(l,s)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Nn(l)}`),f.hasPlayed=!0,this.hls.trigger(b.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){this.updateSchedule();const S=this.schedule.items;if(s&&S){const E=this.schedule.findItemIndex(s);this.advanceSchedule(E,S,t,l,o)}return}}this.advanceSchedule(e,i,t,l,o)}advanceSchedule(e,t,i,s,l){const o=e>=0?t[e]:null,c=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(f=>{const g=f.interstitial,m=this.schedule.findEventIndex(g.identifier);(m<e||m>e+1)&&this.clearInterstitial(g,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const f=o.event;i===void 0&&(i=this.schedule.findAssetIndex(f,this.timelinePos));const g=this.waitingItem;this.assetsBuffered(o,c)||this.setBufferingItem(o);let m=this.preloadAssets(f,i);if(this.eventItemsMatch(o,g||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Nn(o)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(b.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const y=f.assetList[i];if(!y){const S=t[e+1],E=this.media;S&&E&&!this.isInterstitial(S)&&E.currentTime<S.start&&(E.currentTime=this.timelinePos=S.start),this.advanceAfterAssetEnded(f,e,i||0);return}if(m||(m=this.getAssetPlayer(y.identifier)),m===null||m.destroyed){const S=f.assetList.length;this.warn(`asset ${i+1}/${S} player destroyed ${f}`),m=this.createAssetPlayer(f,y,i)}if(!this.eventItemsMatch(o,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(m,i,t,e,c),this.shouldPlay&&by(m.media)}else o!==null?(this.resumePrimary(o,e,s),this.shouldPlay&&by(this.hls.media)):l&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Nn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const l=this.schedule.items;l&&(this.log(`resumed ${Nn(e)}`),this.hls.trigger(b.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:De.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(b.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(b.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],s=$e($e({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=$e($e({},this.altSelection),{},{audio:i});return}const l=$e($e({},s),{},{audio:i});this.mediaSelection=l}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=$e($e({},this.altSelection),{},{subtitles:i});return}const l=$e($e({},s),{},{subtitles:i});this.mediaSelection=l}onAudioTrackSwitching(e,t){const i=Pp(t);this.playerQueue.forEach(s=>s.hls.setAudioOption(t)||s.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=Pp(t);this.playerQueue.forEach(s=>s.hls.setSubtitleOption(t)||t.id!==-1&&s.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const l=t[s];if(l.cue.post){var i;const o=this.schedule.findEventIndex(l.identifier),c=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=De.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const s=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}const o=this.playingItem,c=this.findItemIndex(o);let h=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var f,g;const m=this.findItemIndex(l),y=Math.min(m+1,t.length-1),S=t[y];if((h===-1&&l&&e>=l.end||(f=S.event)!=null&&f.appendInPlace&&e+.01>=S.start)&&(h=y),y-c>1&&(l==null||(g=l.event)==null?void 0:g.appendInPlace)===!1)return;if(this.bufferedPos=e,h>m&&h>c)this.bufferedToItem(S);else{const E=this.primaryDetails;this.primaryLive&&E&&e>E.edge-E.targetduration&&S.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(S)&&this.preloadAssets(S.event,0)}}else i&&o&&!this.itemsMatch(o,l)&&(h===c?this.bufferedToItem(o):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const l=this.getAssetPlayer(s.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:s,events:l}=i;if(!s||!l)return t;const o=this.isInterstitial(e),c=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const h=c?c.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${Nn(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),o?e.event.assetList.forEach(f=>{const g=this.getAssetPlayer(f.identifier);g&&g.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering()))}this.hls.trigger(b.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,s=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(s||!l){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const c=i.assetList[t],h=this.primaryMedia;c&&h&&this.bufferAssetPlayer(o,h)}}}preloadAssets(e,t){const i=e.assetUrl,s=e.assetList.length,l=s===0&&!e.assetListLoader,o=e.cue.once;if(l){const h=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let f,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(e.cue.pre||e.cue.post)){const y=g-h;y>0&&(f=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:s} ${e}${f?` live-start: ${g} start-offset: ${f}`:""}`),i)return this.createAsset(e,0,0,h,e.duration,i);const m=this.assetListLoader.loadAssetList(e,f);m&&(e.assetListLoader=m)}else if(!o&&s){for(let h=t;h<s;h++){const f=e.assetList[h],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,h)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,s,l,o){const c={parentIdentifier:e.identifier,identifier:SD(e,o,t),duration:l,startOffset:i,timelineStart:s,uri:o};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,i){this.log(`create HLSAssetPlayer for ${Sd(t)}`);const s=this.hls,l=s.userConfig;let o=l.videoPreference;const c=s.loadLevelObj||s.levels[s.currentLevel];(o||c)&&(o=Ke({},o),c.videoCodec&&(o.videoCodec=c.videoCodec),c.videoRange&&(o.allowedVideoRanges=[c.videoRange]));const h=s.audioTracks[s.audioTrack],f=s.subtitleTracks[s.subtitleTrack];let g=0;if(this.primaryLive||e.appendInPlace){const A=this.timelinePos-t.timelineStart;if(A>1){const O=t.duration;O&&A<O&&(g=A)}}const m=t.identifier,y=$e($e({},l),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||l.audioPreference,subtitlePreference:f||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const S=y.cmcd;S!=null&&S.sessionId&&S.contentId&&(y.cmcd=Ke({},S,{contentId:Da(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const E=new bD(this.HlsPlayerClass,y,e,t);this.playerQueue.push(E),e.assetList[i]=t;const x=A=>{if(A.live){const N=new Error(`Interstitials MUST be VOD assets ${e}`),M={fatal:!0,type:pe.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(M,e,this.schedule.findEventIndex(e.identifier),i,N.message);return}const O=A.edge-A.fragmentStart,I=t.duration;(I===null||O>I)&&(this.log(`Interstitial asset "${m}" duration change ${I} > ${O}`),t.duration=O,this.updateSchedule())};E.on(b.LEVEL_UPDATED,(A,{details:O})=>x(O)),E.on(b.LEVEL_PTS_UPDATED,(A,{details:O})=>x(O));const T=(A,O)=>{const I=this.getAssetPlayer(m);if(I&&O.tracks){I.off(b.BUFFER_CODECS,T),I.tracks=O.tracks;const N=this.primaryMedia;this.bufferingAsset===I.assetItem&&N&&!I.media&&this.bufferAssetPlayer(I,N)}};E.on(b.BUFFER_CODECS,T);const R=()=>{var A;const O=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${O}`),!O)return;const I=this.schedule.findEventIndex(e.identifier),N=e.findAssetIndex(t),M=N+1,F=(A=this.schedule.items)==null?void 0:A[I];if(this.isInterstitial(F))if(N!==-1&&!e.isAssetPastPlayoutLimit(M)&&!e.assetList[M].error)this.bufferedToItem(F,M);else{var H;const B=(H=this.schedule.items)==null?void 0:H[I+1];B&&this.bufferedToItem(B)}};E.on(b.BUFFERED_TO_END,R);const D=A=>()=>{if(!this.getAssetPlayer(m))return;this.shouldPlay=!0;const I=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,I,A)};return E.once(b.MEDIA_ENDED,D(i)),E.once(b.PLAYOUT_LIMIT_REACHED,D(1/0)),E.on(b.ERROR,(A,O)=>{const I=this.getAssetPlayer(m);if(O.details===z.BUFFER_STALLED_ERROR){if(I!=null&&I.media){const N=I.currentTime,M=I.duration-N;N&&e.appendInPlace&&M/I.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${m} ${e} at ${I.media.currentTime}`),R()):(this.warn(`Stalled at ${N} of ${N+M} in asset ${m} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(O,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${O.error} ${e}`)}),E.on(b.DESTROYING,()=>{if(!this.getAssetPlayer(m))return;const O=new Error(`Asset player destroyed unexpectedly ${m}`),I={fatal:!0,type:pe.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:O};this.handleAssetItemError(I,e,this.schedule.findEventIndex(e.identifier),i,O.message)}),this.hls.trigger(b.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:E}),E}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&Nn(t)}`);const s=this.playerQueue[i];this.transferMediaFromPlayer(s,t),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,s,l){const{interstitial:o,assetItem:c,assetId:h}=e,f=o.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!g||g.identifier!==h)&&(g&&(this.clearAssetPlayer(g.identifier,i[s]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${f} ${e}`),this.hls.trigger(b.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,t){var i,s;const{interstitial:l,assetItem:o,assetId:c}=e,h=this.schedule.findEventIndex(l.identifier),f=(i=this.schedule.items)==null?void 0:i[h];if(!f)return;this.setBufferingItem(f),this.bufferingAsset=o;const g=this.getBufferingPlayer();if(g===e)return;const m=l.appendInPlace;if(m&&(g==null?void 0:g.interstitial.appendInPlace)===!1)return;const y=(g==null?void 0:g.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(m&&o!==this.playingAsset){if(!e.tracks)return;if(y&&!Lv(y,e.tracks)){const S=new Error(`Asset "${c}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(y)}')`),E={fatal:!0,type:pe.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:S},x=l.findAssetIndex(o);this.handleAssetItemError(E,l,h,x,S.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,s,l){if(e.details===z.BUFFER_STALLED_ERROR)return;const o=t.assetList[s]||null;let c=null;if(o){const m=this.getAssetPlayerQueueIndex(o.identifier);c=this.playerQueue[m]||null}const h=this.schedule.items,f=Ke({},e,{fatal:!1,errorAction:ka(!0),asset:o,assetListIndex:s,event:t,schedule:h,scheduleIndex:i,player:c});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(b.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;const g=new Error(l);o&&(this.playingAsset!==o&&this.clearAssetPlayer(o.identifier,null),o.error=g),t.assetList.some(m=>!m.error)?t.appendInPlace&&(t.error=g):t.error=g,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?Nn(i):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const l=this.updateItem(i,s);if(this.itemsMatch(i,l))this.clearInterstitial(e,null);else{const o=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(o)}}else this.checkStart()}onAssetListLoaded(e,t){var i;const s=t.event,l=s.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(l))return;const c=s.timelineStart,h=s.duration;let f=0;o.forEach((E,x)=>{const T=parseFloat(E.DURATION);this.createAsset(s,x,f,c+f,T,E.URI),f+=T}),s.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${h}) ${s}`);const g=this.waitingItem,m=(g==null?void 0:g.event.identifier)===l;this.updateSchedule();const y=(i=this.bufferingItem)==null?void 0:i.event;if(m){var S;const E=this.schedule.findEventIndex(l),x=(S=this.schedule.items)==null?void 0:S[E];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.primaryFallback(s);return}this.setBufferingItem(x)}this.setSchedulePosition(E)}else if((y==null?void 0:y.identifier)===l&&y.appendInPlace){const E=s.assetList[0],x=this.getAssetPlayer(E.identifier),T=this.primaryMedia;E&&x&&T&&this.bufferAssetPlayer(x,T)}}onError(e,t){switch(t.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case z.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Ay=500;class _D extends Vd{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",me.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=te.IDLE,this.setInterval(Ay),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:s}=t;if(Et(i)&&(this.fragPrevious=i),this.state=te.IDLE,!s)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const c=i.start;for(let f=0;f<l.length;f++)if(c>=l[f].start&&c<=l[f].end){o=l[f];break}const h=i.start+i.duration;o?o.end=h:(o={start:c,end:h},l.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:s}=t;if(i===0&&s!==Number.POSITIVE_INFINITY){const l=s-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let c=0;c<o.length;){if(o[c].end<=l){o.shift();continue}else if(o[c].start<l)o[c].start=l;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,l,me.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===me.SUBTITLE&&(t.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==te.STOPPED&&(this.state=te.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&RE(this.levels,t)){this.levels=t.map(i=>new Oa(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const s=new Oa(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,me.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==te.STOPPED&&this.setInterval(Ay)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:s,levels:l}=this,{details:o,id:c}=t;if(!l){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=l[c];if(c>=l.length||!h)return;this.log(`Subtitle track ${c} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(o.live||(i=h.details)!=null&&i.live){const m=this.mainDetails;if(o.deltaUpdateFailed||!m)return;const y=m.fragments[0];if(!h.details)o.hasProgramDateTime&&m.hasProgramDateTime?(Ko(o,m),f=o.fragmentStart):y&&(f=y.start,hd(o,f));else{var g;f=this.alignPlaylists(o,h.details,(g=this.levelLastLoaded)==null?void 0:g.details),f===0&&y&&(f=y.start,hd(o,f))}}h.details=o,this.levelLastLoaded=h,c===s&&(this.hls.trigger(b.SUBTITLE_TRACK_UPDATED,{details:o,id:c,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===te.IDLE&&(ps(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,s=t.decryptdata,l=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&fr(s.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,jd(s.method)).catch(c=>{throw l.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();l.trigger(b.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:o,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=te.IDLE})}}doTick(){if(!this.media){this.state=te.IDLE;return}if(this.state===te.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:s}=this,l=this.getLoadPosition(),o=De.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,s.maxBufferHole),{end:c,len:h}=o,f=i.details,g=this.hls.maxBufferLength+f.levelTargetDuration;if(h>g)return;const m=f.fragments,y=m.length,S=f.edge;let E=null;const x=this.fragPrevious;if(c<S){const D=s.maxFragLookUpTolerance,A=c>S-D?0:D;E=ps(x,m,Math.max(m[0].start,c),A),!E&&x&&x.start<m[0].start&&(E=m[0])}else E=m[y-1];if(E=this.filterReplacedPrimary(E,i.details),!E)return;const T=E.sn-f.startSN,R=m[T-1];if(R&&R.cc===E.cc&&this.fragmentTracker.getState(R)===ht.NOT_LOADED&&(E=R),this.fragmentTracker.getState(E)===ht.NOT_LOADED){const D=this.mapToInitFragWhenRequired(E);D&&this.loadFragment(D,i,c)}}}loadFragment(e,t,i){Et(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new DD(this.tracksBuffered[this.currentTrackId]||[])}}class DD{constructor(e){this.buffered=void 0;const t=(i,s,l)=>{if(s=s>>>0,s>l-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${l})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const CD={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},PE=a=>String.fromCharCode(CD[a]||a),mi=15,tn=100,ID={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},wD={17:2,18:4,21:6,22:8,23:10,19:13,20:15},OD={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},kD={25:2,26:4,29:6,30:8,31:10,27:13,28:15},MD=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class PD{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Me.log(`${this.time} [${e}] ${i}`)}}}const cs=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class NE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const s=t[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ND{constructor(){this.uchar=" ",this.penState=new NE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class UD{constructor(e){this.chars=[],this.pos=0,this.currPenState=new NE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<tn;t++)this.chars.push(new ND);this.logger=e}equals(e){for(let t=0;t<tn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<tn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<tn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>tn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=tn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=PE(e);if(this.pos>=tn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<tn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<tn;i++){const s=this.chars[i].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Kf{constructor(e){this.rows=[],this.currRow=mi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<mi;t++)this.rows.push(new UD(e));this.logger=e}reset(){for(let e=0;e<mi;e++)this.rows[e].clear();this.currRow=mi-1}equals(e){let t=!0;for(let i=0;i<mi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<mi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<mi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Je(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<mi;c++)this.rows[c].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const c=o.rows[l].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(o.rows[l+f])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,o=Math.max(l-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Je(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",s=-1;for(let l=0;l<mi;l++){const o=this.rows[l].getTextString();o&&(s=l+1,e?t.push("Row "+s+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Ry{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Kf(i),this.nonDisplayedMemory=new Kf(i),this.lastOutputScreen=new Kf(i),this.currRollUpRow=this.displayedMemory.rows[mi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[mi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[i]}this.logger.log(2,"MIDROW: "+Je(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ly{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=FD(),this.logger=void 0;const s=this.logger=new PD;this.channels=[null,new Ry(e,t,s),new Ry(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const s=t[i]&127,l=t[i+1]&127;let o=!1,c=null;if(s===0&&l===0)continue;this.logger.log(3,()=>"["+cs([t[i],t[i+1]])+"] -> ("+cs([s,l])+")");const h=this.cmdHistory;if(s>=16&&s<=31){if(BD(s,l,h)){vo(null,null,h),this.logger.log(3,()=>"Repeated command ("+cs([s,l])+") is dropped");continue}vo(s,l,this.cmdHistory),o=this.parseCmd(s,l),o||(o=this.parseMidrow(s,l)),o||(o=this.parsePAC(s,l)),o||(o=this.parseBackgroundAttributes(s,l))}else vo(null,null,h);if(!o&&(c=this.parseChars(s,l),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+cs([s,l])+" orig: "+cs([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;const l=e===20||e===21||e===23?1:2,o=this.channels[l];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=l,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+cs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(s||l))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?ID[e]:OD[e]:i=o===1?wD[e]:kD[e];const c=this.channels[o];return c?(c.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,t){let i,s=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19){let o;l===17?o=t+80:l===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+PE(o)+"' in channel "+i),s=[o]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+cs(s).join(",")),s}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(i||s))return!1;let l;const o={};e===16||e===24?(l=Math.floor((t-32)/2),o.background=MD[l],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}vo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function vo(a,e,t){t.a=a,t.b=e}function BD(a,e,t){return t.a===a&&t.b===e}function FD(){return{a:null,b:null}}var th=function(){if(Vo!=null&&Vo.VTTCue)return self.VTTCue;const a=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const f=h.toLowerCase();return~c.indexOf(f)?f:!1}function i(c){return t(a,c)}function s(c){return t(e,c)}function l(c,...h){let f=1;for(;f<arguments.length;f++){const g=arguments[f];for(const m in g)c[m]=g[m]}return c}function o(c,h,f){const g=this,m={enumerable:!0};g.hasBeenReset=!1;let y="",S=!1,E=c,x=h,T=f,R=null,D="",A=!0,O="auto",I="start",N=50,M="middle",F=50,H="middle";Object.defineProperty(g,"id",l({},m,{get:function(){return y},set:function(B){y=""+B}})),Object.defineProperty(g,"pauseOnExit",l({},m,{get:function(){return S},set:function(B){S=!!B}})),Object.defineProperty(g,"startTime",l({},m,{get:function(){return E},set:function(B){if(typeof B!="number")throw new TypeError("Start time must be set to a number.");E=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",l({},m,{get:function(){return x},set:function(B){if(typeof B!="number")throw new TypeError("End time must be set to a number.");x=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",l({},m,{get:function(){return T},set:function(B){T=""+B,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",l({},m,{get:function(){return R},set:function(B){R=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",l({},m,{get:function(){return D},set:function(B){const ie=i(B);if(ie===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=ie,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",l({},m,{get:function(){return A},set:function(B){A=!!B,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",l({},m,{get:function(){return O},set:function(B){if(typeof B!="number"&&B!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",l({},m,{get:function(){return I},set:function(B){const ie=s(B);if(!ie)throw new SyntaxError("An invalid or illegal string was specified.");I=ie,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",l({},m,{get:function(){return N},set:function(B){if(B<0||B>100)throw new Error("Position must be between 0 and 100.");N=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",l({},m,{get:function(){return M},set:function(B){const ie=s(B);if(!ie)throw new SyntaxError("An invalid or illegal string was specified.");M=ie,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",l({},m,{get:function(){return F},set:function(B){if(B<0||B>100)throw new Error("Size must be between 0 and 100.");F=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",l({},m,{get:function(){return H},set:function(B){const ie=s(B);if(!ie)throw new SyntaxError("An invalid or illegal string was specified.");H=ie,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class $D{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function UE(a){function e(i,s,l,o){return(i|0)*3600+(s|0)*60+(l|0)+parseFloat(o||0)}const t=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class GD{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let s=0;s<i.length;++s)if(t===i[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function BE(a,e,t,i){const s=i?a.split(i):[a];for(const l in s){if(typeof s[l]!="string")continue;const o=s[l].split(t);if(o.length!==2)continue;const c=o[0],h=o[1];e(c,h)}}const Td=new th(0,0,""),Eo=Td.align==="middle"?"middle":"center";function jD(a,e,t){const i=a;function s(){const c=UE(a);if(c===null)throw new Error("Malformed timestamp: "+i);return a=a.replace(/^[^\sa-zA-Z-]+/,""),c}function l(c,h){const f=new GD;BE(c,function(y,S){let E;switch(y){case"region":for(let x=t.length-1;x>=0;x--)if(t[x].id===S){f.set(y,t[x].region);break}break;case"vertical":f.alt(y,S,["rl","lr"]);break;case"line":E=S.split(","),f.integer(y,E[0]),f.percent(y,E[0])&&f.set("snapToLines",!1),f.alt(y,E[0],["auto"]),E.length===2&&f.alt("lineAlign",E[1],["start",Eo,"end"]);break;case"position":E=S.split(","),f.percent(y,E[0]),E.length===2&&f.alt("positionAlign",E[1],["start",Eo,"end","line-left","line-right","auto"]);break;case"size":f.percent(y,S);break;case"align":f.alt(y,S,["start",Eo,"end","left","right"]);break}},/:/,/\s/),h.region=f.get("region",null),h.vertical=f.get("vertical","");let g=f.get("line","auto");g==="auto"&&Td.line===-1&&(g=-1),h.line=g,h.lineAlign=f.get("lineAlign","start"),h.snapToLines=f.get("snapToLines",!0),h.size=f.get("size",100),h.align=f.get("align",Eo);let m=f.get("position","auto");m==="auto"&&Td.position===50&&(m=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=m}function o(){a=a.replace(/^\s+/,"")}if(o(),e.startTime=s(),o(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);a=a.slice(3),o(),e.endTime=s(),o(),l(a,e)}function FE(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class HD{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new $D,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let l=t.buffer,o=0;for(l=FE(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const c=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,t.buffer=l.slice(o),c}function s(l){BE(l,function(o,c){},/:/)}try{let l="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;l=i();const c=l.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:l=i(),t.state){case"HEADER":/:/.test(l)?s(l):l||(t.state="ID");continue;case"NOTE":l||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l)continue;if(t.cue=new th(0,0,""),t.state="CUE",l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{jD(l,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=l.indexOf("-->")!==-1;if(!l||c&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=l}continue;case"BADCUE":l||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const VD=/\r\n|\n\r|\n|\r/g,zf=function(e,t,i=0){return e.slice(i,i+t.length)===t},KD=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!fe(t)||!fe(i)||!fe(s)||!fe(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*s,t+=60*60*1e3*l,t};function ih(a,e,t){return Da(a.toString())+Da(e.toString())+Da(t)}const zD=function(e,t,i){let s=e[t],l=e[s.prevCC];if(!l||!l.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(o=l)!=null&&o.new;){var o;e.ccOffset+=s.start-l.start,s.new=!1,s=l,l=e[s.prevCC]}e.presentationOffset=i};function qD(a,e,t,i,s,l,o){const c=new HD,h=Wt(new Uint8Array(a)).trim().replace(VD,`
`).split(`
`),f=[],g=e?f_(e.baseTime,e.timescale):0;let m="00:00.000",y=0,S=0,E,x=!0;c.oncue=function(T){const R=t[i];let D=t.ccOffset;const A=(y-g)/9e4;if(R!=null&&R.new&&(S!==void 0?D=t.ccOffset=R.start:zD(t,i,A)),A){if(!e){E=new Error("Missing initPTS for VTT MPEGTS");return}D=A-t.presentationOffset}const O=T.endTime-T.startTime,I=oi((T.startTime+D-S)*9e4,s*9e4)/9e4;T.startTime=Math.max(I,0),T.endTime=Math.max(I+O,0);const N=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(N)),T.id||(T.id=ih(T.startTime,T.endTime,N)),T.endTime>0&&f.push(T)},c.onparsingerror=function(T){E=T},c.onflush=function(){if(E){o(E);return}l(f)},h.forEach(T=>{if(x)if(zf(T,"X-TIMESTAMP-MAP=")){x=!1,T.slice(16).split(",").forEach(R=>{zf(R,"LOCAL:")?m=R.slice(6):zf(R,"MPEGTS:")&&(y=parseInt(R.slice(7)))});try{S=KD(m)/1e3}catch(R){E=R}return}else T===""&&(x=!1);c.parse(T+`
`)}),c.flush()}const qf="stpp.ttml.im1t",$E=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,GE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,YD={left:"start",center:"center",right:"end",start:"start",end:"end"};function _y(a,e,t,i){const s=Re(new Uint8Array(a),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const l=s.map(c=>Wt(c)),o=c_(e.baseTime,1,e.timescale);try{l.forEach(c=>t(XD(c,o)))}catch(c){i(c)}}function XD(a,e){const s=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((m,y)=>(m[y]=s.getAttribute(`ttp:${y}`)||l[y],m),{}),c=s.getAttribute("xml:space")!=="preserve",h=Dy(Yf(s,"styling","style")),f=Dy(Yf(s,"layout","region")),g=Yf(s,"body","[begin]");return[].map.call(g,m=>{const y=jE(m,c);if(!y||!m.hasAttribute("begin"))return null;const S=Qf(m.getAttribute("begin"),o),E=Qf(m.getAttribute("dur"),o);let x=Qf(m.getAttribute("end"),o);if(S===null)throw Cy(m);if(x===null){if(E===null)throw Cy(m);x=S+E}const T=new th(S-e,x-e,y);T.id=ih(T.startTime,T.endTime,T.text);const R=f[m.getAttribute("region")],D=h[m.getAttribute("style")],A=QD(R,D,h),{textAlign:O}=A;if(O){const I=YD[O];I&&(T.lineAlign=I),T.align=O}return Ke(T,A),T}).filter(m=>m!==null)}function Yf(a,e,t){const i=a.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Dy(a){return a.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function jE(a,e){return[].slice.call(a.childNodes).reduce((t,i,s)=>{var l;return i.nodeName==="br"&&s?t+`
`:(l=i.childNodes)!=null&&l.length?jE(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function QD(a,e,t){const i="http://www.w3.org/ns/ttml#styling";let s=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(s=t[o]),l.reduce((c,h)=>{const f=Xf(e,i,h)||Xf(a,i,h)||Xf(s,i,h);return f&&(c[h]=f),c},{})}function Xf(a,e,t){return a&&a.hasAttributeNS(e,t)?a.getAttributeNS(e,t):null}function Cy(a){return new Error(`Could not parse ttml timestamp ${a}`)}function Qf(a,e){if(!a)return null;let t=UE(a);return t===null&&($E.test(a)?t=WD(a,e):GE.test(a)&&(t=ZD(a,e))),t}function WD(a,e){const t=$E.exec(a),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function ZD(a,e){const t=GE.exec(a),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class So{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class JD{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=wy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new So(this,"textTrack1"),t=new So(this,"textTrack2"),i=new So(this,"textTrack3"),s=new So(this,"textTrack4");this.cea608Parser1=new Ly(1,e,t),this.cea608Parser2=new Ly(3,i,s)}addCues(e,t,i,s,l){let o=!1;for(let c=l.length;c--;){const h=l[c],f=eC(h[0],h[1],t,i);if(f>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],i),o=!0,f/(i-t)>.5))return}if(o||l.push([t,i]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,i,s)}else{const c=this.Cues.newCue(null,t,i,s);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:s,timescale:l}){const{unparsedVttFrags:o}=this;i===me.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:l}),o.length&&(this.unparsedVttFrags=[],o.forEach(c=>{this.onFragLoaded(b.FRAG_LOADED,c)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const l=i.textTracks[s];if(Iy(l,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:s}=this,{label:l,languageCode:o}=t[e],c=this.getExistingTrack(l,o);if(c)i[e]=c,cr(i[e]),OE(i[e],s);else{const h=this.createTextTrack("captions",l,o);h&&(h[e]=!0,i[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,s={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,i){const s=this.media;if(s)return s.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(l=>{cr(s[l]),delete s[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=wy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)cr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],s=i.some(l=>l.textCodec===qf);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(RE(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,c=o?Oo(o.textTracks):null;if(this.tracks.forEach((h,f)=>{let g;if(c){let m=null;for(let y=0;y<c.length;y++)if(c[y]&&Iy(c[y],h)){m=c[y],c[y]=null;break}m&&(g=m)}if(g)cr(g);else{const m=HE(h);g=this.createTextTrack(m,h.name,h.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const h=c.filter(f=>f!==null).map(f=>f.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const l=`textTrack${s[1]}`,o=this.captionsProperties[l];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===me.MAIN){var i,s;const{cea608Parser1:l,cea608Parser2:o,lastSn:c}=this,{cc:h,sn:f}=t.frag,g=(i=(s=t.part)==null?void 0:s.index)!=null?i:-1;l&&o&&(f!==c+1||f===c&&g!==this.lastPartIndex+1||h!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=h,this.lastSn=f,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:i,payload:s}=t;if(i.type===me.SUBTITLE)if(s.byteLength){const l=i.decryptdata,o="stats"in t;if(l==null||!l.encrypted||o){const c=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&c.textCodec===qf?this._parseIMSC1(i,s):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;_y(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:i,payload:s}=e,{initPTS:l,unparsedVttFrags:o}=this,c=l.length-1;if(!l[i.cc]&&c===-1){o.push(e);return}const h=this.hls,f=(t=i.initSegment)!=null&&t.data?ui(i.initSegment.data,new Uint8Array(s)).buffer:s;qD(f,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,g=>{this._appendCues(g,i.level),h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},g=>{const m=g.message==="Missing initPTS for VTT MPEGTS";m?o.push(e):this._fallbackToIMSC1(i,s),h.logger.log(`Failed to parse VTT cue: ${g}`),!(m&&c>i.cc)&&h.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:g})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||_y(t,this.initPTS[e.cc],()=>{i.textCodec=qf,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(l=>kE(s,l))}else{const s=this.tracks[t];if(!s)return;const l=s.default?"default":"subtitles"+t;i.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===me.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=t;if(!(i.type===me.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let l=0;l<s.length;l++){const o=s[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(o);this.cea608Parser1.addData(s[l].pts,c[0]),this.cea608Parser2.addData(s[l].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:s,type:l}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!l||l==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Ed(c[h],t,i))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Ed(c[h],t,s))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let s=2;for(let l=0;l<i;l++){const o=e[s++],c=127&e[s++],h=127&e[s++];if(c===0&&h===0)continue;if((4&o)!==0){const g=3&o;(g===0||g===1)&&(t[g].push(c),t[g].push(h))}}return t}}function HE(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function Iy(a,e){return!!a&&a.kind===HE(e)&&pd(e,a)}function eC(a,e,t,i){return Math.min(e,i)-Math.max(a,t)}function wy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const tC=/\s/,iC={newCue(a,e,t,i){const s=[];let l,o,c,h,f;const g=self.VTTCue||self.TextTrackCue;for(let y=0;y<i.rows.length;y++)if(l=i.rows[y],c=!0,h=0,f="",!l.isEmpty()){var m;for(let x=0;x<l.chars.length;x++)tC.test(l.chars[x].uchar)&&c?h++:(f+=l.chars[x].uchar,c=!1);l.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const S=FE(f.trim()),E=ih(e,t,S);a!=null&&(m=a.cues)!=null&&m.getCueById(E)||(o=new g(e,t,S),o.id=E,o.line=y+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),s.push(o))}return a&&s.length&&(s.sort((y,S)=>y.line==="auto"||S.line==="auto"?0:y.line>8&&S.line>8?S.line-y.line:y.line-S.line),s.forEach(y=>kE(a,y))),s}};function nC(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const sC=/(\d+)-(\d+)\/(\d+)/;class Oy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||oC,this.controller=new self.AbortController,this.stats=new Nd}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const l=rC(e,this.controller.signal),o=e.responseType==="arraybuffer",c=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),t.timeout=h&&fe(h)?h:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Ua(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var y;this.response=this.loader=m;const S=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},f-(S-s.loading.start)),!m.ok){const{status:x,statusText:T}=m;throw new uC(T||"fetch, bad network response",x,m)}s.loading.first=S,s.total=lC(m.headers)||s.total;const E=(y=this.callbacks)==null?void 0:y.onProgress;return E&&fe(t.highWaterMark)?this.loadProgressively(m,s,e,t.highWaterMark,E):o?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var y,S;const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const x=m[c];x&&(s.loaded=s.total=x);const T={url:E.url,data:m,code:E.status},R=(y=this.callbacks)==null?void 0:y.onProgress;R&&!fe(t.highWaterMark)&&R(s,e,m,E),(S=this.callbacks)==null||S.onSuccess(T,s,e,E)}).catch(m=>{var y;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const S=m&&m.code||0,E=m?m.message:null;(y=this.callbacks)==null||y.onError({code:S,text:E},e,m?m.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,s=0,l){const o=new sE,c=e.body.getReader(),h=()=>c.read().then(f=>{if(f.done)return o.dataLength&&l(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const g=f.value,m=g.length;return t.loaded+=m,m<s||o.dataLength?(o.push(g),o.dataLength>=s&&l(t,i,o.flush().buffer,e)):l(t,i,g.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function rC(a,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},a.headers))};return a.rangeEnd&&t.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),t}function aC(a){const e=sC.exec(a);if(e)return parseInt(e[2])-parseInt(e[1])+1}function lC(a){const e=a.get("Content-Range");if(e){const i=aC(e);if(fe(i))return i}const t=a.get("Content-Length");if(t)return parseInt(t)}function oC(a,e){return new self.Request(a.url,e)}class uC extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const cC=/^age:\s*[\d.]+\s*$/im;class VE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Nd,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return l(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var c;(c=this.callbacks)==null||c.onError({code:i.status,text:o.message},t,i,s)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=i.loadPolicy;if(s)for(const c in s)e.setRequestHeader(c,s[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=l&&fe(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const s=t.readyState,l=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const f=t.status,g=t.responseType==="text"?t.responseText:null;if(f>=200&&f<300){const E=g??t.response;if(E!=null){var o,c;i.loading.end=Math.max(self.performance.now(),i.loading.first);const x=t.responseType==="arraybuffer"?E.byteLength:E.length;i.loaded=i.total=x,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,E,t);const R={url:t.responseURL,data:E,code:f};(c=this.callbacks)==null||c.onSuccess(R,i,e,t);return}}const m=l.loadPolicy.errorRetry,y=i.retry,S={url:e.url,data:void 0,code:f};if(Ho(m,y,!1,S))this.retry(m);else{var h;Me.error(`${f} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:f,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Ho(e,t,!0))this.retry(e);else{var i;Me.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Fd(e,i.retry),i.retry++,Me.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&cC.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const fC={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},dC=$e($e({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:VE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ML,bufferController:L_,capLevelController:Jd,errorController:$L,fpsController:pD,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:qv,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:fC},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},hC()),{},{subtitleStreamController:_D,subtitleTrackController:ED,timelineController:JD,audioStreamController:x_,audioTrackController:b_,emeController:dr,cmcdController:hD,contentSteeringController:mD,interstitialsController:LD});function hC(){return{cueHandler:iC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function gC(a,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=xd(a),s=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(o=>{const c=`${o==="level"?"playlist":o}LoadPolicy`,h=e[c]===void 0,f=[];l.forEach(g=>{const m=`${o}Loading${g}`,y=e[m];if(y!==void 0&&h){f.push(m);const S=i[c].default;switch(e[c]={default:S},g){case"TimeOut":S.maxLoadTimeMs=y,S.maxTimeToFirstByteMs=y;break;case"MaxRetry":S.errorRetry.maxNumRetry=y,S.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":S.errorRetry.retryDelayMs=y,S.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":S.errorRetry.maxRetryDelayMs=y,S.timeoutRetry.maxRetryDelayMs=y;break}}}),f.length&&t.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${c}": ${Je(e[c])}`)}),$e($e({},i),e)}function xd(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(xd):Object.keys(a).reduce((e,t)=>(e[t]=xd(a[t]),e),{}):a}function mC(a,e){const t=a.loader;t!==Oy&&t!==VE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):nC()&&(a.loader=Oy,a.progressive=!0,a.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ko=2,pC=.1,yC=.05,vC=100;class EC extends Vv{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(vC),this.mediaSource=t.mediaSource;const i=this.media=t.media;an(i,"playing",this.onMediaPlaying),an(i,"waiting",this.onMediaWaiting),an(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Mi(i,"playing",this.onMediaPlaying),Mi(i,"waiting",this.onMediaWaiting),Mi(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,s;const l=(i=this.hls)==null?void 0:i.config;if(!l)return;const{media:o,stalled:c}=this;if(!o)return;const{seeking:h}=o,f=this.seeking&&!h,g=!this.seeking&&h,m=o.paused&&!h||o.ended||o.playbackRate===0;if(this.seeking=h,e!==t){t&&(this.ended=0),this.moved=!0,h||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!m&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(g||f){f&&this.stallResolved(e);return}if(m){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!1}));return}if(!De.getBuffered(o).length){this.nudgeRetry=0;return}const y=De.bufferInfo(o,e,0),S=y.nextStart||0,E=this.fragmentTracker;if(h&&E&&this.hls){const N=ky(this.hls.inFlightFragments,e),M=y.len>ko,F=!S||N||S-e>ko&&!E.getPartialFragment(e);if(M||F)return;this.moved=!1}const x=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(y.len>0)&&!S)return;const M=Math.max(S,y.start||0)-e,H=!!(x!=null&&x.live)?x.targetduration*2:ko,B=E.getPartialFragment(e);if(M>0&&(M<=H||B)){o.paused||this._trySkipBufferHole(B);return}}const T=l.detectStallWithCurrentTimeMs,R=self.performance.now(),D=this.waiting;if(c===null){D>0&&R-D<T?this.stalled=D:this.stalled=R;return}const A=R-c;if(!h&&(A>=T||D)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(x!=null&&x.live)&&Math.abs(e-((x==null?void 0:x.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(b.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(y),!this.media||!this.hls)return}const I=De.bufferInfo(o,e,l.maxBufferHole);this._tryFixBufferStall(I,A)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(b.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){const l=De.bufferedInfo(De.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){const o=De.timeRangesToArray(s),c=De.bufferedInfo(o,t,0).bufferedIndex;if(c>-1&&c<o.length-1){const h=De.bufferedInfo(o,e,0).bufferedIndex,f=o[c].end,g=o[c+1].start;if((h===-1||h>c)&&g-f<1&&e-f<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${f} -> ${g} buffered index: ${h}`);this.warn(m.message),this.media.currentTime+=1e-6;const y=this.fragmentTracker.getPartialFragment(e)||void 0,S=De.bufferInfo(this.media,e,0);this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:y,buffer:S.len,bufferInfo:S})}}}}}_tryFixBufferStall(e,t){var i,s;const{fragmentTracker:l,media:o}=this,c=(i=this.hls)==null?void 0:i.config;if(!o||!l||!c)return;const h=o.currentTime,f=(s=this.hls)==null?void 0:s.latestLevelDetails,g=l.getPartialFragment(h);if((g||f!=null&&f.live&&h<f.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const m=e.buffered;(m&&m.length>1&&e.len>c.maxBufferHole||e.nextStart&&e.nextStart-h<c.maxBufferHole)&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:i,stallReported:s,stalled:l}=this;if(!s&&l!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Je(e)})`);this.warn(o.message),t.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:s}=this,l=(t=this.hls)==null?void 0:t.config;if(!s||!i||!l)return 0;const o=s.currentTime,c=De.bufferInfo(s,o,0),h=o<c.start?c.start:c.nextStart;if(h&&this.hls){const g=c.len<=l.maxBufferHole,m=c.len>0&&c.len<1&&s.readyState<3,y=h-o;if(y>0&&(g||m)){if(y>l.maxBufferHole){let E=!1;if(o===0){const x=i.getAppendedFrag(0,me.MAIN);x&&h<x.end&&(E=!0)}if(!E){const x=e||i.getAppendedFrag(o,me.MAIN);if(x){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||ky(this.hls.inFlightFragments,h))return 0;let R=!1,D=x.end;for(;D<h;){const A=i.getPartialFragment(D);if(A)D+=A.duration;else{R=!0;break}}if(R)return 0}}}const S=Math.max(h+yC,o+pC);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${S}`),this.moved=!0,s.currentTime=S,!(e!=null&&e.gap)){const E=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${S}`);this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e||void 0,buffer:c.len,bufferInfo:c})}return S}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:s}=this,l=t==null?void 0:t.config;if(!i||!l)return 0;const o=i.currentTime;if(this.nudgeRetry++,s<l.nudgeMaxRetry){const c=o+(s+1)*l.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${c}`);this.warn(h.message),i.currentTime=c,t.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ky(a,e){const t=My(a.main);if(t&&t.start<=e)return t;const i=My(a.audio);return i&&i.start<=e?i:null}function My(a){if(!a)return null;switch(a.state){case te.IDLE:case te.STOPPED:case te.ENDED:case te.ERROR:return null}return a.frag}const SC=.25;function bd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Py(a,e,t,i,s){let l=new a(e,t,"");try{l.value=i,s&&(l.type=s)}catch{l=new a(e,t,Je(s?$e({type:s},i):i))}return l}const To=(()=>{const a=bd();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function TC(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class xC{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(b.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&cr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return OE(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:s}}}=this;if(!i&&!s)return;const{samples:l}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=bd();if(o)for(let c=0;c<l.length;c++){const h=l[c].type;if(h===Xt.emsg&&!i||!s)continue;const f=dE(l[c].data);if(f){const g=l[c].pts;let m=g+l[c].duration;m>To&&(m=To),m-g<=0&&(m=g+SC);for(let S=0;S<f.length;S++){const E=f[S];if(!hE(E)){this.updateId3CueEnds(g,h);const x=Py(o,g,m,E,h);x&&this.id3Track.addCue(x)}}}}}updateId3CueEnds(e,t){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let l=s.length;l--;){const o=s[l];o.type===t&&o.startTime<e&&o.endTime===To&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:s}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=o;if(l&&(c||h)){let f;s==="audio"?f=g=>g.type===Xt.audioId3&&h:s==="video"?f=g=>g.type===Xt.emsg&&c:f=g=>g.type===Xt.audioId3&&h||g.type===Xt.emsg&&c,Ed(l,t,i,f)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:s}=e,l=Object.keys(s);let o=this.dateRangeCuesAppended;if(i&&t){var c;if((c=i.cues)!=null&&c.length){const g=Object.keys(o).filter(m=>!l.includes(m));for(let m=g.length;m--;){const y=g[m],S=o[y].cues;delete o[y],Object.keys(S).forEach(E=>{try{const x=S[E];x.removeEventListener("enter",this.onEventCueEnter),i.removeCue(x)}catch{}})}}else o=this.dateRangeCuesAppended={}}const h=e.fragments[e.fragments.length-1];if(l.length===0||!fe(h==null?void 0:h.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const f=bd();for(let g=0;g<l.length;g++){const m=l[g],y=s[m],S=y.startTime,E=o[m],x=(E==null?void 0:E.cues)||{};let T=(E==null?void 0:E.durationKnown)||!1,R=To;const{duration:D,endDate:A}=y;if(A&&D!==null)R=S+D,T=!0;else if(y.endOnNext&&!T){const I=l.reduce((N,M)=>{if(M!==y.id){const F=s[M];if(F.class===y.class&&F.startDate>y.startDate&&(!N||y.startDate<N.startDate))return F}return N},null);I&&(R=I.startTime,T=!0)}const O=Object.keys(y.attr);for(let I=0;I<O.length;I++){const N=O[I];if(!JL(N))continue;const M=x[N];if(M)T&&!E.durationKnown?M.endTime=R:Math.abs(M.startTime-S)>.01&&(M.startTime=S,M.endTime=R);else if(f){let F=y.attr[N];e1(N)&&(F=TC(F));const B=Py(f,S,R,{key:N,data:F},Xt.dateRange);B&&(B.id=m,this.id3Track.addCue(B),x[N]=B,this.hls.config.interstitialsController&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&B.addEventListener("enter",this.onEventCueEnter))}}o[m]={cues:x,dateRange:y,durationKnown:T}}}}class bC{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!i.live)return;const c=this.targetLatency;if(c===null)return;const h=s-c,f=Math.min(this.maxLatency,c+i.targetduration);if(h<f&&h>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,o)),y=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,S=Math.min(m,Math.max(1,y));this.changeMediaPlaybackRate(t,S)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let f=c&&i||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||f===0)&&(f=l!==void 0?l:o*s);const g=s;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,l=e-t-this.edgeStalled,o=s-i.totalduration,c=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,l),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,s;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class AC extends Zd{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,s=[],l={},o={};let c=!1,h=!1,f=!1;t.levels.forEach(g=>{var m;const y=g.attrs;let{audioCodec:S,videoCodec:E}=g;S&&(g.audioCodec=S=Fo(S,i)||void 0),((m=E)==null?void 0:m.indexOf("avc1"))===0&&(E=g.videoCodec=SL(E));const{width:x,height:T,unknownCodecs:R}=g;let D=R?R.length:0;if(R)for(let ie=D;ie--;){const ae=R[ie];this.isAudioSupported(ae)?(g.audioCodec=S=S?`${S},${ae}`:ae,D--,gr.audio[S.substring(0,4)]=2):this.isVideoSupported(ae)&&(g.videoCodec=E=E?`${E},${ae}`:ae,D--,gr.video[E.substring(0,4)]=2)}if(c||(c=!!(x&&T)),h||(h=!!E),f||(f=!!S),D||S&&!this.isAudioSupported(S)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${y.CODECS}"`);return}const{CODECS:A,"FRAME-RATE":O,"HDCP-LEVEL":I,"PATHWAY-ID":N,RESOLUTION:M,"VIDEO-RANGE":F}=y,B=`${`${N||"."}-`}${g.bitrate}-${M}-${O}-${A}-${F}-${I}`;if(l[B])if(l[B].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const ie=o[B]+=1;g.attrs["PATHWAY-ID"]=new Array(ie+1).join(".");const ae=this.createLevel(g);l[B]=ae,s.push(ae)}else l[B].addGroupId("audio",y.AUDIO),l[B].addGroupId("text",y.SUBTITLES);else{const ie=this.createLevel(g);l[B]=ie,o[B]=1,s.push(ie)}}),this.filterAndSortMediaOptions(s,t,c,h,f)}createLevel(e){const t=new Oa(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),t.supportedResult=$v(s,[])}return t}isAudioSupported(e){return od(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return od(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,s,l){let o=[],c=[],h=e;if((i||s)&&l&&(h=h.filter(({videoCodec:T,videoRange:R,width:D,height:A})=>(!!T||!!(D&&A))&&RL(R))),h.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",R=T;t.levels.length&&(R=`one or more CODECS in variant not supported: ${Je(t.levels.map(A=>A.attrs.CODECS).filter((A,O,I)=>I.indexOf(A)===O))}`,this.warn(R),T+=` (${R})`);const D=new Error(T);this.hls.trigger(b.ERROR,{type:pe.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:R})}});return}t.audioTracks&&(o=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),Ny(o)),t.subtitles&&(c=t.subtitles,Ny(c));const f=h.slice(0);h.sort((T,R)=>{if(T.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&T.height!==R.height)return T.height-R.height;if(T.frameRate!==R.frameRate)return T.frameRate-R.frameRate;if(T.videoRange!==R.videoRange)return $o.indexOf(T.videoRange)-$o.indexOf(R.videoRange);if(T.videoCodec!==R.videoCodec){const D=Cp(T.videoCodec),A=Cp(R.videoCodec);if(D!==A)return A-D}if(T.uri===R.uri&&T.codecSet!==R.codecSet){const D=Bo(T.codecSet),A=Bo(R.codecSet);if(D!==A)return A-D}return T.averageBitrate!==R.averageBitrate?T.averageBitrate-R.averageBitrate:0});let g=f[0];if(this.steering&&(h=this.steering.filterParsedLevels(h),h.length!==f.length)){for(let T=0;T<f.length;T++)if(f[T].pathwayId===h[0].pathwayId){g=f[T];break}}this._levels=h;for(let T=0;T<h.length;T++)if(h[T]===g){var m;this._firstLevel=T;const R=g.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${h.length} level(s) found, first bitrate: ${R}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const A=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);A>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=A)}break}const y=l&&!s,S=this.hls.config,E=!!(S.audioStreamController&&S.audioTrackController),x={levels:h,audioTracks:o,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:s,altAudio:E&&!y&&o.some(T=>!!T.url)};this.hls.trigger(b.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:g,reason:g.message}),m)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,l=s?s.attrs["PATHWAY-ID"]:void 0,o=t[e],c=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&s&&l===c)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${c?" with Pathway "+c:""} from level ${i}${l?" with Pathway "+l:""}`);const h={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,h);const f=o.details;if(!f||f.live){const g=this.switchParams(o.uri,s==null?void 0:s.details,f);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===we.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===me.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(l=>!!i[l]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var i;const{level:s,details:l}=t,o=t.levelInfo;if(!o){var c;this.warn(`Invalid level index ${s}`),(c=t.deliveryDirectives)!=null&&c.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(s,t,h)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],o=e.details,c=o==null?void 0:o.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${l?" Pathway "+l:""}${c&&o.live?" age "+c.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(b.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((l,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(c=>c.level=-1)),!1));tE(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(b.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Ny(a){const e={};a.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function KE(){return self.SourceBuffer||self.WebKitSourceBuffer}function zE(){if(!$n())return!1;const e=KE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function RC(){if(!zE())return!1;const a=$n();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>a.isTypeSupported(wa(e,"video")))||["mp4a.40.2","fLaC"].some(e=>a.isTypeSupported(wa(e,"audio"))))}function LC(){var a;const e=KE();return typeof(e==null||(a=e.prototype)==null?void 0:a.changeType)=="function"}const _C=100;class DC extends Vd{constructor(e,t,i){super(e,t,i,"stream-controller",me.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,l=s?s.currentTime:null;if(l===null||!fe(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(s,l,me.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(_C),this.level=-1,!this.startFragRequested){let l=s.startLevel;l===-1&&(s.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=s.firstAutoLevel),s.nextLoadLevel=l,this.level=s.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=te.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=te.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case te.WAITING_LEVEL:{const{levels:t,level:i}=this,s=t==null?void 0:t[i],l=s==null?void 0:s.details;if(l&&(!l.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(l))break;this.state=te.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=te.IDLE;break}break}case te.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:s,level:l}=this,o=s==null?void 0:s[l];this.resetStartWhenNotLoaded(o||null),this.state=te.IDLE}}break}this.state===te.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[l]))return;const o=i[l],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const x={};this.altAudio===2&&(x.type="video"),this.hls.trigger(b.BUFFER_EOS,x),this.state=te.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const f=o.details;if(!f||this.state===te.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=te.WAITING_LEVEL,this.startFragRequested=!1;return}const g=c.len,m=this.getMaxBufferLength(o.maxBitrate);if(g>=m)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let S=this.getNextFragment(y,f);if(this.couldBacktrack&&!this.fragPrevious&&S&&Et(S)&&this.fragmentTracker.getState(S)!==ht.OK){var E;const T=((E=this.backtrackFragment)!=null?E:S).sn-f.startSN,R=f.fragments[T-1];R&&S.cc===R.cc&&(S=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(S&&this.isLoopLoading(S,y)){if(!S.gap){const T=this.audioOnly&&!this.altAudio?Ve.AUDIO:Ve.VIDEO,R=(T===Ve.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,T,me.MAIN)}S=this.getNextFragmentLoopLoading(S,f,c,me.MAIN,m)}S&&(S.initSegment&&!S.initSegment.data&&!this.bitrateTest&&(S=S.initSegment),this.loadFragment(S,o,y))}loadFragment(e,t,i){const s=this.fragmentTracker.getState(e);s===ht.NOT_LOADED||s===ht.PARTIAL?Et(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,me.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<l.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],f=this.fragLastKbps;f&&this.fragCurrent?i=this.fragCurrent.duration*h.maxBitrate/(1e3*f)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const c=this.followingBufferedFrag(o);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,f=c.duration,g=Math.max(o.end,h+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case te.KEY_LOADING:case te.FRAG_LOADING:case te.FRAG_LOADING_WAITING_RETRY:case te.PARSING:case te.PARSED:this.state=te.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;an(i,"playing",this.onMediaPlaying),an(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Mi(i,"playing",this.onMediaPlaying),Mi(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,s=!1;t.levels.forEach(l=>{const o=l.audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,s=s||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&s&&!LC(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==te.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=te.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:s,startFragRequested:l}=this,o=t.level,c=t.details,h=c.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const f=t.levelInfo,g=this.fragCurrent;g&&(this.state===te.FRAG_LOADING||this.state===te.FRAG_LOADING_WAITING_RETRY)&&g.level!==t.level&&g.loader&&this.abortCurrentFrag();let m=0;if(c.live||(i=f.details)!=null&&i.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;m=this.alignPlaylists(c,f.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(f.details=c,this.levelLastLoaded=f,l||this.setStartPosition(c,m),this.hls.trigger(b.LEVEL_UPDATED,{details:c,level:o}),this.state===te.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=te.IDLE}l&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=e.fragmentStart,c=e.edge,h=l>=o-t.maxFragLookUpTolerance&&l<=c;if(s!==null&&i.duration>s&&(l<s||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!h&&i.readyState<4||l<c-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState&&(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${s.toFixed(3)}`),i.currentTime=s))}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:s,payload:l}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=o[i.level];if(!c){this.warn(`Level ${i.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const f=c.videoCodec,g=h.PTSKnown||!h.live,m=(t=i.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),S=this.transmuxer=this.transmuxer||new AE(this.hls,me.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=s?s.index:-1,x=E!==-1,T=new Gd(i.level,i.sn,i.stats.chunkCount,l.byteLength,E,x),R=this.initPTS[i.cc];S.push(l,m,y,f,i,s,h.totalduration,g,T,R)}onAudioTrackSwitching(e,t){const i=this.hls,s=this.altAudio===2;if(Go(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),i.once(b.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(b.AUDIO_TRACK_SWITCHED,t)}),i.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Go(t.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let s,l,o=!1;for(const c in i){const h=i[c];if(h.id==="main"){if(l=c,s=h,c==="video"){const f=i[c];f&&(this.videoBuffer=f.buffer)}}else o=!0}o&&s?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:s}=t,l=i.type===me.MAIN;if(l){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===te.PARSED&&(this.state=te.IDLE);return}const c=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),Et(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const o=this.media;o&&(!this._hasEnoughToStart&&De.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=te.ERROR;return}switch(t.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(me.MAIN,t);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===te.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===we.LEVEL&&(this.state=te.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=te.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ve.AUDIO||!this.altAudio){const i=(t===Ve.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,me.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const l=this.getLevelDetails(),o=De.getBuffered(e),c=o.length?o.start(0):0,h=c-i,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);h>0&&(h<f||this.loadingParts&&h<2*((l==null?void 0:l.partTarget)||0))&&(this.log(`adjusting start position by ${h} to match buffer start`),i+=h,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${c}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:s}=this,l=i==null?void 0:i.frag;if(!l||this.fragContextChanged(l))return;t.fragmentError=0,this.state=te.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(b.FRAG_LOADED,i),l.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:s}=this,{remuxResult:l,chunkMeta:o}=e,c=this.getCurrentContext(o);if(!c){this.resetWhenMissingContext(o);return}const{frag:h,part:f,level:g}=c,{video:m,text:y,id3:S,initSegment:E}=l,{details:x}=g,T=this.altAudio?void 0:l.audio;if(this.fragContextChanged(h)){this.fragmentTracker.removeFragment(h);return}if(this.state=te.PARSING,E){if(E!=null&&E.tracks){const A=h.initSegment||h;this._bufferInitSegment(g,E.tracks,A,o),s.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:A,id:i,tracks:E.tracks})}const R=E.initPTS,D=E.timescale;fe(R)&&(this.initPTS[h.cc]={baseTime:R,timescale:D},s.trigger(b.INIT_PTS_FOUND,{frag:h,id:i,initPTS:R,timescale:D}))}if(m&&x){T&&m.type==="audiovideo"&&this.logMuxedErr(h);const R=x.fragments[h.sn-1-x.startSN],D=h.sn===x.startSN,A=!R||h.cc>R.cc;if(l.independent!==!1){const{startPTS:O,endPTS:I,startDTS:N,endDTS:M}=m;if(f)f.elementaryStreams[m.type]={startPTS:O,endPTS:I,startDTS:N,endDTS:M};else if(m.firstKeyFrame&&m.independent&&o.id===1&&!A&&(this.couldBacktrack=!0),m.dropped&&m.independent){const F=this.getMainFwdBufferInfo(),H=(F?F.end:this.getLoadPosition())+this.config.maxBufferHole,B=m.firstKeyFramePTS?m.firstKeyFramePTS:O;if(!D&&H<B-this.config.maxBufferHole&&!A){this.backtrack(h);return}else A&&(h.gap=!0);h.setElementaryStreamInfo(m.type,h.start,I,h.start,M,!0)}else D&&O-(x.appliedTimelineOffset||0)>ko&&(h.gap=!0);h.setElementaryStreamInfo(m.type,O,I,N,M),this.backtrackFragment&&(this.backtrackFragment=h),this.bufferFragmentData(m,h,f,o,D||A)}else if(D||A)h.gap=!0;else{this.backtrack(h);return}}if(T){const{startPTS:R,endPTS:D,startDTS:A,endDTS:O}=T;f&&(f.elementaryStreams[Ve.AUDIO]={startPTS:R,endPTS:D,startDTS:A,endDTS:O}),h.setElementaryStreamInfo(Ve.AUDIO,R,D,A,O),this.bufferFragmentData(T,h,f,o)}if(x&&S!=null&&(t=S.samples)!=null&&t.length){const R={id:i,frag:h,details:x,samples:S.samples};s.trigger(b.FRAG_PARSING_METADATA,R)}if(x&&y){const R={id:i,frag:h,details:x,samples:y.samples};s.trigger(b.FRAG_PARSING_USERDATA,R)}}logMuxedErr(e){this.warn(`${Et(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,s){if(this.state!==te.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:l,video:o,audiovideo:c}=t;if(l){let f=_o(l.codec,e.audioCodec);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const m=l.metadata;m&&"channelCount"in m&&(m.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),e.audioCodec&&e.audioCodec!==f&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${f}"`),l.levelCodec=f,l.id=me.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${f||""}/${e.audioCodec||""}/${l.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=me.MAIN;const f=o.codec;if((f==null?void 0:f.length)===4)switch(f){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${f}]${o.codec!==f?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(b.BUFFER_CODECS,t),!this.hls)return;h.forEach(f=>{const m=t[f].initSegment;m!=null&&m.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:f,data:m,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,me.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=te.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(De.isBuffered(e,i)?t=this.getAppendedFrag(i):De.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,l=t.level;(!s||t.sn!==s.sn||s.level!==l)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!s||s.level!==l)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return fe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(fe(t)){const i=this.getLevelDetails(),s=this.currentFrag||(i?ps(null,i.fragments,t):null);if(s){const l=s.programDateTime;if(l!==null){const o=l+(t-s.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class CC{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[i].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=z.KEY_LOAD_ERROR,i,s,l){return new nn({type:pe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:i,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:s}=e;for(let l=0;l<t.length;l++){const o=t[l];if(s<=o.cc&&(i==="initSegment"||o.sn==="initSegment"||i<o.sn)){this.emeController.selectKeySystemFormat(o).then(c=>{o.setKeyFormat(c)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,s;t&&e.setKeyFormat(t);const l=e.decryptdata;if(!l){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,f))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let c=this.keyUriToKeyInfo[o];if((i=c)!=null&&i.decryptdata.key)return l.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((s=c)!=null&&s.keyLoadPromise){var h;switch((h=c.mediaKeySessionContext)==null?void 0:h.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>(l.key=f.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[o]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(i);if(s)return(e.keyLoadPromise=s.then(l=>(e.mediaKeySessionContext=l,i))).catch(l=>{throw e.keyLoadPromise=null,l})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,s=i.loader,l=new s(i);return t.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((o,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=i.keyLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(y,S,E,x)=>{const{frag:T,keyInfo:R,url:D}=E;if(!T.decryptdata||R!==this.keyUriToKeyInfo[D])return c(this.createKeyLoadError(T,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),x));R.decryptdata.key=T.decryptdata.key=new Uint8Array(y.data),T.keyLoader=null,R.loader=null,o({frag:T,keyInfo:R})},onError:(y,S,E,x)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),E,$e({url:h.url,data:void 0},y)))},onTimeout:(y,S,E)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(y,S,E)=>{this.resetLoader(S),c(this.createKeyLoadError(t,z.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};l.load(h,g,m)})}resetLoader(e){const{frag:t,keyInfo:i,url:s}=e,l=i.loader;t.keyLoader===l&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[s],l&&l.destroy()}}function Uy(a){const{type:e}=a;switch(e){case we.AUDIO_TRACK:return me.AUDIO;case we.SUBTITLE_TRACK:return me.SUBTITLE;default:return me.MAIN}}function Wf(a,e){let t=a.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class IC{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,s=t.loader,l=i||s,o=new l(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:we.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:s,pathwayId:l,url:o,deliveryDirectives:c,levelInfo:h}=t;this.load({id:i,level:s,pathwayId:l,responseType:"text",type:we.LEVEL,url:o,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:i,groupId:s,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:we.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:i,groupId:s,url:l,deliveryDirectives:o,track:c}=t;this.load({id:i,groupId:s,level:null,responseType:"text",type:we.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:c})}onLevelsUpdated(e,t){const i=this.loaders[we.LEVEL];if(i){const s=i.context;s&&!t.levels.some(l=>l===s.levelOrTrack)&&(i.abort(),delete this.loaders[we.LEVEL])}}load(e){var t;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const f=this.hls.logger,g=s.context;if(g&&g.levelOrTrack===e.levelOrTrack&&(g.url===e.url||g.deliveryDirectives&&!e.deliveryDirectives)){g.url===e.url?f.log(`[playlist-loader]: ignore ${e.url} ongoing request`):f.log(`[playlist-loader]: ignore ${e.url} in favor of ${g.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let l;if(e.type===we.MANIFEST?l=i.manifestLoadPolicy.default:l=Ke({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),fe((t=e.deliveryDirectives)==null?void 0:t.part)){let f;if(e.type===we.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===we.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===we.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){const g=f.partTarget,m=f.targetduration;if(g&&m){const y=Math.max(g*3,m*.8)*1e3;l=Ke({},l,{maxTimeToFirstByteMs:Math.min(y,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(f,g,m,y)=>{const S=this.getInternalLoader(m);this.resetInternalLoader(m.type);const E=f.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,m,new Error("no EXTM3U delimiter"),y||null,g);return}g.parsing.start=performance.now(),ki.isMediaPlaylist(E)||m.type!==we.MANIFEST?this.handleTrackOrLevelPlaylist(f,g,m,y||null,S):this.handleMasterPlaylist(f,g,m,y)},onError:(f,g,m,y)=>{this.handleNetworkError(g,m,!1,f,y)},onTimeout:(f,g,m)=>{this.handleNetworkError(g,m,!0,void 0,f)}};s.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,s){const l=this.hls,o=e.data,c=Wf(e,i),h=ki.parseMasterPlaylist(o,c);if(h.playlistParsingError){this.handleManifestParsingError(e,i,h.playlistParsingError,s,t);return}const{contentSteering:f,levels:g,sessionData:m,sessionKeys:y,startTimeOffset:S,variableList:E}=h;this.variableList=E;const{AUDIO:x=[],SUBTITLES:T,"CLOSED-CAPTIONS":R}=ki.parseMasterPlaylistMedia(o,c,h);x.length&&!x.some(A=>!A.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),x.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new it({}),bitrate:0,url:""})),l.trigger(b.MANIFEST_LOADED,{levels:g,audioTracks:x,subtitles:T,captions:R,contentSteering:f,url:c,stats:t,networkDetails:s,sessionData:m,sessionKeys:y,startTimeOffset:S,variableList:E})}handleTrackOrLevelPlaylist(e,t,i,s,l){const o=this.hls,{id:c,level:h,type:f}=i,g=Wf(e,i),m=fe(h)?h:fe(c)?c:0,y=Uy(i),S=ki.parseLevelPlaylist(e.data,g,m,y,0,this.variableList);if(f===we.MANIFEST){const E={attrs:new it({}),bitrate:0,details:S,name:"",url:g};S.requestScheduled=t.loading.start+Zv(S,0),o.trigger(b.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:g,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=S,this.handlePlaylistLoaded(S,e,t,i,s,l)}handleManifestParsingError(e,t,i,s,l){this.hls.trigger(b.ERROR,{type:pe.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:t.type===we.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:s,stats:l})}handleNetworkError(e,t,i=!1,s,l){let o=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===we.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===we.AUDIO_TRACK||e.type===we.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=z.UNKNOWN,f=!1;const g=this.getInternalLoader(e);switch(e.type){case we.MANIFEST:h=i?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,f=!0;break;case we.LEVEL:h=i?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,f=!1;break;case we.AUDIO_TRACK:h=i?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case we.SUBTITLE_TRACK:h=i?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,f=!1;break}g&&this.resetInternalLoader(e.type);const m={type:pe.NETWORK_ERROR,details:h,fatal:f,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:l};if(s){const y=(t==null?void 0:t.url)||e.url;m.response=$e({url:y,data:void 0},s)}this.hls.trigger(b.ERROR,m)}handlePlaylistLoaded(e,t,i,s,l,o){const c=this.hls,{type:h,level:f,id:g,groupId:m,deliveryDirectives:y}=s,S=Wf(t,s),E=Uy(s),x=typeof s.level=="number"&&E===me.MAIN?f:void 0;if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(b.ERROR,{type:pe.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:R,reason:R.message,response:t,context:s,level:x,parent:E,networkDetails:l,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const T=e.playlistParsingError;if(T){if(this.hls.logger.warn(T),!c.config.ignorePlaylistParsingErrors){c.trigger(b.ERROR,{type:pe.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:T,reason:T.message,response:t,context:s,level:x,parent:E,networkDetails:l,stats:i});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case we.MANIFEST:case we.LEVEL:c.trigger(b.LEVEL_LOADED,{details:e,levelInfo:s.levelOrTrack||c.levels[0],level:x||0,id:g||0,stats:i,networkDetails:l,deliveryDirectives:y,withoutMultiVariant:h===we.MANIFEST});break;case we.AUDIO_TRACK:c.trigger(b.AUDIO_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:g||0,groupId:m||"",stats:i,networkDetails:l,deliveryDirectives:y});break;case we.SUBTITLE_TRACK:c.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,track:s.levelOrTrack,id:g||0,groupId:m||"",stats:i,networkDetails:l,deliveryDirectives:y});break}}}class rn{static get version(){return Pa}static isMSESupported(){return zE()}static isSupported(){return RC()}static getMediaSource(){return $n()}static get Events(){return b}static get MetadataSchema(){return Xt}static get ErrorTypes(){return pe}static get ErrorDetails(){return z}static get DefaultConfig(){return rn.defaultConfig?rn.defaultConfig:dC}static set DefaultConfig(e){rn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Kd,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=XR(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=gC(rn.DefaultConfig,e,t);this.userConfig=e,i.progressive&&mC(i,t);const{abrController:s,bufferController:l,capLevelController:o,errorController:c,fpsController:h}=i,f=new c(this),g=this.abrController=new s(this),m=new GL(this),y=i.interstitialsController,S=y?this.interstitialsController=new y(this,rn):null,E=this.bufferController=new l(this,m),x=this.capLevelController=new o(this),T=new h(this),R=new IC(this),D=i.contentSteeringController,A=D?new D(this):null,O=this.levelController=new AC(this,A),I=new xC(this),N=new CC(this.config),M=this.streamController=new DC(this,m,N),F=this.gapController=new EC(this,m);x.setStreamController(M),T.setStreamController(M);const H=[R,O,M];S&&H.splice(1,0,S),A&&H.splice(1,0,A),this.networkControllers=H;const B=[g,E,F,x,T,I,m];this.audioTrackController=this.createController(i.audioTrackController,H);const ie=i.audioStreamController;ie&&H.push(this.audioStreamController=new ie(this,m,N)),this.subtitleTrackController=this.createController(i.subtitleTrackController,H);const ae=i.subtitleStreamController;ae&&H.push(this.subtititleStreamController=new ae(this,m,N)),this.createController(i.timelineController,B),N.emeController=this.emeController=this.createController(i.emeController,B),this.cmcdController=this.createController(i.cmcdController,B),this.latencyController=this.createController(bC,B),this.coreComponents=B,H.push(f);const ve=f.onErrorOut;typeof ve=="function"&&this.on(b.ERROR,ve,f),this.on(b.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,s){this._emitter.off(e,t,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===b.ERROR;this.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(b.ERROR,{type:pe.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,s=t?e:{media:i};this._media=i,this.trigger(b.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(b.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,s=this._url=Pd.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(b.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[me.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[me.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[me.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=F1()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){AL(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,i)for(let l=s;l--;){const o=e[l].attrs["HDCP-LEVEL"];if(o&&o<=i)return l}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=jv(t);return Gv(e,i,navigator.mediaCapabilities)}}rn.defaultConfig=void 0;const By=[{name:"Playlist 1 (IPTV-org)",url:"https://iptv-org.github.io/iptv/index.m3u"},{name:"Playlist 2 (TVPass)",url:"https://tvpass.org/playlist/m3u"}],wC=()=>{const[a,e]=$.useState([]),[t,i]=$.useState(By[0].url),[s,l]=$.useState(null),[o,c]=$.useState(null),h=$.useRef();$.useEffect(()=>{t&&(e([]),l(null),c(null),fetch(t).then(g=>g.text()).then(g=>{const m=f(g);m.length===0?c("No valid channels found."):(e(m),l(m[0].url))}).catch(g=>{console.error("Error loading playlist:",g),c("Failed to load playlist.")}))},[t]),$.useEffect(()=>{if(!s||!h.current)return;const g=s;if(rn.isSupported()){const m=new rn;return m.loadSource(g),m.attachMedia(h.current),()=>m.destroy()}else h.current.canPlayType("application/vnd.apple.mpegurl")?h.current.src=g:c("Your browser doesn't support HLS.")},[s]);const f=g=>{var S,E;const m=g.split(`
`),y=[];for(let x=0;x<m.length;x++)if(m[x].startsWith("#EXTINF")){const T=((S=m[x].split(",")[1])==null?void 0:S.trim())||`Channel ${x}`,R=(E=m[x+1])==null?void 0:E.trim();R!=null&&R.startsWith("http")&&y.push({title:T,url:R})}return y};return _.jsxs("div",{className:"livetv-container",children:[_.jsx(un,{}),_.jsx("h2",{children:"Live TV"}),o&&_.jsx("p",{className:"error",children:o}),_.jsxs("div",{className:"playlist-selector",children:[_.jsx("label",{children:"Select Playlist:"}),_.jsx("select",{onChange:g=>i(g.target.value),value:t,children:By.map((g,m)=>_.jsx("option",{value:g.url,children:g.name},m))})]}),a.length>0&&_.jsxs("div",{className:"channel-selector",children:[_.jsx("label",{children:"Select Channel:"}),_.jsx("select",{onChange:g=>l(g.target.value),value:s||"",children:a.map((g,m)=>_.jsx("option",{value:g.url,children:g.title},m))})]}),_.jsx("div",{className:"video-player",children:_.jsx("video",{ref:h,controls:!0,autoPlay:!0,width:"100%",height:"auto",style:{backgroundColor:"#111"}})}),_.jsx(cn,{})]})};function OC(){return _.jsx(Ob,{children:_.jsxs(ub,{children:[_.jsx(Dt,{path:"/",element:_.jsx(vR,{})}),_.jsx(Dt,{path:"/login",element:_.jsx(ER,{})}),_.jsx(Dt,{path:"/register",element:_.jsx(SR,{})}),_.jsxs(Dt,{path:"/movies",element:_.jsx(xR,{}),children:[_.jsx(Dt,{path:"genre/:genre_id",element:_.jsx(AR,{})}),_.jsx(Dt,{path:"details/:id",element:_.jsx(RR,{})})]}),_.jsxs(Dt,{path:"/tv",element:_.jsx(DR,{}),children:[_.jsx(Dt,{path:"genre/:genre_id",element:_.jsx(wR,{})}),_.jsx(Dt,{path:":id",element:_.jsx(CR,{})})]}),_.jsxs(Dt,{path:"/anime",element:_.jsx(kR,{}),children:[_.jsx(Dt,{path:"genre/:genre",element:_.jsx(MR,{})}),_.jsx(Dt,{path:"details/:anime_id",element:_.jsx(PR,{})})]}),_.jsx(Dt,{path:"/search",element:_.jsx($R,{})}),_.jsx(Dt,{path:"/live-tv",element:_.jsx(wC,{})}),_.jsx(Dt,{path:"*",element:_.jsx(NR,{})})]})})}yx.createRoot(document.getElementById("root")).render(_.jsx($.StrictMode,{children:_.jsx(OC,{})}));
